"use strict";
var StrMap = require("backpack-node").collections.StrMap;
var specStrings = require("../common/specStrings");
var is = require("../common/is");
function InstIdPaths() {
  this._map = new StrMap();
}
InstIdPaths.prototype.add = function(workflowName, methodName, instanceIdPath) {
  var key = specStrings.hosting.doubleKeys(workflowName, methodName);
  var inner = this._map.get(key);
  if (!inner) {
    inner = new StrMap();
    this._map.add(key, inner);
  }
  var count = inner.get(instanceIdPath);
  if (is.undefined(count)) {
    inner.add(instanceIdPath, 1);
  } else {
    inner.set(instanceIdPath, count + 1);
  }
};
InstIdPaths.prototype.remove = function(workflowName, methodName, instanceIdPath) {
  var key = specStrings.hosting.doubleKeys(workflowName, methodName);
  var inner = this._map.get(key);
  if (inner) {
    var count = inner.get(instanceIdPath);
    if (is.defined(count)) {
      if (count === 1) {
        this._map.remove(key);
      } else {
        inner.set(instanceIdPath, count - 1);
      }
    }
  }
  return false;
};
InstIdPaths.prototype.forEach = function(workflowName, methodName, f) {
  var key = specStrings.hosting.doubleKeys(workflowName, methodName);
  var inner = this._map.get(key);
  if (inner)
    inner.forEachKey(f);
};
module.exports = InstIdPaths;
//# sourceMappingURL=data:application/json;base64,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LENBQUM7QUFDOUIsS0FBSSxLQUFJO0FBQUcsUUFBSSxXQUFXLEFBQUMsQ0FBQyxDQUFBLENBQUMsQ0FBQztBQUFBLEFBQ2xDLENBQUE7QUFFQSxLQUFLLFFBQVEsRUFBSSxZQUFVLENBQUM7QUFDNUIiLCJmaWxlIjoiaG9zdGluZy9pbnN0SWRQYXRocy5qcyIsInNvdXJjZVJvb3QiOiJsaWIvZXM2Iiwic291cmNlc0NvbnRlbnQiOlsidmFyIFN0ck1hcCA9IHJlcXVpcmUoXCJiYWNrcGFjay1ub2RlXCIpLmNvbGxlY3Rpb25zLlN0ck1hcDtcbnZhciBzcGVjU3RyaW5ncyA9IHJlcXVpcmUoXCIuLi9jb21tb24vc3BlY1N0cmluZ3NcIik7XG52YXIgaXMgPSByZXF1aXJlKFwiLi4vY29tbW9uL2lzXCIpO1xuXG5mdW5jdGlvbiBJbnN0SWRQYXRocygpIHtcbiAgICB0aGlzLl9tYXAgPSBuZXcgU3RyTWFwKCk7XG59XG5cbkluc3RJZFBhdGhzLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAod29ya2Zsb3dOYW1lLCBtZXRob2ROYW1lLCBpbnN0YW5jZUlkUGF0aCkge1xuICAgIHZhciBrZXkgPSBzcGVjU3RyaW5ncy5ob3N0aW5nLmRvdWJsZUtleXMod29ya2Zsb3dOYW1lLCBtZXRob2ROYW1lKTtcbiAgICB2YXIgaW5uZXIgPSB0aGlzLl9tYXAuZ2V0KGtleSk7XG4gICAgaWYgKCFpbm5lcikge1xuICAgICAgICBpbm5lciA9IG5ldyBTdHJNYXAoKTtcbiAgICAgICAgdGhpcy5fbWFwLmFkZChrZXksIGlubmVyKTtcbiAgICB9XG4gICAgdmFyIGNvdW50ID0gaW5uZXIuZ2V0KGluc3RhbmNlSWRQYXRoKTtcbiAgICBpZiAoaXMudW5kZWZpbmVkKGNvdW50KSkge1xuICAgICAgICBpbm5lci5hZGQoaW5zdGFuY2VJZFBhdGgsIDEpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaW5uZXIuc2V0KGluc3RhbmNlSWRQYXRoLCBjb3VudCArIDEpO1xuICAgIH1cbn1cblxuSW5zdElkUGF0aHMucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICh3b3JrZmxvd05hbWUsIG1ldGhvZE5hbWUsIGluc3RhbmNlSWRQYXRoKSB7XG4gICAgdmFyIGtleSA9IHNwZWNTdHJpbmdzLmhvc3RpbmcuZG91YmxlS2V5cyh3b3JrZmxvd05hbWUsIG1ldGhvZE5hbWUpO1xuICAgIHZhciBpbm5lciA9IHRoaXMuX21hcC5nZXQoa2V5KTtcbiAgICBpZiAoaW5uZXIpIHtcbiAgICAgICAgdmFyIGNvdW50ID0gaW5uZXIuZ2V0KGluc3RhbmNlSWRQYXRoKTtcbiAgICAgICAgaWYgKGlzLmRlZmluZWQoY291bnQpKSB7XG4gICAgICAgICAgICBpZiAoY291bnQgPT09IDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9tYXAucmVtb3ZlKGtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpbm5lci5zZXQoaW5zdGFuY2VJZFBhdGgsIGNvdW50IC0gMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG5JbnN0SWRQYXRocy5wcm90b3R5cGUuZm9yRWFjaCA9IGZ1bmN0aW9uICh3b3JrZmxvd05hbWUsIG1ldGhvZE5hbWUsIGYpIHtcbiAgICB2YXIga2V5ID0gc3BlY1N0cmluZ3MuaG9zdGluZy5kb3VibGVLZXlzKHdvcmtmbG93TmFtZSwgbWV0aG9kTmFtZSk7XG4gICAgdmFyIGlubmVyID0gdGhpcy5fbWFwLmdldChrZXkpO1xuICAgIGlmIChpbm5lcikgaW5uZXIuZm9yRWFjaEtleShmKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBJbnN0SWRQYXRocztcbiJdfQ==
