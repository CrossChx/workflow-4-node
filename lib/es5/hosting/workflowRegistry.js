"use strict";
var Workflow = require("../activities/workflow");
var _ = require("lodash");
var BeginMethod = require("../activities/beginMethod");
var EndMethod = require("../activities/endMethod");
var is = require("../common/is");
var ActivityExecutionContext = require("../activities/activityExecutionContext");
var activityMarkup = require("../activities/activityMarkup");
var Serializer = require("backpack-node").system.Serializer;
var crypto = require("crypto");
var assert = require("better-assert");
function WorkflowRegistry(serializer) {
  this._workflows = new Map();
  this._serializer = serializer || new Serializer();
}
WorkflowRegistry.prototype.register = function(workflow, deprecated) {
  if (_.isPlainObject(workflow)) {
    workflow = activityMarkup.parse(workflow);
  }
  if (workflow instanceof Workflow) {
    if (!_(workflow.name).isString()) {
      throw new TypeError("Workflow name is not a string.");
    }
    var name = workflow.name.trim();
    if (!name) {
      throw new TypeError("Workflow name is empty.");
    }
    var execContext = new ActivityExecutionContext();
    execContext.initialize(workflow);
    var version = this._computeVersion(execContext, workflow);
    var entry = this._workflows.get(name);
    var desc;
    if (entry) {
      desc = entry.get(version);
      if (desc) {
        throw new Error("Workflow " + name + " (" + version + ") already registered.");
      } else {
        if (!deprecated) {
          var $__4 = true;
          var $__5 = false;
          var $__6 = undefined;
          try {
            for (var $__2 = void 0,
                $__1 = (entry.values())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
              desc = $__2.value;
              {
                if (!desc.deprecated) {
                  throw new Error("Workflow " + name + " (" + version + ") has an already registered undeprecated version.");
                }
              }
            }
          } catch ($__7) {
            $__5 = true;
            $__6 = $__7;
          } finally {
            try {
              if (!$__4 && $__1.return != null) {
                $__1.return();
              }
            } finally {
              if ($__5) {
                throw $__6;
              }
            }
          }
        }
        desc = this._createDesc(execContext, workflow, name, version, deprecated);
        entry.set(version, desc);
      }
    } else {
      entry = new Map();
      desc = this._createDesc(execContext, workflow, name, version, deprecated);
      entry.set(version, desc);
      this._workflows.set(name, entry);
    }
    return desc;
  } else {
    throw new TypeError("Workflow instance argument expected.");
  }
};
WorkflowRegistry.prototype.getDesc = function(name, version) {
  var entry = this._workflows.get(name);
  if (entry) {
    if (!_.isUndefined(version)) {
      var desc = entry.get(version);
      if (desc) {
        return desc;
      }
      throw new Error("Workflow " + name + " of version " + version + " has not been registered.");
    } else {
      var desc$__15 = null;
      var $__4 = true;
      var $__5 = false;
      var $__6 = undefined;
      try {
        for (var $__2 = void 0,
            $__1 = (entry.values())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
          var d = $__2.value;
          {
            if (!d.deprecated) {
              desc$__15 = d;
              break;
            }
          }
        }
      } catch ($__7) {
        $__5 = true;
        $__6 = $__7;
      } finally {
        try {
          if (!$__4 && $__1.return != null) {
            $__1.return();
          }
        } finally {
          if ($__5) {
            throw $__6;
          }
        }
      }
      if (desc$__15) {
        return desc$__15;
      }
      throw new Error("Workflow " + name + " hasn't got an undeprecated version registered.");
    }
  }
};
WorkflowRegistry.prototype.getCurrentVersion = function(workflowName) {
  var result = [];
  var entry = this._workflows.get(workflowName);
  if (entry) {
    var desc = null;
    var $__4 = true;
    var $__5 = false;
    var $__6 = undefined;
    try {
      for (var $__2 = void 0,
          $__1 = (entry.values())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
        var d = $__2.value;
        {
          if (!d.deprecated) {
            desc = d;
            break;
          }
        }
      }
    } catch ($__7) {
      $__5 = true;
      $__6 = $__7;
    } finally {
      try {
        if (!$__4 && $__1.return != null) {
          $__1.return();
        }
      } finally {
        if ($__5) {
          throw $__6;
        }
      }
    }
    if (desc) {
      return desc.version;
    }
  }
  return null;
};
WorkflowRegistry.prototype._createDesc = function(execContext, workflow, name, version, deprecated) {
  return {
    workflow: workflow,
    name: name,
    version: version,
    methods: this._collectMethodInfos(execContext, workflow, version),
    deprecated: deprecated
  };
};
WorkflowRegistry.prototype._collectMethodInfos = function(execContext, workflow, version) {
  var self = this;
  var infos = new Map();
  var $__4 = true;
  var $__5 = false;
  var $__6 = undefined;
  try {
    for (var $__2 = void 0,
        $__1 = (workflow.children(execContext))[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
      var child = $__2.value;
      {
        var isBM = child instanceof BeginMethod;
        var isEM = child instanceof EndMethod;
        if (isBM || isEM) {
          var methodName = _.isString(child.methodName) ? child.methodName.trim() : null;
          var instanceIdPath = _.isString(child.instanceIdPath) ? child.instanceIdPath.trim() : null;
          if (methodName) {
            var info = infos.get(methodName);
            if (!info) {
              info = {
                workflow: workflow,
                version: version,
                canCreateInstance: false,
                instanceIdPath: null
              };
              infos.set(methodName, info);
            }
            if (isBM && child.canCreateInstance) {
              info.canCreateInstance = true;
            }
            if (instanceIdPath) {
              if (info.instanceIdPath) {
                if (info.instanceIdPath !== instanceIdPath) {
                  throw new Error("Method '" + methodName + "' in workflow '" + workflow.name + "' has multiple different instanceIdPath value which is not supported.");
                }
              } else {
                info.instanceIdPath = instanceIdPath;
              }
            }
          }
        }
      }
    }
  } catch ($__7) {
    $__5 = true;
    $__6 = $__7;
  } finally {
    try {
      if (!$__4 && $__1.return != null) {
        $__1.return();
      }
    } finally {
      if ($__5) {
        throw $__6;
      }
    }
  }
  var result = new Map();
  var $__11 = true;
  var $__12 = false;
  var $__13 = undefined;
  try {
    for (var $__9 = void 0,
        $__8 = (infos.entries())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__11 = ($__9 = $__8.next()).done); $__11 = true) {
      var kvp = $__9.value;
      {
        if (kvp[1].instanceIdPath) {
          result.set(kvp[0], kvp[1]);
        }
      }
    }
  } catch ($__14) {
    $__12 = true;
    $__13 = $__14;
  } finally {
    try {
      if (!$__11 && $__8.return != null) {
        $__8.return();
      }
    } finally {
      if ($__12) {
        throw $__13;
      }
    }
  }
  return result;
};
WorkflowRegistry.prototype.methodInfos = $traceurRuntime.initGeneratorFunction(function $__16(workflowName, methodName) {
  var entry,
      $__4,
      $__5,
      $__6,
      $__2,
      $__1,
      desc,
      info,
      $__7;
  return $traceurRuntime.createGeneratorInstance(function($ctx) {
    while (true)
      switch ($ctx.state) {
        case 0:
          entry = this._workflows.get(workflowName);
          $ctx.state = 30;
          break;
        case 30:
          $ctx.state = (entry) ? 26 : -2;
          break;
        case 26:
          $__4 = true;
          $__5 = false;
          $__6 = undefined;
          $ctx.state = 27;
          break;
        case 27:
          $ctx.pushTry(13, 14);
          $ctx.state = 16;
          break;
        case 16:
          $__2 = void 0, $__1 = (entry.values())[$traceurRuntime.toProperty(Symbol.iterator)]();
          $ctx.state = 12;
          break;
        case 12:
          $ctx.state = (!($__4 = ($__2 = $__1.next()).done)) ? 8 : 10;
          break;
        case 4:
          $__4 = true;
          $ctx.state = 12;
          break;
        case 8:
          desc = $__2.value;
          $ctx.state = 9;
          break;
        case 9:
          info = desc.methods.get(methodName);
          $ctx.state = 7;
          break;
        case 7:
          $ctx.state = (info) ? 1 : 4;
          break;
        case 1:
          $ctx.state = 2;
          return info;
        case 2:
          $ctx.maybeThrow();
          $ctx.state = 4;
          break;
        case 10:
          $ctx.popTry();
          $ctx.state = 14;
          $ctx.finallyFallThrough = -2;
          break;
        case 13:
          $ctx.popTry();
          $ctx.maybeUncatchable();
          $__7 = $ctx.storedException;
          $ctx.state = 19;
          break;
        case 19:
          $__5 = true;
          $__6 = $__7;
          $ctx.state = 14;
          $ctx.finallyFallThrough = -2;
          break;
        case 14:
          $ctx.popTry();
          $ctx.state = 25;
          break;
        case 25:
          try {
            if (!$__4 && $__1.return != null) {
              $__1.return();
            }
          } finally {
            if ($__5) {
              throw $__6;
            }
          }
          $ctx.state = 23;
          break;
        case 23:
          $ctx.state = $ctx.finallyFallThrough;
          break;
        default:
          return $ctx.end();
      }
  }, $__16, this);
});
WorkflowRegistry.prototype._computeVersion = function(execContext, workflow) {
  var self = this;
  var sha = crypto.createHash("sha256");
  function add(value) {
    if (!_.isNull(value)) {
      value = self._serializer.stringify(value);
      sha.update(value);
    }
  }
  var $__11 = true;
  var $__12 = false;
  var $__13 = undefined;
  try {
    for (var $__9 = void 0,
        $__8 = (workflow.all(execContext))[$traceurRuntime.toProperty(Symbol.iterator)](); !($__11 = ($__9 = $__8.next()).done); $__11 = true) {
      var activity = $__9.value;
      {
        var alias = activityMarkup.getAlias(activity);
        assert(alias);
        add(alias);
        for (var key = void 0 in activity) {
          if (activity.hasOwnProperty(key) && !activity.nonScopedProperties.has(key) && !activity.nonSerializedProperties.has(key)) {
            var value = activity[key];
            if (!is.activity(value)) {
              if (_.isArray(value)) {
                var $__4 = true;
                var $__5 = false;
                var $__6 = undefined;
                try {
                  for (var $__2 = void 0,
                      $__1 = (value)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
                    var item = $__2.value;
                    {
                      if (!is.activity(item)) {
                        add(value);
                      }
                    }
                  }
                } catch ($__7) {
                  $__5 = true;
                  $__6 = $__7;
                } finally {
                  try {
                    if (!$__4 && $__1.return != null) {
                      $__1.return();
                    }
                  } finally {
                    if ($__5) {
                      throw $__6;
                    }
                  }
                }
              } else {
                add(value);
              }
            }
          }
        }
      }
    }
  } catch ($__14) {
    $__12 = true;
    $__13 = $__14;
  } finally {
    try {
      if (!$__11 && $__8.return != null) {
        $__8.return();
      }
    } finally {
      if ($__12) {
        throw $__13;
      }
    }
  }
  return sha.digest("base64");
};
module.exports = WorkflowRegistry;
//# sourceMappingURL=data:application/json;base64,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aUIsR0FBSyxDQUFBLFdBQXVCLEdBQUssS0FBRyxDQUFHO0FBQzFELGdDQUF3QixBQUFDLEVBQUMsQ0FBQztvQkFDN0I7QUFBQSxrQkFDRixDQUFFLE9BQVE7QUFDUiw0QkFBd0I7QUFDdEIsZ0NBQXdCO29CQUMxQjtBQUFBLGtCQUNGO0FBQUEsZ0JBQ0Y7QUFBQSxjQXVMWSxLQUNLO0FBQ0Qsa0JBQUUsQUFBQyxDQUFDLEtBQUksQ0FBQyxDQUFDO2NBQ2Q7QUFBQSxZQUNKO0FBQUEsVUFDSjtBQUFBLFFBQ0o7QUFBQSxNQUNKO0lBek1JO0FBQUEsRUFGQSxDQUFFLGFBQTBCO0FBQzFCLFVBQW9CLEtBQUcsQ0FBQztBQUN4QixnQkFBb0MsQ0FBQztFQUN2QyxDQUFFLE9BQVE7QUFDUixNQUFJO0FBQ0YsU0FBSSxNQUFpQixHQUFLLENBQUEsV0FBdUIsR0FBSyxLQUFHLENBQUc7QUFDMUQsa0JBQXdCLEFBQUMsRUFBQyxDQUFDO01BQzdCO0FBQUEsSUFDRixDQUFFLE9BQVE7QUFDUixlQUF3QjtBQUN0QixtQkFBd0I7TUFDMUI7QUFBQSxJQUNGO0FBQUEsRUFDRjtBQUFBLEFBK0xKLE9BQU8sQ0FBQSxHQUFFLE9BQU8sQUFBQyxDQUFDLFFBQU8sQ0FBQyxDQUFDO0FBQy9CLENBQUM7QUFFRCxLQUFLLFFBQVEsRUFBSSxpQkFBZSxDQUFDO0FBQ2pDIiwiZmlsZSI6Imhvc3Rpbmcvd29ya2Zsb3dSZWdpc3RyeS5qcyIsInNvdXJjZVJvb3QiOiJsaWIvZXM2Iiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmxldCBXb3JrZmxvdyA9IHJlcXVpcmUoXCIuLi9hY3Rpdml0aWVzL3dvcmtmbG93XCIpO1xubGV0IF8gPSByZXF1aXJlKFwibG9kYXNoXCIpO1xubGV0IEJlZ2luTWV0aG9kID0gcmVxdWlyZShcIi4uL2FjdGl2aXRpZXMvYmVnaW5NZXRob2RcIik7XG5sZXQgRW5kTWV0aG9kID0gcmVxdWlyZShcIi4uL2FjdGl2aXRpZXMvZW5kTWV0aG9kXCIpO1xubGV0IGlzID0gcmVxdWlyZShcIi4uL2NvbW1vbi9pc1wiKTtcbmxldCBBY3Rpdml0eUV4ZWN1dGlvbkNvbnRleHQgPSByZXF1aXJlKFwiLi4vYWN0aXZpdGllcy9hY3Rpdml0eUV4ZWN1dGlvbkNvbnRleHRcIik7XG5sZXQgYWN0aXZpdHlNYXJrdXAgPSByZXF1aXJlKFwiLi4vYWN0aXZpdGllcy9hY3Rpdml0eU1hcmt1cFwiKTtcbmxldCBTZXJpYWxpemVyID0gcmVxdWlyZShcImJhY2twYWNrLW5vZGVcIikuc3lzdGVtLlNlcmlhbGl6ZXI7XG5sZXQgY3J5cHRvID0gcmVxdWlyZShcImNyeXB0b1wiKTtcbmxldCBhc3NlcnQgPSByZXF1aXJlKFwiYmV0dGVyLWFzc2VydFwiKTtcblxuZnVuY3Rpb24gV29ya2Zsb3dSZWdpc3RyeShzZXJpYWxpemVyKSB7XG4gICAgdGhpcy5fd29ya2Zsb3dzID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuX3NlcmlhbGl6ZXIgPSBzZXJpYWxpemVyIHx8IG5ldyBTZXJpYWxpemVyKCk7XG59XG5cbldvcmtmbG93UmVnaXN0cnkucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHdvcmtmbG93LCBkZXByZWNhdGVkKSB7XG4gICAgaWYgKF8uaXNQbGFpbk9iamVjdCh3b3JrZmxvdykpIHtcbiAgICAgICAgd29ya2Zsb3cgPSBhY3Rpdml0eU1hcmt1cC5wYXJzZSh3b3JrZmxvdyk7XG4gICAgfVxuICAgIGlmICh3b3JrZmxvdyBpbnN0YW5jZW9mIFdvcmtmbG93KSB7XG4gICAgICAgIGlmICghXyh3b3JrZmxvdy5uYW1lKS5pc1N0cmluZygpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiV29ya2Zsb3cgbmFtZSBpcyBub3QgYSBzdHJpbmcuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBuYW1lID0gd29ya2Zsb3cubmFtZS50cmltKCk7XG4gICAgICAgIGlmICghbmFtZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIldvcmtmbG93IG5hbWUgaXMgZW1wdHkuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBleGVjQ29udGV4dCA9IG5ldyBBY3Rpdml0eUV4ZWN1dGlvbkNvbnRleHQoKTtcbiAgICAgICAgZXhlY0NvbnRleHQuaW5pdGlhbGl6ZSh3b3JrZmxvdyk7XG4gICAgICAgIGxldCB2ZXJzaW9uID0gdGhpcy5fY29tcHV0ZVZlcnNpb24oZXhlY0NvbnRleHQsIHdvcmtmbG93KTtcbiAgICAgICAgbGV0IGVudHJ5ID0gdGhpcy5fd29ya2Zsb3dzLmdldChuYW1lKTtcbiAgICAgICAgbGV0IGRlc2M7XG4gICAgICAgIGlmIChlbnRyeSkge1xuICAgICAgICAgICAgZGVzYyA9IGVudHJ5LmdldCh2ZXJzaW9uKTtcbiAgICAgICAgICAgIGlmIChkZXNjKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiV29ya2Zsb3cgXCIgKyBuYW1lICsgXCIgKFwiICsgdmVyc2lvbiArIFwiKSBhbHJlYWR5IHJlZ2lzdGVyZWQuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKCFkZXByZWNhdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoZGVzYyBvZiBlbnRyeS52YWx1ZXMoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFkZXNjLmRlcHJlY2F0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJXb3JrZmxvdyBcIiArIG5hbWUgKyBcIiAoXCIgKyB2ZXJzaW9uICsgXCIpIGhhcyBhbiBhbHJlYWR5IHJlZ2lzdGVyZWQgdW5kZXByZWNhdGVkIHZlcnNpb24uXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRlc2MgPSB0aGlzLl9jcmVhdGVEZXNjKGV4ZWNDb250ZXh0LCB3b3JrZmxvdywgbmFtZSwgdmVyc2lvbiwgZGVwcmVjYXRlZCk7XG4gICAgICAgICAgICAgICAgZW50cnkuc2V0KHZlcnNpb24sIGRlc2MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZW50cnkgPSBuZXcgTWFwKCk7XG4gICAgICAgICAgICBkZXNjID0gdGhpcy5fY3JlYXRlRGVzYyhleGVjQ29udGV4dCwgd29ya2Zsb3csIG5hbWUsIHZlcnNpb24sIGRlcHJlY2F0ZWQpO1xuICAgICAgICAgICAgZW50cnkuc2V0KHZlcnNpb24sIGRlc2MpO1xuICAgICAgICAgICAgdGhpcy5fd29ya2Zsb3dzLnNldChuYW1lLCBlbnRyeSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlc2M7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiV29ya2Zsb3cgaW5zdGFuY2UgYXJndW1lbnQgZXhwZWN0ZWQuXCIpO1xuICAgIH1cbn07XG5cbldvcmtmbG93UmVnaXN0cnkucHJvdG90eXBlLmdldERlc2MgPSBmdW5jdGlvbiAobmFtZSwgdmVyc2lvbikge1xuICAgIGxldCBlbnRyeSA9IHRoaXMuX3dvcmtmbG93cy5nZXQobmFtZSk7XG4gICAgaWYgKGVudHJ5KSB7XG4gICAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh2ZXJzaW9uKSkge1xuICAgICAgICAgICAgbGV0IGRlc2MgPSBlbnRyeS5nZXQodmVyc2lvbik7XG4gICAgICAgICAgICBpZiAoZGVzYykge1xuICAgICAgICAgICAgICAgIHJldHVybiBkZXNjO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiV29ya2Zsb3cgXCIgKyBuYW1lICsgXCIgb2YgdmVyc2lvbiBcIiArIHZlcnNpb24gKyBcIiBoYXMgbm90IGJlZW4gcmVnaXN0ZXJlZC5cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBHZXQgdW5kZXByZWNhdGVkXG4gICAgICAgICAgICBsZXQgZGVzYyA9IG51bGw7XG4gICAgICAgICAgICBmb3IgKGxldCBkIG9mIGVudHJ5LnZhbHVlcygpKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFkLmRlcHJlY2F0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVzYyA9IGQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkZXNjKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlc2M7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJXb3JrZmxvdyBcIiArIG5hbWUgKyBcIiBoYXNuJ3QgZ290IGFuIHVuZGVwcmVjYXRlZCB2ZXJzaW9uIHJlZ2lzdGVyZWQuXCIpO1xuICAgICAgICB9XG4gICAgfVxufTtcblxuV29ya2Zsb3dSZWdpc3RyeS5wcm90b3R5cGUuZ2V0Q3VycmVudFZlcnNpb24gPSBmdW5jdGlvbiAod29ya2Zsb3dOYW1lKSB7XG4gICAgbGV0IHJlc3VsdCA9IFtdO1xuICAgIGxldCBlbnRyeSA9IHRoaXMuX3dvcmtmbG93cy5nZXQod29ya2Zsb3dOYW1lKTtcbiAgICBpZiAoZW50cnkpIHtcbiAgICAgICAgbGV0IGRlc2MgPSBudWxsO1xuICAgICAgICBmb3IgKGxldCBkIG9mIGVudHJ5LnZhbHVlcygpKSB7XG4gICAgICAgICAgICBpZiAoIWQuZGVwcmVjYXRlZCkge1xuICAgICAgICAgICAgICAgIGRlc2MgPSBkO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChkZXNjKSB7XG4gICAgICAgICAgICByZXR1cm4gZGVzYy52ZXJzaW9uO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufTtcblxuV29ya2Zsb3dSZWdpc3RyeS5wcm90b3R5cGUuX2NyZWF0ZURlc2MgPSBmdW5jdGlvbiAoZXhlY0NvbnRleHQsIHdvcmtmbG93LCBuYW1lLCB2ZXJzaW9uLCBkZXByZWNhdGVkKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgd29ya2Zsb3c6IHdvcmtmbG93LFxuICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uLFxuICAgICAgICBtZXRob2RzOiB0aGlzLl9jb2xsZWN0TWV0aG9kSW5mb3MoZXhlY0NvbnRleHQsIHdvcmtmbG93LCB2ZXJzaW9uKSxcbiAgICAgICAgZGVwcmVjYXRlZDogZGVwcmVjYXRlZFxuICAgIH07XG59O1xuXG5Xb3JrZmxvd1JlZ2lzdHJ5LnByb3RvdHlwZS5fY29sbGVjdE1ldGhvZEluZm9zID0gZnVuY3Rpb24gKGV4ZWNDb250ZXh0LCB3b3JrZmxvdywgdmVyc2lvbikge1xuICAgIGxldCBzZWxmID0gdGhpcztcbiAgICBsZXQgaW5mb3MgPSBuZXcgTWFwKCk7XG4gICAgZm9yIChsZXQgY2hpbGQgb2Ygd29ya2Zsb3cuY2hpbGRyZW4oZXhlY0NvbnRleHQpKSB7XG4gICAgICAgIGxldCBpc0JNID0gY2hpbGQgaW5zdGFuY2VvZiBCZWdpbk1ldGhvZDtcbiAgICAgICAgbGV0IGlzRU0gPSBjaGlsZCBpbnN0YW5jZW9mIEVuZE1ldGhvZDtcbiAgICAgICAgaWYgKGlzQk0gfHwgaXNFTSkge1xuICAgICAgICAgICAgbGV0IG1ldGhvZE5hbWUgPSBfLmlzU3RyaW5nKGNoaWxkLm1ldGhvZE5hbWUpID8gY2hpbGQubWV0aG9kTmFtZS50cmltKCkgOiBudWxsO1xuICAgICAgICAgICAgbGV0IGluc3RhbmNlSWRQYXRoID0gXy5pc1N0cmluZyhjaGlsZC5pbnN0YW5jZUlkUGF0aCkgPyBjaGlsZC5pbnN0YW5jZUlkUGF0aC50cmltKCkgOiBudWxsO1xuICAgICAgICAgICAgaWYgKG1ldGhvZE5hbWUpIHtcbiAgICAgICAgICAgICAgICBsZXQgaW5mbyA9IGluZm9zLmdldChtZXRob2ROYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAoIWluZm8pIHtcbiAgICAgICAgICAgICAgICAgICAgaW5mbyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtmbG93OiB3b3JrZmxvdyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb246IHZlcnNpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW5DcmVhdGVJbnN0YW5jZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZUlkUGF0aDogbnVsbFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBpbmZvcy5zZXQobWV0aG9kTmFtZSwgaW5mbyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpc0JNICYmIGNoaWxkLmNhbkNyZWF0ZUluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGluZm8uY2FuQ3JlYXRlSW5zdGFuY2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaW5zdGFuY2VJZFBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8uaW5zdGFuY2VJZFBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmZvLmluc3RhbmNlSWRQYXRoICE9PSBpbnN0YW5jZUlkUGF0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCAnXCIgKyBtZXRob2ROYW1lICsgXCInIGluIHdvcmtmbG93ICdcIiArIHdvcmtmbG93Lm5hbWUgKyBcIicgaGFzIG11bHRpcGxlIGRpZmZlcmVudCBpbnN0YW5jZUlkUGF0aCB2YWx1ZSB3aGljaCBpcyBub3Qgc3VwcG9ydGVkLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZm8uaW5zdGFuY2VJZFBhdGggPSBpbnN0YW5jZUlkUGF0aDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBsZXQgcmVzdWx0ID0gbmV3IE1hcCgpO1xuICAgIGZvciAobGV0IGt2cCBvZiBpbmZvcy5lbnRyaWVzKCkpIHtcbiAgICAgICAgaWYgKGt2cFsxXS5pbnN0YW5jZUlkUGF0aCkge1xuICAgICAgICAgICAgcmVzdWx0LnNldChrdnBbMF0sIGt2cFsxXSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbldvcmtmbG93UmVnaXN0cnkucHJvdG90eXBlLm1ldGhvZEluZm9zID0gZnVuY3Rpb24qICh3b3JrZmxvd05hbWUsIG1ldGhvZE5hbWUpIHtcbiAgICBsZXQgZW50cnkgPSB0aGlzLl93b3JrZmxvd3MuZ2V0KHdvcmtmbG93TmFtZSk7XG4gICAgaWYgKGVudHJ5KSB7XG4gICAgICAgIGZvciAobGV0IGRlc2Mgb2YgZW50cnkudmFsdWVzKCkpIHtcbiAgICAgICAgICAgIGxldCBpbmZvID0gZGVzYy5tZXRob2RzLmdldChtZXRob2ROYW1lKTtcbiAgICAgICAgICAgIGlmIChpbmZvKSB7XG4gICAgICAgICAgICAgICAgeWllbGQgaW5mbztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn07XG5cbldvcmtmbG93UmVnaXN0cnkucHJvdG90eXBlLl9jb21wdXRlVmVyc2lvbiA9IGZ1bmN0aW9uKGV4ZWNDb250ZXh0LCB3b3JrZmxvdykge1xuICAgIGxldCBzZWxmID0gdGhpcztcbiAgICBsZXQgc2hhID0gY3J5cHRvLmNyZWF0ZUhhc2goXCJzaGEyNTZcIik7XG4gICAgZnVuY3Rpb24gYWRkKHZhbHVlKSB7XG4gICAgICAgIGlmICghXy5pc051bGwodmFsdWUpKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IHNlbGYuX3NlcmlhbGl6ZXIuc3RyaW5naWZ5KHZhbHVlKTtcbiAgICAgICAgICAgIHNoYS51cGRhdGUodmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZvciAobGV0IGFjdGl2aXR5IG9mIHdvcmtmbG93LmFsbChleGVjQ29udGV4dCkpIHtcbiAgICAgICAgbGV0IGFsaWFzID0gYWN0aXZpdHlNYXJrdXAuZ2V0QWxpYXMoYWN0aXZpdHkpO1xuICAgICAgICBhc3NlcnQoYWxpYXMpO1xuICAgICAgICBhZGQoYWxpYXMpO1xuICAgICAgICBmb3IgKGxldCBrZXkgaW4gYWN0aXZpdHkpIHtcbiAgICAgICAgICAgIGlmIChhY3Rpdml0eS5oYXNPd25Qcm9wZXJ0eShrZXkpICYmXG4gICAgICAgICAgICAgICAgIWFjdGl2aXR5Lm5vblNjb3BlZFByb3BlcnRpZXMuaGFzKGtleSkgJiZcbiAgICAgICAgICAgICAgICAhYWN0aXZpdHkubm9uU2VyaWFsaXplZFByb3BlcnRpZXMuaGFzKGtleSkpIHtcbiAgICAgICAgICAgICAgICBsZXQgdmFsdWUgPSBhY3Rpdml0eVtrZXldO1xuICAgICAgICAgICAgICAgIGlmICghaXMuYWN0aXZpdHkodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfLmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpdGVtIG9mIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpcy5hY3Rpdml0eShpdGVtKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGQodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHNoYS5kaWdlc3QoXCJiYXNlNjRcIik7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFdvcmtmbG93UmVnaXN0cnk7XG4iXX0=
