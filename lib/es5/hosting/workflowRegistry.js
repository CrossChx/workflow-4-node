"use strict";
var Workflow = require("../activities/workflow");
var _ = require("lodash");
var BeginMethod = require("../activities/beginMethod");
var EndMethod = require("../activities/endMethod");
var is = require("../common/is");
var ActivityExecutionContext = require("../activities/activityExecutionContext");
function WorkflowRegistry() {
  this._workflows = new Map();
}
WorkflowRegistry.prototype.register = function(workflow) {
  if (workflow instanceof Workflow) {
    if (!_(workflow.name).isString()) {
      throw new TypeError("Workflow name is not a string.");
    }
    var name = workflow.name.trim();
    if (!name) {
      throw new TypeError("Workflow name is empty.");
    }
    if (!_(workflow.version).isNumber()) {
      throw new TypeError("Workflow version is not a number.");
    }
    var version = workflow.version;
    var entry = this._workflows.get(name);
    if (entry) {
      var desc = entry.get(version);
      if (desc) {
        throw new Error("Workflow " + name + " " + version + " already registered.");
      } else {
        entry.set(version, this._createDesc(workflow, name, workflow.version));
      }
    } else {
      entry = new Map();
      entry.set(version, this._createDesc(workflow, name, workflow.version));
      this._workflows.set(name, entry);
    }
  } else {
    throw new TypeError("Workflow instance argument expected.");
  }
};
WorkflowRegistry.prototype.getDesc = function(name, version) {
  var entry = this._workflows.get(name);
  if (entry) {
    if (!_.isUndefined(version)) {
      var desc = entry.get(version);
      if (desc) {
        return desc;
      }
      throw new Error("Workflow " + name + " of version " + version + " has not been registered.");
    } else {
      var maxV = -10000000;
      var desc$__15 = null;
      var $__4 = true;
      var $__5 = false;
      var $__6 = undefined;
      try {
        for (var $__2 = void 0,
            $__1 = (entry.values())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
          var d = $__2.value;
          {
            if (d.version > maxV) {
              desc$__15 = d;
              break;
            }
          }
        }
      } catch ($__7) {
        $__5 = true;
        $__6 = $__7;
      } finally {
        try {
          if (!$__4 && $__1.return != null) {
            $__1.return();
          }
        } finally {
          if ($__5) {
            throw $__6;
          }
        }
      }
      if (desc$__15) {
        return desc$__15;
      }
      throw new Error("Workflow " + name + " has not been registered.");
    }
  }
};
WorkflowRegistry.prototype.getTopVersion = function(workflowName) {
  var result = [];
  var entry = this._workflows.get(workflowName);
  if (entry) {
    var $__4 = true;
    var $__5 = false;
    var $__6 = undefined;
    try {
      for (var $__2 = void 0,
          $__1 = (entry.keys())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
        var version = $__2.value;
        {
          result.push(version);
        }
      }
    } catch ($__7) {
      $__5 = true;
      $__6 = $__7;
    } finally {
      try {
        if (!$__4 && $__1.return != null) {
          $__1.return();
        }
      } finally {
        if ($__5) {
          throw $__6;
        }
      }
    }
  }
  if (result.length === 0) {
    return null;
  }
  result.sort();
  return result[result.length - 1];
};
WorkflowRegistry.prototype._createDesc = function(workflow, name, version) {
  return {
    workflow: workflow,
    name: name,
    version: version,
    methods: this._collectMethodInfos(workflow)
  };
};
WorkflowRegistry.prototype._collectMethodInfos = function(workflow) {
  var self = this;
  var infos = new Map();
  var execContext = new ActivityExecutionContext();
  execContext.initialize(workflow);
  var $__4 = true;
  var $__5 = false;
  var $__6 = undefined;
  try {
    for (var $__2 = void 0,
        $__1 = (workflow.children(execContext))[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
      var child = $__2.value;
      {
        var isBM = child instanceof BeginMethod;
        var isEM = child instanceof EndMethod;
        if (isBM || isEM) {
          var methodName = _.isString(child.methodName) ? child.methodName.trim() : null;
          var instanceIdPath = _.isString(child.instanceIdPath) ? child.instanceIdPath.trim() : null;
          if (methodName) {
            var info = infos.get(methodName);
            if (!info) {
              info = {
                workflow: workflow,
                canCreateInstance: false,
                instanceIdPath: null
              };
              infos.set(methodName, info);
            }
            if (isBM && child.canCreateInstance) {
              info.canCreateInstance = true;
            }
            if (instanceIdPath) {
              if (info.instanceIdPath) {
                if (info.instanceIdPath !== instanceIdPath) {
                  throw new Error("Method '" + methodName + "' in workflow '" + workflow.name + "' has multiple different instanceIdPath value which is not supported.");
                }
              } else {
                info.instanceIdPath = instanceIdPath;
              }
            }
          }
        }
      }
    }
  } catch ($__7) {
    $__5 = true;
    $__6 = $__7;
  } finally {
    try {
      if (!$__4 && $__1.return != null) {
        $__1.return();
      }
    } finally {
      if ($__5) {
        throw $__6;
      }
    }
  }
  var result = new Map();
  var $__11 = true;
  var $__12 = false;
  var $__13 = undefined;
  try {
    for (var $__9 = void 0,
        $__8 = (infos.entries())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__11 = ($__9 = $__8.next()).done); $__11 = true) {
      var kvp = $__9.value;
      {
        if (kvp[1].instanceIdPath) {
          result.set(kvp[0], kvp[1]);
        }
      }
    }
  } catch ($__14) {
    $__12 = true;
    $__13 = $__14;
  } finally {
    try {
      if (!$__11 && $__8.return != null) {
        $__8.return();
      }
    } finally {
      if ($__12) {
        throw $__13;
      }
    }
  }
  return result;
};
WorkflowRegistry.prototype.methodInfos = $traceurRuntime.initGeneratorFunction(function $__16(workflowName, methodName) {
  var entry,
      $__4,
      $__5,
      $__6,
      $__2,
      $__1,
      desc,
      info,
      $__7;
  return $traceurRuntime.createGeneratorInstance(function($ctx) {
    while (true)
      switch ($ctx.state) {
        case 0:
          entry = this._workflows.get(workflowName);
          $ctx.state = 30;
          break;
        case 30:
          $ctx.state = (entry) ? 26 : -2;
          break;
        case 26:
          $__4 = true;
          $__5 = false;
          $__6 = undefined;
          $ctx.state = 27;
          break;
        case 27:
          $ctx.pushTry(13, 14);
          $ctx.state = 16;
          break;
        case 16:
          $__2 = void 0, $__1 = (entry.values())[$traceurRuntime.toProperty(Symbol.iterator)]();
          $ctx.state = 12;
          break;
        case 12:
          $ctx.state = (!($__4 = ($__2 = $__1.next()).done)) ? 8 : 10;
          break;
        case 4:
          $__4 = true;
          $ctx.state = 12;
          break;
        case 8:
          desc = $__2.value;
          $ctx.state = 9;
          break;
        case 9:
          info = desc.methods.get(methodName);
          $ctx.state = 7;
          break;
        case 7:
          $ctx.state = (info) ? 1 : 4;
          break;
        case 1:
          $ctx.state = 2;
          return info;
        case 2:
          $ctx.maybeThrow();
          $ctx.state = 4;
          break;
        case 10:
          $ctx.popTry();
          $ctx.state = 14;
          $ctx.finallyFallThrough = -2;
          break;
        case 13:
          $ctx.popTry();
          $ctx.maybeUncatchable();
          $__7 = $ctx.storedException;
          $ctx.state = 19;
          break;
        case 19:
          $__5 = true;
          $__6 = $__7;
          $ctx.state = 14;
          $ctx.finallyFallThrough = -2;
          break;
        case 14:
          $ctx.popTry();
          $ctx.state = 25;
          break;
        case 25:
          try {
            if (!$__4 && $__1.return != null) {
              $__1.return();
            }
          } finally {
            if ($__5) {
              throw $__6;
            }
          }
          $ctx.state = 23;
          break;
        case 23:
          $ctx.state = $ctx.finallyFallThrough;
          break;
        default:
          return $ctx.end();
      }
  }, $__16, this);
});
module.exports = WorkflowRegistry;
//# sourceMappingURL=data:application/json;base64,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QW9CLEtBQUcsQ0FBQztBQUN4QixvQkFBb0MsQ0FBQzs7QUFSL0MsYUFBRyxtQkFBbUIsS0FBb0IsQ0FBQTs7O0FBQTFDLGFBQUcsT0FBTyxBQUFDLEVBQUMsQ0FBQzs7OztBQVVILFlBQUk7QUFDRixlQUFJLEtBQWlCLEdBQUssQ0FBQSxXQUF1QixHQUFLLEtBQUcsQ0FBRztBQUMxRCx3QkFBd0IsQUFBQyxFQUFDLENBQUM7WUFDN0I7QUFBQSxVQUNGLENBQUUsT0FBUTtBQUNSLG9CQUF3QjtBQUN0Qix3QkFBd0I7WUFDMUI7QUFBQSxVQUNGO0FBQUE7OztBQWpCWSxhQUFHLE1BQU0sRUFBSSxDQUFBLElBQUcsbUJBQW1CLENBQUM7QUFDcEMsZUFBSzs7QUFGM0IsZUFBTyxDQUFBLElBQUcsSUFBSSxBQUFDLEVBQUMsQ0FBQTs7QUFDbUIsRUFDL0IsUUFBNkIsS0FBRyxDQUFDLENBQUM7QUEwSnRDLENBNUp1RCxBQTRKdkQsQ0FBQztBQUVELEtBQUssUUFBUSxFQUFJLGlCQUFlLENBQUM7QUFDakMiLCJmaWxlIjoiaG9zdGluZy93b3JrZmxvd1JlZ2lzdHJ5LmpzIiwic291cmNlUm9vdCI6ImxpYi9lczYiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxubGV0IFdvcmtmbG93ID0gcmVxdWlyZShcIi4uL2FjdGl2aXRpZXMvd29ya2Zsb3dcIik7XG5sZXQgXyA9IHJlcXVpcmUoXCJsb2Rhc2hcIik7XG5sZXQgQmVnaW5NZXRob2QgPSByZXF1aXJlKFwiLi4vYWN0aXZpdGllcy9iZWdpbk1ldGhvZFwiKTtcbmxldCBFbmRNZXRob2QgPSByZXF1aXJlKFwiLi4vYWN0aXZpdGllcy9lbmRNZXRob2RcIik7XG5sZXQgaXMgPSByZXF1aXJlKFwiLi4vY29tbW9uL2lzXCIpO1xubGV0IEFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dCA9IHJlcXVpcmUoXCIuLi9hY3Rpdml0aWVzL2FjdGl2aXR5RXhlY3V0aW9uQ29udGV4dFwiKTtcblxuZnVuY3Rpb24gV29ya2Zsb3dSZWdpc3RyeSgpIHtcbiAgICB0aGlzLl93b3JrZmxvd3MgPSBuZXcgTWFwKCk7XG59XG5cbldvcmtmbG93UmVnaXN0cnkucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHdvcmtmbG93KSB7XG4gICAgaWYgKHdvcmtmbG93IGluc3RhbmNlb2YgV29ya2Zsb3cpIHtcbiAgICAgICAgaWYgKCFfKHdvcmtmbG93Lm5hbWUpLmlzU3RyaW5nKCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJXb3JrZmxvdyBuYW1lIGlzIG5vdCBhIHN0cmluZy5cIik7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG5hbWUgPSB3b3JrZmxvdy5uYW1lLnRyaW0oKTtcbiAgICAgICAgaWYgKCFuYW1lKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiV29ya2Zsb3cgbmFtZSBpcyBlbXB0eS5cIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFfKHdvcmtmbG93LnZlcnNpb24pLmlzTnVtYmVyKCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJXb3JrZmxvdyB2ZXJzaW9uIGlzIG5vdCBhIG51bWJlci5cIik7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHZlcnNpb24gPSB3b3JrZmxvdy52ZXJzaW9uO1xuXG4gICAgICAgIGxldCBlbnRyeSA9IHRoaXMuX3dvcmtmbG93cy5nZXQobmFtZSk7XG4gICAgICAgIGlmIChlbnRyeSkge1xuICAgICAgICAgICAgbGV0IGRlc2MgPSBlbnRyeS5nZXQodmVyc2lvbik7XG4gICAgICAgICAgICBpZiAoZGVzYykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIldvcmtmbG93IFwiICsgbmFtZSArIFwiIFwiICsgdmVyc2lvbiArIFwiIGFscmVhZHkgcmVnaXN0ZXJlZC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBlbnRyeS5zZXQodmVyc2lvbiwgdGhpcy5fY3JlYXRlRGVzYyh3b3JrZmxvdywgbmFtZSwgd29ya2Zsb3cudmVyc2lvbikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZW50cnkgPSBuZXcgTWFwKCk7XG4gICAgICAgICAgICBlbnRyeS5zZXQodmVyc2lvbiwgdGhpcy5fY3JlYXRlRGVzYyh3b3JrZmxvdywgbmFtZSwgd29ya2Zsb3cudmVyc2lvbikpO1xuICAgICAgICAgICAgdGhpcy5fd29ya2Zsb3dzLnNldChuYW1lLCBlbnRyeSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJXb3JrZmxvdyBpbnN0YW5jZSBhcmd1bWVudCBleHBlY3RlZC5cIik7XG4gICAgfVxufTtcblxuV29ya2Zsb3dSZWdpc3RyeS5wcm90b3R5cGUuZ2V0RGVzYyA9IGZ1bmN0aW9uIChuYW1lLCB2ZXJzaW9uKSB7XG4gICAgbGV0IGVudHJ5ID0gdGhpcy5fd29ya2Zsb3dzLmdldChuYW1lKTtcbiAgICBpZiAoZW50cnkpIHtcbiAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHZlcnNpb24pKSB7XG4gICAgICAgICAgICBsZXQgZGVzYyA9IGVudHJ5LmdldCh2ZXJzaW9uKTtcbiAgICAgICAgICAgIGlmIChkZXNjKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlc2M7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJXb3JrZmxvdyBcIiArIG5hbWUgKyBcIiBvZiB2ZXJzaW9uIFwiICsgdmVyc2lvbiArIFwiIGhhcyBub3QgYmVlbiByZWdpc3RlcmVkLlwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIEdldCB0b3AgdmVyc2lvblxuICAgICAgICAgICAgbGV0IG1heFYgPSAtMTAwMDAwMDA7XG4gICAgICAgICAgICBsZXQgZGVzYyA9IG51bGw7XG4gICAgICAgICAgICBmb3IgKGxldCBkIG9mIGVudHJ5LnZhbHVlcygpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGQudmVyc2lvbiA+IG1heFYpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVzYyA9IGQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkZXNjKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlc2M7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJXb3JrZmxvdyBcIiArIG5hbWUgKyBcIiBoYXMgbm90IGJlZW4gcmVnaXN0ZXJlZC5cIik7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5Xb3JrZmxvd1JlZ2lzdHJ5LnByb3RvdHlwZS5nZXRUb3BWZXJzaW9uID0gZnVuY3Rpb24gKHdvcmtmbG93TmFtZSkge1xuICAgIGxldCByZXN1bHQgPSBbXTtcbiAgICBsZXQgZW50cnkgPSB0aGlzLl93b3JrZmxvd3MuZ2V0KHdvcmtmbG93TmFtZSk7XG4gICAgaWYgKGVudHJ5KSB7XG4gICAgICAgIGZvciAobGV0IHZlcnNpb24gb2YgZW50cnkua2V5cygpKSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaCh2ZXJzaW9uKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmVzdWx0LnNvcnQoKTtcbiAgICByZXR1cm4gcmVzdWx0W3Jlc3VsdC5sZW5ndGggLSAxXTtcbn07XG5cbldvcmtmbG93UmVnaXN0cnkucHJvdG90eXBlLl9jcmVhdGVEZXNjID0gZnVuY3Rpb24gKHdvcmtmbG93LCBuYW1lLCB2ZXJzaW9uKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgd29ya2Zsb3c6IHdvcmtmbG93LFxuICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uLFxuICAgICAgICBtZXRob2RzOiB0aGlzLl9jb2xsZWN0TWV0aG9kSW5mb3Mod29ya2Zsb3cpXG4gICAgfTtcbn07XG5cbldvcmtmbG93UmVnaXN0cnkucHJvdG90eXBlLl9jb2xsZWN0TWV0aG9kSW5mb3MgPSBmdW5jdGlvbiAod29ya2Zsb3cpIHtcbiAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgbGV0IGluZm9zID0gbmV3IE1hcCgpO1xuICAgIGxldCBleGVjQ29udGV4dCA9IG5ldyBBY3Rpdml0eUV4ZWN1dGlvbkNvbnRleHQoKTtcbiAgICBleGVjQ29udGV4dC5pbml0aWFsaXplKHdvcmtmbG93KTtcbiAgICBmb3IgKGxldCBjaGlsZCBvZiB3b3JrZmxvdy5jaGlsZHJlbihleGVjQ29udGV4dCkpIHtcbiAgICAgICAgbGV0IGlzQk0gPSBjaGlsZCBpbnN0YW5jZW9mIEJlZ2luTWV0aG9kO1xuICAgICAgICBsZXQgaXNFTSA9IGNoaWxkIGluc3RhbmNlb2YgRW5kTWV0aG9kO1xuICAgICAgICBpZiAoaXNCTSB8fCBpc0VNKSB7XG4gICAgICAgICAgICBsZXQgbWV0aG9kTmFtZSA9IF8uaXNTdHJpbmcoY2hpbGQubWV0aG9kTmFtZSkgPyBjaGlsZC5tZXRob2ROYW1lLnRyaW0oKSA6IG51bGw7XG4gICAgICAgICAgICBsZXQgaW5zdGFuY2VJZFBhdGggPSBfLmlzU3RyaW5nKGNoaWxkLmluc3RhbmNlSWRQYXRoKSA/IGNoaWxkLmluc3RhbmNlSWRQYXRoLnRyaW0oKSA6IG51bGw7XG4gICAgICAgICAgICBpZiAobWV0aG9kTmFtZSkge1xuICAgICAgICAgICAgICAgIGxldCBpbmZvID0gaW5mb3MuZ2V0KG1ldGhvZE5hbWUpO1xuICAgICAgICAgICAgICAgIGlmICghaW5mbykge1xuICAgICAgICAgICAgICAgICAgICBpbmZvID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgd29ya2Zsb3c6IHdvcmtmbG93LFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FuQ3JlYXRlSW5zdGFuY2U6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VJZFBhdGg6IG51bGxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgaW5mb3Muc2V0KG1ldGhvZE5hbWUsIGluZm8pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaXNCTSAmJiBjaGlsZC5jYW5DcmVhdGVJbnN0YW5jZSkge1xuICAgICAgICAgICAgICAgICAgICBpbmZvLmNhbkNyZWF0ZUluc3RhbmNlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGluc3RhbmNlSWRQYXRoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmZvLmluc3RhbmNlSWRQYXRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mby5pbnN0YW5jZUlkUGF0aCAhPT0gaW5zdGFuY2VJZFBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2QgJ1wiICsgbWV0aG9kTmFtZSArIFwiJyBpbiB3b3JrZmxvdyAnXCIgKyB3b3JrZmxvdy5uYW1lICsgXCInIGhhcyBtdWx0aXBsZSBkaWZmZXJlbnQgaW5zdGFuY2VJZFBhdGggdmFsdWUgd2hpY2ggaXMgbm90IHN1cHBvcnRlZC5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmZvLmluc3RhbmNlSWRQYXRoID0gaW5zdGFuY2VJZFBhdGg7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgbGV0IHJlc3VsdCA9IG5ldyBNYXAoKTtcbiAgICBmb3IgKGxldCBrdnAgb2YgaW5mb3MuZW50cmllcygpKSB7XG4gICAgICAgIGlmIChrdnBbMV0uaW5zdGFuY2VJZFBhdGgpIHtcbiAgICAgICAgICAgIHJlc3VsdC5zZXQoa3ZwWzBdLCBrdnBbMV0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59O1xuXG5Xb3JrZmxvd1JlZ2lzdHJ5LnByb3RvdHlwZS5tZXRob2RJbmZvcyA9IGZ1bmN0aW9uKiAod29ya2Zsb3dOYW1lLCBtZXRob2ROYW1lKSB7XG4gICAgbGV0IGVudHJ5ID0gdGhpcy5fd29ya2Zsb3dzLmdldCh3b3JrZmxvd05hbWUpO1xuICAgIGlmIChlbnRyeSkge1xuICAgICAgICBmb3IgKGxldCBkZXNjIG9mIGVudHJ5LnZhbHVlcygpKSB7XG4gICAgICAgICAgICBsZXQgaW5mbyA9IGRlc2MubWV0aG9kcy5nZXQobWV0aG9kTmFtZSk7XG4gICAgICAgICAgICBpZiAoaW5mbykge1xuICAgICAgICAgICAgICAgIHlpZWxkIGluZm87XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFdvcmtmbG93UmVnaXN0cnk7XG4iXX0=
