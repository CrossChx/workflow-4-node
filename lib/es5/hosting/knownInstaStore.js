"use strict";
var specStrings = require("../common/specStrings");
var InstIdPaths = require("./instIdPaths");
var _ = require("lodash");
var debug = require("debug")("wf4node:KnownInstaStore");
function KnownInstaStore() {
  this._instances = new Map();
}
KnownInstaStore.prototype.add = function(workflowName, insta) {
  this._instances.set(specStrings.hosting.doubleKeys(workflowName, insta.id), insta);
};
KnownInstaStore.prototype.get = function(workflowName, instanceId) {
  return this._instances.get(specStrings.hosting.doubleKeys(workflowName, instanceId));
};
KnownInstaStore.prototype.exists = function(workflowName, instanceId) {
  return this._instances.has(specStrings.hosting.doubleKeys(workflowName, instanceId));
};
KnownInstaStore.prototype.remove = function(workflowName, instanceId) {
  this._instances.delete(specStrings.hosting.doubleKeys(workflowName, instanceId));
};
KnownInstaStore.prototype.getNextWakeupables = function(count) {
  var now = new Date();
  var result = [];
  var $__12 = true;
  var $__13 = false;
  var $__14 = undefined;
  try {
    for (var $__10 = void 0,
        $__9 = (this._instances.values())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__12 = ($__10 = $__9.next()).done); $__12 = true) {
      var insta = $__10.value;
      {
        if (insta.activeDelays) {
          var $__5 = true;
          var $__6 = false;
          var $__7 = undefined;
          try {
            for (var $__3 = void 0,
                $__2 = (insta.activeDelays)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
              var ad = $__3.value;
              {
                if (ad.delayTo <= now) {
                  result.push({
                    instanceId: insta.id,
                    workflowName: insta.workflowName,
                    activeDelay: {
                      methodName: ad.methodName,
                      delayTo: ad.delayTo
                    }
                  });
                }
              }
            }
          } catch ($__8) {
            $__6 = true;
            $__7 = $__8;
          } finally {
            try {
              if (!$__5 && $__2.return != null) {
                $__2.return();
              }
            } finally {
              if ($__6) {
                throw $__7;
              }
            }
          }
        }
      }
    }
  } catch ($__15) {
    $__13 = true;
    $__14 = $__15;
  } finally {
    try {
      if (!$__12 && $__9.return != null) {
        $__9.return();
      }
    } finally {
      if ($__13) {
        throw $__14;
      }
    }
  }
  result.sort(function(i1, i2) {
    if (i1.updatedOn < i2.updatedOn) {
      return -1;
    } else if (i1.updatedOn > i2.updatedOn) {
      return 1;
    } else if (i1.activeDelay.delayTo < i2.activeDelay.delayTo) {
      return -1;
    } else if (i1.activeDelay.delayTo > i2.activeDelay.delayTo) {
      return 1;
    }
    return 0;
  });
  return _.take(result, count);
};
KnownInstaStore.prototype.getRunningInstanceHeadersForOtherVersion = function(workflowName, version) {
  var result = [];
  var $__5 = true;
  var $__6 = false;
  var $__7 = undefined;
  try {
    for (var $__3 = void 0,
        $__2 = (this._instances.values())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
      var insta = $__3.value;
      {
        if (insta.workflowName === workflowName && insta.version !== version) {
          result.push({
            workflowName: insta.workflowName,
            workflowVersion: insta.workflowVersion,
            instanceId: insta.id
          });
        }
      }
    }
  } catch ($__8) {
    $__6 = true;
    $__7 = $__8;
  } finally {
    try {
      if (!$__5 && $__2.return != null) {
        $__2.return();
      }
    } finally {
      if ($__6) {
        throw $__7;
      }
    }
  }
  return result;
};
KnownInstaStore.prototype.addTracker = function(tracker) {
  var $__5 = true;
  var $__6 = false;
  var $__7 = undefined;
  try {
    for (var $__3 = void 0,
        $__2 = (this._instances.values())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
      var insta = $__3.value;
      {
        insta.addTracker(tracker);
      }
    }
  } catch ($__8) {
    $__6 = true;
    $__7 = $__8;
  } finally {
    try {
      if (!$__5 && $__2.return != null) {
        $__2.return();
      }
    } finally {
      if ($__6) {
        throw $__7;
      }
    }
  }
};
module.exports = KnownInstaStore;
//# sourceMappingURL=data:application/json;base64,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QUNyRCxFQUFDLENBQUMsTUFBb0IsQ0FBQSxDQUFDLE1BQW9CLENBQUEsU0FBcUIsQUFBQyxFQUFDLENBQUMsS0FBSyxDQUFDLENBQ3pFLE9BQW9CLEtBQUcsQ0FBRztRQTBFMUIsTUFBSTtBQUErQjtBQUN4QyxZQUFJLFdBQVcsQUFBQyxDQUFDLE9BQU0sQ0FBQyxDQUFDO01BQzdCO0lBekVJO0FBQUEsRUFGQSxDQUFFLFlBQTBCO0FBQzFCLFNBQW9CLEtBQUcsQ0FBQztBQUN4QixjQUFvQyxDQUFDO0VBQ3ZDLENBQUUsT0FBUTtBQUNSLE1BQUk7QUFDRixTQUFJLEtBQWlCLEdBQUssQ0FBQSxXQUF1QixHQUFLLEtBQUcsQ0FBRztBQUMxRCxrQkFBd0IsQUFBQyxFQUFDLENBQUM7TUFDN0I7QUFBQSxJQUNGLENBQUUsT0FBUTtBQUNSLGNBQXdCO0FBQ3RCLGtCQUF3QjtNQUMxQjtBQUFBLElBQ0Y7QUFBQSxFQUNGO0FBQUEsQUErRFIsQ0FBQztBQUVELEtBQUssUUFBUSxFQUFJLGdCQUFjLENBQUM7QUFDaEMiLCJmaWxlIjoiaG9zdGluZy9rbm93bkluc3RhU3RvcmUuanMiLCJzb3VyY2VSb290IjoibGliL2VzNiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5sZXQgc3BlY1N0cmluZ3MgPSByZXF1aXJlKFwiLi4vY29tbW9uL3NwZWNTdHJpbmdzXCIpO1xubGV0IEluc3RJZFBhdGhzID0gcmVxdWlyZShcIi4vaW5zdElkUGF0aHNcIik7XG5sZXQgXyA9IHJlcXVpcmUoXCJsb2Rhc2hcIik7XG5sZXQgZGVidWcgPSByZXF1aXJlKFwiZGVidWdcIikoXCJ3ZjRub2RlOktub3duSW5zdGFTdG9yZVwiKTtcblxuZnVuY3Rpb24gS25vd25JbnN0YVN0b3JlKCkge1xuICAgIHRoaXMuX2luc3RhbmNlcyA9IG5ldyBNYXAoKTtcbn1cblxuS25vd25JbnN0YVN0b3JlLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAod29ya2Zsb3dOYW1lLCBpbnN0YSkge1xuICAgIHRoaXMuX2luc3RhbmNlcy5zZXQoc3BlY1N0cmluZ3MuaG9zdGluZy5kb3VibGVLZXlzKHdvcmtmbG93TmFtZSwgaW5zdGEuaWQpLCBpbnN0YSk7XG59O1xuXG5Lbm93bkluc3RhU3RvcmUucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uICh3b3JrZmxvd05hbWUsIGluc3RhbmNlSWQpIHtcbiAgICByZXR1cm4gdGhpcy5faW5zdGFuY2VzLmdldChzcGVjU3RyaW5ncy5ob3N0aW5nLmRvdWJsZUtleXMod29ya2Zsb3dOYW1lLCBpbnN0YW5jZUlkKSk7XG59O1xuXG5Lbm93bkluc3RhU3RvcmUucHJvdG90eXBlLmV4aXN0cyA9IGZ1bmN0aW9uICh3b3JrZmxvd05hbWUsIGluc3RhbmNlSWQpIHtcbiAgICByZXR1cm4gdGhpcy5faW5zdGFuY2VzLmhhcyhzcGVjU3RyaW5ncy5ob3N0aW5nLmRvdWJsZUtleXMod29ya2Zsb3dOYW1lLCBpbnN0YW5jZUlkKSk7XG59O1xuXG5Lbm93bkluc3RhU3RvcmUucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICh3b3JrZmxvd05hbWUsIGluc3RhbmNlSWQpIHtcbiAgICB0aGlzLl9pbnN0YW5jZXMuZGVsZXRlKHNwZWNTdHJpbmdzLmhvc3RpbmcuZG91YmxlS2V5cyh3b3JrZmxvd05hbWUsIGluc3RhbmNlSWQpKTtcbn07XG5cbktub3duSW5zdGFTdG9yZS5wcm90b3R5cGUuZ2V0TmV4dFdha2V1cGFibGVzID0gZnVuY3Rpb24gKGNvdW50KSB7XG4gICAgbGV0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgbGV0IHJlc3VsdCA9IFtdO1xuICAgIGZvciAobGV0IGluc3RhIG9mIHRoaXMuX2luc3RhbmNlcy52YWx1ZXMoKSkge1xuICAgICAgICBpZiAoaW5zdGEuYWN0aXZlRGVsYXlzKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBhZCBvZiBpbnN0YS5hY3RpdmVEZWxheXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWQuZGVsYXlUbyA8PSBub3cpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VJZDogaW5zdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JrZmxvd05hbWU6IGluc3RhLndvcmtmbG93TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZURlbGF5OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kTmFtZTogYWQubWV0aG9kTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxheVRvOiBhZC5kZWxheVRvXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXN1bHQuc29ydChmdW5jdGlvbiAoaTEsIGkyKSB7XG4gICAgICAgIGlmIChpMS51cGRhdGVkT24gPCBpMi51cGRhdGVkT24pIHtcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpMS51cGRhdGVkT24gPiBpMi51cGRhdGVkT24pIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGkxLmFjdGl2ZURlbGF5LmRlbGF5VG8gPCBpMi5hY3RpdmVEZWxheS5kZWxheVRvKSB7XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaTEuYWN0aXZlRGVsYXkuZGVsYXlUbyA+IGkyLmFjdGl2ZURlbGF5LmRlbGF5VG8pIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgIH0pO1xuICAgIHJldHVybiBfLnRha2UocmVzdWx0LCBjb3VudCk7XG59O1xuXG5Lbm93bkluc3RhU3RvcmUucHJvdG90eXBlLmdldFJ1bm5pbmdJbnN0YW5jZUhlYWRlcnNGb3JPdGhlclZlcnNpb24gPSBmdW5jdGlvbih3b3JrZmxvd05hbWUsIHZlcnNpb24pIHtcbiAgICBsZXQgcmVzdWx0ID0gW107XG4gICAgZm9yIChsZXQgaW5zdGEgb2YgdGhpcy5faW5zdGFuY2VzLnZhbHVlcygpKSB7XG4gICAgICAgIGlmIChpbnN0YS53b3JrZmxvd05hbWUgPT09IHdvcmtmbG93TmFtZSAmJiBpbnN0YS52ZXJzaW9uICE9PSB2ZXJzaW9uKSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgICAgICAgICAgd29ya2Zsb3dOYW1lOiBpbnN0YS53b3JrZmxvd05hbWUsXG4gICAgICAgICAgICAgICAgd29ya2Zsb3dWZXJzaW9uOiBpbnN0YS53b3JrZmxvd1ZlcnNpb24sXG4gICAgICAgICAgICAgICAgaW5zdGFuY2VJZDogaW5zdGEuaWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59O1xuXG5Lbm93bkluc3RhU3RvcmUucHJvdG90eXBlLmFkZFRyYWNrZXIgPSBmdW5jdGlvbih0cmFja2VyKSB7XG4gICAgZm9yIChsZXQgaW5zdGEgb2YgdGhpcy5faW5zdGFuY2VzLnZhbHVlcygpKSB7XG4gICAgICAgIGluc3RhLmFkZFRyYWNrZXIodHJhY2tlcik7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBLbm93bkluc3RhU3RvcmU7XG4iXX0=
