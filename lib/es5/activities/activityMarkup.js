"use strict";
var _ = require("lodash");
var errors = require("../common/errors");
var Activity = require("./activity");
var is = require("../common/is");
var path = require("path");
var fs = require("fs");
var Reflection = require("backpack-node").system.Reflection;
var templateHelpers = require('./templateHelpers');
var activityTypeNameRex = /^\@([a-zA-Z_]+[0-9a-zA-Z_]*)$/;
function getActivityTypeName(str) {
  if (_.isString(str)) {
    var result = activityTypeNameRex.exec(str);
    if (result && result.length === 2) {
      return result[1];
    }
  }
  return null;
}
function requireFromRoot(resource) {
  var pPos = resource.indexOf("/");
  if (pPos === -1) {
    return require(resource);
  }
  var module = resource.substr(0, pPos);
  if (!module) {
    return require(resource);
  }
  try {
    module = require(module);
    var obj = module;
    var $__4 = true;
    var $__5 = false;
    var $__6 = undefined;
    try {
      for (var $__2 = void 0,
          $__1 = (resource.substr(pPos + 1).split("/"))[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
        var key = $__2.value;
        {
          obj = obj[key];
        }
      }
    } catch ($__7) {
      $__5 = true;
      $__6 = $__7;
    } finally {
      try {
        if (!$__4 && $__1.return != null) {
          $__1.return();
        }
      } finally {
        if ($__5) {
          throw $__6;
        }
      }
    }
    return obj;
  } catch (e) {
    return require(resource);
  }
}
function ActivityMarkup() {
  this._systemTypes = new Map();
  this._registerSystemTypes();
}
ActivityMarkup.prototype._registerSystemTypes = function() {
  this._registerTypes(__dirname);
};
ActivityMarkup.prototype._registerTypes = function(sourcePath) {
  this._registerTypesTo(this._systemTypes, sourcePath);
};
ActivityMarkup.prototype._registerTypesTo = function(types, sourcePath) {
  var self = this;
  var obj = requireFromRoot(sourcePath);
  Reflection.visitObject(obj, function(inObj) {
    var alias = self.getAlias(inObj);
    if (alias && !types.has(alias)) {
      types.set(alias, inObj);
    }
    return alias === null;
  });
};
ActivityMarkup.prototype.getAlias = function(type) {
  if (_.isFunction(type) && !_.isUndefined(type.super_)) {
    var alias = this._toCamelCase(type.name);
    do {
      if (type.super_ === Activity) {
        return alias;
      }
      type = type.super_;
    } while (type);
  }
  return null;
};
ActivityMarkup.prototype._toCamelCase = function(id) {
  return id[0].toLowerCase() + id.substr(1);
};
ActivityMarkup.prototype.parse = function(markup) {
  if (!markup) {
    throw new TypeError("Parameter 'markup' expected.");
  }
  if (_.isString(markup)) {
    markup = JSON.parse(markup);
  }
  if (!_.isPlainObject(markup)) {
    throw new TypeError("Parameter 'markup' is not a plain object.");
  }
  var types = new Map();
  var $__4 = true;
  var $__5 = false;
  var $__6 = undefined;
  try {
    for (var $__2 = void 0,
        $__1 = (this._systemTypes.entries())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
      var kvp = $__2.value;
      {
        types.set(kvp[0], kvp[1]);
      }
    }
  } catch ($__7) {
    $__5 = true;
    $__6 = $__7;
  } finally {
    try {
      if (!$__4 && $__1.return != null) {
        $__1.return();
      }
    } finally {
      if ($__5) {
        throw $__6;
      }
    }
  }
  var req = markup["@require"];
  if (req) {
    this._require(types, req);
  }
  var activity = this._createActivity(types, markup);
  if (req) {
    activity["@require"] = req;
  }
  return activity;
};
ActivityMarkup.prototype._createActivity = function(types, markup) {
  var filedNames = _.filter(_.keys(markup), function(k) {
    return k !== "@require";
  });
  if (filedNames.length !== 1) {
    throw new errors.ActivityMarkupError("There should be one field." + this._errorHint(markup));
  }
  var activityAlias = getActivityTypeName(filedNames[0]);
  if (activityAlias) {
    return this._createAndInitActivityInstance(types, activityAlias, markup);
  } else {
    throw new errors.ActivityMarkupError("Root entry is not an activity type name '" + filedNames[0] + "'." + this._errorHint(markup));
  }
};
ActivityMarkup.prototype._createAndInitActivityInstance = function(types, typeName, markup) {
  var activity = this._createActivityInstance(types, typeName);
  if (!activity) {
    throw new errors.ActivityMarkupError("Unknown activity type name '" + typeName + "'." + this._errorHint(markup));
  }
  var activityRef = {
    name: typeName,
    value: activity
  };
  var pars = markup["@" + typeName];
  if (pars) {
    this._setupActivity(types, activityRef, pars);
  }
  return activityRef.value;
};
ActivityMarkup.prototype._createActivityInstance = function(types, alias) {
  var Constructor = types.get(alias);
  if (_.isUndefined(Constructor)) {
    return null;
  }
  return new Constructor();
};
ActivityMarkup.prototype._setupActivity = function(types, activityRef, pars) {
  var self = this;
  var activity = activityRef.value;
  function noFunction(fieldName) {
    return activity.codeProperties.has(fieldName);
  }
  if (_.isArray(pars)) {
    activity.args = [];
    var $__4 = true;
    var $__5 = false;
    var $__6 = undefined;
    try {
      for (var $__2 = void 0,
          $__1 = (pars)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
        var obj = $__2.value;
        {
          activity.args.push(self._createValue(types, obj, false, is.template(activity)));
        }
      }
    } catch ($__7) {
      $__5 = true;
      $__6 = $__7;
    } finally {
      try {
        if (!$__4 && $__1.return != null) {
          $__1.return();
        }
      } finally {
        if ($__5) {
          throw $__6;
        }
      }
    }
  } else if (_.isObject(pars)) {
    var to = null;
    for (var fieldName in pars) {
      if (pars.hasOwnProperty(fieldName)) {
        if (activity.isArrayProperty(fieldName)) {
          var v = self._createValue(types, pars[fieldName], true, is.template(activity));
          if (!_.isArray(v)) {
            v = [v];
          }
          activity[fieldName] = v;
        } else if (fieldName === "@to") {
          if (to) {
            throw new errors.ActivityMarkupError("Multiple to defined in activity '" + activityRef.name + "." + this._errorHint(pars));
          }
          to = pars[fieldName];
        } else if (fieldName[0] === "!") {
          if (!activity.promotedProperties || !_.isFunction(activity.promoted)) {
            throw new errors.ActivityMarkupError("Activity '" + activityRef.name + " cannot have promoted properties." + this._errorHint(pars));
          }
          activity.promoted(fieldName.substr(1), self._createValue(types, pars[fieldName], true, is.template(activity)));
        } else if (fieldName[0] === "`") {
          if (!activity.reservedProperties || !_.isFunction(activity.reserved)) {
            throw new errors.ActivityMarkupError("Activity '" + activityRef.name + " cannot have reserved properties." + this._errorHint(pars));
          }
          activity.reserved(fieldName.substr(1), self._createValue(types, pars[fieldName], true, is.template(activity)));
        } else if (fieldName === "@require") {
          self._require(types, pars[fieldName]);
        } else {
          activity[fieldName] = self._createValue(types, pars[fieldName], false, is.template(activity), noFunction(fieldName));
        }
      }
    }
    if (to) {
      var current = activity;
      var assign = activityRef.value = this._createActivityInstance(types, "assign");
      assign.value = current;
      assign.to = to;
    }
  } else {
    activity.args = [self._createValue(types, pars, false, is.template(activity))];
  }
};
ActivityMarkup.prototype._require = function(types, markup) {
  var self = this;
  if (_.isArray(markup)) {
    var $__4 = true;
    var $__5 = false;
    var $__6 = undefined;
    try {
      for (var $__2 = void 0,
          $__1 = (markup)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
        var item = $__2.value;
        {
          self._require(types, item);
        }
      }
    } catch ($__7) {
      $__5 = true;
      $__6 = $__7;
    } finally {
      try {
        if (!$__4 && $__1.return != null) {
          $__1.return();
        }
      } finally {
        if ($__5) {
          throw $__6;
        }
      }
    }
  } else if (_.isString(markup)) {
    self._registerTypesTo(types, markup);
  } else {
    throw new errors.ActivityMarkupError("Cannot register '" + markup + "'." + self._errorHint(markup));
  }
};
ActivityMarkup.prototype._createValue = function(types, markup, canBeArray, noTemplate, noFunction) {
  var self = this;
  function templatize(_markup) {
    var template = self._createActivityInstance(types, "template");
    template.declare = _markup;
    return template;
  }
  function funcletize(f) {
    var func = self._createActivityInstance(types, "func");
    func.code = f;
    return func;
  }
  function expressionize(str) {
    var expr = self._createActivityInstance(types, "expression");
    expr.expr = str;
    return expr;
  }
  if (_.isArray(markup)) {
    if (canBeArray) {
      var result = [];
      var $__4 = true;
      var $__5 = false;
      var $__6 = undefined;
      try {
        for (var $__2 = void 0,
            $__1 = (markup)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
          var v = $__2.value;
          {
            result.push(self._createValue(types, v));
          }
        }
      } catch ($__7) {
        $__5 = true;
        $__6 = $__7;
      } finally {
        try {
          if (!$__4 && $__1.return != null) {
            $__1.return();
          }
        } finally {
          if ($__5) {
            throw $__6;
          }
        }
      }
      return result;
    } else if (!noTemplate && templateHelpers.isTemplate(markup)) {
      return templatize(markup);
    }
  } else if (_.isPlainObject(markup)) {
    var filedNames = _.keys(markup);
    if (filedNames.length === 1) {
      var fieldName = filedNames[0];
      var fieldValue = markup[fieldName];
      if (fieldName === "_") {
        return fieldValue;
      }
      var activityTypeName = getActivityTypeName(fieldName);
      if (activityTypeName) {
        return self._createAndInitActivityInstance(types, activityTypeName, markup);
      }
    }
    if (!noTemplate && templateHelpers.isTemplate(markup)) {
      return templatize(markup);
    }
  } else if (_.isString(markup)) {
    var str = markup.trim();
    if (templateHelpers.isFunctionString(str)) {
      var f;
      eval("f = function(_){return (" + str + ");}");
      f = f(_);
      if (!noFunction) {
        return funcletize(f);
      } else {
        return f;
      }
    } else if (str.length > 1) {
      if (str[0] === "=") {
        return expressionize(str.substr(1));
      }
    }
  } else if (_.isFunction(markup)) {
    if (!noFunction) {
      return funcletize(markup);
    }
  }
  return markup;
};
ActivityMarkup.prototype._errorHint = function(markup) {
  var len = 20;
  var json = JSON.stringify(markup);
  if (json.length > len) {
    json = json.substr(0, len) + " ...";
  }
  return "\nSee error near:\n" + json;
};
ActivityMarkup.prototype.stringify = function(obj) {
  if (_.isString(obj)) {
    return obj;
  }
  if (is.activity(obj)) {
    obj = this.toMarkup(obj);
  }
  if (!_.isPlainObject(obj)) {
    throw new TypeError("Parameter 'obj' is not a plain object.");
  }
  var cloned = _.cloneDeep(obj);
  this._functionsToString(cloned);
  return JSON.stringify(cloned);
};
ActivityMarkup.prototype._functionsToString = function(obj) {
  var self = this;
  for (var fieldName in obj) {
    var fieldValue = obj[fieldName];
    if (_.isFunction(fieldValue)) {
      obj[fieldName] = fieldValue.toString();
    } else if (_.isObject(fieldValue)) {
      self._functionsToString(fieldValue);
    } else if (_.isArray(fieldValue)) {
      var $__4 = true;
      var $__5 = false;
      var $__6 = undefined;
      try {
        for (var $__2 = void 0,
            $__1 = (fieldValue)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
          var v = $__2.value;
          {
            self._functionsToString(v);
          }
        }
      } catch ($__7) {
        $__5 = true;
        $__6 = $__7;
      } finally {
        try {
          if (!$__4 && $__1.return != null) {
            $__1.return();
          }
        } finally {
          if ($__5) {
            throw $__6;
          }
        }
      }
    }
  }
};
ActivityMarkup.prototype.toMarkup = function(activity) {
  throw new Error("Not supported yet!");
};
var activityMarkup = null;
module.exports = {
  parse: function(markup) {
    return (activityMarkup = (activityMarkup || new ActivityMarkup())).parse(markup);
  },
  toMarkup: function(activity) {
    return (activityMarkup = (activityMarkup || new ActivityMarkup())).toMarkup(activity);
  },
  stringify: function(obj) {
    return (activityMarkup = (activityMarkup || new ActivityMarkup())).stringify(obj);
  },
  getAlias: function(activity) {
    return (activityMarkup = (activityMarkup || new ActivityMarkup())).getAlias(activity.constructor);
  }
};
//# sourceMappingURL=data:application/json;base64,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VUFBVSxNQUFLLENBQUc7QUFDckIsU0FBTyxDQUFBLENBQUMsY0FBYSxFQUFJLEVBQUMsY0FBYSxHQUFLLElBQUksZUFBYSxBQUFDLEVBQUMsQ0FBQyxDQUFDLE1BQU0sQUFBQyxDQUFDLE1BQUssQ0FBQyxDQUFDO0VBQ3BGO0FBRUEsU0FBTyxDQUFHLFVBQVUsUUFBTyxDQUFHO0FBQzFCLFNBQU8sQ0FBQSxDQUFDLGNBQWEsRUFBSSxFQUFDLGNBQWEsR0FBSyxJQUFJLGVBQWEsQUFBQyxFQUFDLENBQUMsQ0FBQyxTQUFTLEFBQUMsQ0FBQyxRQUFPLENBQUMsQ0FBQztFQUN6RjtBQUVBLFVBQVEsQ0FBRyxVQUFVLEdBQUUsQ0FBRztBQUN0QixTQUFPLENBQUEsQ0FBQyxjQUFhLEVBQUksRUFBQyxjQUFhLEdBQUssSUFBSSxlQUFhLEFBQUMsRUFBQyxDQUFDLENBQUMsVUFBVSxBQUFDLENBQUMsR0FBRSxDQUFDLENBQUM7RUFDckY7QUFFQSxTQUFPLENBQUcsVUFBVSxRQUFPLENBQUc7QUFDMUIsU0FBTyxDQUFBLENBQUMsY0FBYSxFQUFJLEVBQUMsY0FBYSxHQUFLLElBQUksZUFBYSxBQUFDLEVBQUMsQ0FBQyxDQUFDLFNBQVMsQUFBQyxDQUFDLFFBQU8sWUFBWSxDQUFDLENBQUM7RUFDckc7QUFBQSxBQUNKLENBQUM7QUFBQSIsImZpbGUiOiJhY3Rpdml0aWVzL2FjdGl2aXR5TWFya3VwLmpzIiwic291cmNlUm9vdCI6ImxpYi9lczYiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLyoganNoaW50IC1XMDYxICovXG5cbmxldCBfID0gcmVxdWlyZShcImxvZGFzaFwiKTtcbmxldCBlcnJvcnMgPSByZXF1aXJlKFwiLi4vY29tbW9uL2Vycm9yc1wiKTtcbmxldCBBY3Rpdml0eSA9IHJlcXVpcmUoXCIuL2FjdGl2aXR5XCIpO1xubGV0IGlzID0gcmVxdWlyZShcIi4uL2NvbW1vbi9pc1wiKTtcbmxldCBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XG5sZXQgZnMgPSByZXF1aXJlKFwiZnNcIik7XG5sZXQgUmVmbGVjdGlvbiA9IHJlcXVpcmUoXCJiYWNrcGFjay1ub2RlXCIpLnN5c3RlbS5SZWZsZWN0aW9uO1xubGV0IHRlbXBsYXRlSGVscGVycyA9IHJlcXVpcmUoJy4vdGVtcGxhdGVIZWxwZXJzJyk7XG5cbmNvbnN0IGFjdGl2aXR5VHlwZU5hbWVSZXggPSAvXlxcQChbYS16QS1aX10rWzAtOWEtekEtWl9dKikkLztcbmZ1bmN0aW9uIGdldEFjdGl2aXR5VHlwZU5hbWUoc3RyKSB7XG4gICAgaWYgKF8uaXNTdHJpbmcoc3RyKSkge1xuICAgICAgICBsZXQgcmVzdWx0ID0gYWN0aXZpdHlUeXBlTmFtZVJleC5leGVjKHN0cik7XG4gICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0Lmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cblxuZnVuY3Rpb24gcmVxdWlyZUZyb21Sb290KHJlc291cmNlKSB7XG4gICAgbGV0IHBQb3MgPSByZXNvdXJjZS5pbmRleE9mKFwiL1wiKTtcbiAgICBpZiAocFBvcyA9PT0gLTEpIHtcbiAgICAgICAgcmV0dXJuIHJlcXVpcmUocmVzb3VyY2UpO1xuICAgIH1cbiAgICBsZXQgbW9kdWxlID0gcmVzb3VyY2Uuc3Vic3RyKDAsIHBQb3MpO1xuICAgIGlmICghbW9kdWxlKSB7XG4gICAgICAgIHJldHVybiByZXF1aXJlKHJlc291cmNlKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgbW9kdWxlID0gcmVxdWlyZShtb2R1bGUpO1xuICAgICAgICBsZXQgb2JqID0gbW9kdWxlO1xuICAgICAgICBmb3IgKGxldCBrZXkgb2YgcmVzb3VyY2Uuc3Vic3RyKHBQb3MgKyAxKS5zcGxpdChcIi9cIikpIHtcbiAgICAgICAgICAgIG9iaiA9IG9ialtrZXldO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvYmo7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiByZXF1aXJlKHJlc291cmNlKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIEFjdGl2aXR5TWFya3VwKCkge1xuICAgIHRoaXMuX3N5c3RlbVR5cGVzID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuX3JlZ2lzdGVyU3lzdGVtVHlwZXMoKTtcbn1cblxuQWN0aXZpdHlNYXJrdXAucHJvdG90eXBlLl9yZWdpc3RlclN5c3RlbVR5cGVzID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX3JlZ2lzdGVyVHlwZXMoX19kaXJuYW1lKTtcbn07XG5cbkFjdGl2aXR5TWFya3VwLnByb3RvdHlwZS5fcmVnaXN0ZXJUeXBlcyA9IGZ1bmN0aW9uIChzb3VyY2VQYXRoKSB7XG4gICAgdGhpcy5fcmVnaXN0ZXJUeXBlc1RvKHRoaXMuX3N5c3RlbVR5cGVzLCBzb3VyY2VQYXRoKTtcbn07XG5cbkFjdGl2aXR5TWFya3VwLnByb3RvdHlwZS5fcmVnaXN0ZXJUeXBlc1RvID0gZnVuY3Rpb24gKHR5cGVzLCBzb3VyY2VQYXRoKSB7XG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgIGxldCBvYmogPSByZXF1aXJlRnJvbVJvb3Qoc291cmNlUGF0aCk7XG4gICAgUmVmbGVjdGlvbi52aXNpdE9iamVjdChvYmosIGZ1bmN0aW9uIChpbk9iaikge1xuICAgICAgICBsZXQgYWxpYXMgPSBzZWxmLmdldEFsaWFzKGluT2JqKTtcbiAgICAgICAgaWYgKGFsaWFzICYmICF0eXBlcy5oYXMoYWxpYXMpKSB7XG4gICAgICAgICAgICAvLyBUaGlzIGlzIGFuIGFjdGl2aXR5IHR5cGVcbiAgICAgICAgICAgIHR5cGVzLnNldChhbGlhcywgaW5PYmopO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhbGlhcyA9PT0gbnVsbDtcbiAgICB9KTtcbn07XG5cbkFjdGl2aXR5TWFya3VwLnByb3RvdHlwZS5nZXRBbGlhcyA9IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgaWYgKF8uaXNGdW5jdGlvbih0eXBlKSAmJiAhXy5pc1VuZGVmaW5lZCh0eXBlLnN1cGVyXykpIHtcbiAgICAgICAgbGV0IGFsaWFzID0gdGhpcy5fdG9DYW1lbENhc2UodHlwZS5uYW1lKTtcbiAgICAgICAgZG9cbiAgICAgICAge1xuICAgICAgICAgICAgaWYgKHR5cGUuc3VwZXJfID09PSBBY3Rpdml0eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhbGlhcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHR5cGUgPSB0eXBlLnN1cGVyXztcbiAgICAgICAgfVxuICAgICAgICB3aGlsZSAodHlwZSk7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufTtcblxuQWN0aXZpdHlNYXJrdXAucHJvdG90eXBlLl90b0NhbWVsQ2FzZSA9IGZ1bmN0aW9uIChpZCkge1xuICAgIHJldHVybiBpZFswXS50b0xvd2VyQ2FzZSgpICsgaWQuc3Vic3RyKDEpO1xufTtcblxuQWN0aXZpdHlNYXJrdXAucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gKG1hcmt1cCkge1xuICAgIGlmICghbWFya3VwKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJQYXJhbWV0ZXIgJ21hcmt1cCcgZXhwZWN0ZWQuXCIpO1xuICAgIH1cbiAgICBpZiAoXy5pc1N0cmluZyhtYXJrdXApKSB7XG4gICAgICAgIG1hcmt1cCA9IEpTT04ucGFyc2UobWFya3VwKTtcbiAgICB9XG4gICAgaWYgKCFfLmlzUGxhaW5PYmplY3QobWFya3VwKSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUGFyYW1ldGVyICdtYXJrdXAnIGlzIG5vdCBhIHBsYWluIG9iamVjdC5cIik7XG4gICAgfVxuXG4gICAgbGV0IHR5cGVzID0gbmV3IE1hcCgpO1xuICAgIGZvciAobGV0IGt2cCBvZiB0aGlzLl9zeXN0ZW1UeXBlcy5lbnRyaWVzKCkpIHtcbiAgICAgICAgdHlwZXMuc2V0KGt2cFswXSwga3ZwWzFdKTtcbiAgICB9XG4gICAgbGV0IHJlcSA9IG1hcmt1cFtcIkByZXF1aXJlXCJdO1xuICAgIGlmIChyZXEpIHtcbiAgICAgICAgdGhpcy5fcmVxdWlyZSh0eXBlcywgcmVxKTtcbiAgICB9XG4gICAgbGV0IGFjdGl2aXR5ID0gdGhpcy5fY3JlYXRlQWN0aXZpdHkodHlwZXMsIG1hcmt1cCk7XG4gICAgaWYgKHJlcSkge1xuICAgICAgICBhY3Rpdml0eVtcIkByZXF1aXJlXCJdID0gcmVxO1xuICAgIH1cbiAgICByZXR1cm4gYWN0aXZpdHk7XG59O1xuXG5BY3Rpdml0eU1hcmt1cC5wcm90b3R5cGUuX2NyZWF0ZUFjdGl2aXR5ID0gZnVuY3Rpb24gKHR5cGVzLCBtYXJrdXApIHtcbiAgICBsZXQgZmlsZWROYW1lcyA9IF8uZmlsdGVyKF8ua2V5cyhtYXJrdXApLCBmdW5jdGlvbiAoaykgeyByZXR1cm4gayAhPT0gXCJAcmVxdWlyZVwiOyB9KTtcbiAgICBpZiAoZmlsZWROYW1lcy5sZW5ndGggIT09IDEpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5BY3Rpdml0eU1hcmt1cEVycm9yKFwiVGhlcmUgc2hvdWxkIGJlIG9uZSBmaWVsZC5cIiArIHRoaXMuX2Vycm9ySGludChtYXJrdXApKTtcbiAgICB9XG5cbiAgICBsZXQgYWN0aXZpdHlBbGlhcyA9IGdldEFjdGl2aXR5VHlwZU5hbWUoZmlsZWROYW1lc1swXSk7XG4gICAgaWYgKGFjdGl2aXR5QWxpYXMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NyZWF0ZUFuZEluaXRBY3Rpdml0eUluc3RhbmNlKHR5cGVzLCBhY3Rpdml0eUFsaWFzLCBtYXJrdXApO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5BY3Rpdml0eU1hcmt1cEVycm9yKFwiUm9vdCBlbnRyeSBpcyBub3QgYW4gYWN0aXZpdHkgdHlwZSBuYW1lICdcIiArIGZpbGVkTmFtZXNbMF0gKyBcIicuXCIgKyB0aGlzLl9lcnJvckhpbnQobWFya3VwKSk7XG4gICAgfVxufTtcblxuQWN0aXZpdHlNYXJrdXAucHJvdG90eXBlLl9jcmVhdGVBbmRJbml0QWN0aXZpdHlJbnN0YW5jZSA9IGZ1bmN0aW9uICh0eXBlcywgdHlwZU5hbWUsIG1hcmt1cCkge1xuICAgIGxldCBhY3Rpdml0eSA9IHRoaXMuX2NyZWF0ZUFjdGl2aXR5SW5zdGFuY2UodHlwZXMsIHR5cGVOYW1lKTtcbiAgICBpZiAoIWFjdGl2aXR5KSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcnMuQWN0aXZpdHlNYXJrdXBFcnJvcihcIlVua25vd24gYWN0aXZpdHkgdHlwZSBuYW1lICdcIiArIHR5cGVOYW1lICsgXCInLlwiICsgdGhpcy5fZXJyb3JIaW50KG1hcmt1cCkpO1xuICAgIH1cbiAgICBsZXQgYWN0aXZpdHlSZWYgPSB7XG4gICAgICAgIG5hbWU6IHR5cGVOYW1lLFxuICAgICAgICB2YWx1ZTogYWN0aXZpdHlcbiAgICB9O1xuICAgIGxldCBwYXJzID0gbWFya3VwW1wiQFwiICsgdHlwZU5hbWVdO1xuICAgIGlmIChwYXJzKSB7XG4gICAgICAgIHRoaXMuX3NldHVwQWN0aXZpdHkodHlwZXMsIGFjdGl2aXR5UmVmLCBwYXJzKTtcbiAgICB9XG4gICAgcmV0dXJuIGFjdGl2aXR5UmVmLnZhbHVlO1xufTtcblxuQWN0aXZpdHlNYXJrdXAucHJvdG90eXBlLl9jcmVhdGVBY3Rpdml0eUluc3RhbmNlID0gZnVuY3Rpb24gKHR5cGVzLCBhbGlhcykge1xuICAgIGxldCBDb25zdHJ1Y3RvciA9IHR5cGVzLmdldChhbGlhcyk7XG4gICAgaWYgKF8uaXNVbmRlZmluZWQoQ29uc3RydWN0b3IpKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IENvbnN0cnVjdG9yKCk7XG59O1xuXG5BY3Rpdml0eU1hcmt1cC5wcm90b3R5cGUuX3NldHVwQWN0aXZpdHkgPSBmdW5jdGlvbiAodHlwZXMsIGFjdGl2aXR5UmVmLCBwYXJzKSB7XG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgIGxldCBhY3Rpdml0eSA9IGFjdGl2aXR5UmVmLnZhbHVlO1xuXG4gICAgZnVuY3Rpb24gbm9GdW5jdGlvbihmaWVsZE5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGFjdGl2aXR5LmNvZGVQcm9wZXJ0aWVzLmhhcyhmaWVsZE5hbWUpO1xuICAgIH1cblxuICAgIGlmIChfLmlzQXJyYXkocGFycykpIHtcbiAgICAgICAgLy8gYXJnc1xuICAgICAgICBhY3Rpdml0eS5hcmdzID0gW107XG4gICAgICAgIGZvciAobGV0IG9iaiBvZiBwYXJzKSB7XG4gICAgICAgICAgICBhY3Rpdml0eS5hcmdzLnB1c2goc2VsZi5fY3JlYXRlVmFsdWUodHlwZXMsIG9iaiwgZmFsc2UsIGlzLnRlbXBsYXRlKGFjdGl2aXR5KSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKF8uaXNPYmplY3QocGFycykpIHtcbiAgICAgICAgbGV0IHRvID0gbnVsbDtcbiAgICAgICAgLy8gdmFsdWVzXG4gICAgICAgIGZvciAobGV0IGZpZWxkTmFtZSBpbiBwYXJzKSB7XG4gICAgICAgICAgICBpZiAocGFycy5oYXNPd25Qcm9wZXJ0eShmaWVsZE5hbWUpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFjdGl2aXR5LmlzQXJyYXlQcm9wZXJ0eShmaWVsZE5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCB2ID0gc2VsZi5fY3JlYXRlVmFsdWUodHlwZXMsIHBhcnNbZmllbGROYW1lXSwgdHJ1ZSwgaXMudGVtcGxhdGUoYWN0aXZpdHkpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzQXJyYXkodikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHYgPSBbdl07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHlbZmllbGROYW1lXSA9IHY7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGZpZWxkTmFtZSA9PT0gXCJAdG9cIikge1xuICAgICAgICAgICAgICAgICAgICBpZiAodG8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcnMuQWN0aXZpdHlNYXJrdXBFcnJvcihcIk11bHRpcGxlIHRvIGRlZmluZWQgaW4gYWN0aXZpdHkgJ1wiICsgYWN0aXZpdHlSZWYubmFtZSArIFwiLlwiICsgdGhpcy5fZXJyb3JIaW50KHBhcnMpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0byA9IHBhcnNbZmllbGROYW1lXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZmllbGROYW1lWzBdID09PSBcIiFcIikge1xuICAgICAgICAgICAgICAgICAgICAvLyBQcm9tb3RlZDpcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFhY3Rpdml0eS5wcm9tb3RlZFByb3BlcnRpZXMgfHwgIV8uaXNGdW5jdGlvbihhY3Rpdml0eS5wcm9tb3RlZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcnMuQWN0aXZpdHlNYXJrdXBFcnJvcihcIkFjdGl2aXR5ICdcIiArIGFjdGl2aXR5UmVmLm5hbWUgKyBcIiBjYW5ub3QgaGF2ZSBwcm9tb3RlZCBwcm9wZXJ0aWVzLlwiICsgdGhpcy5fZXJyb3JIaW50KHBhcnMpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS5wcm9tb3RlZChmaWVsZE5hbWUuc3Vic3RyKDEpLCBzZWxmLl9jcmVhdGVWYWx1ZSh0eXBlcywgcGFyc1tmaWVsZE5hbWVdLCB0cnVlLCBpcy50ZW1wbGF0ZShhY3Rpdml0eSkpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZmllbGROYW1lWzBdID09PSBcImBcIikge1xuICAgICAgICAgICAgICAgICAgICAvLyBSZXNlcnZlZDpcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFhY3Rpdml0eS5yZXNlcnZlZFByb3BlcnRpZXMgfHwgIV8uaXNGdW5jdGlvbihhY3Rpdml0eS5yZXNlcnZlZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcnMuQWN0aXZpdHlNYXJrdXBFcnJvcihcIkFjdGl2aXR5ICdcIiArIGFjdGl2aXR5UmVmLm5hbWUgKyBcIiBjYW5ub3QgaGF2ZSByZXNlcnZlZCBwcm9wZXJ0aWVzLlwiICsgdGhpcy5fZXJyb3JIaW50KHBhcnMpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS5yZXNlcnZlZChmaWVsZE5hbWUuc3Vic3RyKDEpLCBzZWxmLl9jcmVhdGVWYWx1ZSh0eXBlcywgcGFyc1tmaWVsZE5hbWVdLCB0cnVlLCBpcy50ZW1wbGF0ZShhY3Rpdml0eSkpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZmllbGROYW1lID09PSBcIkByZXF1aXJlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVxdWlyZTpcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fcmVxdWlyZSh0eXBlcywgcGFyc1tmaWVsZE5hbWVdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5W2ZpZWxkTmFtZV0gPSBzZWxmLl9jcmVhdGVWYWx1ZSh0eXBlcywgcGFyc1tmaWVsZE5hbWVdLCBmYWxzZSwgaXMudGVtcGxhdGUoYWN0aXZpdHkpLCBub0Z1bmN0aW9uKGZpZWxkTmFtZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodG8pIHtcbiAgICAgICAgICAgIGxldCBjdXJyZW50ID0gYWN0aXZpdHk7XG4gICAgICAgICAgICBsZXQgYXNzaWduID0gYWN0aXZpdHlSZWYudmFsdWUgPSB0aGlzLl9jcmVhdGVBY3Rpdml0eUluc3RhbmNlKHR5cGVzLCBcImFzc2lnblwiKTtcbiAgICAgICAgICAgIGFzc2lnbi52YWx1ZSA9IGN1cnJlbnQ7XG4gICAgICAgICAgICBhc3NpZ24udG8gPSB0bztcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gMSBhcmdcbiAgICAgICAgYWN0aXZpdHkuYXJncyA9IFtzZWxmLl9jcmVhdGVWYWx1ZSh0eXBlcywgcGFycywgZmFsc2UsIGlzLnRlbXBsYXRlKGFjdGl2aXR5KSldO1xuICAgIH1cbn07XG5cbkFjdGl2aXR5TWFya3VwLnByb3RvdHlwZS5fcmVxdWlyZSA9IGZ1bmN0aW9uICh0eXBlcywgbWFya3VwKSB7XG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuXG4gICAgaWYgKF8uaXNBcnJheShtYXJrdXApKSB7XG4gICAgICAgIGZvciAobGV0IGl0ZW0gb2YgbWFya3VwKSB7XG4gICAgICAgICAgICBzZWxmLl9yZXF1aXJlKHR5cGVzLCBpdGVtKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChfLmlzU3RyaW5nKG1hcmt1cCkpIHtcbiAgICAgICAgc2VsZi5fcmVnaXN0ZXJUeXBlc1RvKHR5cGVzLCBtYXJrdXApO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5BY3Rpdml0eU1hcmt1cEVycm9yKFwiQ2Fubm90IHJlZ2lzdGVyICdcIiArIG1hcmt1cCArIFwiJy5cIiArIHNlbGYuX2Vycm9ySGludChtYXJrdXApKTtcbiAgICB9XG59O1xuXG5BY3Rpdml0eU1hcmt1cC5wcm90b3R5cGUuX2NyZWF0ZVZhbHVlID0gZnVuY3Rpb24gKHR5cGVzLCBtYXJrdXAsIGNhbkJlQXJyYXksIG5vVGVtcGxhdGUsIG5vRnVuY3Rpb24pIHtcbiAgICBsZXQgc2VsZiA9IHRoaXM7XG5cbiAgICAvLyBIZWxwZXJzXG4gICAgZnVuY3Rpb24gdGVtcGxhdGl6ZShfbWFya3VwKSB7XG4gICAgICAgIGxldCB0ZW1wbGF0ZSA9IHNlbGYuX2NyZWF0ZUFjdGl2aXR5SW5zdGFuY2UodHlwZXMsIFwidGVtcGxhdGVcIik7XG4gICAgICAgIHRlbXBsYXRlLmRlY2xhcmUgPSBfbWFya3VwO1xuICAgICAgICByZXR1cm4gdGVtcGxhdGU7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZnVuY2xldGl6ZShmKSB7XG4gICAgICAgIGxldCBmdW5jID0gc2VsZi5fY3JlYXRlQWN0aXZpdHlJbnN0YW5jZSh0eXBlcywgXCJmdW5jXCIpO1xuICAgICAgICBmdW5jLmNvZGUgPSBmO1xuICAgICAgICByZXR1cm4gZnVuYztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBleHByZXNzaW9uaXplKHN0cikge1xuICAgICAgICBsZXQgZXhwciA9IHNlbGYuX2NyZWF0ZUFjdGl2aXR5SW5zdGFuY2UodHlwZXMsIFwiZXhwcmVzc2lvblwiKTtcbiAgICAgICAgZXhwci5leHByID0gc3RyO1xuICAgICAgICByZXR1cm4gZXhwcjtcbiAgICB9XG5cbiAgICBpZiAoXy5pc0FycmF5KG1hcmt1cCkpIHtcbiAgICAgICAgaWYgKGNhbkJlQXJyYXkpIHtcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSBbXTtcbiAgICAgICAgICAgIGZvciAobGV0IHYgb2YgbWFya3VwKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goc2VsZi5fY3JlYXRlVmFsdWUodHlwZXMsIHYpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIW5vVGVtcGxhdGUgJiYgdGVtcGxhdGVIZWxwZXJzLmlzVGVtcGxhdGUobWFya3VwKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRlbXBsYXRpemUobWFya3VwKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChfLmlzUGxhaW5PYmplY3QobWFya3VwKSkge1xuICAgICAgICBsZXQgZmlsZWROYW1lcyA9IF8ua2V5cyhtYXJrdXApO1xuICAgICAgICBpZiAoZmlsZWROYW1lcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIGxldCBmaWVsZE5hbWUgPSBmaWxlZE5hbWVzWzBdO1xuICAgICAgICAgICAgbGV0IGZpZWxkVmFsdWUgPSBtYXJrdXBbZmllbGROYW1lXTtcblxuICAgICAgICAgICAgaWYgKGZpZWxkTmFtZSA9PT0gXCJfXCIpIHtcbiAgICAgICAgICAgICAgICAvLyBFc2NhcGU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkVmFsdWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBhY3Rpdml0eVR5cGVOYW1lID0gZ2V0QWN0aXZpdHlUeXBlTmFtZShmaWVsZE5hbWUpO1xuICAgICAgICAgICAgaWYgKGFjdGl2aXR5VHlwZU5hbWUpIHtcbiAgICAgICAgICAgICAgICAvLyBBY3Rpdml0eTpcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fY3JlYXRlQW5kSW5pdEFjdGl2aXR5SW5zdGFuY2UodHlwZXMsIGFjdGl2aXR5VHlwZU5hbWUsIG1hcmt1cCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBQbGFpbiBvYmplY3Q6XG4gICAgICAgIGlmICghbm9UZW1wbGF0ZSAmJiB0ZW1wbGF0ZUhlbHBlcnMuaXNUZW1wbGF0ZShtYXJrdXApKSB7XG4gICAgICAgICAgICByZXR1cm4gdGVtcGxhdGl6ZShtYXJrdXApO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKF8uaXNTdHJpbmcobWFya3VwKSkge1xuICAgICAgICBsZXQgc3RyID0gbWFya3VwLnRyaW0oKTtcbiAgICAgICAgaWYgKHRlbXBsYXRlSGVscGVycy5pc0Z1bmN0aW9uU3RyaW5nKHN0cikpIHtcbiAgICAgICAgICAgIGxldCBmO1xuICAgICAgICAgICAgZXZhbChcImYgPSBmdW5jdGlvbihfKXtyZXR1cm4gKFwiICsgc3RyICsgXCIpO31cIik7XG4gICAgICAgICAgICBmID0gZihfKTtcbiAgICAgICAgICAgIGlmICghbm9GdW5jdGlvbikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jbGV0aXplKGYpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGY7IC8vIGFrYSB3aGVuIGZ1bmMuY29kZVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHN0ci5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBpZiAoc3RyWzBdID09PSBcIj1cIikge1xuICAgICAgICAgICAgICAgIC8vIEV4cHJlc3Npb25cbiAgICAgICAgICAgICAgICByZXR1cm4gZXhwcmVzc2lvbml6ZShzdHIuc3Vic3RyKDEpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChfLmlzRnVuY3Rpb24obWFya3VwKSkge1xuICAgICAgICBpZiAoIW5vRnVuY3Rpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jbGV0aXplKG1hcmt1cCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbWFya3VwO1xufTtcblxuQWN0aXZpdHlNYXJrdXAucHJvdG90eXBlLl9lcnJvckhpbnQgPSBmdW5jdGlvbiAobWFya3VwKSB7XG4gICAgbGV0IGxlbiA9IDIwO1xuICAgIGxldCBqc29uID0gSlNPTi5zdHJpbmdpZnkobWFya3VwKTtcbiAgICBpZiAoanNvbi5sZW5ndGggPiBsZW4pIHtcbiAgICAgICAganNvbiA9IGpzb24uc3Vic3RyKDAsIGxlbikgKyBcIiAuLi5cIjtcbiAgICB9XG4gICAgcmV0dXJuIFwiXFxuU2VlIGVycm9yIG5lYXI6XFxuXCIgKyBqc29uO1xufTtcblxuQWN0aXZpdHlNYXJrdXAucHJvdG90eXBlLnN0cmluZ2lmeSA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICBpZiAoXy5pc1N0cmluZyhvYmopKSB7XG4gICAgICAgIHJldHVybiBvYmo7XG4gICAgfVxuICAgIGlmIChpcy5hY3Rpdml0eShvYmopKSB7XG4gICAgICAgIG9iaiA9IHRoaXMudG9NYXJrdXAob2JqKTtcbiAgICB9XG4gICAgaWYgKCFfLmlzUGxhaW5PYmplY3Qob2JqKSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUGFyYW1ldGVyICdvYmonIGlzIG5vdCBhIHBsYWluIG9iamVjdC5cIik7XG4gICAgfVxuICAgIGxldCBjbG9uZWQgPSBfLmNsb25lRGVlcChvYmopO1xuICAgIHRoaXMuX2Z1bmN0aW9uc1RvU3RyaW5nKGNsb25lZCk7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGNsb25lZCk7XG59O1xuXG5BY3Rpdml0eU1hcmt1cC5wcm90b3R5cGUuX2Z1bmN0aW9uc1RvU3RyaW5nID0gZnVuY3Rpb24gKG9iaikge1xuICAgIGxldCBzZWxmID0gdGhpcztcbiAgICBmb3IgKGxldCBmaWVsZE5hbWUgaW4gb2JqKSB7XG4gICAgICAgIGxldCBmaWVsZFZhbHVlID0gb2JqW2ZpZWxkTmFtZV07XG4gICAgICAgIGlmIChfLmlzRnVuY3Rpb24oZmllbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgIG9ialtmaWVsZE5hbWVdID0gZmllbGRWYWx1ZS50b1N0cmluZygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKF8uaXNPYmplY3QoZmllbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgIHNlbGYuX2Z1bmN0aW9uc1RvU3RyaW5nKGZpZWxkVmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKF8uaXNBcnJheShmaWVsZFZhbHVlKSkge1xuICAgICAgICAgICAgZm9yIChsZXQgdiBvZiBmaWVsZFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5fZnVuY3Rpb25zVG9TdHJpbmcodik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG4vLyBUbyBNYXJrdXA6XG5cbkFjdGl2aXR5TWFya3VwLnByb3RvdHlwZS50b01hcmt1cCA9IGZ1bmN0aW9uIChhY3Rpdml0eSkge1xuICAgIC8qaWYgKCFpcy5hY3Rpdml0eShhY3Rpdml0eSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFyZ3VtZW50IGlzIG5vdCBhbiBhY3Rpdml0eSBpbnN0YW5jZS5cIik7XG4gICAgfVxuICAgIGxldCBtYXJrdXAgPSB7fTtcbiAgICBsZXQgYWxpYXMgPSB0aGlzLmdldEFsaWFzKGFjdGl2aXR5LmNvbnN0cnVjdG9yKTtcbiAgICBsZXQgYWN0aXZpdHlNYXJrdXAgPSB0aGlzLl9jcmVhdGVNYXJrdXBPZkFjdGl2aXR5KGFjdGl2aXR5KTsqL1xuICAgIHRocm93IG5ldyBFcnJvcihcIk5vdCBzdXBwb3J0ZWQgeWV0IVwiKTtcbn07XG5cbi8vIEV4cG9ydHM6XG5cbmxldCBhY3Rpdml0eU1hcmt1cCA9IG51bGw7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICAgIHBhcnNlOiBmdW5jdGlvbiAobWFya3VwKSB7XG4gICAgICAgIHJldHVybiAoYWN0aXZpdHlNYXJrdXAgPSAoYWN0aXZpdHlNYXJrdXAgfHwgbmV3IEFjdGl2aXR5TWFya3VwKCkpKS5wYXJzZShtYXJrdXApO1xuICAgIH0sXG5cbiAgICB0b01hcmt1cDogZnVuY3Rpb24gKGFjdGl2aXR5KSB7XG4gICAgICAgIHJldHVybiAoYWN0aXZpdHlNYXJrdXAgPSAoYWN0aXZpdHlNYXJrdXAgfHwgbmV3IEFjdGl2aXR5TWFya3VwKCkpKS50b01hcmt1cChhY3Rpdml0eSk7XG4gICAgfSxcblxuICAgIHN0cmluZ2lmeTogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICByZXR1cm4gKGFjdGl2aXR5TWFya3VwID0gKGFjdGl2aXR5TWFya3VwIHx8IG5ldyBBY3Rpdml0eU1hcmt1cCgpKSkuc3RyaW5naWZ5KG9iaik7XG4gICAgfSxcblxuICAgIGdldEFsaWFzOiBmdW5jdGlvbiAoYWN0aXZpdHkpIHtcbiAgICAgICAgcmV0dXJuIChhY3Rpdml0eU1hcmt1cCA9IChhY3Rpdml0eU1hcmt1cCB8fCBuZXcgQWN0aXZpdHlNYXJrdXAoKSkpLmdldEFsaWFzKGFjdGl2aXR5LmNvbnN0cnVjdG9yKTtcbiAgICB9XG59OyJdfQ==
