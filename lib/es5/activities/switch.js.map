{"version":3,"sources":["activities/switch.js"],"names":[],"mappings":"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","file":"activities/switch.js","sourcesContent":["\"use strict\";\n\nlet Activity = require(\"./activity\");\nlet util = require(\"util\");\nlet _ = require(\"lodash\");\nlet Case = require(\"./case\");\nlet When = require(\"./when\");\nlet Default = require(\"./default\");\nlet errors = require(\"../common/errors\");\nlet constants = require(\"../common/constants\");\n\nfunction Switch() {\n    Activity.call(this);\n\n    this.expression = null;\n}\n\nutil.inherits(Switch, Activity);\n\nSwitch.prototype.run = function (callContext, args) {\n    if (args && args.length) {\n        let parts = {\n            cases: [],\n            whens: [],\n            default: null\n        };\n        for (let arg of args) {\n            if (arg instanceof Case) {\n                parts.cases.push(arg);\n            }\n            else if (arg instanceof When) {\n                parts.whens.push(arg);\n            }\n            else if (arg instanceof Default) {\n                if (parts.default === null) {\n                    parts.default = arg;\n                }\n                else {\n                    throw new errors.ActivityRuntimeError(\"Multiple default for a switch is not allowed.\");\n                }\n            }\n        }\n        if (parts.cases.length || parts.whens.length || parts.default) {\n            this._parts = parts;\n            if (parts.cases.length) {\n                this._doCase = true;\n                callContext.schedule(this.expression, \"_expressionGot\");\n            }\n            else {\n                this._doCase = false;\n                callContext.activity._step.call(this, callContext);\n            }\n            return;\n        }\n    }\n    callContext.complete();\n};\n\nSwitch.prototype._expressionGot = function (callContext, reason, result) {\n    if (reason === Activity.states.complete) {\n        this.expression = result;\n        callContext.activity._step.call(this, callContext);\n    }\n    else {\n        callContext.end(reason, result);\n    }\n};\n\nSwitch.prototype._step = function (callContext) {\n    let parts = this._parts;\n    let doCase = this._doCase;\n    if (doCase && parts.cases.length) {\n        let next = parts.cases[0];\n        parts.cases.splice(0, 1);\n        callContext.schedule(next, \"_partCompleted\");\n    }\n    else if (!doCase && parts.whens.length) {\n        let next = parts.whens[0];\n        parts.whens.splice(0, 1);\n        callContext.schedule(next, \"_partCompleted\");\n    }\n    else if (parts.default) {\n        callContext.schedule(parts.default, \"_partCompleted\");\n    }\n    else {\n        callContext.complete();\n    }\n};\n\nSwitch.prototype._partCompleted = function (callContext, reason, result) {\n    if (reason === Activity.states.complete) {\n        if (result === constants.markers.nope) {\n            callContext.activity._step.call(this, callContext);\n        }\n        else {\n            callContext.complete(result);\n        }\n    }\n    else {\n        callContext.end(reason, result);\n    }\n};\n\nmodule.exports = Switch;"],"sourceRoot":"/source/"}