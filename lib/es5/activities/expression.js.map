{"version":3,"names":[],"mappings":"","sources":["activities/expression.js"],"sourcesContent":["/* jshint -W054*/\n\"use strict\";\n\nlet Activity = require(\"./activity\");\nlet util = require(\"util\");\nlet _ = require(\"lodash\");\nlet errors = require(\"../common/errors\");\n\nfunction Expression(expr) {\n    Activity.call(this);\n    this.expr = expr || null;\n    this.nonSerializedProperties.add(\"_f\");\n}\n\nutil.inherits(Expression, Activity);\n\nExpression.prototype.run = function (callContext, args) {\n    let self = this;\n    let expr = self.expr;\n    if (expr) {\n        try {\n            let f = self._f;\n            if (!f) {\n                f = self._f = new Function(\"_\", \"return (\" + expr + \")\");\n            }\n            let result = f.call(self, _);\n            if (result === callContext.activity) {\n                let parent = this.$parent;\n                if (!parent) {\n                    callContext.fail(new errors.ActivityRuntimeError(\"Exception can't reference itself.\"));\n                    return;\n                }\n                result = f.call(parent, _);\n            }\n            callContext.complete(result);\n        }\n        catch(e) {\n            callContext.fail(e);\n        }\n    }\n    else {\n        callContext.complete(null);\n    }\n};\n\nmodule.exports = Expression;\n"],"file":"activities/expression.js","sourceRoot":"/source/"}