"use strict";
var _ = require('lodash');
var Reflection = require('backpack-node').system.Reflection;
var maxDepth = 10;
var templateHelpers = {
  isTemplate: function(obj) {
    var activityCount = 0;
    templateHelpers.visitActivities(obj, function() {
      activityCount++;
    });
    return activityCount > 0;
  },
  visitActivities: function(obj, f) {
    if (!_.isPlainObject(obj) && !_.isArray(obj))
      return ;
    Reflection.visitObject(obj, function(subObj, parent, pkey) {
      if (_.isString(subObj)) {
        var str = subObj.trim();
        if (str.length > 1 && str[0] === '#') {
          var markup = {expression: {expr: str.substr(1)}};
          f(markup, parent, pkey);
          return false;
        }
      } else if (_.isPlainObject(subObj)) {
        var keys = _.keys(subObj);
        if (keys.length === 1) {
          var key = keys[0];
          if (key[0] === '@' && key.length > 1) {
            var markup = {};
            markup[key.substr(1)] = subObj[key];
            f(markup, parent, pkey);
            return false;
          }
        } else if (keys.length == 2) {
          var key1 = keys[0];
          var key2 = keys[1];
          if (key1 === '@require' && key2[0] === '@' && key2.length > 1) {
            var markup = {};
            markup[key1] = subObj[key1];
            markup[key2.substr(1)] = subObj[key2];
            f(markup, parent, pkey);
            return false;
          } else if (key2 === '@require' && key1[0] === '@' && key1.length > 1) {
            var markup = {};
            markup[key2] = subObj[key2];
            markup[key1.substr(1)] = subObj[key1];
            f(markup, parent, pkey);
            return false;
          }
        }
      }
      return true;
    }, maxDepth);
  }
};
module.exports = templateHelpers;
//# sourceMappingURL=data:application/json;base64,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ZXMvdGVtcGxhdGVIZWxwZXJzLmpzIiwic291cmNlUm9vdCI6ImxpYi9lczYiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgXyA9IHJlcXVpcmUoJ2xvZGFzaCcpO1xudmFyIFJlZmxlY3Rpb24gPSByZXF1aXJlKCdiYWNrcGFjay1ub2RlJykuc3lzdGVtLlJlZmxlY3Rpb247XG5cbnZhciBtYXhEZXB0aCA9IDEwO1xuXG52YXIgdGVtcGxhdGVIZWxwZXJzID0ge1xuXG4gICAgaXNUZW1wbGF0ZTogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICB2YXIgYWN0aXZpdHlDb3VudCA9IDA7XG4gICAgICAgIHRlbXBsYXRlSGVscGVycy52aXNpdEFjdGl2aXRpZXMob2JqLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBhY3Rpdml0eUNvdW50Kys7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gYWN0aXZpdHlDb3VudCA+IDA7XG4gICAgfSxcblxuICAgIHZpc2l0QWN0aXZpdGllczogZnVuY3Rpb24gKG9iaiwgZikge1xuICAgICAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChvYmopICYmICFfLmlzQXJyYXkob2JqKSkgcmV0dXJuO1xuICAgICAgICBSZWZsZWN0aW9uLnZpc2l0T2JqZWN0KG9iaiwgZnVuY3Rpb24gKHN1Yk9iaiwgcGFyZW50LCBwa2V5KSB7XG5cbiAgICAgICAgICAgIGlmIChfLmlzU3RyaW5nKHN1Yk9iaikpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RyID0gc3ViT2JqLnRyaW0oKTtcbiAgICAgICAgICAgICAgICBpZiAoc3RyLmxlbmd0aCA+IDEgJiYgc3RyWzBdID09PSAnIycpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hcmt1cCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHByOiBzdHIuc3Vic3RyKDEpXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGYobWFya3VwLCBwYXJlbnQsIHBrZXkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoXy5pc1BsYWluT2JqZWN0KHN1Yk9iaikpIHtcblxuICAgICAgICAgICAgICAgIHZhciBrZXlzID0gXy5rZXlzKHN1Yk9iaik7XG5cbiAgICAgICAgICAgICAgICBpZiAoa2V5cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IGtleXNbMF07XG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXlbMF0gPT09ICdAJyAmJiBrZXkubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1hcmt1cCA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgbWFya3VwW2tleS5zdWJzdHIoMSldID0gc3ViT2JqW2tleV07XG4gICAgICAgICAgICAgICAgICAgICAgICBmKG1hcmt1cCwgcGFyZW50LCBwa2V5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChrZXlzLmxlbmd0aCA9PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBrZXkxID0ga2V5c1swXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleTIgPSBrZXlzWzFdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5MSA9PT0gJ0ByZXF1aXJlJyAmJiBrZXkyWzBdID09PSAnQCcgJiYga2V5Mi5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWFya3VwID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXJrdXBba2V5MV0gPSBzdWJPYmpba2V5MV07XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXJrdXBba2V5Mi5zdWJzdHIoMSldID0gc3ViT2JqW2tleTJdO1xuICAgICAgICAgICAgICAgICAgICAgICAgZihtYXJrdXAsIHBhcmVudCwgcGtleSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoa2V5MiA9PT0gJ0ByZXF1aXJlJyAmJiBrZXkxWzBdID09PSAnQCcgJiYga2V5MS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWFya3VwID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXJrdXBba2V5Ml0gPSBzdWJPYmpba2V5Ml07XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXJrdXBba2V5MS5zdWJzdHIoMSldID0gc3ViT2JqW2tleTFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgZihtYXJrdXAsIHBhcmVudCwgcGtleSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSwgbWF4RGVwdGgpO1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gdGVtcGxhdGVIZWxwZXJzOyJdfQ==
