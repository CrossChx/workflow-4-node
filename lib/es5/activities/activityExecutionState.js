"use strict";
var EventEmitter = require('events').EventEmitter;
var util = require("util");
var enums = require("../common/enums");
var is = require("../common/is");
var StrSet = require("backpack-node").collections.StrSet;
var _ = require("lodash");
function ActivityExecutionState(activityId) {
  this.activityId = activityId;
  this.execState = null;
  this.parentActivityId = null;
  this.childActivityIds = new StrSet();
}
util.inherits(ActivityExecutionState, EventEmitter);
Object.defineProperties(ActivityExecutionState.prototype, {isRunning: {get: function() {
      return this.execState === enums.ActivityStates.run;
    }}});
ActivityExecutionState.prototype.reportState = function(reason, result) {
  if (this.execState !== reason) {
    this.execState = reason;
    this.emitState(reason, result);
  }
};
ActivityExecutionState.prototype.emitState = function(result) {
  this.emit(this.execState, result);
  if (this.execState !== enums.ActivityStates.run) {
    this.emit(enums.ActivityStates.end, this.execState, result);
  }
};
ActivityExecutionState.prototype.asJSON = function() {
  return {execState: this.execState};
};
ActivityExecutionState.prototype.fromJSON = function(json) {
  if (!_.isObject(json))
    throw new TypeError("Object argument expected.");
  if (json.execState !== null) {
    if (!_.isString(json.execState))
      throw new TypeError("Argument object's execState property value is not a string.");
    if (is.undefined(enums.ActivityStates[json.execState]))
      throw new TypeError("Argument object's execState property value is not a valid Activity state value.");
  }
  this.execState = json.execState;
};
module.exports = ActivityExecutionState;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjdGl2aXR5RXhlY3V0aW9uU3RhdGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQSxBQUFJLEVBQUEsQ0FBQSxZQUFXLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxRQUFPLENBQUMsYUFBYSxDQUFDO0FBQ2pELEFBQUksRUFBQSxDQUFBLElBQUcsRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLE1BQUssQ0FBQyxDQUFDO0FBQzFCLEFBQUksRUFBQSxDQUFBLEtBQUksRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLGlCQUFnQixDQUFDLENBQUM7QUFDdEMsQUFBSSxFQUFBLENBQUEsRUFBQyxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsY0FBYSxDQUFDLENBQUM7QUFDaEMsQUFBSSxFQUFBLENBQUEsTUFBSyxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsZUFBYyxDQUFDLFlBQVksT0FBTyxDQUFDO0FBQ3hELEFBQUksRUFBQSxDQUFBLENBQUEsRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLFFBQU8sQ0FBQyxDQUFDO0FBRXpCLE9BQVMsdUJBQXFCLENBQUUsVUFBUyxDQUFHO0FBQ3hDLEtBQUcsV0FBVyxFQUFJLFdBQVMsQ0FBQztBQUM1QixLQUFHLFVBQVUsRUFBSSxLQUFHLENBQUM7QUFDckIsS0FBRyxpQkFBaUIsRUFBSSxLQUFHLENBQUM7QUFDNUIsS0FBRyxpQkFBaUIsRUFBSSxJQUFJLE9BQUssQUFBQyxFQUFDLENBQUM7QUFDeEM7QUFBQSxBQUVBLEdBQUcsU0FBUyxBQUFDLENBQUMsc0JBQXFCLENBQUcsYUFBVyxDQUFDLENBQUM7QUFFbkQsS0FBSyxpQkFBaUIsQUFBQyxDQUFDLHNCQUFxQixVQUFVLENBQUcsRUFDdEQsU0FBUSxDQUFHLEVBQ1AsR0FBRSxDQUFHLFVBQVUsQUFBRCxDQUFHO0FBQ2IsV0FBTyxDQUFBLElBQUcsVUFBVSxJQUFNLENBQUEsS0FBSSxlQUFlLElBQUksQ0FBQztJQUN0RCxDQUNKLENBQ0osQ0FBQyxDQUFDO0FBRUYscUJBQXFCLFVBQVUsWUFBWSxFQUFJLFVBQVUsTUFBSyxDQUFHLENBQUEsTUFBSyxDQUFHO0FBQ3JFLEtBQUksSUFBRyxVQUFVLElBQU0sT0FBSyxDQUFHO0FBQzNCLE9BQUcsVUFBVSxFQUFJLE9BQUssQ0FBQztBQUN2QixPQUFHLFVBQVUsQUFBQyxDQUFDLE1BQUssQ0FBRyxPQUFLLENBQUMsQ0FBQztFQUNsQztBQUFBLEFBQ0osQ0FBQTtBQUVBLHFCQUFxQixVQUFVLFVBQVUsRUFBSSxVQUFVLE1BQUssQ0FBRztBQUMzRCxLQUFHLEtBQUssQUFBQyxDQUFDLElBQUcsVUFBVSxDQUFHLE9BQUssQ0FBQyxDQUFDO0FBQ2pDLEtBQUksSUFBRyxVQUFVLElBQU0sQ0FBQSxLQUFJLGVBQWUsSUFBSSxDQUFHO0FBQzdDLE9BQUcsS0FBSyxBQUFDLENBQUMsS0FBSSxlQUFlLElBQUksQ0FBRyxDQUFBLElBQUcsVUFBVSxDQUFHLE9BQUssQ0FBQyxDQUFDO0VBQy9EO0FBQUEsQUFDSixDQUFBO0FBR0EscUJBQXFCLFVBQVUsT0FBTyxFQUFJLFVBQVUsQUFBRCxDQUFHO0FBQ2xELE9BQU8sRUFDSCxTQUFRLENBQUcsQ0FBQSxJQUFHLFVBQVUsQ0FDNUIsQ0FBQztBQUNMLENBQUE7QUFFQSxxQkFBcUIsVUFBVSxTQUFTLEVBQUksVUFBVSxJQUFHLENBQUc7QUFDeEQsS0FBSSxDQUFDLENBQUEsU0FBUyxBQUFDLENBQUMsSUFBRyxDQUFDO0FBQUcsUUFBTSxJQUFJLFVBQVEsQUFBQyxDQUFDLDJCQUEwQixDQUFDLENBQUM7QUFBQSxBQUN2RSxLQUFJLElBQUcsVUFBVSxJQUFNLEtBQUcsQ0FBRztBQUN6QixPQUFJLENBQUMsQ0FBQSxTQUFTLEFBQUMsQ0FBQyxJQUFHLFVBQVUsQ0FBQztBQUFHLFVBQU0sSUFBSSxVQUFRLEFBQUMsQ0FBQyw2REFBNEQsQ0FBQyxDQUFDO0FBQUEsQUFDbkgsT0FBSSxFQUFDLFVBQVUsQUFBQyxDQUFDLEtBQUksZUFBZSxDQUFFLElBQUcsVUFBVSxDQUFDLENBQUM7QUFBRyxVQUFNLElBQUksVUFBUSxBQUFDLENBQUMsaUZBQWdGLENBQUMsQ0FBQztBQUFBLEVBQ2xLO0FBQUEsQUFFQSxLQUFHLFVBQVUsRUFBSSxDQUFBLElBQUcsVUFBVSxDQUFDO0FBQ25DLENBQUE7QUFHQSxLQUFLLFFBQVEsRUFBSSx1QkFBcUIsQ0FBQztBQUN2QyIsImZpbGUiOiJhY3Rpdml0aWVzL2FjdGl2aXR5RXhlY3V0aW9uU3RhdGUuanMiLCJzb3VyY2VSb290IjoibGliL2VzNiIsInNvdXJjZXNDb250ZW50IjpbInZhciBFdmVudEVtaXR0ZXIgPSByZXF1aXJlKCdldmVudHMnKS5FdmVudEVtaXR0ZXI7XG52YXIgdXRpbCA9IHJlcXVpcmUoXCJ1dGlsXCIpO1xudmFyIGVudW1zID0gcmVxdWlyZShcIi4uL2NvbW1vbi9lbnVtc1wiKTtcbnZhciBpcyA9IHJlcXVpcmUoXCIuLi9jb21tb24vaXNcIik7XG52YXIgU3RyU2V0ID0gcmVxdWlyZShcImJhY2twYWNrLW5vZGVcIikuY29sbGVjdGlvbnMuU3RyU2V0O1xudmFyIF8gPSByZXF1aXJlKFwibG9kYXNoXCIpO1xuXG5mdW5jdGlvbiBBY3Rpdml0eUV4ZWN1dGlvblN0YXRlKGFjdGl2aXR5SWQpIHtcbiAgICB0aGlzLmFjdGl2aXR5SWQgPSBhY3Rpdml0eUlkO1xuICAgIHRoaXMuZXhlY1N0YXRlID0gbnVsbDtcbiAgICB0aGlzLnBhcmVudEFjdGl2aXR5SWQgPSBudWxsO1xuICAgIHRoaXMuY2hpbGRBY3Rpdml0eUlkcyA9IG5ldyBTdHJTZXQoKTtcbn1cblxudXRpbC5pbmhlcml0cyhBY3Rpdml0eUV4ZWN1dGlvblN0YXRlLCBFdmVudEVtaXR0ZXIpO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydGllcyhBY3Rpdml0eUV4ZWN1dGlvblN0YXRlLnByb3RvdHlwZSwge1xuICAgIGlzUnVubmluZzoge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmV4ZWNTdGF0ZSA9PT0gZW51bXMuQWN0aXZpdHlTdGF0ZXMucnVuO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cbkFjdGl2aXR5RXhlY3V0aW9uU3RhdGUucHJvdG90eXBlLnJlcG9ydFN0YXRlID0gZnVuY3Rpb24gKHJlYXNvbiwgcmVzdWx0KSB7XG4gICAgaWYgKHRoaXMuZXhlY1N0YXRlICE9PSByZWFzb24pIHtcbiAgICAgICAgdGhpcy5leGVjU3RhdGUgPSByZWFzb247XG4gICAgICAgIHRoaXMuZW1pdFN0YXRlKHJlYXNvbiwgcmVzdWx0KTtcbiAgICB9XG59XG5cbkFjdGl2aXR5RXhlY3V0aW9uU3RhdGUucHJvdG90eXBlLmVtaXRTdGF0ZSA9IGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICB0aGlzLmVtaXQodGhpcy5leGVjU3RhdGUsIHJlc3VsdCk7XG4gICAgaWYgKHRoaXMuZXhlY1N0YXRlICE9PSBlbnVtcy5BY3Rpdml0eVN0YXRlcy5ydW4pIHtcbiAgICAgICAgdGhpcy5lbWl0KGVudW1zLkFjdGl2aXR5U3RhdGVzLmVuZCwgdGhpcy5leGVjU3RhdGUsIHJlc3VsdCk7XG4gICAgfVxufVxuXG4vKiBTRVJJQUxJWkFUSU9OICovXG5BY3Rpdml0eUV4ZWN1dGlvblN0YXRlLnByb3RvdHlwZS5hc0pTT04gPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZXhlY1N0YXRlOiB0aGlzLmV4ZWNTdGF0ZVxuICAgIH07XG59XG5cbkFjdGl2aXR5RXhlY3V0aW9uU3RhdGUucHJvdG90eXBlLmZyb21KU09OID0gZnVuY3Rpb24gKGpzb24pIHtcbiAgICBpZiAoIV8uaXNPYmplY3QoanNvbikpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJPYmplY3QgYXJndW1lbnQgZXhwZWN0ZWQuXCIpO1xuICAgIGlmIChqc29uLmV4ZWNTdGF0ZSAhPT0gbnVsbCkge1xuICAgICAgICBpZiAoIV8uaXNTdHJpbmcoanNvbi5leGVjU3RhdGUpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQXJndW1lbnQgb2JqZWN0J3MgZXhlY1N0YXRlIHByb3BlcnR5IHZhbHVlIGlzIG5vdCBhIHN0cmluZy5cIik7XG4gICAgICAgIGlmIChpcy51bmRlZmluZWQoZW51bXMuQWN0aXZpdHlTdGF0ZXNbanNvbi5leGVjU3RhdGVdKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFyZ3VtZW50IG9iamVjdCdzIGV4ZWNTdGF0ZSBwcm9wZXJ0eSB2YWx1ZSBpcyBub3QgYSB2YWxpZCBBY3Rpdml0eSBzdGF0ZSB2YWx1ZS5cIik7XG4gICAgfVxuXG4gICAgdGhpcy5leGVjU3RhdGUgPSBqc29uLmV4ZWNTdGF0ZTtcbn1cbi8qIFNFUklBTElaQVRJT04gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBBY3Rpdml0eUV4ZWN1dGlvblN0YXRlO1xuIl19
