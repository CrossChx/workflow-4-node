{"version":3,"sources":["activities/scopeNode.js"],"names":[],"mappings":"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","file":"activities/scopeNode.js","sourcesContent":["\"use strict\";\n\nlet util = require(\"util\");\nlet _ = require(\"lodash\");\nlet is = require(\"../common/is\");\nlet assert = require(\"assert\");\n\nfunction ScopeNode(instanceId, scopePart, userId, activity) {\n    assert(instanceId);\n    assert(scopePart);\n    this.instanceId = instanceId;\n    this.userId = userId;\n    this.activity = activity || null;\n    this._parent = null;\n    this._children = new Map();\n    this._scopePart = scopePart;\n    this._keys = [];\n    for (let key in scopePart) {\n        this._keys.push(key);\n    }\n}\n\nObject.defineProperties(ScopeNode.prototype, {\n    _keys: {\n        value: null,\n        writable: true,\n        enumerable: false\n    },\n    scopePart: {\n        get: function() {\n            return this._scopePart;\n        }\n    },\n    parent: {\n        get: function () {\n            return this._parent;\n        },\n        set: function (value) {\n            if (value !== null && !(value instanceof ScopeNode)) {\n                throw new TypeError(\"Node argument expected.\");\n            }\n            if (this._parent !== null) {\n                throw new Error(\"Parent already defined.\");\n            }\n            value.addChild(this);\n        }\n    }\n});\n\nScopeNode.prototype.walkToRoot = function* () {\n    let current = this;\n    while (current) {\n        yield current;\n        current = current._parent;\n    }\n};\n\nScopeNode.prototype.children = function* () {\n    for (let child of this._children.values()) {\n        yield child;\n    }\n};\n\nScopeNode.prototype.addChild = function (childItem) {\n    if (!(childItem instanceof ScopeNode)) {\n        throw new TypeError(\"Node argument expected.\");\n    }\n    if (childItem._parent) {\n        throw new Error(\"Item has been already ha a parent node.\");\n    }\n    childItem._parent = this;\n    this._children.set(childItem.instanceId, childItem);\n};\n\nScopeNode.prototype.removeChild = function (childItem) {\n    if (!(childItem instanceof ScopeNode)) {\n        throw new TypeError(\"Node argument expected.\");\n    }\n    if (childItem._parent !== this) {\n        throw new Error(\"Item is not a current node's child.\");\n    }\n    childItem._parent = null;\n    this._children.delete(childItem.instanceId);\n};\n\nScopeNode.prototype.clearChildren = function () {\n    this._children.clear();\n};\n\nScopeNode.prototype.isPropertyExists = function (name) {\n    return !_.isUndefined(this._scopePart[name]);\n};\n\nScopeNode.prototype.getPropertyValue = function (name, canReturnPrivate) {\n    if (canReturnPrivate) {\n        return this._scopePart[name];\n    }\n    else if (!this._isPrivate(name)) {\n        return this._scopePart[name];\n    }\n};\n\nScopeNode.prototype.setPropertyValue = function (name, value, canSetPrivate) {\n    if (this._isPrivate(name)) {\n        if (canSetPrivate) {\n            if (!this.isPropertyExists(name)) {\n                this._keys.push(name);\n            }\n            this._scopePart[name] = value;\n            return true;\n        }\n    }\n    else if (!_.isUndefined(this._scopePart[name])) {\n        this._scopePart[name] = value;\n        return true;\n    }\n    return false;\n};\n\nScopeNode.prototype.createPropertyWithValue = function (name, value) {\n    if (!this.isPropertyExists(name)) {\n        this._keys.push(name);\n    }\n    this._scopePart[name] = value;\n};\n\nScopeNode.prototype.deleteProperty = function (name, canDeletePrivate) {\n    if (!_.isUndefined(this._scopePart[name])) {\n        if (this._isPrivate(name)) {\n            if (canDeletePrivate) {\n                this._keys.splice(_.indexOf(this._keys, name), 1);\n                delete this._scopePart[name];\n                return true;\n            }\n        }\n        else {\n            this._keys.splice(_.indexOf(this._keys, name), 1);\n            delete this._scopePart[name];\n            return true;\n        }\n    }\n    return false;\n};\n\nScopeNode.prototype.enumeratePropertyNames = function* (canEnumeratePrivate) {\n    if (canEnumeratePrivate) {\n        for (let i = 0; i < this._keys.length; i++) {\n            yield this._keys[i];\n        }\n    }\n    else {\n        for (let i = 0; i < this._keys.length; i++) {\n            let key = this._keys[i];\n            if (!this._isPrivate(key)) {\n                yield key;\n            }\n        }\n    }\n};\n\nScopeNode.prototype.properties = function* () {\n    let self = this;\n    for (let fn of self._keys) {\n        yield { name: fn, value: self._scopePart[fn] };\n    }\n};\n\nScopeNode.prototype._isPrivate = function (key) {\n    return key[0] === \"_\";\n};\n\nmodule.exports = ScopeNode;\n"],"sourceRoot":"/source/"}