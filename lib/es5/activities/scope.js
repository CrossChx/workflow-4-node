"use strict";
var _ = require("lodash");
var scopeFactory = {create: function(scopeTree, node, noWalk) {
    var Proxy;
    try {
      Proxy = require("node-proxy");
    } catch (e) {
      _.noop(e);
    }
    if (Proxy) {
      return Proxy.create({
        has: function(name) {
          return scopeTree.hasProperty(node, name, noWalk);
        },
        get: function(target, name) {
          if (name === "$keys") {
            return scopeTree.enumeratePropertyNames(node, noWalk);
          } else if (name === "delete") {
            return this.delete;
          } else if (name === "update") {
            return _.noop;
          }
          return scopeTree.getValue(node, name, noWalk);
        },
        set: function(target, name, value) {
          if (name === "$keys" || name === "delete" || name === "update") {
            throw new TypeError((name + " is read only."));
          }
          scopeTree.setValue(node, name, value, noWalk);
          return value;
        },
        delete: function(name) {
          return scopeTree.deleteProperty(node, name, noWalk);
        },
        enumerate: function(target) {
          return scopeTree.enumeratePropertyNames(node, noWalk);
        }
      });
    } else {
      var SimpleProxy = require("../common/simpleProxy");
      var getKeys = function() {
        var keys = [];
        var has = new Set();
        var $__5 = true;
        var $__6 = false;
        var $__7 = undefined;
        try {
          for (var $__3 = void 0,
              $__2 = (scopeTree.enumeratePropertyNames(node, noWalk))[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
            var key = $__3.value;
            {
              if (!has.has(key)) {
                keys.push(key);
                has.add(key);
              }
            }
          }
        } catch ($__8) {
          $__6 = true;
          $__7 = $__8;
        } finally {
          try {
            if (!$__5 && $__2.return != null) {
              $__2.return();
            }
          } finally {
            if ($__6) {
              throw $__7;
            }
          }
        }
        return keys;
      };
      return new SimpleProxy({
        getKeys: function(proxy) {
          return getKeys();
        },
        getValue: function(proxy, name) {
          return scopeTree.getValue(node, name, noWalk);
        },
        setValue: function(proxy, name, value) {
          scopeTree.setValue(node, name, value, noWalk);
          return value;
        },
        delete: function(proxy, name) {
          scopeTree.deleteProperty(node, name, noWalk);
        }
      });
    }
  }};
module.exports = scopeFactory;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjb3BlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBRUEsQUFBSSxFQUFBLENBQUEsQ0FBQSxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsUUFBTyxDQUFDLENBQUM7QUFFekIsQUFBSSxFQUFBLENBQUEsWUFBVyxFQUFJLEVBQ2YsTUFBSyxDQUFHLFVBQVMsU0FBUSxDQUFHLENBQUEsSUFBRyxDQUFHLENBQUEsTUFBSztBQUNuQyxBQUFJLE1BQUEsQ0FBQSxLQUFJLENBQUM7QUFDVCxNQUFJO0FBQ0EsVUFBSSxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsWUFBVyxDQUFDLENBQUM7SUFDakMsQ0FDQSxPQUFNLENBQUEsQ0FBRztBQUNMLE1BQUEsS0FBSyxBQUFDLENBQUMsQ0FBQSxDQUFDLENBQUM7SUFDYjtBQUFBLEFBQ0EsT0FBSSxLQUFJLENBQUc7QUFFUCxXQUFPLENBQUEsS0FBSSxPQUFPLEFBQUMsQ0FBQztBQUNoQixVQUFFLENBQUcsVUFBVSxJQUFHLENBQUc7QUFDakIsZUFBTyxDQUFBLFNBQVEsWUFBWSxBQUFDLENBQUMsSUFBRyxDQUFHLEtBQUcsQ0FBRyxPQUFLLENBQUMsQ0FBQztRQUNwRDtBQUVBLFVBQUUsQ0FBRyxVQUFVLE1BQUssQ0FBRyxDQUFBLElBQUcsQ0FBRztBQUN6QixhQUFJLElBQUcsSUFBTSxRQUFNLENBQUc7QUFDbEIsaUJBQU8sQ0FBQSxTQUFRLHVCQUF1QixBQUFDLENBQUMsSUFBRyxDQUFHLE9BQUssQ0FBQyxDQUFDO1VBQ3pELEtBQ0ssS0FBSSxJQUFHLElBQU0sU0FBTyxDQUFHO0FBQ3hCLGlCQUFPLENBQUEsSUFBRyxPQUFPLENBQUM7VUFDdEIsS0FDSyxLQUFJLElBQUcsSUFBTSxTQUFPLENBQUc7QUFDeEIsaUJBQU8sQ0FBQSxDQUFBLEtBQUssQ0FBQztVQUNqQjtBQUFBLEFBQ0EsZUFBTyxDQUFBLFNBQVEsU0FBUyxBQUFDLENBQUMsSUFBRyxDQUFHLEtBQUcsQ0FBRyxPQUFLLENBQUMsQ0FBQztRQUNqRDtBQUVBLFVBQUUsQ0FBRyxVQUFVLE1BQUssQ0FBRyxDQUFBLElBQUcsQ0FBRyxDQUFBLEtBQUksQ0FBRztBQUNoQyxhQUFJLElBQUcsSUFBTSxRQUFNLENBQUEsRUFBSyxDQUFBLElBQUcsSUFBTSxTQUFPLENBQUEsRUFBSyxDQUFBLElBQUcsSUFBTSxTQUFPLENBQUc7QUFDNUQsZ0JBQU0sSUFBSSxVQUFRLEFBQUMsRUFBSSxJQUFHLEVBQUMsaUJBQWUsRUFBQyxDQUFDO1VBQ2hEO0FBQUEsQUFDQSxrQkFBUSxTQUFTLEFBQUMsQ0FBQyxJQUFHLENBQUcsS0FBRyxDQUFHLE1BQUksQ0FBRyxPQUFLLENBQUMsQ0FBQztBQUM3QyxlQUFPLE1BQUksQ0FBQztRQUNoQjtBQUVBLGFBQUssQ0FBRyxVQUFVLElBQUcsQ0FBRztBQUNwQixlQUFPLENBQUEsU0FBUSxlQUFlLEFBQUMsQ0FBQyxJQUFHLENBQUcsS0FBRyxDQUFHLE9BQUssQ0FBQyxDQUFDO1FBQ3ZEO0FBRUEsZ0JBQVEsQ0FBRyxVQUFVLE1BQUssQ0FBRztBQUN6QixlQUFPLENBQUEsU0FBUSx1QkFBdUIsQUFBQyxDQUFDLElBQUcsQ0FBRyxPQUFLLENBQUMsQ0FBQztRQUN6RDtBQUFBLE1BQ0osQ0FBQyxDQUFDO0lBQ04sS0FDSztBQUVELEFBQUksUUFBQSxDQUFBLFdBQVUsRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLHVCQUFzQixDQUFDLENBQUM7QUFFbEQsQUFBSSxRQUFBLENBQUEsT0FBTSxFQUFJLFVBQVMsQUFBRDtBQUNsQixBQUFJLFVBQUEsQ0FBQSxJQUFHLEVBQUksR0FBQyxDQUFDO0FBQ2IsQUFBSSxVQUFBLENBQUEsR0FBRSxFQUFJLElBQUksSUFBRSxBQUFDLEVBQUMsQ0FBQztBQXZEM0IsQUFBSSxVQUFBLE9BQW9CLEtBQUcsQ0FBQztBQUM1QixBQUFJLFVBQUEsT0FBb0IsTUFBSSxDQUFDO0FBQzdCLEFBQUksVUFBQSxPQUFvQixVQUFRLENBQUM7QUFDakMsVUFBSTtBQUhKLGNBQVMsR0FBQSxPQURqQixLQUFLLEVBQUEsQUFDNEI7QUFDaEIsbUJBQW9CLENBQUEsQ0F1REwsU0FBUSx1QkFBdUIsQUFBQyxDQUFDLElBQUcsQ0FBRyxPQUFLLENBQUMsQ0F2RHRCLENBQ2xDLGVBQWMsV0FBVyxBQUFDLENBQUMsTUFBSyxTQUFTLENBQUMsQ0FBQyxBQUFDLEVBQUMsQ0FDckQsRUFBQyxDQUFDLE1BQW9CLENBQUEsQ0FBQyxNQUFvQixDQUFBLFNBQXFCLEFBQUMsRUFBQyxDQUFDLEtBQUssQ0FBQyxDQUN6RSxPQUFvQixLQUFHLENBQUc7Y0FvRGQsSUFBRTtBQUFxRDtBQUM1RCxpQkFBSSxDQUFDLEdBQUUsSUFBSSxBQUFDLENBQUMsR0FBRSxDQUFDLENBQUc7QUFDZixtQkFBRyxLQUFLLEFBQUMsQ0FBQyxHQUFFLENBQUMsQ0FBQztBQUNkLGtCQUFFLElBQUksQUFBQyxDQUFDLEdBQUUsQ0FBQyxDQUFDO2NBQ2hCO0FBQUEsWUFDSjtVQXREUjtBQUFBLFFBRkEsQ0FBRSxZQUEwQjtBQUMxQixlQUFvQixLQUFHLENBQUM7QUFDeEIsb0JBQW9DLENBQUM7UUFDdkMsQ0FBRSxPQUFRO0FBQ1IsWUFBSTtBQUNGLGVBQUksS0FBaUIsR0FBSyxDQUFBLFdBQXVCLEdBQUssS0FBRyxDQUFHO0FBQzFELHdCQUF3QixBQUFDLEVBQUMsQ0FBQztZQUM3QjtBQUFBLFVBQ0YsQ0FBRSxPQUFRO0FBQ1Isb0JBQXdCO0FBQ3RCLHdCQUF3QjtZQUMxQjtBQUFBLFVBQ0Y7QUFBQSxRQUNGO0FBQUEsQUE0Q1EsYUFBTyxLQUFHLENBQUM7TUFDZixDQUFDO0FBRUQsV0FBTyxJQUFJLFlBQVUsQUFBQyxDQUFDO0FBQ25CLGNBQU0sQ0FBRyxVQUFVLEtBQUksQ0FBRztBQUN0QixlQUFPLENBQUEsT0FBTSxBQUFDLEVBQUMsQ0FBQztRQUNwQjtBQUNBLGVBQU8sQ0FBRyxVQUFVLEtBQUksQ0FBRyxDQUFBLElBQUcsQ0FBRztBQUM3QixlQUFPLENBQUEsU0FBUSxTQUFTLEFBQUMsQ0FBQyxJQUFHLENBQUcsS0FBRyxDQUFHLE9BQUssQ0FBQyxDQUFDO1FBQ2pEO0FBQ0EsZUFBTyxDQUFHLFVBQVUsS0FBSSxDQUFHLENBQUEsSUFBRyxDQUFHLENBQUEsS0FBSSxDQUFHO0FBQ3BDLGtCQUFRLFNBQVMsQUFBQyxDQUFDLElBQUcsQ0FBRyxLQUFHLENBQUcsTUFBSSxDQUFHLE9BQUssQ0FBQyxDQUFDO0FBQzdDLGVBQU8sTUFBSSxDQUFDO1FBQ2hCO0FBQ0EsYUFBSyxDQUFHLFVBQVUsS0FBSSxDQUFHLENBQUEsSUFBRyxDQUFHO0FBQzNCLGtCQUFRLGVBQWUsQUFBQyxDQUFDLElBQUcsQ0FBRyxLQUFHLENBQUcsT0FBSyxDQUFDLENBQUM7UUFDaEQ7QUFBQSxNQUNKLENBQUMsQ0FBQztJQUNOO0FBQUEsRUFDSixDQUNKLENBQUM7QUFFRCxLQUFLLFFBQVEsRUFBSSxhQUFXLENBQUM7QUE4QjFCIiwiZmlsZSI6ImFjdGl2aXRpZXMvc2NvcGUuanMiLCJzb3VyY2VSb290IjoibGliL2VzNiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5sZXQgXyA9IHJlcXVpcmUoXCJsb2Rhc2hcIik7XG5cbmxldCBzY29wZUZhY3RvcnkgPSB7XG4gICAgY3JlYXRlOiBmdW5jdGlvbihzY29wZVRyZWUsIG5vZGUsIG5vV2Fsaykge1xuICAgICAgICBsZXQgUHJveHk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBQcm94eSA9IHJlcXVpcmUoXCJub2RlLXByb3h5XCIpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoKGUpIHtcbiAgICAgICAgICAgIF8ubm9vcChlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoUHJveHkpIHtcbiAgICAgICAgICAgIC8vIG5vZGUtcHJveHkgaXMgc3VjY2Vzc2Z1bGx5IGNvbXBpbGVkIGFuZCBsb2RhZGVkXG4gICAgICAgICAgICByZXR1cm4gUHJveHkuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICBoYXM6IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzY29wZVRyZWUuaGFzUHJvcGVydHkobm9kZSwgbmFtZSwgbm9XYWxrKTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAodGFyZ2V0LCBuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuYW1lID09PSBcIiRrZXlzXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzY29wZVRyZWUuZW51bWVyYXRlUHJvcGVydHlOYW1lcyhub2RlLCBub1dhbGspO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG5hbWUgPT09IFwiZGVsZXRlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRlbGV0ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChuYW1lID09PSBcInVwZGF0ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5ub29wO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzY29wZVRyZWUuZ2V0VmFsdWUobm9kZSwgbmFtZSwgbm9XYWxrKTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodGFyZ2V0LCBuYW1lLCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobmFtZSA9PT0gXCIka2V5c1wiIHx8IG5hbWUgPT09IFwiZGVsZXRlXCIgfHwgbmFtZSA9PT0gXCJ1cGRhdGVcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgJHtuYW1lfSBpcyByZWFkIG9ubHkuYCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc2NvcGVUcmVlLnNldFZhbHVlKG5vZGUsIG5hbWUsIHZhbHVlLCBub1dhbGspO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGRlbGV0ZTogZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlVHJlZS5kZWxldGVQcm9wZXJ0eShub2RlLCBuYW1lLCBub1dhbGspO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBlbnVtZXJhdGU6IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlVHJlZS5lbnVtZXJhdGVQcm9wZXJ0eU5hbWVzKG5vZGUsIG5vV2Fsayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBub2RlLXByb3h5IGlzIHVuYXZhaWxhYmxlLCB3ZSBzaG91bGQgZW11bGF0ZSBhIHByb3h5OlxuICAgICAgICAgICAgbGV0IFNpbXBsZVByb3h5ID0gcmVxdWlyZShcIi4uL2NvbW1vbi9zaW1wbGVQcm94eVwiKTtcblxuICAgICAgICAgICAgbGV0IGdldEtleXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBsZXQga2V5cyA9IFtdO1xuICAgICAgICAgICAgICAgIGxldCBoYXMgPSBuZXcgU2V0KCk7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQga2V5IG9mIHNjb3BlVHJlZS5lbnVtZXJhdGVQcm9wZXJ0eU5hbWVzKG5vZGUsIG5vV2FsaykpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXMuaGFzKGtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleXMucHVzaChrZXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFzLmFkZChrZXkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBrZXlzO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTaW1wbGVQcm94eSh7XG4gICAgICAgICAgICAgICAgZ2V0S2V5czogZnVuY3Rpb24gKHByb3h5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRLZXlzKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gKHByb3h5LCBuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzY29wZVRyZWUuZ2V0VmFsdWUobm9kZSwgbmFtZSwgbm9XYWxrKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiAocHJveHksIG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlVHJlZS5zZXRWYWx1ZShub2RlLCBuYW1lLCB2YWx1ZSwgbm9XYWxrKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGVsZXRlOiBmdW5jdGlvbiAocHJveHksIG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGVUcmVlLmRlbGV0ZVByb3BlcnR5KG5vZGUsIG5hbWUsIG5vV2Fsayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHNjb3BlRmFjdG9yeTtcblxuLypsZXQgUHJveHkgPSByZXF1aXJlKFwibm9kZS1wcm94eVwiKTsgLy8gVE9ETzogcmVlbmFibGUgdGhpcyBhcyBhbiBvcHRpb25hbCBkZXBlbmRlbmN5XG5cbm1vZHVsZS5leHBvcnRzLmNyZWF0ZSA9IGZ1bmN0aW9uIChzY29wZVRyZWUsIG5vZGUsIG5vV2Fsaykge1xuICAgIHJldHVybiBQcm94eS5jcmVhdGUoe1xuICAgICAgICBoYXM6IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gc2NvcGVUcmVlLmhhc1Byb3BlcnR5KG5vZGUsIG5hbWUsIG5vV2Fsayk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAodGFyZ2V0LCBuYW1lKSB7XG4gICAgICAgICAgICBpZiAobmFtZSA9PT0gXCIka2V5c1wiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlVHJlZS5lbnVtZXJhdGVQcm9wZXJ0eU5hbWVzKG5vZGUsIG5vV2Fsayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc2NvcGVUcmVlLmdldFZhbHVlKG5vZGUsIG5hbWUsIG5vV2Fsayk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodGFyZ2V0LCBuYW1lLCB2YWx1ZSkge1xuICAgICAgICAgICAgc2NvcGVUcmVlLnNldFZhbHVlKG5vZGUsIG5hbWUsIHZhbHVlLCBub1dhbGspO1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlbGV0ZTogZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBzY29wZVRyZWUuZGVsZXRlUHJvcGVydHkobm9kZSwgbmFtZSwgbm9XYWxrKTtcbiAgICAgICAgfSxcblxuICAgICAgICBlbnVtZXJhdGU6IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgICAgICAgIHJldHVybiBzY29wZVRyZWUuZW51bWVyYXRlUHJvcGVydHlOYW1lcyhub2RlLCBub1dhbGspO1xuICAgICAgICB9XG4gICAgfSk7XG59OyovIl19
