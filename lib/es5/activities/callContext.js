"use strict";
var common = require("../common");
var is = common.is;
var _ = require("lodash");
function CallContext(executionContext, activityOrActivityId, scope) {
  this._executionContext = executionContext;
  this._activity = activityOrActivityId ? this._asActivity(activityOrActivityId) : null;
  this._activityInstanceId = this._activity ? this._activity.getInstanceId(executionContext) : null;
  this._scope = scope ? scope : null;
  this._executionState = null;
  this._scopePart = null;
}
Object.defineProperties(CallContext.prototype, {
  instanceId: {get: function() {
      return this._activityInstanceId;
    }},
  _parentActivityId: {get: function() {
      if (!this._activity) {
        return null;
      }
      var state = this._executionContext.getExecutionState(this.instanceId);
      return state.parentInstanceId;
    }},
  _scopeTree: {get: function() {
      return this._executionContext._scopeTree;
    }},
  activity: {get: function() {
      return this._activity;
    }},
  executionContext: {get: function() {
      return this._executionContext;
    }},
  executionState: {get: function() {
      return this._executionState || (this._activity ? (this._executionState = this._executionContext.getExecutionState(this.instanceId)) : null);
    }},
  scope: {get: function() {
      return this._scope || (this._scope = this._scopeTree.find(this.instanceId));
    }}
});
CallContext.prototype.next = function(childActivityOrActivityId, variables) {
  var child = this._asActivity(childActivityOrActivityId);
  var part = child.createScopePart();
  if (_.isObject(variables)) {
    _.extend(part, variables);
  }
  return new CallContext(this._executionContext, child, this._scopeTree.next(this.instanceId, child.getInstanceId(this.executionContext), part, child.id));
};
CallContext.prototype.back = function(keepScope) {
  var parentId = this._parentActivityId;
  if (parentId) {
    return new CallContext(this._executionContext, parentId, this._scopeTree.back(this.instanceId, keepScope));
  } else {
    return null;
  }
};
CallContext.prototype._asActivity = function(activityOrActivityId) {
  return is.activity(activityOrActivityId) ? activityOrActivityId : this._executionContext._getKnownActivity(activityOrActivityId);
};
CallContext.prototype.complete = function(result) {
  this.activity.complete(this, result);
};
CallContext.prototype.cancel = function() {
  this.activity.cancel(this);
};
CallContext.prototype.idle = function() {
  this.activity.idle(this);
};
CallContext.prototype.fail = function(e) {
  this.activity.fail(this, e);
};
CallContext.prototype.end = function(reason, result) {
  this.activity.end(this, reason, result);
};
CallContext.prototype.schedule = function(obj, endcallback) {
  this.activity.schedule(this, obj, endcallback);
};
CallContext.prototype.createBookmark = function(name, callback) {
  return this._executionContext.createBookmark(this.instanceId, name, callback);
};
CallContext.prototype.resumeBookmark = function(name, reason, result) {
  this._executionContext.resumeBookmarkInternal(this, name, reason, result);
};
module.exports = CallContext;
//# sourceMappingURL=data:application/json;base64,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QUcsQ0FBRyxPQUFLLENBQUcsT0FBSyxDQUFDLENBQUM7QUFDN0UsQ0FBQztBQUVELEtBQUssUUFBUSxFQUFJLFlBQVUsQ0FBQztBQUM1QiIsImZpbGUiOiJhY3Rpdml0aWVzL2NhbGxDb250ZXh0LmpzIiwic291cmNlUm9vdCI6ImxpYi9lczYiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxubGV0IGNvbW1vbiA9IHJlcXVpcmUoXCIuLi9jb21tb25cIik7XG5sZXQgaXMgPSBjb21tb24uaXM7XG5sZXQgXyA9IHJlcXVpcmUoXCJsb2Rhc2hcIik7XG5cbmZ1bmN0aW9uIENhbGxDb250ZXh0KGV4ZWN1dGlvbkNvbnRleHQsIGFjdGl2aXR5T3JBY3Rpdml0eUlkLCBzY29wZSkge1xuICAgIHRoaXMuX2V4ZWN1dGlvbkNvbnRleHQgPSBleGVjdXRpb25Db250ZXh0O1xuICAgIHRoaXMuX2FjdGl2aXR5ID0gYWN0aXZpdHlPckFjdGl2aXR5SWQgPyB0aGlzLl9hc0FjdGl2aXR5KGFjdGl2aXR5T3JBY3Rpdml0eUlkKSA6IG51bGw7XG4gICAgdGhpcy5fYWN0aXZpdHlJbnN0YW5jZUlkID0gdGhpcy5fYWN0aXZpdHkgPyB0aGlzLl9hY3Rpdml0eS5nZXRJbnN0YW5jZUlkKGV4ZWN1dGlvbkNvbnRleHQpIDogbnVsbDtcbiAgICB0aGlzLl9zY29wZSA9IHNjb3BlID8gc2NvcGUgOiBudWxsO1xuICAgIHRoaXMuX2V4ZWN1dGlvblN0YXRlID0gbnVsbDtcbiAgICB0aGlzLl9zY29wZVBhcnQgPSBudWxsO1xufVxuXG5PYmplY3QuZGVmaW5lUHJvcGVydGllcyhcbiAgICBDYWxsQ29udGV4dC5wcm90b3R5cGUsXG4gICAge1xuICAgICAgICBpbnN0YW5jZUlkOiB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZpdHlJbnN0YW5jZUlkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBfcGFyZW50QWN0aXZpdHlJZDoge1xuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9hY3Rpdml0eSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IHN0YXRlID0gdGhpcy5fZXhlY3V0aW9uQ29udGV4dC5nZXRFeGVjdXRpb25TdGF0ZSh0aGlzLmluc3RhbmNlSWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZS5wYXJlbnRJbnN0YW5jZUlkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBfc2NvcGVUcmVlOiB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZXhlY3V0aW9uQ29udGV4dC5fc2NvcGVUcmVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBhY3Rpdml0eToge1xuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2aXR5O1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBleGVjdXRpb25Db250ZXh0OiB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZXhlY3V0aW9uQ29udGV4dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXhlY3V0aW9uU3RhdGU6IHtcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9leGVjdXRpb25TdGF0ZSB8fCAodGhpcy5fYWN0aXZpdHkgPyAodGhpcy5fZXhlY3V0aW9uU3RhdGUgPSB0aGlzLl9leGVjdXRpb25Db250ZXh0LmdldEV4ZWN1dGlvblN0YXRlKHRoaXMuaW5zdGFuY2VJZCkpIDogbnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2NvcGUgfHwgKHRoaXMuX3Njb3BlID0gdGhpcy5fc2NvcGVUcmVlLmZpbmQodGhpcy5pbnN0YW5jZUlkKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4pO1xuXG5DYWxsQ29udGV4dC5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uIChjaGlsZEFjdGl2aXR5T3JBY3Rpdml0eUlkLCB2YXJpYWJsZXMpIHtcbiAgICBsZXQgY2hpbGQgPSB0aGlzLl9hc0FjdGl2aXR5KGNoaWxkQWN0aXZpdHlPckFjdGl2aXR5SWQpO1xuICAgIGxldCBwYXJ0ID0gY2hpbGQuY3JlYXRlU2NvcGVQYXJ0KCk7XG4gICAgaWYgKF8uaXNPYmplY3QodmFyaWFibGVzKSkge1xuICAgICAgICBfLmV4dGVuZChwYXJ0LCB2YXJpYWJsZXMpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IENhbGxDb250ZXh0KFxuICAgICAgICB0aGlzLl9leGVjdXRpb25Db250ZXh0LFxuICAgICAgICBjaGlsZCxcbiAgICAgICAgdGhpcy5fc2NvcGVUcmVlLm5leHQodGhpcy5pbnN0YW5jZUlkLCBjaGlsZC5nZXRJbnN0YW5jZUlkKHRoaXMuZXhlY3V0aW9uQ29udGV4dCksIHBhcnQsIGNoaWxkLmlkKSk7XG59O1xuXG5DYWxsQ29udGV4dC5wcm90b3R5cGUuYmFjayA9IGZ1bmN0aW9uIChrZWVwU2NvcGUpIHtcbiAgICBsZXQgcGFyZW50SWQgPSB0aGlzLl9wYXJlbnRBY3Rpdml0eUlkO1xuICAgIGlmIChwYXJlbnRJZCkge1xuICAgICAgICByZXR1cm4gbmV3IENhbGxDb250ZXh0KFxuICAgICAgICAgICAgdGhpcy5fZXhlY3V0aW9uQ29udGV4dCxcbiAgICAgICAgICAgIHBhcmVudElkLFxuICAgICAgICAgICAgdGhpcy5fc2NvcGVUcmVlLmJhY2sodGhpcy5pbnN0YW5jZUlkLCBrZWVwU2NvcGUpKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn07XG5cbkNhbGxDb250ZXh0LnByb3RvdHlwZS5fYXNBY3Rpdml0eSA9IGZ1bmN0aW9uIChhY3Rpdml0eU9yQWN0aXZpdHlJZCkge1xuICAgIHJldHVybiBpcy5hY3Rpdml0eShhY3Rpdml0eU9yQWN0aXZpdHlJZCkgPyBhY3Rpdml0eU9yQWN0aXZpdHlJZCA6IHRoaXMuX2V4ZWN1dGlvbkNvbnRleHQuX2dldEtub3duQWN0aXZpdHkoYWN0aXZpdHlPckFjdGl2aXR5SWQpO1xufTtcblxuLyogQ2FsbGJhY2tzICovXG5cbkNhbGxDb250ZXh0LnByb3RvdHlwZS5jb21wbGV0ZSA9IGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICB0aGlzLmFjdGl2aXR5LmNvbXBsZXRlKHRoaXMsIHJlc3VsdCk7XG59O1xuXG5DYWxsQ29udGV4dC5wcm90b3R5cGUuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuYWN0aXZpdHkuY2FuY2VsKHRoaXMpO1xufTtcblxuQ2FsbENvbnRleHQucHJvdG90eXBlLmlkbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5hY3Rpdml0eS5pZGxlKHRoaXMpO1xufTtcblxuQ2FsbENvbnRleHQucHJvdG90eXBlLmZhaWwgPSBmdW5jdGlvbiAoZSkge1xuICAgIHRoaXMuYWN0aXZpdHkuZmFpbCh0aGlzLCBlKTtcbn07XG5cbkNhbGxDb250ZXh0LnByb3RvdHlwZS5lbmQgPSBmdW5jdGlvbiAocmVhc29uLCByZXN1bHQpIHtcbiAgICB0aGlzLmFjdGl2aXR5LmVuZCh0aGlzLCByZWFzb24sIHJlc3VsdCk7XG59O1xuXG5DYWxsQ29udGV4dC5wcm90b3R5cGUuc2NoZWR1bGUgPSBmdW5jdGlvbiAob2JqLCBlbmRjYWxsYmFjaykge1xuICAgIHRoaXMuYWN0aXZpdHkuc2NoZWR1bGUodGhpcywgb2JqLCBlbmRjYWxsYmFjayk7XG59O1xuXG5DYWxsQ29udGV4dC5wcm90b3R5cGUuY3JlYXRlQm9va21hcmsgPSBmdW5jdGlvbiAobmFtZSwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gdGhpcy5fZXhlY3V0aW9uQ29udGV4dC5jcmVhdGVCb29rbWFyayh0aGlzLmluc3RhbmNlSWQsIG5hbWUsIGNhbGxiYWNrKTtcbn07XG5cbkNhbGxDb250ZXh0LnByb3RvdHlwZS5yZXN1bWVCb29rbWFyayA9IGZ1bmN0aW9uIChuYW1lLCByZWFzb24sIHJlc3VsdCkge1xuICAgIHRoaXMuX2V4ZWN1dGlvbkNvbnRleHQucmVzdW1lQm9va21hcmtJbnRlcm5hbCh0aGlzLCBuYW1lLCByZWFzb24sIHJlc3VsdCk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENhbGxDb250ZXh0O1xuIl19
