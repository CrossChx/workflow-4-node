"use strict";
"use strict";
var ScopeNode = require("./scopeNode");
var guids = require("../common/guids");
var _ = require("lodash");
var specStrings = require("../common/specStrings");
var errors = require("../common/errors");
var is = require("../common/is");
var scope = require("./scope");
var Expression = require("./expression");
function ScopeTree(initialScope, getActivityByIdFunc) {
  this._initialNode = new ScopeNode(guids.ids.initialScope, initialScope);
  this._nodes = new Map();
  this._nodes.set(this._initialNode.instanceId, this._initialNode);
  this._getActivityById = getActivityByIdFunc;
}
ScopeTree.prototype.getState = function(getPromotions) {
  var self = this;
  var state = [];
  var promotedProperties = getPromotions ? new Map() : null;
  self._nodes.forEach(function(node) {
    if (node.instanceId === guids.ids.initialScope) {
      return ;
    }
    var item = {
      instanceId: node.instanceId,
      userId: node.userId,
      parentId: node.parent ? node.parent.instanceId : null,
      parts: []
    };
    var activity = self._getActivityById(node.instanceId);
    node.forEachProperty(function(propertyName, propertyValue) {
      if (!activity.nonSerializedProperties.has(propertyName)) {
        if (_.isArray(propertyValue)) {
          var iPart = {
            name: propertyName,
            value: []
          };
          item.parts.push(iPart);
          propertyValue.forEach(function(pv) {
            if (is.activity(pv)) {
              iPart.value.push(specStrings.hosting.createActivityInstancePart(pv.instanceId));
            } else {
              iPart.value.push(pv);
            }
          });
        } else if (is.activity(propertyValue)) {
          item.parts.push({
            name: propertyName,
            value: specStrings.hosting.createActivityInstancePart(propertyValue.instanceId)
          });
        } else if (_.isFunction(propertyValue) && !activity.hasOwnProperty(propertyName) && _.isFunction(activity[propertyName])) {
          item.parts.push(specStrings.hosting.createActivityPropertyPart(propertyName));
        } else if (_.isObject(propertyValue) && propertyValue === activity[propertyName]) {
          item.parts.push(specStrings.hosting.createActivityPropertyPart(propertyName));
        } else {
          item.parts.push({
            name: propertyName,
            value: propertyValue
          });
        }
      }
    });
    state.push(item);
    if (promotedProperties && activity.promotedProperties) {
      activity.promotedProperties.forEach(function(promotedPropName) {
        var pv = node.getPropertyValue(promotedPropName, true);
        if (is.defined(pv) && !(is.activity(pv))) {
          var promotedEntry = promotedProperties.get(promotedPropName);
          if (is.undefined(promotedEntry) || node.instanceId > promotedEntry.level) {
            promotedProperties.set(promotedPropName, {
              level: node.instanceId,
              value: pv
            });
          }
        }
      });
    }
  });
  var actualPromotions = null;
  if (promotedProperties) {
    actualPromotions = {};
    if (promotedProperties.size) {
      promotedProperties.forEach(function(value, key) {
        actualPromotions[key] = value.value;
      });
    }
  }
  return {
    state: state,
    promotedProperties: actualPromotions
  };
};
ScopeTree.prototype.setState = function(json) {
  var self = this;
  if (!_.isArray(json)) {
    throw new TypeError("Array argument expected.");
  }
  if (self._nodes.count !== 1) {
    var prev = self._nodes;
    self._nodes = new Map();
    self._nodes.set(guids.ids.initialScope, prev.get(guids.ids.initialScope));
    self._initialNode.clearChildren();
  }
  try {
    var $__17 = true;
    var $__18 = false;
    var $__19 = undefined;
    try {
      for (var $__15 = void 0,
          $__14 = (json)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__17 = ($__15 = $__14.next()).done); $__17 = true) {
        var item = $__15.value;
        {
          var scopePart = {};
          var activity = self._getActivityById(item.instanceId);
          var $__10 = true;
          var $__11 = false;
          var $__12 = undefined;
          try {
            for (var $__8 = void 0,
                $__7 = (item.parts)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__10 = ($__8 = $__7.next()).done); $__10 = true) {
              var part = $__8.value;
              {
                var activityProperty = specStrings.hosting.getActivityPropertyName(part);
                if (activityProperty) {
                  if (_.isUndefined(scopePart[activityProperty] = activity[activityProperty])) {
                    throw new Error("Activity has no property '" + part + "'.");
                  }
                } else {
                  var activityId = specStrings.hosting.getActivityId(part.value);
                  if (activityId) {
                    scopePart[part.name] = self._getActivityById(activityId);
                  } else if (_.isArray(part.value)) {
                    var scopePartValue = [];
                    scopePart[part.name] = scopePartValue;
                    var $__3 = true;
                    var $__4 = false;
                    var $__5 = undefined;
                    try {
                      for (var $__1 = void 0,
                          $__0 = (part.value)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__3 = ($__1 = $__0.next()).done); $__3 = true) {
                        var pv = $__1.value;
                        {
                          activityId = specStrings.hosting.getActivityId(pv);
                          if (activityId) {
                            scopePartValue.push(self._getActivityById(activityId));
                          } else {
                            scopePartValue.push(pv);
                          }
                        }
                      }
                    } catch ($__6) {
                      $__4 = true;
                      $__5 = $__6;
                    } finally {
                      try {
                        if (!$__3 && $__0.return != null) {
                          $__0.return();
                        }
                      } finally {
                        if ($__4) {
                          throw $__5;
                        }
                      }
                    }
                  } else {
                    scopePart[part.name] = part.value;
                  }
                }
              }
            }
          } catch ($__13) {
            $__11 = true;
            $__12 = $__13;
          } finally {
            try {
              if (!$__10 && $__7.return != null) {
                $__7.return();
              }
            } finally {
              if ($__11) {
                throw $__12;
              }
            }
          }
          var node = new ScopeNode(item.instanceId, scopePart, item.userId);
          self._nodes.set(item.instanceId, node);
        }
      }
    } catch ($__20) {
      $__18 = true;
      $__19 = $__20;
    } finally {
      try {
        if (!$__17 && $__14.return != null) {
          $__14.return();
        }
      } finally {
        if ($__18) {
          throw $__19;
        }
      }
    }
    var $__24 = true;
    var $__25 = false;
    var $__26 = undefined;
    try {
      for (var $__22 = void 0,
          $__21 = (json)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__24 = ($__22 = $__21.next()).done); $__24 = true) {
        var item$__28 = $__22.value;
        {
          self._nodes.get(item$__28.instanceId).parent = self._nodes.get(item$__28.parentId);
        }
      }
    } catch ($__27) {
      $__25 = true;
      $__26 = $__27;
    } finally {
      try {
        if (!$__24 && $__21.return != null) {
          $__21.return();
        }
      } finally {
        if ($__25) {
          throw $__26;
        }
      }
    }
  } catch (e) {
    throw new errors.WorkflowError("Cannot restore state tree, because data is corrupt. Inner error: " + e.stack);
  }
};
ScopeTree.prototype._getRealParent = function(currentNode) {
  var parent = currentNode.parent;
  if (this._getActivityById(currentNode.instanceId) instanceof Expression) {
    parent = parent.parent;
  }
  return parent;
};
ScopeTree.prototype.hasProperty = function(currentNode, name, noWalk) {
  if (name === "$parent") {
    var parent = this._getRealParent(currentNode);
    if (parent && parent !== this._initialNode) {
      return !!parent;
    }
  }
  if (name === "$activity") {
    return true;
  }
  var found = false;
  currentNode.forEachToRoot(function(node) {
    if (node.isPropertyExists(name)) {
      found = true;
      return false;
    }
    if (node.userId === name) {
      found = true;
      return false;
    }
  }, noWalk);
  return found;
};
ScopeTree.prototype.getValue = function(currentNode, name, noWalk) {
  var self = this;
  if (name === "$parent") {
    var parent = this._getRealParent(currentNode);
    if (parent && parent !== this._initialNode) {
      return scope.create(this, parent, true);
    } else {
      return undefined;
    }
  }
  if (name === "$activity") {
    return self._getActivityById(currentNode.instanceId);
  }
  var canReturnPrivate = true;
  var value;
  currentNode.forEachToRoot(function(node) {
    if (is.defined(value = node.getPropertyValue(name, canReturnPrivate))) {
      return false;
    }
    if (node.userId === name) {
      value = scope.create(self, node, true);
      return false;
    }
    canReturnPrivate = false;
  }, noWalk);
  return value;
};
ScopeTree.prototype.setValue = function(currentNode, name, value, noWalk) {
  if (this.isOnInitial) {
    throw new Error("Cannot set property of the initial scope.");
  }
  var self = this;
  var canSetPrivate = true;
  var setDone = false;
  currentNode.forEachToRoot(function(node) {
    if (node === self._initialNode) {
      return false;
    }
    if (node.setPropertyValue(name, value, canSetPrivate)) {
      setDone = true;
      return false;
    }
    canSetPrivate = false;
  }, noWalk);
  if (!setDone) {
    currentNode.createPropertyWithValue(name, value);
  }
  return true;
};
ScopeTree.prototype.deleteProperty = function(currentNode, name, noWalk) {
  var self = this;
  var canDeletePrivate = true;
  var deleteDone = false;
  currentNode.forEachToRoot(function(node) {
    if (node === self._initialNode) {
      return false;
    }
    if (node.deleteProperty(name, canDeletePrivate)) {
      deleteDone = true;
      return false;
    }
    canDeletePrivate = false;
  }, noWalk);
  return deleteDone;
};
ScopeTree.prototype.enumeratePropertyNames = $traceurRuntime.initGeneratorFunction(function $__29(currentNode, noWalk) {
  var canEnumeratePrivate,
      node,
      $__30,
      $__31;
  return $traceurRuntime.createGeneratorInstance(function($ctx) {
    while (true)
      switch ($ctx.state) {
        case 0:
          canEnumeratePrivate = true;
          node = currentNode;
          $ctx.state = 35;
          break;
        case 35:
          $ctx.state = 2;
          return "$parent";
        case 2:
          $ctx.maybeThrow();
          $ctx.state = 4;
          break;
        case 4:
          $ctx.state = 6;
          return "$activity";
        case 6:
          $ctx.maybeThrow();
          $ctx.state = 8;
          break;
        case 8:
          $ctx.state = (node.userId) ? 9 : 12;
          break;
        case 9:
          $ctx.state = 10;
          return node.userId;
        case 10:
          $ctx.maybeThrow();
          $ctx.state = 12;
          break;
        case 12:
          $__30 = $ctx.wrapYieldStar(node.enumeratePropertyNames(canEnumeratePrivate)[Symbol.iterator]());
          $ctx.sent = void 0;
          $ctx.action = 'next';
          $ctx.state = 25;
          break;
        case 25:
          $__31 = $__30[$ctx.action]($ctx.sentIgnoreThrow);
          $ctx.state = 22;
          break;
        case 22:
          $ctx.state = ($__31.done) ? 16 : 15;
          break;
        case 16:
          $ctx.sent = $__31.value;
          $ctx.state = 23;
          break;
        case 15:
          $ctx.state = 25;
          return $__31.value;
        case 23:
          canEnumeratePrivate = false;
          $ctx.state = 30;
          break;
        case 30:
          $ctx.state = (noWalk) ? -2 : 27;
          break;
        case 27:
          node = node.parent;
          $ctx.state = 32;
          break;
        case 32:
          $ctx.state = (node) ? 35 : -2;
          break;
        default:
          return $ctx.end();
      }
  }, $__29, this);
});
ScopeTree.prototype.next = function(nodeInstanceId, childInstanceId, scopePart, childUserId) {
  var currentNode = this._getNodeByExternalId(nodeInstanceId);
  var nextNode = new ScopeNode(childInstanceId, scopePart, childUserId);
  currentNode.addChild(nextNode);
  this._nodes.set(childInstanceId, nextNode);
  return scope.create(this, nextNode);
};
ScopeTree.prototype.back = function(nodeId, keepItem) {
  var currentNode = this._getNodeByExternalId(nodeId);
  if (currentNode === this._initialNode) {
    throw new Error("Cannot go back because current scope is the initial scope.");
  }
  var toRemove = currentNode;
  var goTo = toRemove.parent;
  currentNode = goTo;
  if (!keepItem) {
    goTo.removeChild(toRemove);
    this._nodes.delete(toRemove.instanceId);
  }
  return scope.create(this, currentNode);
};
ScopeTree.prototype.find = function(nodeId) {
  var currentNode = this._getNodeByExternalId(nodeId);
  return scope.create(this, currentNode);
};
ScopeTree.prototype.findPart = function(nodeId) {
  var currentNode = this._getNodeByExternalId(nodeId);
  if (currentNode !== this._initialNode) {
    return currentNode.scopePart;
  }
  return null;
};
ScopeTree.prototype._getNodeByExternalId = function(id) {
  if (id === null) {
    return this._initialNode;
  }
  var node = this._nodes.get(id);
  if (!node) {
    throw new Error("Scope node for activity id '" + id + "' is not found.");
  }
  return node;
};
ScopeTree.prototype.deleteScopePart = function(currentNodeId, id) {
  var self = this;
  var currentNode = this._getNodeByExternalId(currentNodeId);
  var delNode = self._nodes.get(id);
  if (delNode) {
    if (delNode === self._initialNode) {
      throw new Error("Cannot delete the initial scope.");
    }
    var found = false;
    delNode.forEachToRoot(function(node) {
      if (node === currentNode) {
        found = true;
        return false;
      }
    });
    if (!found) {
      throw new Error("Cannot delete scope, because current active scope is inside in it.");
    }
    delNode.parent.removeChild(delNode);
    self._removeAllNodes(delNode);
  }
};
ScopeTree.prototype._removeAllNodes = function(node) {
  var self = this;
  self._nodes.delete(node.instanceId);
  node.forEachChild(function(c) {
    self._removeAllNodes(c);
  });
};
module.exports = ScopeTree;
//# sourceMappingURL=data:application/json;base64,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SSxNQUFBLENBQUEsS0FBSSxFQUFJLE1BQUksQ0FBQztBQUNqQixVQUFNLGNBQWMsQUFBQyxDQUNqQixTQUFVLElBQUcsQ0FBRztBQUNaLFNBQUksSUFBRyxJQUFNLFlBQVUsQ0FBRztBQUN0QixZQUFJLEVBQUksS0FBRyxDQUFDO0FBQ1osYUFBTyxNQUFJLENBQUM7TUFDaEI7QUFBQSxJQUNKLENBQUMsQ0FBQztBQUNOLE9BQUksQ0FBQyxLQUFJLENBQUc7QUFDUixVQUFNLElBQUksTUFBSSxBQUFDLENBQUMsb0VBQW1FLENBQUMsQ0FBQztJQUN6RjtBQUFBLEFBQ0EsVUFBTSxPQUFPLFlBQVksQUFBQyxDQUFDLE9BQU0sQ0FBQyxDQUFDO0FBQ25DLE9BQUcsZ0JBQWdCLEFBQUMsQ0FBQyxPQUFNLENBQUMsQ0FBQztFQUNqQztBQUFBLEFBQ0osQ0FBQztBQUVELFFBQVEsVUFBVSxnQkFBZ0IsRUFBSSxVQUFVLElBQUcsQ0FBRztBQUNsRCxBQUFJLElBQUEsQ0FBQSxJQUFHLEVBQUksS0FBRyxDQUFDO0FBRWYsS0FBRyxPQUFPLE9BQU8sQUFBQyxDQUFDLElBQUcsV0FBVyxDQUFDLENBQUM7QUFDbkMsS0FBRyxhQUFhLEFBQUMsQ0FBQyxTQUFVLENBQUEsQ0FBRztBQUMzQixPQUFHLGdCQUFnQixBQUFDLENBQUMsQ0FBQSxDQUFDLENBQUM7RUFDM0IsQ0FBQyxDQUFDO0FBQ04sQ0FBQztBQUVELEtBQUssUUFBUSxFQUFJLFVBQVEsQ0FBQztBQUFBIiwiZmlsZSI6ImFjdGl2aXRpZXMvc2NvcGVUcmVlLmpzIiwic291cmNlUm9vdCI6ImxpYi9lczYiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxubGV0IFNjb3BlTm9kZSA9IHJlcXVpcmUoXCIuL3Njb3BlTm9kZVwiKTtcbmxldCBndWlkcyA9IHJlcXVpcmUoXCIuLi9jb21tb24vZ3VpZHNcIik7XG5sZXQgXyA9IHJlcXVpcmUoXCJsb2Rhc2hcIik7XG5sZXQgc3BlY1N0cmluZ3MgPSByZXF1aXJlKFwiLi4vY29tbW9uL3NwZWNTdHJpbmdzXCIpO1xubGV0IGVycm9ycyA9IHJlcXVpcmUoXCIuLi9jb21tb24vZXJyb3JzXCIpO1xubGV0IGlzID0gcmVxdWlyZShcIi4uL2NvbW1vbi9pc1wiKTtcbmxldCBzY29wZSA9IHJlcXVpcmUoXCIuL3Njb3BlXCIpO1xubGV0IEV4cHJlc3Npb24gPSByZXF1aXJlKFwiLi9leHByZXNzaW9uXCIpO1xuXG5mdW5jdGlvbiBTY29wZVRyZWUoaW5pdGlhbFNjb3BlLCBnZXRBY3Rpdml0eUJ5SWRGdW5jKSB7XG4gICAgdGhpcy5faW5pdGlhbE5vZGUgPSBuZXcgU2NvcGVOb2RlKGd1aWRzLmlkcy5pbml0aWFsU2NvcGUsIGluaXRpYWxTY29wZSk7XG4gICAgdGhpcy5fbm9kZXMgPSBuZXcgTWFwKCk7XG4gICAgdGhpcy5fbm9kZXMuc2V0KHRoaXMuX2luaXRpYWxOb2RlLmluc3RhbmNlSWQsIHRoaXMuX2luaXRpYWxOb2RlKTtcbiAgICB0aGlzLl9nZXRBY3Rpdml0eUJ5SWQgPSBnZXRBY3Rpdml0eUJ5SWRGdW5jO1xufVxuXG4vKiBTRVJJQUxJWkFUSU9OICovXG5TY29wZVRyZWUucHJvdG90eXBlLmdldFN0YXRlID0gZnVuY3Rpb24gKGdldFByb21vdGlvbnMpIHtcbiAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgbGV0IHN0YXRlID0gW107XG4gICAgbGV0IHByb21vdGVkUHJvcGVydGllcyA9IGdldFByb21vdGlvbnMgPyBuZXcgTWFwKCkgOiBudWxsO1xuXG4gICAgc2VsZi5fbm9kZXMuZm9yRWFjaChcbiAgICAgICAgZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgIGlmIChub2RlLmluc3RhbmNlSWQgPT09IGd1aWRzLmlkcy5pbml0aWFsU2NvcGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBpdGVtID0ge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlSWQ6IG5vZGUuaW5zdGFuY2VJZCxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IG5vZGUudXNlcklkLFxuICAgICAgICAgICAgICAgIHBhcmVudElkOiBub2RlLnBhcmVudCA/IG5vZGUucGFyZW50Lmluc3RhbmNlSWQgOiBudWxsLFxuICAgICAgICAgICAgICAgIHBhcnRzOiBbXVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbGV0IGFjdGl2aXR5ID0gc2VsZi5fZ2V0QWN0aXZpdHlCeUlkKG5vZGUuaW5zdGFuY2VJZCk7XG5cbiAgICAgICAgICAgIG5vZGUuZm9yRWFjaFByb3BlcnR5KFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChwcm9wZXJ0eU5hbWUsIHByb3BlcnR5VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFhY3Rpdml0eS5ub25TZXJpYWxpemVkUHJvcGVydGllcy5oYXMocHJvcGVydHlOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF8uaXNBcnJheShwcm9wZXJ0eVZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpUGFydCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJvcGVydHlOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogW11cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ucGFydHMucHVzaChpUGFydCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlWYWx1ZS5mb3JFYWNoKGZ1bmN0aW9uIChwdikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXMuYWN0aXZpdHkocHYpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpUGFydC52YWx1ZS5wdXNoKHNwZWNTdHJpbmdzLmhvc3RpbmcuY3JlYXRlQWN0aXZpdHlJbnN0YW5jZVBhcnQocHYuaW5zdGFuY2VJZCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaVBhcnQudmFsdWUucHVzaChwdik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzLmFjdGl2aXR5KHByb3BlcnR5VmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5wYXJ0cy5wdXNoKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcm9wZXJ0eU5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogc3BlY1N0cmluZ3MuaG9zdGluZy5jcmVhdGVBY3Rpdml0eUluc3RhbmNlUGFydChwcm9wZXJ0eVZhbHVlLmluc3RhbmNlSWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoXy5pc0Z1bmN0aW9uKHByb3BlcnR5VmFsdWUpICYmICFhY3Rpdml0eS5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eU5hbWUpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5pc0Z1bmN0aW9uKGFjdGl2aXR5W3Byb3BlcnR5TmFtZV0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5wYXJ0cy5wdXNoKHNwZWNTdHJpbmdzLmhvc3RpbmcuY3JlYXRlQWN0aXZpdHlQcm9wZXJ0eVBhcnQocHJvcGVydHlOYW1lKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChfLmlzT2JqZWN0KHByb3BlcnR5VmFsdWUpICYmIHByb3BlcnR5VmFsdWUgPT09IGFjdGl2aXR5W3Byb3BlcnR5TmFtZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnBhcnRzLnB1c2goc3BlY1N0cmluZ3MuaG9zdGluZy5jcmVhdGVBY3Rpdml0eVByb3BlcnR5UGFydChwcm9wZXJ0eU5hbWUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ucGFydHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByb3BlcnR5TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHByb3BlcnR5VmFsdWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc3RhdGUucHVzaChpdGVtKTtcblxuICAgICAgICAgICAgLy8gUHJvbW90aW9uczpcbiAgICAgICAgICAgIGlmIChwcm9tb3RlZFByb3BlcnRpZXMgJiYgYWN0aXZpdHkucHJvbW90ZWRQcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgICAgYWN0aXZpdHkucHJvbW90ZWRQcm9wZXJ0aWVzLmZvckVhY2goXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChwcm9tb3RlZFByb3BOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHYgPSBub2RlLmdldFByb3BlcnR5VmFsdWUocHJvbW90ZWRQcm9wTmFtZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXMuZGVmaW5lZChwdikgJiYgIShpcy5hY3Rpdml0eShwdikpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHByb21vdGVkRW50cnkgPSBwcm9tb3RlZFByb3BlcnRpZXMuZ2V0KHByb21vdGVkUHJvcE5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGFuIEFjdGl2aXR5IElkIGdyZWF0ZXIgdGhhbiBvdGhlciwgdGhlbiB3ZSBjYW4gc3VyZSB0aGF0IG90aGVyIGJlbG93IG9yIGFmdGVyIGluIHRoZSB0cmVlLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpcy51bmRlZmluZWQocHJvbW90ZWRFbnRyeSkgfHwgbm9kZS5pbnN0YW5jZUlkID4gcHJvbW90ZWRFbnRyeS5sZXZlbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9tb3RlZFByb3BlcnRpZXMuc2V0KHByb21vdGVkUHJvcE5hbWUsIHsgbGV2ZWw6IG5vZGUuaW5zdGFuY2VJZCwgdmFsdWU6IHB2IH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgbGV0IGFjdHVhbFByb21vdGlvbnMgPSBudWxsO1xuICAgIGlmIChwcm9tb3RlZFByb3BlcnRpZXMpIHtcbiAgICAgICAgYWN0dWFsUHJvbW90aW9ucyA9IHt9O1xuICAgICAgICBpZiAocHJvbW90ZWRQcm9wZXJ0aWVzLnNpemUpIHtcbiAgICAgICAgICAgIHByb21vdGVkUHJvcGVydGllcy5mb3JFYWNoKFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIGFjdHVhbFByb21vdGlvbnNba2V5XSA9IHZhbHVlLnZhbHVlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdGU6IHN0YXRlLFxuICAgICAgICBwcm9tb3RlZFByb3BlcnRpZXM6IGFjdHVhbFByb21vdGlvbnNcbiAgICB9O1xufTtcblxuU2NvcGVUcmVlLnByb3RvdHlwZS5zZXRTdGF0ZSA9IGZ1bmN0aW9uIChqc29uKSB7XG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuXG4gICAgaWYgKCFfLmlzQXJyYXkoanNvbikpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFycmF5IGFyZ3VtZW50IGV4cGVjdGVkLlwiKTtcbiAgICB9XG5cbiAgICBpZiAoc2VsZi5fbm9kZXMuY291bnQgIT09IDEpIHtcbiAgICAgICAgbGV0IHByZXYgPSBzZWxmLl9ub2RlcztcbiAgICAgICAgc2VsZi5fbm9kZXMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHNlbGYuX25vZGVzLnNldChndWlkcy5pZHMuaW5pdGlhbFNjb3BlLCBwcmV2LmdldChndWlkcy5pZHMuaW5pdGlhbFNjb3BlKSk7XG4gICAgICAgIHNlbGYuX2luaXRpYWxOb2RlLmNsZWFyQ2hpbGRyZW4oKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBmb3IgKGxldCBpdGVtIG9mIGpzb24pIHtcbiAgICAgICAgICAgIGxldCBzY29wZVBhcnQgPSB7fTtcbiAgICAgICAgICAgIGxldCBhY3Rpdml0eSA9IHNlbGYuX2dldEFjdGl2aXR5QnlJZChpdGVtLmluc3RhbmNlSWQpO1xuICAgICAgICAgICAgZm9yIChsZXQgcGFydCBvZiBpdGVtLnBhcnRzKSB7XG4gICAgICAgICAgICAgICAgbGV0IGFjdGl2aXR5UHJvcGVydHkgPSBzcGVjU3RyaW5ncy5ob3N0aW5nLmdldEFjdGl2aXR5UHJvcGVydHlOYW1lKHBhcnQpO1xuICAgICAgICAgICAgICAgIGlmIChhY3Rpdml0eVByb3BlcnR5KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfLmlzVW5kZWZpbmVkKHNjb3BlUGFydFthY3Rpdml0eVByb3BlcnR5XSA9IGFjdGl2aXR5W2FjdGl2aXR5UHJvcGVydHldKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQWN0aXZpdHkgaGFzIG5vIHByb3BlcnR5ICdcIiArIHBhcnQgKyBcIicuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsZXQgYWN0aXZpdHlJZCA9IHNwZWNTdHJpbmdzLmhvc3RpbmcuZ2V0QWN0aXZpdHlJZChwYXJ0LnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2aXR5SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlUGFydFtwYXJ0Lm5hbWVdID0gc2VsZi5fZ2V0QWN0aXZpdHlCeUlkKGFjdGl2aXR5SWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKF8uaXNBcnJheShwYXJ0LnZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNjb3BlUGFydFZhbHVlID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZVBhcnRbcGFydC5uYW1lXSA9IHNjb3BlUGFydFZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgcHYgb2YgcGFydC52YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5SWQgPSBzcGVjU3RyaW5ncy5ob3N0aW5nLmdldEFjdGl2aXR5SWQocHYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpdml0eUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlUGFydFZhbHVlLnB1c2goc2VsZi5fZ2V0QWN0aXZpdHlCeUlkKGFjdGl2aXR5SWQpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlUGFydFZhbHVlLnB1c2gocHYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlUGFydFtwYXJ0Lm5hbWVdID0gcGFydC52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBub2RlID0gbmV3IFNjb3BlTm9kZShpdGVtLmluc3RhbmNlSWQsIHNjb3BlUGFydCwgaXRlbS51c2VySWQpO1xuICAgICAgICAgICAgc2VsZi5fbm9kZXMuc2V0KGl0ZW0uaW5zdGFuY2VJZCwgbm9kZSk7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGxldCBpdGVtIG9mIGpzb24pIHtcbiAgICAgICAgICAgIHNlbGYuX25vZGVzLmdldChpdGVtLmluc3RhbmNlSWQpLnBhcmVudCA9IHNlbGYuX25vZGVzLmdldChpdGVtLnBhcmVudElkKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLldvcmtmbG93RXJyb3IoXCJDYW5ub3QgcmVzdG9yZSBzdGF0ZSB0cmVlLCBiZWNhdXNlIGRhdGEgaXMgY29ycnVwdC4gSW5uZXIgZXJyb3I6IFwiICsgZS5zdGFjayk7XG4gICAgfVxufTtcbi8qIFNFUklBTElaQVRJT04gKi9cblxuLyogUFJPWFkgKi9cblxuU2NvcGVUcmVlLnByb3RvdHlwZS5fZ2V0UmVhbFBhcmVudCA9IGZ1bmN0aW9uIChjdXJyZW50Tm9kZSkge1xuICAgIGxldCBwYXJlbnQgPSBjdXJyZW50Tm9kZS5wYXJlbnQ7XG4gICAgaWYgKHRoaXMuX2dldEFjdGl2aXR5QnlJZChjdXJyZW50Tm9kZS5pbnN0YW5jZUlkKSBpbnN0YW5jZW9mIEV4cHJlc3Npb24pIHtcbiAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDtcbiAgICB9XG4gICAgcmV0dXJuIHBhcmVudDtcbn07XG5cblNjb3BlVHJlZS5wcm90b3R5cGUuaGFzUHJvcGVydHkgPSBmdW5jdGlvbiAoY3VycmVudE5vZGUsIG5hbWUsIG5vV2Fsaykge1xuICAgIGlmIChuYW1lID09PSBcIiRwYXJlbnRcIikge1xuICAgICAgICBsZXQgcGFyZW50ID0gdGhpcy5fZ2V0UmVhbFBhcmVudChjdXJyZW50Tm9kZSk7XG4gICAgICAgIGlmIChwYXJlbnQgJiYgcGFyZW50ICE9PSB0aGlzLl9pbml0aWFsTm9kZSkge1xuICAgICAgICAgICAgcmV0dXJuICEhcGFyZW50O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG5hbWUgPT09IFwiJGFjdGl2aXR5XCIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgbGV0IGZvdW5kID0gZmFsc2U7XG4gICAgY3VycmVudE5vZGUuZm9yRWFjaFRvUm9vdChmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICBpZiAobm9kZS5pc1Byb3BlcnR5RXhpc3RzKG5hbWUpKSB7XG4gICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUudXNlcklkID09PSBuYW1lKSB7XG4gICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9LCBub1dhbGspO1xuICAgIHJldHVybiBmb3VuZDtcbn07XG5cblNjb3BlVHJlZS5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiAoY3VycmVudE5vZGUsIG5hbWUsIG5vV2Fsaykge1xuICAgIGxldCBzZWxmID0gdGhpcztcblxuICAgIGlmIChuYW1lID09PSBcIiRwYXJlbnRcIikge1xuICAgICAgICBsZXQgcGFyZW50ID0gdGhpcy5fZ2V0UmVhbFBhcmVudChjdXJyZW50Tm9kZSk7XG4gICAgICAgIGlmIChwYXJlbnQgJiYgcGFyZW50ICE9PSB0aGlzLl9pbml0aWFsTm9kZSkge1xuICAgICAgICAgICAgcmV0dXJuIHNjb3BlLmNyZWF0ZSh0aGlzLCBwYXJlbnQsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChuYW1lID09PSBcIiRhY3Rpdml0eVwiKSB7XG4gICAgICAgIHJldHVybiBzZWxmLl9nZXRBY3Rpdml0eUJ5SWQoY3VycmVudE5vZGUuaW5zdGFuY2VJZCk7XG4gICAgfVxuXG4gICAgbGV0IGNhblJldHVyblByaXZhdGUgPSB0cnVlO1xuICAgIGxldCB2YWx1ZTtcbiAgICBjdXJyZW50Tm9kZS5mb3JFYWNoVG9Sb290KGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIGlmIChpcy5kZWZpbmVkKHZhbHVlID0gbm9kZS5nZXRQcm9wZXJ0eVZhbHVlKG5hbWUsIGNhblJldHVyblByaXZhdGUpKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlLnVzZXJJZCA9PT0gbmFtZSkge1xuICAgICAgICAgICAgdmFsdWUgPSBzY29wZS5jcmVhdGUoc2VsZiwgbm9kZSwgdHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY2FuUmV0dXJuUHJpdmF0ZSA9IGZhbHNlO1xuICAgIH0sIG5vV2Fsayk7XG4gICAgcmV0dXJuIHZhbHVlO1xufTtcblxuU2NvcGVUcmVlLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIChjdXJyZW50Tm9kZSwgbmFtZSwgdmFsdWUsIG5vV2Fsaykge1xuICAgIGlmICh0aGlzLmlzT25Jbml0aWFsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzZXQgcHJvcGVydHkgb2YgdGhlIGluaXRpYWwgc2NvcGUuXCIpO1xuICAgIH1cblxuICAgIGxldCBzZWxmID0gdGhpcztcbiAgICBsZXQgY2FuU2V0UHJpdmF0ZSA9IHRydWU7XG4gICAgbGV0IHNldERvbmUgPSBmYWxzZTtcbiAgICBjdXJyZW50Tm9kZS5mb3JFYWNoVG9Sb290KGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIGlmIChub2RlID09PSBzZWxmLl9pbml0aWFsTm9kZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlLnNldFByb3BlcnR5VmFsdWUobmFtZSwgdmFsdWUsIGNhblNldFByaXZhdGUpKSB7XG4gICAgICAgICAgICBzZXREb25lID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjYW5TZXRQcml2YXRlID0gZmFsc2U7XG4gICAgfSwgbm9XYWxrKTtcblxuICAgIGlmICghc2V0RG9uZSkge1xuICAgICAgICBjdXJyZW50Tm9kZS5jcmVhdGVQcm9wZXJ0eVdpdGhWYWx1ZShuYW1lLCB2YWx1ZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG59O1xuXG5TY29wZVRyZWUucHJvdG90eXBlLmRlbGV0ZVByb3BlcnR5ID0gZnVuY3Rpb24gKGN1cnJlbnROb2RlLCBuYW1lLCBub1dhbGspIHtcbiAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgbGV0IGNhbkRlbGV0ZVByaXZhdGUgPSB0cnVlO1xuICAgIGxldCBkZWxldGVEb25lID0gZmFsc2U7XG4gICAgY3VycmVudE5vZGUuZm9yRWFjaFRvUm9vdChmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICBpZiAobm9kZSA9PT0gc2VsZi5faW5pdGlhbE5vZGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZS5kZWxldGVQcm9wZXJ0eShuYW1lLCBjYW5EZWxldGVQcml2YXRlKSkge1xuICAgICAgICAgICAgZGVsZXRlRG9uZSA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY2FuRGVsZXRlUHJpdmF0ZSA9IGZhbHNlO1xuICAgIH0sIG5vV2Fsayk7XG5cbiAgICByZXR1cm4gZGVsZXRlRG9uZTtcbn07XG5cblNjb3BlVHJlZS5wcm90b3R5cGUuZW51bWVyYXRlUHJvcGVydHlOYW1lcyA9IGZ1bmN0aW9uKiAoY3VycmVudE5vZGUsIG5vV2Fsaykge1xuICAgIGxldCBjYW5FbnVtZXJhdGVQcml2YXRlID0gdHJ1ZTtcbiAgICBsZXQgbm9kZSA9IGN1cnJlbnROb2RlO1xuICAgIGRvXG4gICAge1xuICAgICAgICB5aWVsZCBcIiRwYXJlbnRcIjtcbiAgICAgICAgeWllbGQgXCIkYWN0aXZpdHlcIjtcbiAgICAgICAgaWYgKG5vZGUudXNlcklkKSB7XG4gICAgICAgICAgICB5aWVsZCBub2RlLnVzZXJJZDtcbiAgICAgICAgfVxuICAgICAgICB5aWVsZCogbm9kZS5lbnVtZXJhdGVQcm9wZXJ0eU5hbWVzKGNhbkVudW1lcmF0ZVByaXZhdGUpO1xuICAgICAgICBjYW5FbnVtZXJhdGVQcml2YXRlID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKG5vV2Fsaykge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBub2RlID0gbm9kZS5wYXJlbnQ7XG4gICAgfVxuICAgIHdoaWxlIChub2RlKTtcbn07XG4vKiBQUk9YWSAqL1xuXG4vKiBXQUxLICovXG5TY29wZVRyZWUucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAobm9kZUluc3RhbmNlSWQsIGNoaWxkSW5zdGFuY2VJZCwgc2NvcGVQYXJ0LCBjaGlsZFVzZXJJZCkge1xuICAgIGxldCBjdXJyZW50Tm9kZSA9IHRoaXMuX2dldE5vZGVCeUV4dGVybmFsSWQobm9kZUluc3RhbmNlSWQpO1xuICAgIGxldCBuZXh0Tm9kZSA9IG5ldyBTY29wZU5vZGUoY2hpbGRJbnN0YW5jZUlkLCBzY29wZVBhcnQsIGNoaWxkVXNlcklkKTtcbiAgICBjdXJyZW50Tm9kZS5hZGRDaGlsZChuZXh0Tm9kZSk7XG4gICAgdGhpcy5fbm9kZXMuc2V0KGNoaWxkSW5zdGFuY2VJZCwgbmV4dE5vZGUpO1xuICAgIHJldHVybiBzY29wZS5jcmVhdGUodGhpcywgbmV4dE5vZGUpO1xufTtcblxuU2NvcGVUcmVlLnByb3RvdHlwZS5iYWNrID0gZnVuY3Rpb24gKG5vZGVJZCwga2VlcEl0ZW0pIHtcbiAgICBsZXQgY3VycmVudE5vZGUgPSB0aGlzLl9nZXROb2RlQnlFeHRlcm5hbElkKG5vZGVJZCk7XG4gICAgaWYgKGN1cnJlbnROb2RlID09PSB0aGlzLl9pbml0aWFsTm9kZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZ28gYmFjayBiZWNhdXNlIGN1cnJlbnQgc2NvcGUgaXMgdGhlIGluaXRpYWwgc2NvcGUuXCIpO1xuICAgIH1cbiAgICBsZXQgdG9SZW1vdmUgPSBjdXJyZW50Tm9kZTtcbiAgICBsZXQgZ29UbyA9IHRvUmVtb3ZlLnBhcmVudDtcbiAgICBjdXJyZW50Tm9kZSA9IGdvVG87XG4gICAgaWYgKCFrZWVwSXRlbSkge1xuICAgICAgICBnb1RvLnJlbW92ZUNoaWxkKHRvUmVtb3ZlKTtcbiAgICAgICAgdGhpcy5fbm9kZXMuZGVsZXRlKHRvUmVtb3ZlLmluc3RhbmNlSWQpO1xuICAgIH1cbiAgICByZXR1cm4gc2NvcGUuY3JlYXRlKHRoaXMsIGN1cnJlbnROb2RlKTtcbn07XG5cblNjb3BlVHJlZS5wcm90b3R5cGUuZmluZCA9IGZ1bmN0aW9uIChub2RlSWQpIHtcbiAgICBsZXQgY3VycmVudE5vZGUgPSB0aGlzLl9nZXROb2RlQnlFeHRlcm5hbElkKG5vZGVJZCk7XG4gICAgcmV0dXJuIHNjb3BlLmNyZWF0ZSh0aGlzLCBjdXJyZW50Tm9kZSk7XG59O1xuXG5TY29wZVRyZWUucHJvdG90eXBlLmZpbmRQYXJ0ID0gZnVuY3Rpb24gKG5vZGVJZCkge1xuICAgIGxldCBjdXJyZW50Tm9kZSA9IHRoaXMuX2dldE5vZGVCeUV4dGVybmFsSWQobm9kZUlkKTtcbiAgICBpZiAoY3VycmVudE5vZGUgIT09IHRoaXMuX2luaXRpYWxOb2RlKSB7XG4gICAgICAgIHJldHVybiBjdXJyZW50Tm9kZS5zY29wZVBhcnQ7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufTtcbi8qIFdBTEsgKi9cblxuU2NvcGVUcmVlLnByb3RvdHlwZS5fZ2V0Tm9kZUJ5RXh0ZXJuYWxJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgIGlmIChpZCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faW5pdGlhbE5vZGU7XG4gICAgfVxuICAgIGxldCBub2RlID0gdGhpcy5fbm9kZXMuZ2V0KGlkKTtcbiAgICBpZiAoIW5vZGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2NvcGUgbm9kZSBmb3IgYWN0aXZpdHkgaWQgJ1wiICsgaWQgKyBcIicgaXMgbm90IGZvdW5kLlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5TY29wZVRyZWUucHJvdG90eXBlLmRlbGV0ZVNjb3BlUGFydCA9IGZ1bmN0aW9uIChjdXJyZW50Tm9kZUlkLCBpZCkge1xuICAgIGxldCBzZWxmID0gdGhpcztcbiAgICBsZXQgY3VycmVudE5vZGUgPSB0aGlzLl9nZXROb2RlQnlFeHRlcm5hbElkKGN1cnJlbnROb2RlSWQpO1xuICAgIGxldCBkZWxOb2RlID0gc2VsZi5fbm9kZXMuZ2V0KGlkKTtcbiAgICBpZiAoZGVsTm9kZSkge1xuICAgICAgICBpZiAoZGVsTm9kZSA9PT0gc2VsZi5faW5pdGlhbE5vZGUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBkZWxldGUgdGhlIGluaXRpYWwgc2NvcGUuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBmb3VuZCA9IGZhbHNlO1xuICAgICAgICBkZWxOb2RlLmZvckVhY2hUb1Jvb3QoXG4gICAgICAgICAgICBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgICAgIGlmIChub2RlID09PSBjdXJyZW50Tm9kZSkge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGRlbGV0ZSBzY29wZSwgYmVjYXVzZSBjdXJyZW50IGFjdGl2ZSBzY29wZSBpcyBpbnNpZGUgaW4gaXQuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGRlbE5vZGUucGFyZW50LnJlbW92ZUNoaWxkKGRlbE5vZGUpO1xuICAgICAgICBzZWxmLl9yZW1vdmVBbGxOb2RlcyhkZWxOb2RlKTtcbiAgICB9XG59O1xuXG5TY29wZVRyZWUucHJvdG90eXBlLl9yZW1vdmVBbGxOb2RlcyA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuXG4gICAgc2VsZi5fbm9kZXMuZGVsZXRlKG5vZGUuaW5zdGFuY2VJZCk7XG4gICAgbm9kZS5mb3JFYWNoQ2hpbGQoZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgc2VsZi5fcmVtb3ZlQWxsTm9kZXMoYyk7XG4gICAgfSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNjb3BlVHJlZTsiXX0=
