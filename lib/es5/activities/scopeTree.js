"use strict";
var ScopeNode = require("./scopeNode");
var guids = require("../common/guids");
var _ = require("lodash");
var specStrings = require("../common/specStrings");
var errors = require("../common/errors");
var is = require("../common/is");
var scope = require("./scope");
var Expression = require("./expression");
var scopeSerializer = require("./scopeSerializer");
function ScopeTree(initialScope, getActivityByIdFunc) {
  this._initialNode = new ScopeNode(guids.ids.initialScope, initialScope);
  this._nodes = new Map();
  this._nodes.set(this._initialNode.instanceId, this._initialNode);
  this._getActivityById = getActivityByIdFunc;
}
ScopeTree.prototype.getExecutionState = function(execContext, enablePromotions) {
  return scopeSerializer.serialize(execContext, this._getActivityById, enablePromotions, this._nodes.values());
};
ScopeTree.prototype.setState = function(json) {
  if (!_.isArray(json)) {
    throw new TypeError("Array argument expected.");
  }
  if (this._nodes.count !== 1) {
    var prev = this._nodes;
    this._nodes = new Map();
    this._nodes.set(guids.ids.initialScope, prev.get(guids.ids.initialScope));
    this._initialNode.clearChildren();
  }
  try {
    var $__3 = true;
    var $__4 = false;
    var $__5 = undefined;
    try {
      for (var $__1 = void 0,
          $__0 = (scopeSerializer.deserializeNodes(this._getActivityById, json))[$traceurRuntime.toProperty(Symbol.iterator)](); !($__3 = ($__1 = $__0.next()).done); $__3 = true) {
        var node = $__1.value;
        {
          this._nodes.set(node.instanceId, node);
        }
      }
    } catch ($__6) {
      $__4 = true;
      $__5 = $__6;
    } finally {
      try {
        if (!$__3 && $__0.return != null) {
          $__0.return();
        }
      } finally {
        if ($__4) {
          throw $__5;
        }
      }
    }
    var $__10 = true;
    var $__11 = false;
    var $__12 = undefined;
    try {
      for (var $__8 = void 0,
          $__7 = (json)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__10 = ($__8 = $__7.next()).done); $__10 = true) {
        var item = $__8.value;
        {
          this._nodes.get(item.instanceId).parent = this._nodes.get(item.parentId);
        }
      }
    } catch ($__13) {
      $__11 = true;
      $__12 = $__13;
    } finally {
      try {
        if (!$__10 && $__7.return != null) {
          $__7.return();
        }
      } finally {
        if ($__11) {
          throw $__12;
        }
      }
    }
  } catch (e) {
    throw new errors.WorkflowError("Cannot restore state tree, because data is corrupt. Inner error: " + e.stack);
  }
};
ScopeTree.prototype._getRealParent = function(currentNode) {
  var parent = currentNode.parent;
  if (this._getActivityById(currentNode.instanceId) instanceof Expression) {
    parent = parent.parent;
  }
  return parent;
};
ScopeTree.prototype.hasProperty = function(currentNode, name, noWalk) {
  if (name === "$parent") {
    var parent = this._getRealParent(currentNode);
    if (parent && parent !== this._initialNode) {
      return !!parent;
    }
  }
  if (name === "$activity") {
    return true;
  }
  var found = false;
  var $__3 = true;
  var $__4 = false;
  var $__5 = undefined;
  try {
    for (var $__1 = void 0,
        $__0 = (currentNode.walkToRoot(noWalk))[$traceurRuntime.toProperty(Symbol.iterator)](); !($__3 = ($__1 = $__0.next()).done); $__3 = true) {
      var node = $__1.value;
      {
        if (node.isPropertyExists(name)) {
          found = true;
          break;
        }
        if (node.userId === name) {
          found = true;
          break;
        }
      }
    }
  } catch ($__6) {
    $__4 = true;
    $__5 = $__6;
  } finally {
    try {
      if (!$__3 && $__0.return != null) {
        $__0.return();
      }
    } finally {
      if ($__4) {
        throw $__5;
      }
    }
  }
  return found;
};
ScopeTree.prototype.getValue = function(currentNode, name, noWalk) {
  var self = this;
  if (name === "$parent") {
    var parent = this._getRealParent(currentNode);
    if (parent && parent !== this._initialNode) {
      var parentScope = scope.create(this, parent, true);
      parentScope.__marker = guids.markers.$parent;
      return parentScope;
    } else {
      return undefined;
    }
  }
  if (name === "$activity") {
    return self._getActivityById(currentNode.instanceId);
  }
  var canReturnPrivate = true;
  var value;
  var $__3 = true;
  var $__4 = false;
  var $__5 = undefined;
  try {
    for (var $__1 = void 0,
        $__0 = (currentNode.walkToRoot(noWalk))[$traceurRuntime.toProperty(Symbol.iterator)](); !($__3 = ($__1 = $__0.next()).done); $__3 = true) {
      var node = $__1.value;
      {
        if (!_.isUndefined(value = node.getPropertyValue(name, canReturnPrivate))) {
          break;
        }
        if (node.userId === name) {
          value = scope.create(self, node, true);
          break;
        }
        canReturnPrivate = false;
      }
    }
  } catch ($__6) {
    $__4 = true;
    $__5 = $__6;
  } finally {
    try {
      if (!$__3 && $__0.return != null) {
        $__0.return();
      }
    } finally {
      if ($__4) {
        throw $__5;
      }
    }
  }
  return value;
};
ScopeTree.prototype.setValue = function(currentNode, name, value, noWalk) {
  if (this.isOnInitial) {
    throw new Error("Cannot set property of the initial scope.");
  }
  var self = this;
  var canSetPrivate = true;
  var setDone = false;
  var $__3 = true;
  var $__4 = false;
  var $__5 = undefined;
  try {
    for (var $__1 = void 0,
        $__0 = (currentNode.walkToRoot(noWalk))[$traceurRuntime.toProperty(Symbol.iterator)](); !($__3 = ($__1 = $__0.next()).done); $__3 = true) {
      var node = $__1.value;
      {
        if (node === self._initialNode) {
          break;
        }
        if (node.setPropertyValue(name, value, canSetPrivate)) {
          setDone = true;
          break;
        }
        canSetPrivate = false;
      }
    }
  } catch ($__6) {
    $__4 = true;
    $__5 = $__6;
  } finally {
    try {
      if (!$__3 && $__0.return != null) {
        $__0.return();
      }
    } finally {
      if ($__4) {
        throw $__5;
      }
    }
  }
  if (!setDone) {
    currentNode.createPropertyWithValue(name, value);
  }
  return true;
};
ScopeTree.prototype.deleteProperty = function(currentNode, name, noWalk) {
  var self = this;
  var canDeletePrivate = true;
  var deleteDone = false;
  var $__3 = true;
  var $__4 = false;
  var $__5 = undefined;
  try {
    for (var $__1 = void 0,
        $__0 = (currentNode.walkToRoot(noWalk))[$traceurRuntime.toProperty(Symbol.iterator)](); !($__3 = ($__1 = $__0.next()).done); $__3 = true) {
      var node = $__1.value;
      {
        if (node === self._initialNode) {
          break;
        }
        if (node.deleteProperty(name, canDeletePrivate)) {
          deleteDone = true;
          break;
        }
        canDeletePrivate = false;
      }
    }
  } catch ($__6) {
    $__4 = true;
    $__5 = $__6;
  } finally {
    try {
      if (!$__3 && $__0.return != null) {
        $__0.return();
      }
    } finally {
      if ($__4) {
        throw $__5;
      }
    }
  }
  return deleteDone;
};
ScopeTree.prototype.enumeratePropertyNames = $traceurRuntime.initGeneratorFunction(function $__14(currentNode, noWalk) {
  var canEnumeratePrivate,
      node,
      $__15,
      $__16;
  return $traceurRuntime.createGeneratorInstance(function($ctx) {
    while (true)
      switch ($ctx.state) {
        case 0:
          canEnumeratePrivate = true;
          node = currentNode;
          $ctx.state = 35;
          break;
        case 35:
          $ctx.state = 2;
          return "$parent";
        case 2:
          $ctx.maybeThrow();
          $ctx.state = 4;
          break;
        case 4:
          $ctx.state = 6;
          return "$activity";
        case 6:
          $ctx.maybeThrow();
          $ctx.state = 8;
          break;
        case 8:
          $ctx.state = (node.userId) ? 9 : 12;
          break;
        case 9:
          $ctx.state = 10;
          return node.userId;
        case 10:
          $ctx.maybeThrow();
          $ctx.state = 12;
          break;
        case 12:
          $__15 = $ctx.wrapYieldStar(node.enumeratePropertyNames(canEnumeratePrivate)[Symbol.iterator]());
          $ctx.sent = void 0;
          $ctx.action = 'next';
          $ctx.state = 25;
          break;
        case 25:
          $__16 = $__15[$ctx.action]($ctx.sentIgnoreThrow);
          $ctx.state = 22;
          break;
        case 22:
          $ctx.state = ($__16.done) ? 16 : 15;
          break;
        case 16:
          $ctx.sent = $__16.value;
          $ctx.state = 23;
          break;
        case 15:
          $ctx.state = 25;
          return $__16.value;
        case 23:
          canEnumeratePrivate = false;
          $ctx.state = 30;
          break;
        case 30:
          $ctx.state = (noWalk) ? -2 : 27;
          break;
        case 27:
          node = node.parent;
          $ctx.state = 32;
          break;
        case 32:
          $ctx.state = (node) ? 35 : -2;
          break;
        default:
          return $ctx.end();
      }
  }, $__14, this);
});
ScopeTree.prototype.next = function(nodeInstanceId, childInstanceId, scopePart, childUserId) {
  var currentNode = this._getNodeByExternalId(nodeInstanceId);
  var nextNode = new ScopeNode(childInstanceId, scopePart, childUserId);
  currentNode.addChild(nextNode);
  this._nodes.set(childInstanceId, nextNode);
  return scope.create(this, nextNode);
};
ScopeTree.prototype.back = function(nodeId, keepItem) {
  var currentNode = this._getNodeByExternalId(nodeId);
  if (currentNode === this._initialNode) {
    throw new Error("Cannot go back because current scope is the initial scope.");
  }
  var toRemove = currentNode;
  var goTo = toRemove.parent;
  currentNode = goTo;
  if (!keepItem) {
    goTo.removeChild(toRemove);
    this._nodes.delete(toRemove.instanceId);
  }
  return scope.create(this, currentNode);
};
ScopeTree.prototype.find = function(nodeId) {
  var currentNode = this._getNodeByExternalId(nodeId);
  return scope.create(this, currentNode);
};
ScopeTree.prototype.findPart = function(nodeId) {
  var currentNode = this._getNodeByExternalId(nodeId);
  if (currentNode !== this._initialNode) {
    return currentNode.scopePart;
  }
  return null;
};
ScopeTree.prototype._getNodeByExternalId = function(id) {
  if (id === null) {
    return this._initialNode;
  }
  var node = this._nodes.get(id);
  if (!node) {
    throw new Error("Scope node for activity id '" + id + "' is not found.");
  }
  return node;
};
ScopeTree.prototype.deleteScopePart = function(currentNodeId, id) {
  var self = this;
  var currentNode = this._getNodeByExternalId(currentNodeId);
  var delNode = self._nodes.get(id);
  if (delNode) {
    if (delNode === self._initialNode) {
      throw new Error("Cannot delete the initial scope.");
    }
    var found = false;
    var $__3 = true;
    var $__4 = false;
    var $__5 = undefined;
    try {
      for (var $__1 = void 0,
          $__0 = (delNode.walkToRoot())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__3 = ($__1 = $__0.next()).done); $__3 = true) {
        var node = $__1.value;
        {
          if (node === currentNode) {
            found = true;
            break;
          }
        }
      }
    } catch ($__6) {
      $__4 = true;
      $__5 = $__6;
    } finally {
      try {
        if (!$__3 && $__0.return != null) {
          $__0.return();
        }
      } finally {
        if ($__4) {
          throw $__5;
        }
      }
    }
    if (!found) {
      throw new Error("Cannot delete scope, because current active scope is inside in it.");
    }
    delNode.parent.removeChild(delNode);
    self._removeAllNodes(delNode);
  }
};
ScopeTree.prototype._removeAllNodes = function(node) {
  var self = this;
  self._nodes.delete(node.instanceId);
  var $__3 = true;
  var $__4 = false;
  var $__5 = undefined;
  try {
    for (var $__1 = void 0,
        $__0 = (node.children())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__3 = ($__1 = $__0.next()).done); $__3 = true) {
      var c = $__1.value;
      {
        self._removeAllNodes(c);
      }
    }
  } catch ($__6) {
    $__4 = true;
    $__5 = $__6;
  } finally {
    try {
      if (!$__3 && $__0.return != null) {
        $__0.return();
      }
    } finally {
      if ($__4) {
        throw $__5;
      }
    }
  }
};
module.exports = ScopeTree;
//# sourceMappingURL=data:application/json;base64,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QyxJQUFHLFdBQVcsQ0FBQyxDQUFDO0FBdlEvQixBQUFJLElBQUEsT0FBb0IsS0FBRyxDQUFDO0FBQzVCLEFBQUksSUFBQSxPQUFvQixNQUFJLENBQUM7QUFDN0IsQUFBSSxJQUFBLE9BQW9CLFVBQVEsQ0FBQztBQUNqQyxJQUFJO0FBSEosUUFBUyxHQUFBLE9BRGpCLEtBQUssRUFBQSxBQUM0QjtBQUNoQixhQUFvQixDQUFBLENBdVFuQixJQUFHLFNBQVMsQUFBQyxFQUFDLENBdlF1QixDQUNsQyxlQUFjLFdBQVcsQUFBQyxDQUFDLE1BQUssU0FBUyxDQUFDLENBQUMsQUFBQyxFQUFDLENBQ3JELEVBQUMsQ0FBQyxNQUFvQixDQUFBLENBQUMsTUFBb0IsQ0FBQSxTQUFxQixBQUFDLEVBQUMsQ0FBQyxLQUFLLENBQUMsQ0FDekUsT0FBb0IsS0FBRyxDQUFHO1FBb1ExQixFQUFBO0FBQXNCO0FBQzNCLFdBQUcsZ0JBQWdCLEFBQUMsQ0FBQyxDQUFBLENBQUMsQ0FBQztNQUMzQjtJQW5RSTtBQUFBLEVBRkEsQ0FBRSxZQUEwQjtBQUMxQixTQUFvQixLQUFHLENBQUM7QUFDeEIsY0FBb0MsQ0FBQztFQUN2QyxDQUFFLE9BQVE7QUFDUixNQUFJO0FBQ0YsU0FBSSxLQUFpQixHQUFLLENBQUEsV0FBdUIsR0FBSyxLQUFHLENBQUc7QUFDMUQsa0JBQXdCLEFBQUMsRUFBQyxDQUFDO01BQzdCO0FBQUEsSUFDRixDQUFFLE9BQVE7QUFDUixjQUF3QjtBQUN0QixrQkFBd0I7TUFDMUI7QUFBQSxJQUNGO0FBQUEsRUFDRjtBQUFBLEFBeVBSLENBQUM7QUFFRCxLQUFLLFFBQVEsRUFBSSxVQUFRLENBQUM7QUFBQSIsImZpbGUiOiJhY3Rpdml0aWVzL3Njb3BlVHJlZS5qcyIsInNvdXJjZVJvb3QiOiJsaWIvZXM2Iiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmxldCBTY29wZU5vZGUgPSByZXF1aXJlKFwiLi9zY29wZU5vZGVcIik7XG5sZXQgZ3VpZHMgPSByZXF1aXJlKFwiLi4vY29tbW9uL2d1aWRzXCIpO1xubGV0IF8gPSByZXF1aXJlKFwibG9kYXNoXCIpO1xubGV0IHNwZWNTdHJpbmdzID0gcmVxdWlyZShcIi4uL2NvbW1vbi9zcGVjU3RyaW5nc1wiKTtcbmxldCBlcnJvcnMgPSByZXF1aXJlKFwiLi4vY29tbW9uL2Vycm9yc1wiKTtcbmxldCBpcyA9IHJlcXVpcmUoXCIuLi9jb21tb24vaXNcIik7XG5sZXQgc2NvcGUgPSByZXF1aXJlKFwiLi9zY29wZVwiKTtcbmxldCBFeHByZXNzaW9uID0gcmVxdWlyZShcIi4vZXhwcmVzc2lvblwiKTtcbmxldCBzY29wZVNlcmlhbGl6ZXIgPSByZXF1aXJlKFwiLi9zY29wZVNlcmlhbGl6ZXJcIik7XG5cbmZ1bmN0aW9uIFNjb3BlVHJlZShpbml0aWFsU2NvcGUsIGdldEFjdGl2aXR5QnlJZEZ1bmMpIHtcbiAgICB0aGlzLl9pbml0aWFsTm9kZSA9IG5ldyBTY29wZU5vZGUoZ3VpZHMuaWRzLmluaXRpYWxTY29wZSwgaW5pdGlhbFNjb3BlKTtcbiAgICB0aGlzLl9ub2RlcyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLl9ub2Rlcy5zZXQodGhpcy5faW5pdGlhbE5vZGUuaW5zdGFuY2VJZCwgdGhpcy5faW5pdGlhbE5vZGUpO1xuICAgIHRoaXMuX2dldEFjdGl2aXR5QnlJZCA9IGdldEFjdGl2aXR5QnlJZEZ1bmM7XG59XG5cbi8qIFNFUklBTElaQVRJT04gKi9cblNjb3BlVHJlZS5wcm90b3R5cGUuZ2V0RXhlY3V0aW9uU3RhdGUgPSBmdW5jdGlvbiAoZXhlY0NvbnRleHQsIGVuYWJsZVByb21vdGlvbnMpIHtcbiAgICByZXR1cm4gc2NvcGVTZXJpYWxpemVyLnNlcmlhbGl6ZShleGVjQ29udGV4dCwgdGhpcy5fZ2V0QWN0aXZpdHlCeUlkLCBlbmFibGVQcm9tb3Rpb25zLCB0aGlzLl9ub2Rlcy52YWx1ZXMoKSk7XG59O1xuXG5TY29wZVRyZWUucHJvdG90eXBlLnNldFN0YXRlID0gZnVuY3Rpb24gKGpzb24pIHtcbiAgICBpZiAoIV8uaXNBcnJheShqc29uKSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQXJyYXkgYXJndW1lbnQgZXhwZWN0ZWQuXCIpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLl9ub2Rlcy5jb3VudCAhPT0gMSkge1xuICAgICAgICBsZXQgcHJldiA9IHRoaXMuX25vZGVzO1xuICAgICAgICB0aGlzLl9ub2RlcyA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy5fbm9kZXMuc2V0KGd1aWRzLmlkcy5pbml0aWFsU2NvcGUsIHByZXYuZ2V0KGd1aWRzLmlkcy5pbml0aWFsU2NvcGUpKTtcbiAgICAgICAgdGhpcy5faW5pdGlhbE5vZGUuY2xlYXJDaGlsZHJlbigpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIC8vIENyZWF0ZSBub2RlczpcbiAgICAgICAgZm9yIChsZXQgbm9kZSBvZiBzY29wZVNlcmlhbGl6ZXIuZGVzZXJpYWxpemVOb2Rlcyh0aGlzLl9nZXRBY3Rpdml0eUJ5SWQsIGpzb24pKSB7XG4gICAgICAgICAgICB0aGlzLl9ub2Rlcy5zZXQobm9kZS5pbnN0YW5jZUlkLCBub2RlKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBTZXR1cCBUcmVlOlxuICAgICAgICBmb3IgKGxldCBpdGVtIG9mIGpzb24pIHtcbiAgICAgICAgICAgIHRoaXMuX25vZGVzLmdldChpdGVtLmluc3RhbmNlSWQpLnBhcmVudCA9IHRoaXMuX25vZGVzLmdldChpdGVtLnBhcmVudElkKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLldvcmtmbG93RXJyb3IoXCJDYW5ub3QgcmVzdG9yZSBzdGF0ZSB0cmVlLCBiZWNhdXNlIGRhdGEgaXMgY29ycnVwdC4gSW5uZXIgZXJyb3I6IFwiICsgZS5zdGFjayk7XG4gICAgfVxufTtcbi8qIFNFUklBTElaQVRJT04gKi9cblxuLyogUFJPWFkgKi9cblxuU2NvcGVUcmVlLnByb3RvdHlwZS5fZ2V0UmVhbFBhcmVudCA9IGZ1bmN0aW9uIChjdXJyZW50Tm9kZSkge1xuICAgIGxldCBwYXJlbnQgPSBjdXJyZW50Tm9kZS5wYXJlbnQ7XG4gICAgaWYgKHRoaXMuX2dldEFjdGl2aXR5QnlJZChjdXJyZW50Tm9kZS5pbnN0YW5jZUlkKSBpbnN0YW5jZW9mIEV4cHJlc3Npb24pIHtcbiAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDtcbiAgICB9XG4gICAgcmV0dXJuIHBhcmVudDtcbn07XG5cblNjb3BlVHJlZS5wcm90b3R5cGUuaGFzUHJvcGVydHkgPSBmdW5jdGlvbiAoY3VycmVudE5vZGUsIG5hbWUsIG5vV2Fsaykge1xuICAgIGlmIChuYW1lID09PSBcIiRwYXJlbnRcIikge1xuICAgICAgICBsZXQgcGFyZW50ID0gdGhpcy5fZ2V0UmVhbFBhcmVudChjdXJyZW50Tm9kZSk7XG4gICAgICAgIGlmIChwYXJlbnQgJiYgcGFyZW50ICE9PSB0aGlzLl9pbml0aWFsTm9kZSkge1xuICAgICAgICAgICAgcmV0dXJuICEhcGFyZW50O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG5hbWUgPT09IFwiJGFjdGl2aXR5XCIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgbGV0IGZvdW5kID0gZmFsc2U7XG4gICAgZm9yIChsZXQgbm9kZSBvZiBjdXJyZW50Tm9kZS53YWxrVG9Sb290KG5vV2FsaykpIHtcbiAgICAgICAgaWYgKG5vZGUuaXNQcm9wZXJ0eUV4aXN0cyhuYW1lKSkge1xuICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUudXNlcklkID09PSBuYW1lKSB7XG4gICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZm91bmQ7XG59O1xuXG5TY29wZVRyZWUucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKGN1cnJlbnROb2RlLCBuYW1lLCBub1dhbGspIHtcbiAgICBsZXQgc2VsZiA9IHRoaXM7XG5cbiAgICBpZiAobmFtZSA9PT0gXCIkcGFyZW50XCIpIHtcbiAgICAgICAgbGV0IHBhcmVudCA9IHRoaXMuX2dldFJlYWxQYXJlbnQoY3VycmVudE5vZGUpO1xuICAgICAgICBpZiAocGFyZW50ICYmIHBhcmVudCAhPT0gdGhpcy5faW5pdGlhbE5vZGUpIHtcbiAgICAgICAgICAgIGxldCBwYXJlbnRTY29wZSA9IHNjb3BlLmNyZWF0ZSh0aGlzLCBwYXJlbnQsIHRydWUpO1xuICAgICAgICAgICAgcGFyZW50U2NvcGUuX19tYXJrZXIgPSBndWlkcy5tYXJrZXJzLiRwYXJlbnQ7XG4gICAgICAgICAgICByZXR1cm4gcGFyZW50U2NvcGU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG5hbWUgPT09IFwiJGFjdGl2aXR5XCIpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuX2dldEFjdGl2aXR5QnlJZChjdXJyZW50Tm9kZS5pbnN0YW5jZUlkKTtcbiAgICB9XG5cbiAgICBsZXQgY2FuUmV0dXJuUHJpdmF0ZSA9IHRydWU7XG4gICAgbGV0IHZhbHVlO1xuICAgIGZvciAobGV0IG5vZGUgb2YgY3VycmVudE5vZGUud2Fsa1RvUm9vdChub1dhbGspKSB7XG4gICAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh2YWx1ZSA9IG5vZGUuZ2V0UHJvcGVydHlWYWx1ZShuYW1lLCBjYW5SZXR1cm5Qcml2YXRlKSkpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlLnVzZXJJZCA9PT0gbmFtZSkge1xuICAgICAgICAgICAgdmFsdWUgPSBzY29wZS5jcmVhdGUoc2VsZiwgbm9kZSwgdHJ1ZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYW5SZXR1cm5Qcml2YXRlID0gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZTtcbn07XG5cblNjb3BlVHJlZS5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiAoY3VycmVudE5vZGUsIG5hbWUsIHZhbHVlLCBub1dhbGspIHtcbiAgICBpZiAodGhpcy5pc09uSW5pdGlhbCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2V0IHByb3BlcnR5IG9mIHRoZSBpbml0aWFsIHNjb3BlLlwiKTtcbiAgICB9XG5cbiAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgbGV0IGNhblNldFByaXZhdGUgPSB0cnVlO1xuICAgIGxldCBzZXREb25lID0gZmFsc2U7XG4gICAgZm9yIChsZXQgbm9kZSBvZiBjdXJyZW50Tm9kZS53YWxrVG9Sb290KG5vV2FsaykpIHtcbiAgICAgICAgaWYgKG5vZGUgPT09IHNlbGYuX2luaXRpYWxOb2RlKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZS5zZXRQcm9wZXJ0eVZhbHVlKG5hbWUsIHZhbHVlLCBjYW5TZXRQcml2YXRlKSkge1xuICAgICAgICAgICAgc2V0RG9uZSA9IHRydWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYW5TZXRQcml2YXRlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKCFzZXREb25lKSB7XG4gICAgICAgIGN1cnJlbnROb2RlLmNyZWF0ZVByb3BlcnR5V2l0aFZhbHVlKG5hbWUsIHZhbHVlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbn07XG5cblNjb3BlVHJlZS5wcm90b3R5cGUuZGVsZXRlUHJvcGVydHkgPSBmdW5jdGlvbiAoY3VycmVudE5vZGUsIG5hbWUsIG5vV2Fsaykge1xuICAgIGxldCBzZWxmID0gdGhpcztcbiAgICBsZXQgY2FuRGVsZXRlUHJpdmF0ZSA9IHRydWU7XG4gICAgbGV0IGRlbGV0ZURvbmUgPSBmYWxzZTtcbiAgICBmb3IgKGxldCBub2RlIG9mIGN1cnJlbnROb2RlLndhbGtUb1Jvb3Qobm9XYWxrKSkge1xuICAgICAgICBpZiAobm9kZSA9PT0gc2VsZi5faW5pdGlhbE5vZGUpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlLmRlbGV0ZVByb3BlcnR5KG5hbWUsIGNhbkRlbGV0ZVByaXZhdGUpKSB7XG4gICAgICAgICAgICBkZWxldGVEb25lID0gdHJ1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhbkRlbGV0ZVByaXZhdGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZGVsZXRlRG9uZTtcbn07XG5cblNjb3BlVHJlZS5wcm90b3R5cGUuZW51bWVyYXRlUHJvcGVydHlOYW1lcyA9IGZ1bmN0aW9uKiAoY3VycmVudE5vZGUsIG5vV2Fsaykge1xuICAgIGxldCBjYW5FbnVtZXJhdGVQcml2YXRlID0gdHJ1ZTtcbiAgICBsZXQgbm9kZSA9IGN1cnJlbnROb2RlO1xuICAgIGRvXG4gICAge1xuICAgICAgICB5aWVsZCBcIiRwYXJlbnRcIjtcbiAgICAgICAgeWllbGQgXCIkYWN0aXZpdHlcIjtcbiAgICAgICAgaWYgKG5vZGUudXNlcklkKSB7XG4gICAgICAgICAgICB5aWVsZCBub2RlLnVzZXJJZDtcbiAgICAgICAgfVxuICAgICAgICB5aWVsZCogbm9kZS5lbnVtZXJhdGVQcm9wZXJ0eU5hbWVzKGNhbkVudW1lcmF0ZVByaXZhdGUpO1xuICAgICAgICBjYW5FbnVtZXJhdGVQcml2YXRlID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKG5vV2Fsaykge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBub2RlID0gbm9kZS5wYXJlbnQ7XG4gICAgfVxuICAgIHdoaWxlIChub2RlKTtcbn07XG4vKiBQUk9YWSAqL1xuXG4vKiBXQUxLICovXG5TY29wZVRyZWUucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAobm9kZUluc3RhbmNlSWQsIGNoaWxkSW5zdGFuY2VJZCwgc2NvcGVQYXJ0LCBjaGlsZFVzZXJJZCkge1xuICAgIGxldCBjdXJyZW50Tm9kZSA9IHRoaXMuX2dldE5vZGVCeUV4dGVybmFsSWQobm9kZUluc3RhbmNlSWQpO1xuICAgIGxldCBuZXh0Tm9kZSA9IG5ldyBTY29wZU5vZGUoY2hpbGRJbnN0YW5jZUlkLCBzY29wZVBhcnQsIGNoaWxkVXNlcklkKTtcbiAgICBjdXJyZW50Tm9kZS5hZGRDaGlsZChuZXh0Tm9kZSk7XG4gICAgdGhpcy5fbm9kZXMuc2V0KGNoaWxkSW5zdGFuY2VJZCwgbmV4dE5vZGUpO1xuICAgIHJldHVybiBzY29wZS5jcmVhdGUodGhpcywgbmV4dE5vZGUpO1xufTtcblxuU2NvcGVUcmVlLnByb3RvdHlwZS5iYWNrID0gZnVuY3Rpb24gKG5vZGVJZCwga2VlcEl0ZW0pIHtcbiAgICBsZXQgY3VycmVudE5vZGUgPSB0aGlzLl9nZXROb2RlQnlFeHRlcm5hbElkKG5vZGVJZCk7XG4gICAgaWYgKGN1cnJlbnROb2RlID09PSB0aGlzLl9pbml0aWFsTm9kZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZ28gYmFjayBiZWNhdXNlIGN1cnJlbnQgc2NvcGUgaXMgdGhlIGluaXRpYWwgc2NvcGUuXCIpO1xuICAgIH1cbiAgICBsZXQgdG9SZW1vdmUgPSBjdXJyZW50Tm9kZTtcbiAgICBsZXQgZ29UbyA9IHRvUmVtb3ZlLnBhcmVudDtcbiAgICBjdXJyZW50Tm9kZSA9IGdvVG87XG4gICAgaWYgKCFrZWVwSXRlbSkge1xuICAgICAgICBnb1RvLnJlbW92ZUNoaWxkKHRvUmVtb3ZlKTtcbiAgICAgICAgdGhpcy5fbm9kZXMuZGVsZXRlKHRvUmVtb3ZlLmluc3RhbmNlSWQpO1xuICAgIH1cbiAgICByZXR1cm4gc2NvcGUuY3JlYXRlKHRoaXMsIGN1cnJlbnROb2RlKTtcbn07XG5cblNjb3BlVHJlZS5wcm90b3R5cGUuZmluZCA9IGZ1bmN0aW9uIChub2RlSWQpIHtcbiAgICBsZXQgY3VycmVudE5vZGUgPSB0aGlzLl9nZXROb2RlQnlFeHRlcm5hbElkKG5vZGVJZCk7XG4gICAgcmV0dXJuIHNjb3BlLmNyZWF0ZSh0aGlzLCBjdXJyZW50Tm9kZSk7XG59O1xuXG5TY29wZVRyZWUucHJvdG90eXBlLmZpbmRQYXJ0ID0gZnVuY3Rpb24gKG5vZGVJZCkge1xuICAgIGxldCBjdXJyZW50Tm9kZSA9IHRoaXMuX2dldE5vZGVCeUV4dGVybmFsSWQobm9kZUlkKTtcbiAgICBpZiAoY3VycmVudE5vZGUgIT09IHRoaXMuX2luaXRpYWxOb2RlKSB7XG4gICAgICAgIHJldHVybiBjdXJyZW50Tm9kZS5zY29wZVBhcnQ7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufTtcbi8qIFdBTEsgKi9cblxuU2NvcGVUcmVlLnByb3RvdHlwZS5fZ2V0Tm9kZUJ5RXh0ZXJuYWxJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgIGlmIChpZCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faW5pdGlhbE5vZGU7XG4gICAgfVxuICAgIGxldCBub2RlID0gdGhpcy5fbm9kZXMuZ2V0KGlkKTtcbiAgICBpZiAoIW5vZGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2NvcGUgbm9kZSBmb3IgYWN0aXZpdHkgaWQgJ1wiICsgaWQgKyBcIicgaXMgbm90IGZvdW5kLlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIG5vZGU7XG59O1xuXG5TY29wZVRyZWUucHJvdG90eXBlLmRlbGV0ZVNjb3BlUGFydCA9IGZ1bmN0aW9uIChjdXJyZW50Tm9kZUlkLCBpZCkge1xuICAgIGxldCBzZWxmID0gdGhpcztcbiAgICBsZXQgY3VycmVudE5vZGUgPSB0aGlzLl9nZXROb2RlQnlFeHRlcm5hbElkKGN1cnJlbnROb2RlSWQpO1xuICAgIGxldCBkZWxOb2RlID0gc2VsZi5fbm9kZXMuZ2V0KGlkKTtcbiAgICBpZiAoZGVsTm9kZSkge1xuICAgICAgICBpZiAoZGVsTm9kZSA9PT0gc2VsZi5faW5pdGlhbE5vZGUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBkZWxldGUgdGhlIGluaXRpYWwgc2NvcGUuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBmb3VuZCA9IGZhbHNlO1xuICAgICAgICBmb3IgKGxldCBub2RlIG9mIGRlbE5vZGUud2Fsa1RvUm9vdCgpKSB7XG4gICAgICAgICAgICBpZiAobm9kZSA9PT0gY3VycmVudE5vZGUpIHtcbiAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGRlbGV0ZSBzY29wZSwgYmVjYXVzZSBjdXJyZW50IGFjdGl2ZSBzY29wZSBpcyBpbnNpZGUgaW4gaXQuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGRlbE5vZGUucGFyZW50LnJlbW92ZUNoaWxkKGRlbE5vZGUpO1xuICAgICAgICBzZWxmLl9yZW1vdmVBbGxOb2RlcyhkZWxOb2RlKTtcbiAgICB9XG59O1xuXG5TY29wZVRyZWUucHJvdG90eXBlLl9yZW1vdmVBbGxOb2RlcyA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuXG4gICAgc2VsZi5fbm9kZXMuZGVsZXRlKG5vZGUuaW5zdGFuY2VJZCk7XG4gICAgZm9yIChsZXQgYyBvZiBub2RlLmNoaWxkcmVuKCkpIHtcbiAgICAgICAgc2VsZi5fcmVtb3ZlQWxsTm9kZXMoYyk7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTY29wZVRyZWU7Il19
