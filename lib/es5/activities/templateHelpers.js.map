{"version":3,"sources":["activities/templateHelpers.js"],"names":[],"mappings":"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","file":"activities/templateHelpers.js","sourcesContent":["\"use strict\";\n\nlet _ = require(\"lodash\");\nlet Reflection = require(\"backpack-node\").system.Reflection;\n\nlet maxDepth = 10;\n\nlet templateHelpers = {\n\n    isFunctionString: function (str) {\n        return _.isString(str) && str.match(/^\\s*function\\s*\\w*\\s*\\((?:\\w+,)*(?:\\w+)?\\)\\s*\\{/);\n    },\n    isTemplate: function (obj) {\n        let activityCount = 0;\n        templateHelpers.visitActivities(obj, function () {\n            activityCount++;\n        });\n        return activityCount > 0;\n    },\n    visitActivities: function (obj, f) {\n        if (!_.isPlainObject(obj) && !_.isArray(obj)) {\n            return;\n        }\n        Reflection.visitObject(obj,\n            function (subObj, parent, pkey) {\n                if (_.isString(subObj)) {\n                    let str = subObj.trim();\n                    if (str.length > 1) {\n                        if (str[0] === \"=\") {\n                            let markup = {\n                                \"@expression\": {\n                                    expr: str.substr(1)\n                                }\n                            };\n                            f(markup, parent, pkey);\n                            return false;\n                        }\n                        if (templateHelpers.isFunctionString(str)) {\n                            let markup = {\n                                \"@func\": {\n                                    code: str\n                                }\n                            };\n                            f(markup, parent, pkey);\n                            return false;\n                        }\n                    }\n                }\n                else if (_.isPlainObject(subObj)) {\n                    let keys = _.keys(subObj);\n\n                    if (keys.length === 1) {\n                        let key = keys[0];\n                        if (key[0] === \"@\" && key.length > 1) {\n                            let markup = {};\n                            markup[key] = subObj[key];\n                            f(markup, parent, pkey);\n                            return false;\n                        }\n                    }\n                    else if (keys.length === 2) {\n                        let key1 = keys[0];\n                        let key2 = keys[1];\n                        if (key1 === \"@require\" && key2[0] === \"@\" && key2.length > 1) {\n                            let markup = {};\n                            markup[key1] = subObj[key1];\n                            markup[key2] = subObj[key2];\n                            f(markup, parent, pkey);\n                            return false;\n                        }\n                        else if (key2 === \"@require\" && key1[0] === \"@\" && key1.length > 1) {\n                            let markup = {};\n                            markup[key2] = subObj[key2];\n                            markup[key1] = subObj[key1];\n                            f(markup, parent, pkey);\n                            return false;\n                        }\n                    }\n                }\n                else if (_.isFunction(subObj)) {\n                    let markup = {\n                        \"@func\": {\n                            code: subObj\n                        }\n                    };\n                    f(markup, parent, pkey);\n                    return false;\n                }\n                return true;\n            },\n            maxDepth);\n    },\n    cloneDeep: function(obj) {\n        if (_.isPlainObject(obj)) {\n            let other = {};\n            for (let key in obj) {\n                if (obj.hasOwnProperty(key)) {\n                    other[key] = this.cloneDeep(obj[key]);\n                }\n            }\n            return other;\n        }\n        else if (_.isArray(obj)) {\n            let other = [];\n            for (let item of obj) {\n                other.push(this.cloneDeep(item));\n            }\n            return other;\n        }\n        else if (_.isObject(obj) && _.isFunction(obj.clone)) {\n            return obj.clone();\n        }\n        return obj;\n    }\n};\n\nmodule.exports = templateHelpers;"],"sourceRoot":"/source/"}