{"version":3,"names":[],"mappings":"","sources":["activities/templateHelpers.js"],"sourcesContent":["\"use strict\";\n\nlet _ = require(\"lodash\");\nlet Reflection = require(\"backpack-node\").system.Reflection;\n\nlet maxDepth = 10;\n\nlet templateHelpers = {\n\n    isFunctionString: function (str) {\n        return _.isString(str) && str.match(/^\\s*function\\s*\\w*\\s*\\((?:\\w+,)*(?:\\w+)?\\)\\s*\\{/);\n    },\n    isTemplate: function (obj) {\n        let activityCount = 0;\n        templateHelpers.visitActivities(obj, function () {\n            activityCount++;\n        });\n        return activityCount > 0;\n    },\n    visitActivities: function (obj, f) {\n        if (!_.isPlainObject(obj) && !_.isArray(obj)) {\n            return;\n        }\n        Reflection.visitObject(obj,\n            function (subObj, parent, pkey) {\n                if (_.isString(subObj)) {\n                    let str = subObj.trim();\n                    if (str.length > 1) {\n                        if (str[0] === \"=\") {\n                            let markup = {\n                                \"@expression\": {\n                                    expr: str.substr(1)\n                                }\n                            };\n                            f(markup, parent, pkey);\n                            return false;\n                        }\n                        if (templateHelpers.isFunctionString(str)) {\n                            let markup = {\n                                \"@func\": {\n                                    code: str\n                                }\n                            };\n                            f(markup, parent, pkey);\n                            return false;\n                        }\n                    }\n                }\n                else if (_.isPlainObject(subObj)) {\n                    let keys = _.keys(subObj);\n\n                    if (keys.length === 1) {\n                        let key = keys[0];\n                        if (key[0] === \"@\" && key.length > 1) {\n                            let markup = {};\n                            markup[key] = subObj[key];\n                            f(markup, parent, pkey);\n                            return false;\n                        }\n                    }\n                    else if (keys.length === 2) {\n                        let key1 = keys[0];\n                        let key2 = keys[1];\n                        if (key1 === \"@require\" && key2[0] === \"@\" && key2.length > 1) {\n                            let markup = {};\n                            markup[key1] = subObj[key1];\n                            markup[key2] = subObj[key2];\n                            f(markup, parent, pkey);\n                            return false;\n                        }\n                        else if (key2 === \"@require\" && key1[0] === \"@\" && key1.length > 1) {\n                            let markup = {};\n                            markup[key2] = subObj[key2];\n                            markup[key1] = subObj[key1];\n                            f(markup, parent, pkey);\n                            return false;\n                        }\n                    }\n                }\n                else if (_.isFunction(subObj)) {\n                    let markup = {\n                        \"@func\": {\n                            code: subObj\n                        }\n                    };\n                    f(markup, parent, pkey);\n                    return false;\n                }\n                return true;\n            },\n            maxDepth);\n    }\n};\n\nmodule.exports = templateHelpers;"],"file":"activities/templateHelpers.js","sourceRoot":"/source/"}