"use strict";
var guids = require("../common/guids");
var errors = require("../common/errors");
var enums = require("../common/enums");
var _ = require("lodash");
var specStrings = require("../common/specStrings");
var WFObject = require("../common/wfObject");
var util = require("util");
var StrSet = require("backpack-node").collections.StrSet;
var is = require("../common/is");
var fast = require("fast.js");
var CallContext = require("./callContext");
function Activity() {
  WFObject.call(this);
  this[guids.types.activity] = true;
  this.id = null;
  this.args = null;
  this.displayName = "";
  this.nonSerializedProperties = new StrSet();
  this.nonScopedProperties = new StrSet();
  this.nonScopedProperties.add(guids.types.activity);
  this.nonScopedProperties.add("nonScopedProperties");
  this.nonScopedProperties.add("nonSerializedProperties");
  this.nonScopedProperties.add("_instanceId");
  this.nonScopedProperties.add("activity");
  this.nonScopedProperties.add("id");
  this.nonScopedProperties.add("args");
  this.nonScopedProperties.add("__typeTag");
  this.nonScopedProperties.add("displayName");
  this.nonScopedProperties.add("complete");
  this.nonScopedProperties.add("cancel");
  this.nonScopedProperties.add("idle");
  this.nonScopedProperties.add("fail");
  this.nonScopedProperties.add("end");
  this.nonScopedProperties.add("schedule");
  this.nonScopedProperties.add("createBookmark");
  this.nonScopedProperties.add("resumeBookmark");
  this.nonScopedProperties.add("resultCollected");
  this.nonScopedProperties.add("codeProperties");
  this.codeProperties = new StrSet();
}
util.inherits(Activity, WFObject);
Object.defineProperties(Activity.prototype, {
  _scopeKeys: {
    value: null,
    writable: true,
    enumerable: false
  },
  _createScopePartImpl: {
    value: null,
    writable: true,
    enumerable: false
  }
});
Activity.prototype.toString = function() {
  return (this.displayName ? (this.displayName + " ") : "") + "(" + this.constructor.name + ":" + this.id + ")";
};
Activity.prototype.forEach = function(f) {
  var visited = {};
  return this._forEach(f, visited, null);
};
Activity.prototype.forEachChild = function(f) {
  var visited = {};
  return this._forEach(f, visited, this);
};
Activity.prototype.forEachImmediateChild = function(f) {
  var self = this;
  fast.forEach(self.getKeys(), function(fieldName) {
    var fieldValue = self[fieldName];
    if (fieldValue) {
      if (_.isArray(fieldValue)) {
        fieldValue.forEach(function(obj) {
          if (obj instanceof Activity) {
            f(obj);
          }
        });
      } else if (fieldValue instanceof Activity) {
        f(fieldValue);
      }
    }
  });
};
Activity.prototype._forEach = function(f, visited, except) {
  var self = this;
  if (is.undefined(visited[self._instanceId])) {
    visited[self._instanceId] = true;
    if (self !== except)
      f(self);
    fast.forEach(self.getKeys(), function(fieldName) {
      var fieldValue = self[fieldName];
      if (fieldValue) {
        if (_.isArray(fieldValue)) {
          fieldValue.forEach(function(obj) {
            if (obj instanceof Activity) {
              obj._forEach(f, visited, except);
            }
          });
        } else if (fieldValue instanceof Activity) {
          fieldValue._forEach(f, visited, except);
        }
      }
    });
  }
};
Activity.prototype.start = function(callContext) {
  var self = this;
  if (!(callContext instanceof CallContext)) {
    throw new Error("Argument 'context' is not an instance of ActivityExecutionContext.");
  }
  var args = self.args;
  if (arguments.length > 1) {
    args = [];
    for (var i = 1; i < arguments.length; i++)
      args.push(arguments[i]);
  }
  var myCallContext = callContext.next(self);
  var state = myCallContext.executionState;
  if (state.isRunning)
    throw new Error("Activity is already running.");
  var e = fast.try(function() {
    state.reportState(Activity.states.run);
    self.run.call(myCallContext.scope, myCallContext, args);
  });
  if (e)
    throw e;
};
Activity.prototype.run = function(callContext, args) {
  this.complete(callContext, args);
};
Activity.prototype.complete = function(callContext, result) {
  this.end(callContext, Activity.states.complete, result);
};
Activity.prototype.cancel = function(callContext) {
  this.end(callContext, Activity.states.cancel);
};
Activity.prototype.idle = function(callContext) {
  this.end(callContext, Activity.states.idle);
};
Activity.prototype.fail = function(callContext, e) {
  this.end(callContext, Activity.states.fail, e);
};
Activity.prototype.end = function(callContext, reason, result) {
  var state = callContext.executionState;
  if (state.execState === Activity.states.cancel || state.execState === Activity.states.fail) {
    return ;
  }
  state.execState = reason;
  var inIdle = reason === Activity.states.idle;
  var execContext = callContext.executionContext;
  callContext = callContext.back(inIdle);
  if (callContext) {
    var bmName = specStrings.activities.createValueCollectedBMName(this);
    if (execContext.isBookmarkExists(bmName)) {
      state.emitState(result);
      execContext.resumeBookmarkInScope(callContext, bmName, reason, result);
      return ;
    }
  } else {
    if (inIdle && execContext.processResumeBookmarkQueue()) {
      return ;
    }
  }
  state.emitState(result);
};
Activity.prototype.schedule = function(callContext, obj, endCallback) {
  var self = this;
  var scope = callContext.scope;
  var execContext = callContext.executionContext;
  if (Array.isArray(obj) && obj.length) {
    scope.set("__collectValues", []);
    var activities = [];
    obj.forEach(function(v) {
      if (v instanceof Activity) {
        scope.get("__collectValues").push(specStrings.activities.asValueToCollect(v));
        activities.push(v);
      } else {
        scope.get("__collectValues").push(v);
      }
    });
    if (activities.length) {
      scope.set("__collectPickRound2", false);
      scope.set("__collectErrors", []);
      scope.set("__collectCancelCounts", 0);
      scope.set("__collectIdleCounts", 0);
      scope.set("__collectRemaining", activities.length);
      var endBM = scope.set("__collectEndBookmarkName", specStrings.activities.createCollectingCompletedBMName(self));
      execContext.createBookmark(self.id, scope.get("__collectEndBookmarkName"), endCallback);
      var len = activities.length;
      for (var i = 0; i < len; i++) {
        var childActivity = activities[i];
        execContext.createBookmark(self.id, specStrings.activities.createValueCollectedBMName(childActivity), "resultCollected");
        childActivity.start(callContext);
        if (!execContext.isBookmarkExists(endBM)) {
          break;
        }
      }
    } else {
      var result = scope.get("__collectValues");
      scope.delete("__collectValues");
      scope.get(endCallback).call(scope, callContext, Activity.states.complete, result);
    }
  } else if (obj instanceof Activity) {
    execContext.createBookmark(self.id, specStrings.activities.createValueCollectedBMName(obj), endCallback);
    obj.start(callContext);
  } else {
    scope.get(endCallback).call(scope, callContext, Activity.states.complete, obj);
  }
};
Activity.prototype.resultCollected = function(callContext, reason, result, bookmark) {
  var self = this;
  var execContext = callContext.executionContext;
  var childId = specStrings.getString(bookmark.name);
  var argMarker = specStrings.activities.asValueToCollect(childId);
  var resultIndex = self.get("__collectValues").indexOf(argMarker);
  var pickCurrent = false;
  if (resultIndex === -1) {
    self.get("__collectErrors").push(new errors.ActivityStateExceptionError("Activity '" + childId + "' is not found in __collectValues."));
  } else {
    if (self.get("__collectPick") && (reason !== Activity.states.idle || self.get("__collectPickRound2"))) {
      var ids = [];
      fast.forEach(self.get("__collectValues"), function(cv) {
        var id = specStrings.getString(cv);
        if (id && id != childId) {
          ids.push(id);
          execContext.deleteScopeOfActivity(callContext, id);
          var ibmName = specStrings.activities.createValueCollectedBMName(id);
          execContext.deleteBookmark(ibmName);
        }
      });
      execContext.cancelExecution(ids);
      pickCurrent = true;
    } else {
      switch (reason) {
        case Activity.states.complete:
          self.get("__collectValues")[resultIndex] = result;
          break;
        case Activity.states.cancel:
          self.inc("__collectCancelCounts");
          self.get("__collectValues")[resultIndex] = null;
          break;
        case Activity.states.idle:
          self.inc("__collectIdleCounts");
          break;
        case Activity.states.fail:
          result = result || new errors.ActivityStateExceptionError("Unknown error.");
          self.get("__collectErrors").push(result);
          self.get("__collectValues")[resultIndex] = null;
          break;
        default:
          self.get("__collectErrors").push(new errors.ActivityStateExceptionError("Bookmark should not be continued with reason '" + reason + "'."));
          self.get("__collectValues")[resultIndex] = null;
          break;
      }
    }
  }
  if (self.dec("__collectRemaining") === 0 || pickCurrent) {
    var endBookmarkName = self.get("__collectEndBookmarkName");
    if (!pickCurrent) {
      var reason;
      var result = null;
      if (self.get("__collectErrors").length) {
        reason = Activity.states.fail;
        var __collectErrors = self.get("__collectErrors");
        if (__collectErrors.length === 1) {
          result = __collectErrors[0];
        } else {
          result = new errors.AggregateError(__collectErrors);
        }
      } else if (self.get("__collectCancelCounts")) {
        reason = Activity.states.cancel;
      } else if (self.get("__collectIdleCounts")) {
        reason = Activity.states.idle;
        self.set("__collectRemaining", 1);
        self.dec("__collectIdleCounts");
        if (self.get("__collectPick")) {
          self.set("__collectPickRound2", true);
        }
      } else {
        reason = Activity.states.complete;
        result = self.get("__collectValues");
      }
    }
    if (!self.get("__collectRemaining")) {
      self.delete("__collectValues");
      self.delete("__collectRemaining");
      self.delete("__collectIdleCounts");
      self.delete("__collectEndBookmarkName");
      self.delete("__collectCancelCounts");
      self.delete("__collectErrors");
      self.delete("__collectPick");
      self.delete("__collectPickRound2");
    }
    execContext.resumeBookmarkInScope(callContext, endBookmarkName, reason, result);
  }
};
Activity.prototype._getScopeKeys = function() {
  var self = this;
  if (!self._scopeKeys) {
    self._scopeKeys = [];
    fast.forEach(self.getKeys(), function(key) {
      if (self.nonScopedProperties.exists(key))
        return ;
      if (Activity.prototype[key])
        return ;
      self._scopeKeys.push(key);
    });
  }
  return self._scopeKeys;
};
Activity.prototype.createScopePart = function() {
  var self = this;
  if (this._createScopePartImpl === null) {
    var first = true;
    var src = "return {";
    fast.forEach(self._getScopeKeys(), function(fieldName) {
      if (first) {
        first = false;
      } else {
        src += ",\n";
      }
      if (_.isPlainObject(self[fieldName])) {
        src += fieldName + ":_.clone(a." + fieldName + ", true)";
      } else {
        src += fieldName + ":a." + fieldName;
      }
    });
    src += "}";
    this._createScopePartImpl = new Function("a,_", src);
  }
  return this._createScopePartImpl(this, _);
};
Activity.states = enums.ActivityStates;
module.exports = Activity;
//# sourceMappingURL=data:application/json;base64,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R0FBSyxNQUFJLENBQUM7TUFDaEI7QUFBQSxBQUNBLFNBQUksQ0FBQSxjQUFjLEFBQUMsQ0FBQyxJQUFHLENBQUUsU0FBUSxDQUFDLENBQUMsQ0FBRztBQUNsQyxVQUFFLEdBQUssQ0FBQSxTQUFRLEVBQUksY0FBWSxDQUFBLENBQUksVUFBUSxDQUFBLENBQUksVUFBUSxDQUFDO01BQzVELEtBQ0s7QUFDRCxVQUFFLEdBQUssQ0FBQSxTQUFRLEVBQUksTUFBSSxDQUFBLENBQUksVUFBUSxDQUFDO01BQ3hDO0FBQUEsSUFDSixDQUFDLENBQUM7QUFDRixNQUFFLEdBQUssSUFBRSxDQUFDO0FBRVYsT0FBRyxxQkFBcUIsRUFBSSxJQUFJLFNBQU8sQUFBQyxDQUFDLEtBQUksQ0FBRyxJQUFFLENBQUMsQ0FBQztFQUN4RDtBQUFBLEFBRUEsT0FBTyxDQUFBLElBQUcscUJBQXFCLEFBQUMsQ0FBQyxJQUFHLENBQUcsRUFBQSxDQUFDLENBQUM7QUFDN0MsQ0FBQTtBQUdBLE9BQU8sT0FBTyxFQUFJLENBQUEsS0FBSSxlQUFlLENBQUM7QUFFdEMsS0FBSyxRQUFRLEVBQUksU0FBTyxDQUFDO0FBQ3pCIiwiZmlsZSI6ImFjdGl2aXRpZXMvYWN0aXZpdHkuanMiLCJzb3VyY2VSb290IjoibGliL2VzNiIsInNvdXJjZXNDb250ZW50IjpbInZhciBndWlkcyA9IHJlcXVpcmUoXCIuLi9jb21tb24vZ3VpZHNcIik7XHJcbnZhciBlcnJvcnMgPSByZXF1aXJlKFwiLi4vY29tbW9uL2Vycm9yc1wiKTtcclxudmFyIGVudW1zID0gcmVxdWlyZShcIi4uL2NvbW1vbi9lbnVtc1wiKTtcclxudmFyIF8gPSByZXF1aXJlKFwibG9kYXNoXCIpO1xyXG52YXIgc3BlY1N0cmluZ3MgPSByZXF1aXJlKFwiLi4vY29tbW9uL3NwZWNTdHJpbmdzXCIpO1xyXG52YXIgV0ZPYmplY3QgPSByZXF1aXJlKFwiLi4vY29tbW9uL3dmT2JqZWN0XCIpO1xyXG52YXIgdXRpbCA9IHJlcXVpcmUoXCJ1dGlsXCIpO1xyXG52YXIgU3RyU2V0ID0gcmVxdWlyZShcImJhY2twYWNrLW5vZGVcIikuY29sbGVjdGlvbnMuU3RyU2V0O1xyXG52YXIgaXMgPSByZXF1aXJlKFwiLi4vY29tbW9uL2lzXCIpO1xyXG52YXIgZmFzdCA9IHJlcXVpcmUoXCJmYXN0LmpzXCIpO1xyXG52YXIgQ2FsbENvbnRleHQgPSByZXF1aXJlKFwiLi9jYWxsQ29udGV4dFwiKTtcclxuXHJcbmZ1bmN0aW9uIEFjdGl2aXR5KCkge1xyXG4gICAgV0ZPYmplY3QuY2FsbCh0aGlzKTtcclxuXHJcbiAgICB0aGlzW2d1aWRzLnR5cGVzLmFjdGl2aXR5XSA9IHRydWU7XHJcbiAgICB0aGlzLmlkID0gbnVsbDtcclxuICAgIHRoaXMuYXJncyA9IG51bGw7XHJcbiAgICB0aGlzLmRpc3BsYXlOYW1lID0gXCJcIjtcclxuXHJcbiAgICAvLyBQcm9wZXJ0aWVzIG5vdCBzZXJpYWxpemVkOlxyXG4gICAgdGhpcy5ub25TZXJpYWxpemVkUHJvcGVydGllcyA9IG5ldyBTdHJTZXQoKTtcclxuXHJcbiAgICAvLyBQcm9wZXJ0aWVzIGFyZSBub3QgZ29pbmcgdG8gY29waWVkIGluIHRoZSBzY29wZTpcclxuICAgIHRoaXMubm9uU2NvcGVkUHJvcGVydGllcyA9IG5ldyBTdHJTZXQoKTtcclxuICAgIHRoaXMubm9uU2NvcGVkUHJvcGVydGllcy5hZGQoZ3VpZHMudHlwZXMuYWN0aXZpdHkpO1xyXG4gICAgdGhpcy5ub25TY29wZWRQcm9wZXJ0aWVzLmFkZChcIm5vblNjb3BlZFByb3BlcnRpZXNcIik7XHJcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKFwibm9uU2VyaWFsaXplZFByb3BlcnRpZXNcIik7XHJcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKFwiX2luc3RhbmNlSWRcIik7XHJcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKFwiYWN0aXZpdHlcIik7XHJcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKFwiaWRcIik7XHJcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKFwiYXJnc1wiKTtcclxuICAgIHRoaXMubm9uU2NvcGVkUHJvcGVydGllcy5hZGQoXCJfX3R5cGVUYWdcIik7XHJcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKFwiZGlzcGxheU5hbWVcIik7XHJcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKFwiY29tcGxldGVcIik7XHJcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKFwiY2FuY2VsXCIpO1xyXG4gICAgdGhpcy5ub25TY29wZWRQcm9wZXJ0aWVzLmFkZChcImlkbGVcIik7XHJcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKFwiZmFpbFwiKTtcclxuICAgIHRoaXMubm9uU2NvcGVkUHJvcGVydGllcy5hZGQoXCJlbmRcIik7XHJcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKFwic2NoZWR1bGVcIik7XHJcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKFwiY3JlYXRlQm9va21hcmtcIik7XHJcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKFwicmVzdW1lQm9va21hcmtcIik7XHJcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKFwicmVzdWx0Q29sbGVjdGVkXCIpO1xyXG4gICAgdGhpcy5ub25TY29wZWRQcm9wZXJ0aWVzLmFkZChcImNvZGVQcm9wZXJ0aWVzXCIpO1xyXG5cclxuICAgIHRoaXMuY29kZVByb3BlcnRpZXMgPSBuZXcgU3RyU2V0KCk7XHJcbn1cclxuXHJcbnV0aWwuaW5oZXJpdHMoQWN0aXZpdHksIFdGT2JqZWN0KTtcclxuXHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKEFjdGl2aXR5LnByb3RvdHlwZSwge1xyXG4gICAgX3Njb3BlS2V5czoge1xyXG4gICAgICAgIHZhbHVlOiBudWxsLFxyXG4gICAgICAgIHdyaXRhYmxlOiB0cnVlLFxyXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlXHJcbiAgICB9LFxyXG4gICAgX2NyZWF0ZVNjb3BlUGFydEltcGw6IHtcclxuICAgICAgICB2YWx1ZTogbnVsbCxcclxuICAgICAgICB3cml0YWJsZTogdHJ1ZSxcclxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZVxyXG4gICAgfVxyXG59KTtcclxuXHJcbkFjdGl2aXR5LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiAodGhpcy5kaXNwbGF5TmFtZSA/ICh0aGlzLmRpc3BsYXlOYW1lICsgXCIgXCIpIDogXCJcIikgKyBcIihcIiArIHRoaXMuY29uc3RydWN0b3IubmFtZSArIFwiOlwiICsgdGhpcy5pZCArIFwiKVwiO1xyXG59XHJcblxyXG4vKiBmb3JFYWNoICovXHJcbkFjdGl2aXR5LnByb3RvdHlwZS5mb3JFYWNoID0gZnVuY3Rpb24gKGYpIHtcclxuICAgIHZhciB2aXNpdGVkID0ge307XHJcbiAgICByZXR1cm4gdGhpcy5fZm9yRWFjaChmLCB2aXNpdGVkLCBudWxsKTtcclxufVxyXG5cclxuQWN0aXZpdHkucHJvdG90eXBlLmZvckVhY2hDaGlsZCA9IGZ1bmN0aW9uIChmKSB7XHJcbiAgICB2YXIgdmlzaXRlZCA9IHt9O1xyXG4gICAgcmV0dXJuIHRoaXMuX2ZvckVhY2goZiwgdmlzaXRlZCwgdGhpcyk7XHJcbn1cclxuXHJcbkFjdGl2aXR5LnByb3RvdHlwZS5mb3JFYWNoSW1tZWRpYXRlQ2hpbGQgPSBmdW5jdGlvbiAoZikge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgIGZhc3QuZm9yRWFjaChzZWxmLmdldEtleXMoKSwgZnVuY3Rpb24gKGZpZWxkTmFtZSkge1xyXG4gICAgICAgIHZhciBmaWVsZFZhbHVlID0gc2VsZltmaWVsZE5hbWVdO1xyXG4gICAgICAgIGlmIChmaWVsZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIGlmIChfLmlzQXJyYXkoZmllbGRWYWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgIGZpZWxkVmFsdWUuZm9yRWFjaChcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAob2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBBY3Rpdml0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZihvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoZmllbGRWYWx1ZSBpbnN0YW5jZW9mIEFjdGl2aXR5KSB7XHJcbiAgICAgICAgICAgICAgICBmKGZpZWxkVmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxuXHJcbkFjdGl2aXR5LnByb3RvdHlwZS5fZm9yRWFjaCA9IGZ1bmN0aW9uIChmLCB2aXNpdGVkLCBleGNlcHQpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIGlmIChpcy51bmRlZmluZWQodmlzaXRlZFtzZWxmLl9pbnN0YW5jZUlkXSkpIHtcclxuICAgICAgICB2aXNpdGVkW3NlbGYuX2luc3RhbmNlSWRdID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgaWYgKHNlbGYgIT09IGV4Y2VwdCkgZihzZWxmKTtcclxuXHJcbiAgICAgICAgZmFzdC5mb3JFYWNoKHNlbGYuZ2V0S2V5cygpLCBmdW5jdGlvbiAoZmllbGROYW1lKSB7XHJcbiAgICAgICAgICAgIHZhciBmaWVsZFZhbHVlID0gc2VsZltmaWVsZE5hbWVdO1xyXG4gICAgICAgICAgICBpZiAoZmllbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKF8uaXNBcnJheShmaWVsZFZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkVmFsdWUuZm9yRWFjaChcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIEFjdGl2aXR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLl9mb3JFYWNoKGYsIHZpc2l0ZWQsIGV4Y2VwdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZmllbGRWYWx1ZSBpbnN0YW5jZW9mIEFjdGl2aXR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGRWYWx1ZS5fZm9yRWFjaChmLCB2aXNpdGVkLCBleGNlcHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuLyogZm9yRWFjaCAqL1xyXG5cclxuLyogUlVOICovXHJcbkFjdGl2aXR5LnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uIChjYWxsQ29udGV4dCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgIGlmICghKGNhbGxDb250ZXh0IGluc3RhbmNlb2YgQ2FsbENvbnRleHQpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQXJndW1lbnQgJ2NvbnRleHQnIGlzIG5vdCBhbiBpbnN0YW5jZSBvZiBBY3Rpdml0eUV4ZWN1dGlvbkNvbnRleHQuXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBhcmdzID0gc2VsZi5hcmdzO1xyXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgYXJncyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSBhcmdzLnB1c2goYXJndW1lbnRzW2ldKTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgbXlDYWxsQ29udGV4dCA9IGNhbGxDb250ZXh0Lm5leHQoc2VsZik7XHJcbiAgICB2YXIgc3RhdGUgPSBteUNhbGxDb250ZXh0LmV4ZWN1dGlvblN0YXRlO1xyXG4gICAgaWYgKHN0YXRlLmlzUnVubmluZykgdGhyb3cgbmV3IEVycm9yKFwiQWN0aXZpdHkgaXMgYWxyZWFkeSBydW5uaW5nLlwiKTtcclxuXHJcbiAgICB2YXIgZSA9IGZhc3QudHJ5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBzdGF0ZS5yZXBvcnRTdGF0ZShBY3Rpdml0eS5zdGF0ZXMucnVuKTtcclxuICAgICAgICBzZWxmLnJ1bi5jYWxsKG15Q2FsbENvbnRleHQuc2NvcGUsIG15Q2FsbENvbnRleHQsIGFyZ3MpO1xyXG4gICAgfSk7XHJcbiAgICBpZiAoZSkgdGhyb3cgZTtcclxufVxyXG5cclxuQWN0aXZpdHkucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uIChjYWxsQ29udGV4dCwgYXJncykge1xyXG4gICAgdGhpcy5jb21wbGV0ZShjYWxsQ29udGV4dCwgYXJncyk7XHJcbn1cclxuXHJcbkFjdGl2aXR5LnByb3RvdHlwZS5jb21wbGV0ZSA9IGZ1bmN0aW9uIChjYWxsQ29udGV4dCwgcmVzdWx0KSB7XHJcbiAgICB0aGlzLmVuZChjYWxsQ29udGV4dCwgQWN0aXZpdHkuc3RhdGVzLmNvbXBsZXRlLCByZXN1bHQpO1xyXG59XHJcblxyXG5BY3Rpdml0eS5wcm90b3R5cGUuY2FuY2VsID0gZnVuY3Rpb24gKGNhbGxDb250ZXh0KSB7XHJcbiAgICB0aGlzLmVuZChjYWxsQ29udGV4dCwgQWN0aXZpdHkuc3RhdGVzLmNhbmNlbCk7XHJcbn1cclxuXHJcbkFjdGl2aXR5LnByb3RvdHlwZS5pZGxlID0gZnVuY3Rpb24gKGNhbGxDb250ZXh0KSB7XHJcbiAgICB0aGlzLmVuZChjYWxsQ29udGV4dCwgQWN0aXZpdHkuc3RhdGVzLmlkbGUpO1xyXG59XHJcblxyXG5BY3Rpdml0eS5wcm90b3R5cGUuZmFpbCA9IGZ1bmN0aW9uIChjYWxsQ29udGV4dCwgZSkge1xyXG4gICAgdGhpcy5lbmQoY2FsbENvbnRleHQsIEFjdGl2aXR5LnN0YXRlcy5mYWlsLCBlKTtcclxufVxyXG5cclxuQWN0aXZpdHkucHJvdG90eXBlLmVuZCA9IGZ1bmN0aW9uIChjYWxsQ29udGV4dCwgcmVhc29uLCByZXN1bHQpIHtcclxuICAgIHZhciBzdGF0ZSA9IGNhbGxDb250ZXh0LmV4ZWN1dGlvblN0YXRlO1xyXG5cclxuICAgIGlmIChzdGF0ZS5leGVjU3RhdGUgPT09IEFjdGl2aXR5LnN0YXRlcy5jYW5jZWwgfHwgc3RhdGUuZXhlY1N0YXRlID09PSBBY3Rpdml0eS5zdGF0ZXMuZmFpbCkge1xyXG4gICAgICAgIC8vIEl0IHdhcyBjYW5jZWxsZWQgb3IgZmFpbGVkOlxyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0ZS5leGVjU3RhdGUgPSByZWFzb247XHJcblxyXG4gICAgdmFyIGluSWRsZSA9IHJlYXNvbiA9PT0gQWN0aXZpdHkuc3RhdGVzLmlkbGU7XHJcbiAgICB2YXIgZXhlY0NvbnRleHQgPSBjYWxsQ29udGV4dC5leGVjdXRpb25Db250ZXh0O1xyXG4gICAgY2FsbENvbnRleHQgPSBjYWxsQ29udGV4dC5iYWNrKGluSWRsZSk7XHJcblxyXG4gICAgaWYgKGNhbGxDb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIGJtTmFtZSA9IHNwZWNTdHJpbmdzLmFjdGl2aXRpZXMuY3JlYXRlVmFsdWVDb2xsZWN0ZWRCTU5hbWUodGhpcyk7XHJcbiAgICAgICAgaWYgKGV4ZWNDb250ZXh0LmlzQm9va21hcmtFeGlzdHMoYm1OYW1lKSkge1xyXG4gICAgICAgICAgICBzdGF0ZS5lbWl0U3RhdGUocmVzdWx0KTtcclxuICAgICAgICAgICAgZXhlY0NvbnRleHQucmVzdW1lQm9va21hcmtJblNjb3BlKGNhbGxDb250ZXh0LCBibU5hbWUsIHJlYXNvbiwgcmVzdWx0KTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIC8vIFdlJ3JlIG9uIHJvb3QsIGRvbmUuXHJcbiAgICAgICAgLy8gSWYgd2YgaW4gaWRsZSwgYnV0IHRoZXJlIGFyZSBpbnRlcm5hbCBib29rbWFyayByZXVtZSByZXF1ZXN0LFxyXG4gICAgICAgIC8vIHRoZW4gaW5zdGVhZCBvZiBlbWl0dGluZyBkb25lLCB3ZSBoYXZlIHRvIGNvbnRpbnVlIHRoZW0uXHJcbiAgICAgICAgaWYgKGluSWRsZSAmJiBleGVjQ29udGV4dC5wcm9jZXNzUmVzdW1lQm9va21hcmtRdWV1ZSgpKSB7XHJcbiAgICAgICAgICAgIC8vIFdlIHNob3VsZCBub3QgZW1taXQgaWRsZSBldmVudCwgYmVjYXVzZSB0aGVyZSB3YXMgaW50ZXJuYWwgYm9va21hcmsgY29udGludXRhdGlvbnMsIHNvIHdlJ3JlIGRvbmUuXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGUuZW1pdFN0YXRlKHJlc3VsdCk7XHJcbn1cclxuXHJcbkFjdGl2aXR5LnByb3RvdHlwZS5zY2hlZHVsZSA9IGZ1bmN0aW9uIChjYWxsQ29udGV4dCwgb2JqLCBlbmRDYWxsYmFjaykge1xyXG4gICAgLy8gVE9ETzogVmFsaWRhdGUgY2FsbGJhY2sgaW4gc2NvcGVcclxuXHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICB2YXIgc2NvcGUgPSBjYWxsQ29udGV4dC5zY29wZTtcclxuICAgIHZhciBleGVjQ29udGV4dCA9IGNhbGxDb250ZXh0LmV4ZWN1dGlvbkNvbnRleHQ7XHJcblxyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkob2JqKSAmJiBvYmoubGVuZ3RoKSB7XHJcbiAgICAgICAgc2NvcGUuc2V0KFwiX19jb2xsZWN0VmFsdWVzXCIsIFtdKTtcclxuICAgICAgICB2YXIgYWN0aXZpdGllcyA9IFtdO1xyXG4gICAgICAgIG9iai5mb3JFYWNoKFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAodikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHYgaW5zdGFuY2VvZiBBY3Rpdml0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmdldChcIl9fY29sbGVjdFZhbHVlc1wiKS5wdXNoKHNwZWNTdHJpbmdzLmFjdGl2aXRpZXMuYXNWYWx1ZVRvQ29sbGVjdCh2KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZpdGllcy5wdXNoKHYpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuZ2V0KFwiX19jb2xsZWN0VmFsdWVzXCIpLnB1c2godik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIGlmIChhY3Rpdml0aWVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBzY29wZS5zZXQoXCJfX2NvbGxlY3RQaWNrUm91bmQyXCIsIGZhbHNlKTtcclxuICAgICAgICAgICAgc2NvcGUuc2V0KFwiX19jb2xsZWN0RXJyb3JzXCIsIFtdKTtcclxuICAgICAgICAgICAgc2NvcGUuc2V0KFwiX19jb2xsZWN0Q2FuY2VsQ291bnRzXCIsIDApO1xyXG4gICAgICAgICAgICBzY29wZS5zZXQoXCJfX2NvbGxlY3RJZGxlQ291bnRzXCIsIDApO1xyXG4gICAgICAgICAgICBzY29wZS5zZXQoXCJfX2NvbGxlY3RSZW1haW5pbmdcIiwgYWN0aXZpdGllcy5sZW5ndGgpO1xyXG4gICAgICAgICAgICB2YXIgZW5kQk0gPSBzY29wZS5zZXQoXCJfX2NvbGxlY3RFbmRCb29rbWFya05hbWVcIiwgc3BlY1N0cmluZ3MuYWN0aXZpdGllcy5jcmVhdGVDb2xsZWN0aW5nQ29tcGxldGVkQk1OYW1lKHNlbGYpKTtcclxuICAgICAgICAgICAgZXhlY0NvbnRleHQuY3JlYXRlQm9va21hcmsoc2VsZi5pZCwgc2NvcGUuZ2V0KFwiX19jb2xsZWN0RW5kQm9va21hcmtOYW1lXCIpLCBlbmRDYWxsYmFjayk7XHJcbiAgICAgICAgICAgIHZhciBsZW4gPSBhY3Rpdml0aWVzLmxlbmd0aDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkQWN0aXZpdHkgPSBhY3Rpdml0aWVzW2ldO1xyXG4gICAgICAgICAgICAgICAgZXhlY0NvbnRleHQuY3JlYXRlQm9va21hcmsoc2VsZi5pZCwgc3BlY1N0cmluZ3MuYWN0aXZpdGllcy5jcmVhdGVWYWx1ZUNvbGxlY3RlZEJNTmFtZShjaGlsZEFjdGl2aXR5KSwgXCJyZXN1bHRDb2xsZWN0ZWRcIik7XHJcbiAgICAgICAgICAgICAgICBjaGlsZEFjdGl2aXR5LnN0YXJ0KGNhbGxDb250ZXh0KTtcclxuICAgICAgICAgICAgICAgIGlmICghZXhlY0NvbnRleHQuaXNCb29rbWFya0V4aXN0cyhlbmRCTSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBJZiBjdXJyZW50IGFjdGl2aXR5IGhhcyBiZWVuIGVuZGVkIChieSBQaWNrIGZvciBleClcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHNjb3BlLmdldChcIl9fY29sbGVjdFZhbHVlc1wiKTtcclxuICAgICAgICAgICAgc2NvcGUuZGVsZXRlKFwiX19jb2xsZWN0VmFsdWVzXCIpO1xyXG4gICAgICAgICAgICBzY29wZS5nZXQoZW5kQ2FsbGJhY2spLmNhbGwoc2NvcGUsIGNhbGxDb250ZXh0LCBBY3Rpdml0eS5zdGF0ZXMuY29tcGxldGUsIHJlc3VsdCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgQWN0aXZpdHkpIHtcclxuICAgICAgICBleGVjQ29udGV4dC5jcmVhdGVCb29rbWFyayhzZWxmLmlkLCBzcGVjU3RyaW5ncy5hY3Rpdml0aWVzLmNyZWF0ZVZhbHVlQ29sbGVjdGVkQk1OYW1lKG9iaiksIGVuZENhbGxiYWNrKTtcclxuICAgICAgICBvYmouc3RhcnQoY2FsbENvbnRleHQpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgc2NvcGUuZ2V0KGVuZENhbGxiYWNrKS5jYWxsKHNjb3BlLCBjYWxsQ29udGV4dCwgQWN0aXZpdHkuc3RhdGVzLmNvbXBsZXRlLCBvYmopO1xyXG4gICAgfVxyXG59XHJcblxyXG5BY3Rpdml0eS5wcm90b3R5cGUucmVzdWx0Q29sbGVjdGVkID0gZnVuY3Rpb24gKGNhbGxDb250ZXh0LCByZWFzb24sIHJlc3VsdCwgYm9va21hcmspIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICB2YXIgZXhlY0NvbnRleHQgPSBjYWxsQ29udGV4dC5leGVjdXRpb25Db250ZXh0O1xyXG4gICAgdmFyIGNoaWxkSWQgPSBzcGVjU3RyaW5ncy5nZXRTdHJpbmcoYm9va21hcmsubmFtZSk7XHJcbiAgICB2YXIgYXJnTWFya2VyID0gc3BlY1N0cmluZ3MuYWN0aXZpdGllcy5hc1ZhbHVlVG9Db2xsZWN0KGNoaWxkSWQpO1xyXG4gICAgdmFyIHJlc3VsdEluZGV4ID0gc2VsZi5nZXQoXCJfX2NvbGxlY3RWYWx1ZXNcIikuaW5kZXhPZihhcmdNYXJrZXIpO1xyXG4gICAgdmFyIHBpY2tDdXJyZW50ID0gZmFsc2U7XHJcbiAgICBpZiAocmVzdWx0SW5kZXggPT09IC0xKSB7XHJcbiAgICAgICAgc2VsZi5nZXQoXCJfX2NvbGxlY3RFcnJvcnNcIikucHVzaChuZXcgZXJyb3JzLkFjdGl2aXR5U3RhdGVFeGNlcHRpb25FcnJvcihcIkFjdGl2aXR5ICdcIiArIGNoaWxkSWQgKyBcIicgaXMgbm90IGZvdW5kIGluIF9fY29sbGVjdFZhbHVlcy5cIikpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgaWYgKHNlbGYuZ2V0KFwiX19jb2xsZWN0UGlja1wiKSAmJiAocmVhc29uICE9PSBBY3Rpdml0eS5zdGF0ZXMuaWRsZSB8fCBzZWxmLmdldChcIl9fY29sbGVjdFBpY2tSb3VuZDJcIikpKSB7XHJcbiAgICAgICAgICAgIC8vIFdlIHNob3VsZCBwaWNrIGN1cnJlbnQgcmVzdWx0LCBhbmQgc2h1dCBkb3duIG90aGVyczpcclxuICAgICAgICAgICAgdmFyIGlkcyA9IFtdO1xyXG4gICAgICAgICAgICBmYXN0LmZvckVhY2goc2VsZi5nZXQoXCJfX2NvbGxlY3RWYWx1ZXNcIiksXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoY3YpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWQgPSBzcGVjU3RyaW5ncy5nZXRTdHJpbmcoY3YpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpZCAmJiBpZCAhPSBjaGlsZElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkcy5wdXNoKGlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXhlY0NvbnRleHQuZGVsZXRlU2NvcGVPZkFjdGl2aXR5KGNhbGxDb250ZXh0LCBpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpYm1OYW1lID0gc3BlY1N0cmluZ3MuYWN0aXZpdGllcy5jcmVhdGVWYWx1ZUNvbGxlY3RlZEJNTmFtZShpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4ZWNDb250ZXh0LmRlbGV0ZUJvb2ttYXJrKGlibU5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBleGVjQ29udGV4dC5jYW5jZWxFeGVjdXRpb24oaWRzKTtcclxuICAgICAgICAgICAgcGlja0N1cnJlbnQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgc3dpdGNoIChyZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgQWN0aXZpdHkuc3RhdGVzLmNvbXBsZXRlOlxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZ2V0KFwiX19jb2xsZWN0VmFsdWVzXCIpW3Jlc3VsdEluZGV4XSA9IHJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgQWN0aXZpdHkuc3RhdGVzLmNhbmNlbDpcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmluYyhcIl9fY29sbGVjdENhbmNlbENvdW50c1wiKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmdldChcIl9fY29sbGVjdFZhbHVlc1wiKVtyZXN1bHRJbmRleF0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBBY3Rpdml0eS5zdGF0ZXMuaWRsZTpcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmluYyhcIl9fY29sbGVjdElkbGVDb3VudHNcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEFjdGl2aXR5LnN0YXRlcy5mYWlsOlxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdCB8fCBuZXcgZXJyb3JzLkFjdGl2aXR5U3RhdGVFeGNlcHRpb25FcnJvcihcIlVua25vd24gZXJyb3IuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZ2V0KFwiX19jb2xsZWN0RXJyb3JzXCIpLnB1c2gocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmdldChcIl9fY29sbGVjdFZhbHVlc1wiKVtyZXN1bHRJbmRleF0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmdldChcIl9fY29sbGVjdEVycm9yc1wiKS5wdXNoKG5ldyBlcnJvcnMuQWN0aXZpdHlTdGF0ZUV4Y2VwdGlvbkVycm9yKFwiQm9va21hcmsgc2hvdWxkIG5vdCBiZSBjb250aW51ZWQgd2l0aCByZWFzb24gJ1wiICsgcmVhc29uICsgXCInLlwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5nZXQoXCJfX2NvbGxlY3RWYWx1ZXNcIilbcmVzdWx0SW5kZXhdID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChzZWxmLmRlYyhcIl9fY29sbGVjdFJlbWFpbmluZ1wiKSA9PT0gMCB8fCBwaWNrQ3VycmVudCkge1xyXG4gICAgICAgIHZhciBlbmRCb29rbWFya05hbWUgPSBzZWxmLmdldChcIl9fY29sbGVjdEVuZEJvb2ttYXJrTmFtZVwiKTtcclxuXHJcbiAgICAgICAgaWYgKCFwaWNrQ3VycmVudCkge1xyXG4gICAgICAgICAgICB2YXIgcmVhc29uO1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gbnVsbDtcclxuICAgICAgICAgICAgaWYgKHNlbGYuZ2V0KFwiX19jb2xsZWN0RXJyb3JzXCIpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgcmVhc29uID0gQWN0aXZpdHkuc3RhdGVzLmZhaWw7XHJcbiAgICAgICAgICAgICAgICB2YXIgX19jb2xsZWN0RXJyb3JzID0gc2VsZi5nZXQoXCJfX2NvbGxlY3RFcnJvcnNcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoX19jb2xsZWN0RXJyb3JzLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9fY29sbGVjdEVycm9yc1swXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBlcnJvcnMuQWdncmVnYXRlRXJyb3IoX19jb2xsZWN0RXJyb3JzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChzZWxmLmdldChcIl9fY29sbGVjdENhbmNlbENvdW50c1wiKSkge1xyXG4gICAgICAgICAgICAgICAgcmVhc29uID0gQWN0aXZpdHkuc3RhdGVzLmNhbmNlbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChzZWxmLmdldChcIl9fY29sbGVjdElkbGVDb3VudHNcIikpIHtcclxuICAgICAgICAgICAgICAgIHJlYXNvbiA9IEFjdGl2aXR5LnN0YXRlcy5pZGxlO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5zZXQoXCJfX2NvbGxlY3RSZW1haW5pbmdcIiwgMSk7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmRlYyhcIl9fY29sbGVjdElkbGVDb3VudHNcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5nZXQoXCJfX2NvbGxlY3RQaWNrXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gV2UncmUgaW4gcGljayBtb2RlLCBhbmQgYWxsIHJlc3VsdCB3YXMgaWRsZVxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0KFwiX19jb2xsZWN0UGlja1JvdW5kMlwiLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJlYXNvbiA9IEFjdGl2aXR5LnN0YXRlcy5jb21wbGV0ZTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHNlbGYuZ2V0KFwiX19jb2xsZWN0VmFsdWVzXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXNlbGYuZ2V0KFwiX19jb2xsZWN0UmVtYWluaW5nXCIpKSB7XHJcbiAgICAgICAgICAgIHNlbGYuZGVsZXRlKFwiX19jb2xsZWN0VmFsdWVzXCIpO1xyXG4gICAgICAgICAgICBzZWxmLmRlbGV0ZShcIl9fY29sbGVjdFJlbWFpbmluZ1wiKTtcclxuICAgICAgICAgICAgc2VsZi5kZWxldGUoXCJfX2NvbGxlY3RJZGxlQ291bnRzXCIpO1xyXG4gICAgICAgICAgICBzZWxmLmRlbGV0ZShcIl9fY29sbGVjdEVuZEJvb2ttYXJrTmFtZVwiKTtcclxuICAgICAgICAgICAgc2VsZi5kZWxldGUoXCJfX2NvbGxlY3RDYW5jZWxDb3VudHNcIik7XHJcbiAgICAgICAgICAgIHNlbGYuZGVsZXRlKFwiX19jb2xsZWN0RXJyb3JzXCIpO1xyXG4gICAgICAgICAgICBzZWxmLmRlbGV0ZShcIl9fY29sbGVjdFBpY2tcIik7XHJcbiAgICAgICAgICAgIHNlbGYuZGVsZXRlKFwiX19jb2xsZWN0UGlja1JvdW5kMlwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGV4ZWNDb250ZXh0LnJlc3VtZUJvb2ttYXJrSW5TY29wZShjYWxsQ29udGV4dCwgZW5kQm9va21hcmtOYW1lLCByZWFzb24sIHJlc3VsdCk7XHJcbiAgICB9XHJcbn1cclxuLyogUlVOICovXHJcblxyXG4vKiBTQ09QRSAqL1xyXG5BY3Rpdml0eS5wcm90b3R5cGUuX2dldFNjb3BlS2V5cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIGlmICghc2VsZi5fc2NvcGVLZXlzKSB7XHJcbiAgICAgICAgc2VsZi5fc2NvcGVLZXlzID0gW107XHJcbiAgICAgICAgZmFzdC5mb3JFYWNoKHNlbGYuZ2V0S2V5cygpLCBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgICAgIGlmIChzZWxmLm5vblNjb3BlZFByb3BlcnRpZXMuZXhpc3RzKGtleSkpIHJldHVybjtcclxuICAgICAgICAgICAgaWYgKEFjdGl2aXR5LnByb3RvdHlwZVtrZXldKSByZXR1cm47XHJcbiAgICAgICAgICAgIHNlbGYuX3Njb3BlS2V5cy5wdXNoKGtleSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc2VsZi5fc2NvcGVLZXlzO1xyXG59XHJcblxyXG5BY3Rpdml0eS5wcm90b3R5cGUuY3JlYXRlU2NvcGVQYXJ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgIGlmICh0aGlzLl9jcmVhdGVTY29wZVBhcnRJbXBsID09PSBudWxsKSB7XHJcbiAgICAgICAgdmFyIGZpcnN0ID0gdHJ1ZTtcclxuICAgICAgICB2YXIgc3JjID0gXCJyZXR1cm4ge1wiO1xyXG4gICAgICAgIGZhc3QuZm9yRWFjaChzZWxmLl9nZXRTY29wZUtleXMoKSwgZnVuY3Rpb24gKGZpZWxkTmFtZSkge1xyXG4gICAgICAgICAgICBpZiAoZmlyc3QpIHtcclxuICAgICAgICAgICAgICAgIGZpcnN0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzcmMgKz0gXCIsXFxuXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKF8uaXNQbGFpbk9iamVjdChzZWxmW2ZpZWxkTmFtZV0pKSB7XHJcbiAgICAgICAgICAgICAgICBzcmMgKz0gZmllbGROYW1lICsgXCI6Xy5jbG9uZShhLlwiICsgZmllbGROYW1lICsgXCIsIHRydWUpXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzcmMgKz0gZmllbGROYW1lICsgXCI6YS5cIiArIGZpZWxkTmFtZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHNyYyArPSBcIn1cIjtcclxuXHJcbiAgICAgICAgdGhpcy5fY3JlYXRlU2NvcGVQYXJ0SW1wbCA9IG5ldyBGdW5jdGlvbihcImEsX1wiLCBzcmMpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLl9jcmVhdGVTY29wZVBhcnRJbXBsKHRoaXMsIF8pO1xyXG59XHJcbi8qIFNDT1BFICovXHJcblxyXG5BY3Rpdml0eS5zdGF0ZXMgPSBlbnVtcy5BY3Rpdml0eVN0YXRlcztcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gQWN0aXZpdHk7XHJcbiJdfQ==
