{"version":3,"sources":["activities/try.js"],"names":[],"mappings":"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","file":"activities/try.js","sourcesContent":["\"use strict\";\n\nlet Activity = require(\"./activity\");\nlet util = require(\"util\");\nlet errors = require(\"../common/errors\");\nlet _ = require(\"lodash\");\nlet Block = require(\"./block\");\n\nfunction Try() {\n    Activity.call(this);\n\n    this.arrayProperties.add(\"catch\");\n    this.arrayProperties.add(\"finally\");\n    this.nonScopedProperties.add(\"continueAfterFinally\");\n\n    this.varName = \"e\";\n    this._body = null;\n    this.catch = null;\n    this.finally = null;\n}\n\nutil.inherits(Try, Activity);\n\nTry.prototype.initializeStructure = function() {\n    this._body = new Block();\n    this._body.args = this.args;\n    this.args = null;\n    if (this.catch) {\n        let prev = this.catch;\n        this.catch = new Block();\n        this.catch.args = prev;\n    }\n    if (this.finally) {\n        let prev = this.finally;\n        this.finally = new Block();\n        this.finally.args = prev;\n    }\n};\n\nTry.prototype.run = function (callContext, args) {\n    callContext.schedule(this._body, \"_bodyFinished\");\n};\n\nTry.prototype._bodyFinished = function(callContext, reason, result) {\n    if (this.catch || this.finally) {\n        this._originalResult = result;\n        this._originalReason = reason;\n        if (reason === Activity.states.fail && !(result instanceof errors.ActivityRuntimeError) && this.catch) {\n            this[this.varName] = result;\n            this.Try_ReThrow = false;\n            callContext.schedule(this.catch, \"_catchDone\");\n            return;\n        }\n        else if ((reason === Activity.states.fail || reason === Activity.states.complete) && this.finally) {\n            callContext.schedule(this.finally, \"_finallyDone\");\n            return;\n        }\n    }\n    callContext.end(reason, result);\n};\n\nTry.prototype._catchDone = function(callContext, reason, result) {\n    if (reason !== Activity.states.complete) {\n        callContext.end(reason, result);\n        return;\n    }\n\n    this._catchResult = result;\n    if (this.finally) {\n        callContext.schedule(this.finally, \"_finallyDone\");\n    }\n    else {\n        callContext.activity.continueAfterFinally.call(this, callContext);\n    }\n};\n\nTry.prototype._finallyDone = function(callContext, reason, result) {\n    if (reason !== Activity.states.complete) {\n        callContext.end(reason, result);\n        return;\n    }\n\n    callContext.activity.continueAfterFinally.call(this, callContext);\n};\n\nTry.prototype.continueAfterFinally = function(callContext) {\n    let reason = this._originalReason;\n    let result = this._originalResult;\n    if (reason === Activity.states.fail && !_.isUndefined(this.Try_ReThrow)) {\n        // We've came from a catch:\n        if (this.Try_ReThrow === true) {\n            callContext.fail(result);\n        }\n        else if (this.Try_ReThrow instanceof Error) {\n            callContext.fail(this.Try_ReThrow);\n        }\n        else {\n            callContext.complete(this._catchResult);\n        }\n    }\n    else {\n        callContext.end(reason, result);\n    }\n};\n\nmodule.exports = Try;"],"sourceRoot":"/source/"}