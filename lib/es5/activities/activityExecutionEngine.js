"use strict";
var Activity = require("./activity");
var ActivityExecutionContext = require("./activityExecutionContext");
var ActivityExecutionState = require("./activityExecutionState");
var CallContext = require("./callContext");
var EventEmitter = require('events').EventEmitter;
var util = require("util");
var errors = require("../common/errors");
var _ = require("lodash");
var ActivityStateTracker = require("./activityStateTracker");
var enums = require("../common/enums");
var Bluebird = require("bluebird");
var asyncHelpers = require("../common/asyncHelpers");
var async = asyncHelpers.async;
var activityMarkup = require("./activityMarkup");
function ActivityExecutionEngine(rootActivity) {
  EventEmitter.call(this);
  if (!(rootActivity instanceof Activity)) {
    if (_.isPlainObject(rootActivity)) {
      rootActivity = activityMarkup.parse(rootActivity);
    } else {
      throw new TypeError("Argument 'rootActivity' is not an activity or a markup.");
    }
  }
  this._rootActivity = rootActivity;
  this._context = new ActivityExecutionContext();
  this._isInitialized = false;
  this._rootState = null;
  this._trackers = [];
  this._hookContext();
  this._timestamp = null;
}
util.inherits(ActivityExecutionEngine, EventEmitter);
Object.defineProperties(ActivityExecutionEngine.prototype, {
  rootActivity: {get: function() {
      return this._rootActivity;
    }},
  execState: {get: function() {
      if (this._rootState) {
        return this._rootState.execState;
      } else {
        return null;
      }
    }},
  version: {get: function() {
      return this._rootActivity.version;
    }},
  updatedOn: {get: function() {
      return this._timestamp;
    }}
});
ActivityExecutionEngine.prototype._idle = {toString: function() {
    return enums.ActivityStates.idle;
  }};
ActivityExecutionEngine.prototype.isIdle = function(result) {
  return result === this._idle;
};
ActivityExecutionEngine.prototype._initialize = function() {
  if (!this._isInitialized) {
    this._context.initialize(this._rootActivity);
    this._isInitialized = true;
  }
};
ActivityExecutionEngine.prototype._setRootState = function(state) {
  var self = this;
  if (!self._rootState) {
    self._rootState = state;
    self._rootState.on(Activity.states.cancel, function(args) {
      self.emit(Activity.states.cancel, args);
    });
    self._rootState.on(Activity.states.complete, function(args) {
      self.emit(Activity.states.complete, args);
    });
    self._rootState.on(Activity.states.end, function(args) {
      self._timestamp = new Date();
      self.emit(Activity.states.end, args);
    });
    self._rootState.on(Activity.states.fail, function(args) {
      self.emit(Activity.states.fail, args);
    });
    self._rootState.on(Activity.states.run, function(args) {
      self.emit(Activity.states.run, args);
    });
    self._rootState.on(Activity.states.idle, function(args) {
      self.emit(Activity.states.idle, args);
    });
  }
};
ActivityExecutionEngine.prototype._hookContext = function() {
  var self = this;
  self._context.on(Activity.states.run, function(args) {
    var $__5 = true;
    var $__6 = false;
    var $__7 = undefined;
    try {
      for (var $__3 = void 0,
          $__2 = (self._trackers)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
        var t = $__3.value;
        {
          t.activityStateChanged(args);
        }
      }
    } catch ($__8) {
      $__6 = true;
      $__7 = $__8;
    } finally {
      try {
        if (!$__5 && $__2.return != null) {
          $__2.return();
        }
      } finally {
        if ($__6) {
          throw $__7;
        }
      }
    }
  });
  self._context.on(Activity.states.end, function(args) {
    var $__5 = true;
    var $__6 = false;
    var $__7 = undefined;
    try {
      for (var $__3 = void 0,
          $__2 = (self._trackers)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
        var t = $__3.value;
        {
          t.activityStateChanged(args);
        }
      }
    } catch ($__8) {
      $__6 = true;
      $__7 = $__8;
    } finally {
      try {
        if (!$__5 && $__2.return != null) {
          $__2.return();
        }
      } finally {
        if ($__6) {
          throw $__7;
        }
      }
    }
  });
};
ActivityExecutionEngine.prototype.addTracker = function(tracker) {
  if (!_.isObject(tracker)) {
    throw new TypeError("Parameter is not an object.");
  }
  this._trackers.push(new ActivityStateTracker(tracker));
};
ActivityExecutionEngine.prototype.removeTracker = function(tracker) {
  var idx = -1;
  for (var i = 0; i < this._trackers.length; i++) {
    var t = this._trackers[i];
    if (t._impl === tracker) {
      idx = i;
      break;
    }
  }
  if (idx !== -1) {
    this._trackers.splice(idx, 1);
  }
};
ActivityExecutionEngine.prototype.start = async($traceurRuntime.initGeneratorFunction(function $__9() {
  var args,
      $__5,
      $__6,
      $__7,
      $__3,
      $__2,
      a,
      $__10,
      $__11,
      $__12,
      $__13,
      $__14,
      $__15,
      $__16,
      $__17;
  var $arguments = arguments;
  return $traceurRuntime.createGeneratorInstance(function($ctx) {
    while (true)
      switch ($ctx.state) {
        case 0:
          this._verifyNotStarted();
          this._initialize();
          args = [new CallContext(this._context)];
          $__5 = true;
          $__6 = false;
          $__7 = undefined;
          try {
            for ($__3 = void 0, $__2 = ($arguments)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
              a = $__3.value;
              {
                args.push(a);
              }
            }
          } catch ($__8) {
            $__6 = true;
            $__7 = $__8;
          } finally {
            try {
              if (!$__5 && $__2.return != null) {
                $__2.return();
              }
            } finally {
              if ($__6) {
                throw $__7;
              }
            }
          }
          $ctx.state = 10;
          break;
        case 10:
          $__10 = this._setRootState;
          $__11 = this._rootActivity;
          $__12 = $__11.start;
          $__13 = $__12.apply;
          $__14 = this._rootActivity;
          $__15 = $__13.call($__12, $__14, args);
          $ctx.state = 6;
          break;
        case 6:
          $ctx.state = 2;
          return $__15;
        case 2:
          $__16 = $ctx.sent;
          $ctx.state = 4;
          break;
        case 4:
          $__17 = $__10.call(this, $__16);
          $ctx.state = -2;
          break;
        default:
          return $ctx.end();
      }
  }, $__9, this);
}));
ActivityExecutionEngine.prototype.invoke = function() {
  var self = this;
  self._verifyNotStarted();
  self._initialize();
  var argRemoveToken = null;
  var args = [];
  var $__5 = true;
  var $__6 = false;
  var $__7 = undefined;
  try {
    for (var $__3 = void 0,
        $__2 = (arguments)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
      var a = $__3.value;
      {
        args.push(a);
      }
    }
  } catch ($__8) {
    $__6 = true;
    $__7 = $__8;
  } finally {
    try {
      if (!$__5 && $__2.return != null) {
        $__2.return();
      }
    } finally {
      if ($__6) {
        throw $__7;
      }
    }
  }
  if (args.length) {
    argRemoveToken = self._context.appendToContext(args);
  }
  args.unshift(new CallContext(self._context));
  return new Bluebird(function(resolve, reject) {
    try {
      self._setRootState(self._context.getExecutionState(self._rootActivity));
      self.once(Activity.states.end, function(eArgs) {
        var reason = eArgs.reason;
        var result = eArgs.result;
        try {
          switch (reason) {
            case Activity.states.complete:
              resolve(result);
              break;
            case Activity.states.cancel:
              reject(new errors.Cancelled());
              break;
            case Activity.states.idle:
              resolve(self._idle);
              break;
            default:
              result = result || new errors.ActivityRuntimeError("Unknown error.");
              reject(result);
              break;
          }
        } finally {
          if (argRemoveToken) {
            self._context.removeFromContext(argRemoveToken);
            argRemoveToken = null;
          }
        }
      });
      self._rootActivity.start.apply(self._rootActivity, args);
    } catch (e) {
      reject(e);
      if (argRemoveToken) {
        self._context.removeFromContext(argRemoveToken);
        argRemoveToken = null;
      }
    }
  });
};
ActivityExecutionEngine.prototype._verifyNotStarted = function() {
  if (!(!this.execState || this.execState === enums.ActivityStates.complete)) {
    throw new errors.ActivityStateExceptionError("Workflow has been already started.");
  }
};
ActivityExecutionEngine.prototype.resumeBookmark = function(name, reason, result) {
  var self = this;
  self._initialize();
  return new Bluebird(function(resolve, reject) {
    try {
      self._setRootState(self._context.getExecutionState(self._rootActivity));
      if (self.execState === enums.ActivityStates.idle) {
        var bmTimestamp = self._context.getBookmarkTimestamp(name);
        self.once(Activity.states.end, function(args) {
          var _reason = args.reason;
          var _result = args.result;
          try {
            if (_reason === enums.ActivityStates.complete || _reason === enums.ActivityStates.idle) {
              var endBmTimestamp = self._context.getBookmarkTimestamp(name);
              if (endBmTimestamp && endBmTimestamp === bmTimestamp) {
                if (_reason === enums.ActivityStates.complete) {
                  reject(new errors.ActivityRuntimeError("Workflow has been completed before bookmark '" + name + "' reached."));
                } else {
                  reject(new errors.Idle("Workflow has been gone to idle before bookmark '" + name + "' reached."));
                }
              } else {
                resolve();
              }
            } else if (_reason === enums.ActivityStates.cancel) {
              reject(new errors.ActivityRuntimeError("Workflow has been cancelled before bookmark '" + name + "' reached."));
            } else if (_reason === enums.ActivityStates.fail) {
              reject(_result);
            }
          } catch (e) {
            reject(e);
          }
        });
        self._context.resumeBookmarkExternal(name, reason, result);
      } else {
        reject(new errors.ActivityRuntimeError("Cannot resume bookmark, while the workflow is not in the idle state."));
      }
    } catch (e) {
      reject(e);
    }
  });
};
ActivityExecutionEngine.prototype.getStateAndPromotions = function(serializer, enablePromotions) {
  if (serializer && !_.isObject(serializer)) {
    throw new Error("Argument 'serializer' is not an object.");
  }
  this._initialize();
  return this._context.getStateAndPromotions(serializer, enablePromotions);
};
ActivityExecutionEngine.prototype.setState = function(serializer, json) {
  if (serializer && !_.isObject(serializer)) {
    throw new Error("Argument 'serializer' is not an object.");
  }
  if (!_.isObject(json)) {
    throw new TypeError("Argument 'json' is not an object.");
  }
  this._initialize();
  this._timestamp = new Date();
  this._context.setState(serializer, json);
};
module.exports = ActivityExecutionEngine;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjdGl2aXR5RXhlY3V0aW9uRW5naW5lLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBRUEsQUFBSSxFQUFBLENBQUEsUUFBTyxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsWUFBVyxDQUFDLENBQUM7QUFDcEMsQUFBSSxFQUFBLENBQUEsd0JBQXVCLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyw0QkFBMkIsQ0FBQyxDQUFDO0FBQ3BFLEFBQUksRUFBQSxDQUFBLHNCQUFxQixFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsMEJBQXlCLENBQUMsQ0FBQztBQUNoRSxBQUFJLEVBQUEsQ0FBQSxXQUFVLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxlQUFjLENBQUMsQ0FBQztBQUMxQyxBQUFJLEVBQUEsQ0FBQSxZQUFXLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxRQUFPLENBQUMsYUFBYSxDQUFDO0FBQ2pELEFBQUksRUFBQSxDQUFBLElBQUcsRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLE1BQUssQ0FBQyxDQUFDO0FBQzFCLEFBQUksRUFBQSxDQUFBLE1BQUssRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLGtCQUFpQixDQUFDLENBQUM7QUFDeEMsQUFBSSxFQUFBLENBQUEsQ0FBQSxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsUUFBTyxDQUFDLENBQUM7QUFDekIsQUFBSSxFQUFBLENBQUEsb0JBQW1CLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyx3QkFBdUIsQ0FBQyxDQUFDO0FBQzVELEFBQUksRUFBQSxDQUFBLEtBQUksRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLGlCQUFnQixDQUFDLENBQUM7QUFDdEMsQUFBSSxFQUFBLENBQUEsUUFBTyxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsVUFBUyxDQUFDLENBQUM7QUFDbEMsQUFBSSxFQUFBLENBQUEsWUFBVyxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsd0JBQXVCLENBQUMsQ0FBQztBQUNw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SUFBSSxLQUFHLEFBQUMsRUFBQyxDQUFDO0FBQzVCLEtBQUcsU0FBUyxTQUFTLEFBQUMsQ0FBQyxVQUFTLENBQUcsS0FBRyxDQUFDLENBQUM7QUFDNUMsQ0FBQztBQUdELEtBQUssUUFBUSxFQUFJLHdCQUFzQixDQUFDO0FBQUEiLCJmaWxlIjoiYWN0aXZpdGllcy9hY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZS5qcyIsInNvdXJjZVJvb3QiOiJsaWIvZXM2Iiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmxldCBBY3Rpdml0eSA9IHJlcXVpcmUoXCIuL2FjdGl2aXR5XCIpO1xubGV0IEFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dCA9IHJlcXVpcmUoXCIuL2FjdGl2aXR5RXhlY3V0aW9uQ29udGV4dFwiKTtcbmxldCBBY3Rpdml0eUV4ZWN1dGlvblN0YXRlID0gcmVxdWlyZShcIi4vYWN0aXZpdHlFeGVjdXRpb25TdGF0ZVwiKTtcbmxldCBDYWxsQ29udGV4dCA9IHJlcXVpcmUoXCIuL2NhbGxDb250ZXh0XCIpO1xubGV0IEV2ZW50RW1pdHRlciA9IHJlcXVpcmUoJ2V2ZW50cycpLkV2ZW50RW1pdHRlcjtcbmxldCB1dGlsID0gcmVxdWlyZShcInV0aWxcIik7XG5sZXQgZXJyb3JzID0gcmVxdWlyZShcIi4uL2NvbW1vbi9lcnJvcnNcIik7XG5sZXQgXyA9IHJlcXVpcmUoXCJsb2Rhc2hcIik7XG5sZXQgQWN0aXZpdHlTdGF0ZVRyYWNrZXIgPSByZXF1aXJlKFwiLi9hY3Rpdml0eVN0YXRlVHJhY2tlclwiKTtcbmxldCBlbnVtcyA9IHJlcXVpcmUoXCIuLi9jb21tb24vZW51bXNcIik7XG5sZXQgQmx1ZWJpcmQgPSByZXF1aXJlKFwiYmx1ZWJpcmRcIik7XG5sZXQgYXN5bmNIZWxwZXJzID0gcmVxdWlyZShcIi4uL2NvbW1vbi9hc3luY0hlbHBlcnNcIik7XG5sZXQgYXN5bmMgPSBhc3luY0hlbHBlcnMuYXN5bmM7XG5sZXQgYWN0aXZpdHlNYXJrdXAgPSByZXF1aXJlKFwiLi9hY3Rpdml0eU1hcmt1cFwiKTtcblxuZnVuY3Rpb24gQWN0aXZpdHlFeGVjdXRpb25FbmdpbmUocm9vdEFjdGl2aXR5KSB7XG4gICAgRXZlbnRFbWl0dGVyLmNhbGwodGhpcyk7XG5cbiAgICBpZiAoIShyb290QWN0aXZpdHkgaW5zdGFuY2VvZiBBY3Rpdml0eSkpIHtcbiAgICAgICAgaWYgKF8uaXNQbGFpbk9iamVjdChyb290QWN0aXZpdHkpKSB7XG4gICAgICAgICAgICByb290QWN0aXZpdHkgPSBhY3Rpdml0eU1hcmt1cC5wYXJzZShyb290QWN0aXZpdHkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFyZ3VtZW50ICdyb290QWN0aXZpdHknIGlzIG5vdCBhbiBhY3Rpdml0eSBvciBhIG1hcmt1cC5cIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5fcm9vdEFjdGl2aXR5ID0gcm9vdEFjdGl2aXR5O1xuICAgIHRoaXMuX2NvbnRleHQgPSBuZXcgQWN0aXZpdHlFeGVjdXRpb25Db250ZXh0KCk7XG4gICAgdGhpcy5faXNJbml0aWFsaXplZCA9IGZhbHNlO1xuICAgIHRoaXMuX3Jvb3RTdGF0ZSA9IG51bGw7XG4gICAgdGhpcy5fdHJhY2tlcnMgPSBbXTtcbiAgICB0aGlzLl9ob29rQ29udGV4dCgpO1xuICAgIHRoaXMuX3RpbWVzdGFtcCA9IG51bGw7XG59XG5cbnV0aWwuaW5oZXJpdHMoQWN0aXZpdHlFeGVjdXRpb25FbmdpbmUsIEV2ZW50RW1pdHRlcik7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKEFjdGl2aXR5RXhlY3V0aW9uRW5naW5lLnByb3RvdHlwZSwge1xuICAgIHJvb3RBY3Rpdml0eToge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yb290QWN0aXZpdHk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGV4ZWNTdGF0ZToge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9yb290U3RhdGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcm9vdFN0YXRlLmV4ZWNTdGF0ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcbiAgICB2ZXJzaW9uOiB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Jvb3RBY3Rpdml0eS52ZXJzaW9uO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB1cGRhdGVkT246IHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdGltZXN0YW1wO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cbkFjdGl2aXR5RXhlY3V0aW9uRW5naW5lLnByb3RvdHlwZS5faWRsZSA9IHtcbiAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZW51bXMuQWN0aXZpdHlTdGF0ZXMuaWRsZTtcbiAgICB9XG59O1xuXG5BY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZS5wcm90b3R5cGUuaXNJZGxlID0gZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgIHJldHVybiByZXN1bHQgPT09IHRoaXMuX2lkbGU7XG59O1xuXG5BY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZS5wcm90b3R5cGUuX2luaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCF0aGlzLl9pc0luaXRpYWxpemVkKSB7XG4gICAgICAgIHRoaXMuX2NvbnRleHQuaW5pdGlhbGl6ZSh0aGlzLl9yb290QWN0aXZpdHkpO1xuICAgICAgICB0aGlzLl9pc0luaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB9XG59O1xuXG5BY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZS5wcm90b3R5cGUuX3NldFJvb3RTdGF0ZSA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgIGxldCBzZWxmID0gdGhpcztcbiAgICBpZiAoIXNlbGYuX3Jvb3RTdGF0ZSkge1xuICAgICAgICBzZWxmLl9yb290U3RhdGUgPSBzdGF0ZTtcbiAgICAgICAgc2VsZi5fcm9vdFN0YXRlLm9uKFxuICAgICAgICAgICAgQWN0aXZpdHkuc3RhdGVzLmNhbmNlbCwgZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmVtaXQoQWN0aXZpdHkuc3RhdGVzLmNhbmNlbCwgYXJncyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgc2VsZi5fcm9vdFN0YXRlLm9uKFxuICAgICAgICAgICAgQWN0aXZpdHkuc3RhdGVzLmNvbXBsZXRlLCBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICAgICAgICAgIHNlbGYuZW1pdChBY3Rpdml0eS5zdGF0ZXMuY29tcGxldGUsIGFyZ3MpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIHNlbGYuX3Jvb3RTdGF0ZS5vbihcbiAgICAgICAgICAgIEFjdGl2aXR5LnN0YXRlcy5lbmQsIGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5fdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgICAgICBzZWxmLmVtaXQoQWN0aXZpdHkuc3RhdGVzLmVuZCwgYXJncyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgc2VsZi5fcm9vdFN0YXRlLm9uKFxuICAgICAgICAgICAgQWN0aXZpdHkuc3RhdGVzLmZhaWwsIGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5lbWl0KEFjdGl2aXR5LnN0YXRlcy5mYWlsLCBhcmdzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICBzZWxmLl9yb290U3RhdGUub24oXG4gICAgICAgICAgICBBY3Rpdml0eS5zdGF0ZXMucnVuLCBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICAgICAgICAgIHNlbGYuZW1pdChBY3Rpdml0eS5zdGF0ZXMucnVuLCBhcmdzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICBzZWxmLl9yb290U3RhdGUub24oXG4gICAgICAgICAgICBBY3Rpdml0eS5zdGF0ZXMuaWRsZSwgZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmVtaXQoQWN0aXZpdHkuc3RhdGVzLmlkbGUsIGFyZ3MpO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxufTtcblxuQWN0aXZpdHlFeGVjdXRpb25FbmdpbmUucHJvdG90eXBlLl9ob29rQ29udGV4dCA9IGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgc2VsZi5fY29udGV4dC5vbihcbiAgICAgICAgQWN0aXZpdHkuc3RhdGVzLnJ1biwgZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgICAgIGZvciAobGV0IHQgb2Ygc2VsZi5fdHJhY2tlcnMpIHtcbiAgICAgICAgICAgICAgICB0LmFjdGl2aXR5U3RhdGVDaGFuZ2VkKGFyZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICBzZWxmLl9jb250ZXh0Lm9uKFxuICAgICAgICBBY3Rpdml0eS5zdGF0ZXMuZW5kLCBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICAgICAgZm9yIChsZXQgdCBvZiBzZWxmLl90cmFja2Vycykge1xuICAgICAgICAgICAgICAgIHQuYWN0aXZpdHlTdGF0ZUNoYW5nZWQoYXJncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xufTtcblxuQWN0aXZpdHlFeGVjdXRpb25FbmdpbmUucHJvdG90eXBlLmFkZFRyYWNrZXIgPSBmdW5jdGlvbiAodHJhY2tlcikge1xuICAgIGlmICghXy5pc09iamVjdCh0cmFja2VyKSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUGFyYW1ldGVyIGlzIG5vdCBhbiBvYmplY3QuXCIpO1xuICAgIH1cbiAgICB0aGlzLl90cmFja2Vycy5wdXNoKG5ldyBBY3Rpdml0eVN0YXRlVHJhY2tlcih0cmFja2VyKSk7XG59O1xuXG5BY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZS5wcm90b3R5cGUucmVtb3ZlVHJhY2tlciA9IGZ1bmN0aW9uICh0cmFja2VyKSB7XG4gICAgbGV0IGlkeCA9IC0xO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fdHJhY2tlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbGV0IHQgPSB0aGlzLl90cmFja2Vyc1tpXTtcbiAgICAgICAgaWYgKHQuX2ltcGwgPT09IHRyYWNrZXIpIHtcbiAgICAgICAgICAgIGlkeCA9IGk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoaWR4ICE9PSAtMSkge1xuICAgICAgICB0aGlzLl90cmFja2Vycy5zcGxpY2UoaWR4LCAxKTtcbiAgICB9XG59O1xuXG5BY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZS5wcm90b3R5cGUuc3RhcnQgPSBhc3luYyhmdW5jdGlvbiogKCkge1xuICAgIHRoaXMuX3ZlcmlmeU5vdFN0YXJ0ZWQoKTtcblxuICAgIHRoaXMuX2luaXRpYWxpemUoKTtcblxuICAgIGxldCBhcmdzID0gW25ldyBDYWxsQ29udGV4dCh0aGlzLl9jb250ZXh0KV07XG4gICAgZm9yIChsZXQgYSBvZiBhcmd1bWVudHMpIHtcbiAgICAgICAgYXJncy5wdXNoKGEpO1xuICAgIH1cblxuICAgIHRoaXMuX3NldFJvb3RTdGF0ZSh5aWVsZCB0aGlzLl9yb290QWN0aXZpdHkuc3RhcnQuYXBwbHkodGhpcy5fcm9vdEFjdGl2aXR5LCBhcmdzKSk7XG59KTtcblxuQWN0aXZpdHlFeGVjdXRpb25FbmdpbmUucHJvdG90eXBlLmludm9rZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgc2VsZiA9IHRoaXM7XG5cbiAgICBzZWxmLl92ZXJpZnlOb3RTdGFydGVkKCk7XG5cbiAgICBzZWxmLl9pbml0aWFsaXplKCk7XG5cbiAgICBsZXQgYXJnUmVtb3ZlVG9rZW4gPSBudWxsO1xuICAgIGxldCBhcmdzID0gW107XG4gICAgZm9yIChsZXQgYSBvZiBhcmd1bWVudHMpIHtcbiAgICAgICAgYXJncy5wdXNoKGEpO1xuICAgIH1cblxuICAgIGlmIChhcmdzLmxlbmd0aCkge1xuICAgICAgICBhcmdSZW1vdmVUb2tlbiA9IHNlbGYuX2NvbnRleHQuYXBwZW5kVG9Db250ZXh0KGFyZ3MpO1xuICAgIH1cblxuICAgIGFyZ3MudW5zaGlmdChuZXcgQ2FsbENvbnRleHQoc2VsZi5fY29udGV4dCkpO1xuXG4gICAgcmV0dXJuIG5ldyBCbHVlYmlyZChmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzZWxmLl9zZXRSb290U3RhdGUoc2VsZi5fY29udGV4dC5nZXRFeGVjdXRpb25TdGF0ZShzZWxmLl9yb290QWN0aXZpdHkpKTtcbiAgICAgICAgICAgIHNlbGYub25jZShcbiAgICAgICAgICAgICAgICBBY3Rpdml0eS5zdGF0ZXMuZW5kLCBmdW5jdGlvbiAoZUFyZ3MpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJlYXNvbiA9IGVBcmdzLnJlYXNvbjtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IGVBcmdzLnJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocmVhc29uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBBY3Rpdml0eS5zdGF0ZXMuY29tcGxldGU6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBBY3Rpdml0eS5zdGF0ZXMuY2FuY2VsOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IGVycm9ycy5DYW5jZWxsZWQoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQWN0aXZpdHkuc3RhdGVzLmlkbGU6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc2VsZi5faWRsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSByZXN1bHQgfHwgbmV3IGVycm9ycy5BY3Rpdml0eVJ1bnRpbWVFcnJvcihcIlVua25vd24gZXJyb3IuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJnUmVtb3ZlVG9rZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9jb250ZXh0LnJlbW92ZUZyb21Db250ZXh0KGFyZ1JlbW92ZVRva2VuKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdSZW1vdmVUb2tlbiA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc2VsZi5fcm9vdEFjdGl2aXR5LnN0YXJ0LmFwcGx5KHNlbGYuX3Jvb3RBY3Rpdml0eSwgYXJncyk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJlamVjdChlKTtcblxuICAgICAgICAgICAgaWYgKGFyZ1JlbW92ZVRva2VuKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5fY29udGV4dC5yZW1vdmVGcm9tQ29udGV4dChhcmdSZW1vdmVUb2tlbik7XG4gICAgICAgICAgICAgICAgYXJnUmVtb3ZlVG9rZW4gPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59O1xuXG5BY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZS5wcm90b3R5cGUuX3ZlcmlmeU5vdFN0YXJ0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCEoIXRoaXMuZXhlY1N0YXRlIHx8IHRoaXMuZXhlY1N0YXRlID09PSBlbnVtcy5BY3Rpdml0eVN0YXRlcy5jb21wbGV0ZSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5BY3Rpdml0eVN0YXRlRXhjZXB0aW9uRXJyb3IoXCJXb3JrZmxvdyBoYXMgYmVlbiBhbHJlYWR5IHN0YXJ0ZWQuXCIpO1xuICAgIH1cbn07XG5cbkFjdGl2aXR5RXhlY3V0aW9uRW5naW5lLnByb3RvdHlwZS5yZXN1bWVCb29rbWFyayA9IGZ1bmN0aW9uIChuYW1lLCByZWFzb24sIHJlc3VsdCkge1xuICAgIGxldCBzZWxmID0gdGhpcztcbiAgICBzZWxmLl9pbml0aWFsaXplKCk7XG4gICAgcmV0dXJuIG5ldyBCbHVlYmlyZChmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzZWxmLl9zZXRSb290U3RhdGUoc2VsZi5fY29udGV4dC5nZXRFeGVjdXRpb25TdGF0ZShzZWxmLl9yb290QWN0aXZpdHkpKTtcblxuICAgICAgICAgICAgaWYgKHNlbGYuZXhlY1N0YXRlID09PSBlbnVtcy5BY3Rpdml0eVN0YXRlcy5pZGxlKSB7XG4gICAgICAgICAgICAgICAgbGV0IGJtVGltZXN0YW1wID0gc2VsZi5fY29udGV4dC5nZXRCb29rbWFya1RpbWVzdGFtcChuYW1lKTtcbiAgICAgICAgICAgICAgICBzZWxmLm9uY2UoXG4gICAgICAgICAgICAgICAgICAgIEFjdGl2aXR5LnN0YXRlcy5lbmQsXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgX3JlYXNvbiA9IGFyZ3MucmVhc29uO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IF9yZXN1bHQgPSBhcmdzLnJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9yZWFzb24gPT09IGVudW1zLkFjdGl2aXR5U3RhdGVzLmNvbXBsZXRlIHx8IF9yZWFzb24gPT09IGVudW1zLkFjdGl2aXR5U3RhdGVzLmlkbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGVuZEJtVGltZXN0YW1wID0gc2VsZi5fY29udGV4dC5nZXRCb29rbWFya1RpbWVzdGFtcChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVuZEJtVGltZXN0YW1wICYmIGVuZEJtVGltZXN0YW1wID09PSBibVRpbWVzdGFtcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9yZWFzb24gPT09IGVudW1zLkFjdGl2aXR5U3RhdGVzLmNvbXBsZXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBlcnJvcnMuQWN0aXZpdHlSdW50aW1lRXJyb3IoXCJXb3JrZmxvdyBoYXMgYmVlbiBjb21wbGV0ZWQgYmVmb3JlIGJvb2ttYXJrICdcIiArIG5hbWUgKyBcIicgcmVhY2hlZC5cIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBlcnJvcnMuSWRsZShcIldvcmtmbG93IGhhcyBiZWVuIGdvbmUgdG8gaWRsZSBiZWZvcmUgYm9va21hcmsgJ1wiICsgbmFtZSArIFwiJyByZWFjaGVkLlwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoX3JlYXNvbiA9PT0gZW51bXMuQWN0aXZpdHlTdGF0ZXMuY2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgZXJyb3JzLkFjdGl2aXR5UnVudGltZUVycm9yKFwiV29ya2Zsb3cgaGFzIGJlZW4gY2FuY2VsbGVkIGJlZm9yZSBib29rbWFyayAnXCIgKyBuYW1lICsgXCInIHJlYWNoZWQuXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoX3JlYXNvbiA9PT0gZW51bXMuQWN0aXZpdHlTdGF0ZXMuZmFpbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoX3Jlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHNlbGYuX2NvbnRleHQucmVzdW1lQm9va21hcmtFeHRlcm5hbChuYW1lLCByZWFzb24sIHJlc3VsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZWplY3QobmV3IGVycm9ycy5BY3Rpdml0eVJ1bnRpbWVFcnJvcihcIkNhbm5vdCByZXN1bWUgYm9va21hcmssIHdoaWxlIHRoZSB3b3JrZmxvdyBpcyBub3QgaW4gdGhlIGlkbGUgc3RhdGUuXCIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICB9XG4gICAgfSk7XG59O1xuXG4vKiBTRVJJQUxJWkFUSU9OICovXG5BY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZS5wcm90b3R5cGUuZ2V0U3RhdGVBbmRQcm9tb3Rpb25zID0gZnVuY3Rpb24gKHNlcmlhbGl6ZXIsIGVuYWJsZVByb21vdGlvbnMpIHtcbiAgICBpZiAoc2VyaWFsaXplciAmJiAhXy5pc09iamVjdChzZXJpYWxpemVyKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBcmd1bWVudCAnc2VyaWFsaXplcicgaXMgbm90IGFuIG9iamVjdC5cIik7XG4gICAgfVxuXG4gICAgdGhpcy5faW5pdGlhbGl6ZSgpO1xuICAgIHJldHVybiB0aGlzLl9jb250ZXh0LmdldFN0YXRlQW5kUHJvbW90aW9ucyhzZXJpYWxpemVyLCBlbmFibGVQcm9tb3Rpb25zKTtcbn07XG5cbkFjdGl2aXR5RXhlY3V0aW9uRW5naW5lLnByb3RvdHlwZS5zZXRTdGF0ZSA9IGZ1bmN0aW9uIChzZXJpYWxpemVyLCBqc29uKSB7XG4gICAgaWYgKHNlcmlhbGl6ZXIgJiYgIV8uaXNPYmplY3Qoc2VyaWFsaXplcikpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQXJndW1lbnQgJ3NlcmlhbGl6ZXInIGlzIG5vdCBhbiBvYmplY3QuXCIpO1xuICAgIH1cbiAgICBpZiAoIV8uaXNPYmplY3QoanNvbikpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFyZ3VtZW50ICdqc29uJyBpcyBub3QgYW4gb2JqZWN0LlwiKTtcbiAgICB9XG5cbiAgICB0aGlzLl9pbml0aWFsaXplKCk7XG4gICAgdGhpcy5fdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICB0aGlzLl9jb250ZXh0LnNldFN0YXRlKHNlcmlhbGl6ZXIsIGpzb24pO1xufTtcbi8qIFNFUklBTElaQVRJT04gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBBY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZTsiXX0=
