{"version":3,"sources":["activities/template.js"],"names":[],"mappings":"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","file":"activities/template.js","sourcesContent":["\"use strict\";\n\nlet Activity = require(\"./activity\");\nlet util = require(\"util\");\nlet _ = require(\"lodash\");\nlet activityMarkup = require(\"./activityMarkup\");\nlet is = require(\"../common/is\");\nlet templateHelpers = require(\"./templateHelpers\");\nlet constants = require(\"../common/constants\");\n\nfunction Template() {\n    Activity.call(this);\n\n    this.declare = null;\n\n    this.nonScopedProperties.add(\"_visitActivities\");\n    this.nonScopedProperties.add(\"_getInternalActivities\");\n}\n\nutil.inherits(Template, Activity);\n\nTemplate.prototype.initializeStructure = function(execContext) {\n    let self = this;\n    let require = execContext.rootActivity[\"@require\"];\n    self.args = [];\n    templateHelpers.visitActivities(self.declare,\n        function(markup, parent, key) {\n            if (require) {\n                markup = templateHelpers.cloneDeep(markup);\n                markup[\"@require\"] = require;\n            }\n            self.args.push(activityMarkup.parse(markup));\n        });\n};\n\nTemplate.prototype.run = function(callContext, args) {\n    if (_.isArray(args)) {\n        callContext.schedule(args, \"_activitiesGot\");\n    }\n    else {\n        callContext.complete();\n    }\n};\n\nTemplate.prototype._activitiesGot = function(callContext, reason, result) {\n    if (reason === Activity.states.complete) {\n        if (_.isArray(result) && result.length) {\n            let idx = 0;\n            let declare = _.cloneDeep(this.declare);\n            let setupTasks = [];\n            templateHelpers.visitActivities(declare, function(markup, parent, key) {\n                setupTasks.push(function() {\n                    parent[key] = result[idx++];\n                });\n            });\n            for (let t of setupTasks) {\n                t();\n            }\n            callContext.complete(declare);\n        }\n    }\n    else {\n        callContext.end(reason, result);\n    }\n};\n\nmodule.exports = Template;"],"sourceRoot":"/source/"}