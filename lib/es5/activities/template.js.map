{"version":3,"names":[],"mappings":"","sources":["activities/template.js"],"sourcesContent":["\"use strict\";\n\nlet Activity = require(\"./activity\");\nlet util = require(\"util\");\nlet _ = require(\"lodash\");\nlet activityMarkup = require(\"./activityMarkup\");\nlet is = require(\"../common/is\");\nlet templateHelpers = require(\"./templateHelpers\");\nlet constants = require(\"../common/constants\");\n\nfunction Template() {\n    Activity.call(this);\n\n    this.declare = null;\n\n    this.nonScopedProperties.add(\"_visitActivities\");\n    this.nonScopedProperties.add(\"_getInternalActivities\");\n}\n\nutil.inherits(Template, Activity);\n\nTemplate.prototype.initializeStructure = function(execContext) {\n    let self = this;\n    let require = execContext.rootActivity[\"@require\"];\n    self.args = [];\n    templateHelpers.visitActivities(self.declare,\n        function(markup, parent, key) {\n            if (require) {\n                markup = _.cloneDeep(markup);\n                markup[\"@require\"] = require;\n            }\n            self.args.push(activityMarkup.parse(markup));\n        });\n};\n\nTemplate.prototype.run = function(callContext, args) {\n    if (_.isArray(args)) {\n        callContext.schedule(args, \"_activitiesGot\");\n    }\n    else {\n        callContext.complete();\n    }\n};\n\nTemplate.prototype._activitiesGot = function(callContext, reason, result) {\n    if (reason === Activity.states.complete) {\n        if (_.isArray(result) && result.length) {\n            let idx = 0;\n            let declare = _.cloneDeep(this.declare);\n            let setupTasks = [];\n            templateHelpers.visitActivities(declare, function(markup, parent, key) {\n                setupTasks.push(function() {\n                    parent[key] = result[idx++];\n                });\n            });\n            for (let t of setupTasks) {\n                t();\n            }\n            callContext.complete(declare);\n        }\n    }\n    else {\n        callContext.end(reason, result);\n    }\n};\n\nmodule.exports = Template;"],"file":"activities/template.js","sourceRoot":"/source/"}