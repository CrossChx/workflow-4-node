"use strict";
var Activity = require("./activity");
var util = require("util");
var errors = require("../common/errors");
var _ = require("lodash");
function Throw() {
  Activity.call(this);
  this.error = null;
}
util.inherits(Throw, Activity);
Throw.prototype.run = function(callContext, args) {
  if (!this.error) {
    if (!_.isUndefined(this.Try_ReThrow)) {
      this.Try_ReThrow = true;
    }
    callContext.complete();
  } else {
    callContext.schedule(this.error, "_errorGot");
  }
};
Throw.prototype._errorGot = function(callContext, reason, result) {
  if (reason !== Activity.states.complete) {
    callContext.end(reason, result);
    return;
  }
  var e;
  if (_.isString(result)) {
    e = new Error(result);
  } else if (result instanceof Error) {
    e = result;
  } else {
    callContext.complete();
    return;
  }
  if (!_.isUndefined(this.Try_ReThrow)) {
    this.Try_ReThrow = e;
    callContext.complete();
  } else {
    callContext.fail(e);
  }
};
module.exports = Throw;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRocm93LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBRUEsQUFBSSxFQUFBLENBQUEsUUFBTyxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsWUFBVyxDQUFDLENBQUM7QUFDcEMsQUFBSSxFQUFBLENBQUEsSUFBRyxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsTUFBSyxDQUFDLENBQUM7QUFDMUIsQUFBSSxFQUFBLENBQUEsTUFBSyxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsa0JBQWlCLENBQUMsQ0FBQztBQUN4QyxBQUFJLEVBQUEsQ0FBQSxDQUFBLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxRQUFPLENBQUMsQ0FBQztBQUV6QixPQUFTLE1BQUksQ0FBRSxBQUFELENBQUc7QUFDYixTQUFPLEtBQUssQUFBQyxDQUFDLElBQUcsQ0FBQyxDQUFDO0FBRW5CLEtBQUcsTUFBTSxFQUFJLEtBQUcsQ0FBQztBQUNyQjtBQUFBLEFBRUEsR0FBRyxTQUFTLEFBQUMsQ0FBQyxLQUFJLENBQUcsU0FBTyxDQUFDLENBQUM7QUFFOUIsSUFBSSxVQUFVLElBQUksRUFBSSxVQUFVLFdBQVUsQ0FBRyxDQUFBLElBQUcsQ0FBRztBQUMvQyxLQUFJLENBQUMsSUFBRyxNQUFNLENBQUc7QUFDYixPQUFJLENBQUMsQ0FBQSxZQUFZLEFBQUMsQ0FBQyxJQUFHLFlBQVksQ0FBQyxDQUFHO0FBQ2xDLFNBQUcsWUFBWSxFQUFJLEtBQUcsQ0FBQztJQUMzQjtBQUFBLEFBQ0EsY0FBVSxTQUFTLEFBQUMsRUFBQyxDQUFDO0VBQzFCLEtBQ0s7QUFDRCxjQUFVLFNBQVMsQUFBQyxDQUFDLElBQUcsTUFBTSxDQUFHLFlBQVUsQ0FBQyxDQUFDO0VBQ2pEO0FBQUEsQUFDSixDQUFDO0FBRUQsSUFBSSxVQUFVLFVBQVUsRUFBSSxVQUFTLFdBQVUsQ0FBRyxDQUFBLE1BQUssQ0FBRyxDQUFBLE1BQUssQ0FBRztBQUM5RCxLQUFJLE1BQUssSUFBTSxDQUFBLFFBQU8sT0FBTyxTQUFTLENBQUc7QUFDckMsY0FBVSxJQUFJLEFBQUMsQ0FBQyxNQUFLLENBQUcsT0FBSyxDQUFDLENBQUM7QUFDL0IsVUFBTTtFQUNWO0FBQUEsQUFFSSxJQUFBLENBQUEsQ0FBQSxDQUFDO0FBQ0wsS0FBSSxDQUFBLFNBQVMsQUFBQyxDQUFDLE1BQUssQ0FBQyxDQUFHO0FBQ3BCLElBQUEsRUFBSSxJQUFJLE1BQUksQUFBQyxDQUFDLE1BQUssQ0FBQyxDQUFDO0VBQ3pCLEtBQ0ssS0FBSSxNQUFLLFdBQWEsTUFBSSxDQUFHO0FBQzlCLElBQUEsRUFBSSxPQUFLLENBQUM7RUFDZCxLQUNLO0FBQ0QsY0FBVSxTQUFTLEFBQUMsRUFBQyxDQUFDO0FBQ3RCLFVBQU07RUFDVjtBQUFBLEFBRUEsS0FBSSxDQUFDLENBQUEsWUFBWSxBQUFDLENBQUMsSUFBRyxZQUFZLENBQUMsQ0FBRztBQUNsQyxPQUFHLFlBQVksRUFBSSxFQUFBLENBQUM7QUFDcEIsY0FBVSxTQUFTLEFBQUMsRUFBQyxDQUFDO0VBQzFCLEtBQ0s7QUFDRCxjQUFVLEtBQUssQUFBQyxDQUFDLENBQUEsQ0FBQyxDQUFDO0VBQ3ZCO0FBQUEsQUFDSixDQUFDO0FBRUQsS0FBSyxRQUFRLEVBQUksTUFBSSxDQUFDO0FBQUEiLCJmaWxlIjoiYWN0aXZpdGllcy90aHJvdy5qcyIsInNvdXJjZVJvb3QiOiJsaWIvZXM2Iiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5sZXQgQWN0aXZpdHkgPSByZXF1aXJlKFwiLi9hY3Rpdml0eVwiKTtcclxubGV0IHV0aWwgPSByZXF1aXJlKFwidXRpbFwiKTtcclxubGV0IGVycm9ycyA9IHJlcXVpcmUoXCIuLi9jb21tb24vZXJyb3JzXCIpO1xyXG5sZXQgXyA9IHJlcXVpcmUoXCJsb2Rhc2hcIik7XHJcblxyXG5mdW5jdGlvbiBUaHJvdygpIHtcclxuICAgIEFjdGl2aXR5LmNhbGwodGhpcyk7XHJcblxyXG4gICAgdGhpcy5lcnJvciA9IG51bGw7XHJcbn1cclxuXHJcbnV0aWwuaW5oZXJpdHMoVGhyb3csIEFjdGl2aXR5KTtcclxuXHJcblRocm93LnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoY2FsbENvbnRleHQsIGFyZ3MpIHtcclxuICAgIGlmICghdGhpcy5lcnJvcikge1xyXG4gICAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh0aGlzLlRyeV9SZVRocm93KSkge1xyXG4gICAgICAgICAgICB0aGlzLlRyeV9SZVRocm93ID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FsbENvbnRleHQuY29tcGxldGUoKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGNhbGxDb250ZXh0LnNjaGVkdWxlKHRoaXMuZXJyb3IsIFwiX2Vycm9yR290XCIpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuVGhyb3cucHJvdG90eXBlLl9lcnJvckdvdCA9IGZ1bmN0aW9uKGNhbGxDb250ZXh0LCByZWFzb24sIHJlc3VsdCkge1xyXG4gICAgaWYgKHJlYXNvbiAhPT0gQWN0aXZpdHkuc3RhdGVzLmNvbXBsZXRlKSB7XHJcbiAgICAgICAgY2FsbENvbnRleHQuZW5kKHJlYXNvbiwgcmVzdWx0KTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGU7XHJcbiAgICBpZiAoXy5pc1N0cmluZyhyZXN1bHQpKSB7XHJcbiAgICAgICAgZSA9IG5ldyBFcnJvcihyZXN1bHQpO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAocmVzdWx0IGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICBlID0gcmVzdWx0O1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgY2FsbENvbnRleHQuY29tcGxldGUoKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFfLmlzVW5kZWZpbmVkKHRoaXMuVHJ5X1JlVGhyb3cpKSB7XHJcbiAgICAgICAgdGhpcy5UcnlfUmVUaHJvdyA9IGU7XHJcbiAgICAgICAgY2FsbENvbnRleHQuY29tcGxldGUoKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGNhbGxDb250ZXh0LmZhaWwoZSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFRocm93OyJdfQ==
