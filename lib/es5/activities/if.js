"use strict";
var Activity = require("./activity");
var util = require("util");
var Block = require("./block");
var _ = require("lodash");
function If() {
  Activity.call(this);
  this.arrayProperties.add("then");
  this.arrayProperties.add("else");
  this.condition = null;
  this.then = null;
  this.else = null;
}
util.inherits(If, Activity);
If.prototype.initializeStructure = function() {
  if (this.then) {
    var prev = this.then;
    this.then = new Block();
    this.then.args = prev;
  }
  if (this.else) {
    var prev$__0 = this.else;
    this.else = new Block();
    this.else.args = prev$__0;
  }
};
If.prototype.run = function(callContext, args) {
  var condition = this.condition;
  if (condition) {
    callContext.schedule(condition, "_conditionGot");
  } else {
    callContext.complete();
  }
};
If.prototype._conditionGot = function(callContext, reason, result) {
  if (reason === Activity.states.complete) {
    if (result) {
      var then = this.then;
      if (then) {
        callContext.schedule(then, "_bodyFinished");
        return;
      }
    } else {
      var _else = this.else;
      if (_else) {
        callContext.schedule(_else, "_bodyFinished");
        return;
      }
    }
    callContext.complete();
  } else {
    callContext.end(reason, result);
  }
};
If.prototype._bodyFinished = function(callContext, reason, result) {
  callContext.end(reason, result);
};
module.exports = If;
//# sourceMappingURL=data:application/json;base64,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LENBQUM7RUFDbkM7QUFBQSxBQUNKLENBQUM7QUFFRCxDQUFDLFVBQVUsY0FBYyxFQUFJLFVBQVUsV0FBVSxDQUFHLENBQUEsTUFBSyxDQUFHLENBQUEsTUFBSyxDQUFHO0FBQ2hFLFlBQVUsSUFBSSxBQUFDLENBQUMsTUFBSyxDQUFHLE9BQUssQ0FBQyxDQUFDO0FBQ25DLENBQUM7QUFFRCxLQUFLLFFBQVEsRUFBSSxHQUFDLENBQUM7QUFDbkIiLCJmaWxlIjoiYWN0aXZpdGllcy9pZi5qcyIsInNvdXJjZVJvb3QiOiJsaWIvZXM2Iiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmxldCBBY3Rpdml0eSA9IHJlcXVpcmUoXCIuL2FjdGl2aXR5XCIpO1xubGV0IHV0aWwgPSByZXF1aXJlKFwidXRpbFwiKTtcbmxldCBCbG9jayA9IHJlcXVpcmUoXCIuL2Jsb2NrXCIpO1xubGV0IF8gPSByZXF1aXJlKFwibG9kYXNoXCIpO1xuXG5mdW5jdGlvbiBJZigpIHtcbiAgICBBY3Rpdml0eS5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5hcnJheVByb3BlcnRpZXMuYWRkKFwidGhlblwiKTtcbiAgICB0aGlzLmFycmF5UHJvcGVydGllcy5hZGQoXCJlbHNlXCIpO1xuXG4gICAgdGhpcy5jb25kaXRpb24gPSBudWxsO1xuICAgIHRoaXMudGhlbiA9IG51bGw7XG4gICAgdGhpcy5lbHNlID0gbnVsbDtcbn1cblxudXRpbC5pbmhlcml0cyhJZiwgQWN0aXZpdHkpO1xuXG5JZi5wcm90b3R5cGUuaW5pdGlhbGl6ZVN0cnVjdHVyZSA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLnRoZW4pIHtcbiAgICAgICAgbGV0IHByZXYgPSB0aGlzLnRoZW47XG4gICAgICAgIHRoaXMudGhlbiA9IG5ldyBCbG9jaygpO1xuICAgICAgICB0aGlzLnRoZW4uYXJncyA9IHByZXY7XG4gICAgfVxuICAgIGlmICh0aGlzLmVsc2UpIHtcbiAgICAgICAgbGV0IHByZXYgPSB0aGlzLmVsc2U7XG4gICAgICAgIHRoaXMuZWxzZSA9IG5ldyBCbG9jaygpO1xuICAgICAgICB0aGlzLmVsc2UuYXJncyA9IHByZXY7XG4gICAgfVxufTtcblxuSWYucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uIChjYWxsQ29udGV4dCwgYXJncykge1xuICAgIGxldCBjb25kaXRpb24gPSB0aGlzLmNvbmRpdGlvbjtcbiAgICBpZiAoY29uZGl0aW9uKSB7XG4gICAgICAgIGNhbGxDb250ZXh0LnNjaGVkdWxlKGNvbmRpdGlvbiwgXCJfY29uZGl0aW9uR290XCIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY2FsbENvbnRleHQuY29tcGxldGUoKTtcbiAgICB9XG59O1xuXG5JZi5wcm90b3R5cGUuX2NvbmRpdGlvbkdvdCA9IGZ1bmN0aW9uIChjYWxsQ29udGV4dCwgcmVhc29uLCByZXN1bHQpIHtcbiAgICBpZiAocmVhc29uID09PSBBY3Rpdml0eS5zdGF0ZXMuY29tcGxldGUpIHtcbiAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgbGV0IHRoZW4gPSB0aGlzLnRoZW47XG4gICAgICAgICAgICBpZiAodGhlbikge1xuICAgICAgICAgICAgICAgIGNhbGxDb250ZXh0LnNjaGVkdWxlKHRoZW4sIFwiX2JvZHlGaW5pc2hlZFwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBsZXQgX2Vsc2UgPSB0aGlzLmVsc2U7XG4gICAgICAgICAgICBpZiAoX2Vsc2UpIHtcbiAgICAgICAgICAgICAgICBjYWxsQ29udGV4dC5zY2hlZHVsZShfZWxzZSwgXCJfYm9keUZpbmlzaGVkXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYWxsQ29udGV4dC5jb21wbGV0ZSgpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY2FsbENvbnRleHQuZW5kKHJlYXNvbiwgcmVzdWx0KTtcbiAgICB9XG59O1xuXG5JZi5wcm90b3R5cGUuX2JvZHlGaW5pc2hlZCA9IGZ1bmN0aW9uIChjYWxsQ29udGV4dCwgcmVhc29uLCByZXN1bHQpIHtcbiAgICBjYWxsQ29udGV4dC5lbmQocmVhc29uLCByZXN1bHQpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBJZjtcbiJdfQ==
