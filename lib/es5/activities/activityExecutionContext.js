"use strict";
var ActivityExecutionState = require("./activityExecutionState");
var ResumeBookmarkQueue = require("./resumeBookmarkQueue");
var enums = require("../common/enums");
var errors = require("../common/errors");
var util = require("util");
var EventEmitter = require("events").EventEmitter;
var _ = require("lodash");
var guids = require("../common/guids");
var ScopeTree = require("./scopeTree");
var is = require("../common/is");
var CallContext = require("./callContext");
var assert = require("better-assert");
var Bluebird = require("bluebird");
var converters = require("../common/converters");
function ActivityExecutionContext(engine) {
  EventEmitter.call(this);
  this._activityStates = new Map();
  this._bookmarks = new Map();
  this._activityIds = new Map();
  this._resumeBMQueue = new ResumeBookmarkQueue();
  this._rootActivity = null;
  this._knownActivities = new Map();
  this._nextActivityId = 0;
  this._scopeTree = this._createScopeTree();
  this.engine = engine;
}
util.inherits(ActivityExecutionContext, EventEmitter);
Object.defineProperties(ActivityExecutionContext.prototype, {
  scope: {get: function() {
      return this._scopeTree.currentScope;
    }},
  hasScope: {get: function() {
      return !this._scopeTree.isOnInitial;
    }},
  rootActivity: {get: function() {
      return this._rootActivity;
    }}
});
ActivityExecutionContext.prototype.getInstanceId = function(activity, tryIt) {
  var id = this._activityIds.get(activity);
  if (_.isUndefined(id) && !tryIt) {
    throw new errors.ActivityStateExceptionError(("Activity " + activity + " is not part of the context."));
  }
  return id;
};
ActivityExecutionContext.prototype.setInstanceId = function(activity, id) {
  return this._activityIds.set(activity, id);
};
ActivityExecutionContext.prototype._createScopeTree = function() {
  var self = this;
  return new ScopeTree({resultCollected: function(context, reason, result, bookmarkName) {
      context.activity.resultCollected.call(context.scope, context, reason, result, bookmarkName);
    }}, function(id) {
    return self._getKnownActivity(id);
  });
};
ActivityExecutionContext.prototype.initialize = function(rootActivity) {
  if (this._rootActivity) {
    throw new Error("Context is already initialized.");
  }
  if (!is.activity(rootActivity)) {
    throw new TypeError("Argument 'rootActivity' value is not an activity.");
  }
  this._rootActivity = rootActivity;
  this._initialize(null, rootActivity, {instanceId: 0});
};
ActivityExecutionContext.prototype.appendToContext = function(args) {
  this._checkInit();
  var currMax = this._nextActivityId;
  var c = {instanceId: currMax};
  if (_.isArray(args)) {
    var state = this.getExecutionState(this._rootActivity);
    var $__5 = true;
    var $__6 = false;
    var $__7 = undefined;
    try {
      for (var $__3 = void 0,
          $__2 = (args)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
        var arg = $__3.value;
        {
          if (is.activity(arg)) {
            this._initialize(this._rootActivity, arg, c);
            state.childInstanceIds.add(this.getInstanceId(arg));
          }
        }
      }
    } catch ($__8) {
      $__6 = true;
      $__7 = $__8;
    } finally {
      try {
        if (!$__5 && $__2.return != null) {
          $__2.return();
        }
      } finally {
        if ($__6) {
          throw $__7;
        }
      }
    }
  } else {
    throw new TypeError("Argument 'args' value is not an array.");
  }
  return {
    fromId: currMax,
    toId: this._nextActivityId
  };
};
ActivityExecutionContext.prototype.removeFromContext = function(removeToken) {
  this._checkInit();
  if (removeToken && !_.isUndefined(removeToken.fromId) && !_.isUndefined(removeToken.toId)) {
    var state = this.getExecutionState(this._rootActivity);
    for (var id = removeToken.fromId; id <= removeToken.toId; id++) {
      var sid = id.toString();
      this._knownActivities.delete(sid);
      this._activityStates.delete(sid);
      state.childInstanceIds.delete(sid);
    }
  } else {
    throw new TypeError("Argument 'removeToken' value is not a valid remove token object.");
  }
  this._nextActivityId = removeToken.fromId;
};
ActivityExecutionContext.prototype._checkInit = function() {
  if (!this._rootActivity) {
    throw new Error("Context is not initialized.");
  }
};
ActivityExecutionContext.prototype._initialize = function(parent, activity, idCounter) {
  var activityId = this.getInstanceId(activity, true);
  var nextId = (idCounter.instanceId++).toString();
  if (!activityId) {
    activityId = nextId;
    this.setInstanceId(activity, activityId);
  } else if (activityId !== nextId) {
    throw new Error("Activity " + activity + " has been assigned to an other context in a different tree which is not allowed.");
  }
  this._nextActivityId = idCounter.instanceId;
  var state = this.getExecutionState(activityId);
  state.parentInstanceId = parent ? this.getInstanceId(parent) : null;
  this._knownActivities.set(activityId, activity);
  var $__5 = true;
  var $__6 = false;
  var $__7 = undefined;
  try {
    for (var $__3 = void 0,
        $__2 = (activity.immediateChildren(this))[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
      var child = $__3.value;
      {
        this._initialize(activity, child, idCounter);
        state.childInstanceIds.add(this.getInstanceId(child));
      }
    }
  } catch ($__8) {
    $__6 = true;
    $__7 = $__8;
  } finally {
    try {
      if (!$__5 && $__2.return != null) {
        $__2.return();
      }
    } finally {
      if ($__6) {
        throw $__7;
      }
    }
  }
};
ActivityExecutionContext.prototype.getExecutionState = function(idOrActivity) {
  var self = this;
  var id;
  if (_.isString(idOrActivity)) {
    id = idOrActivity;
  } else if (is.activity(idOrActivity)) {
    id = self.getInstanceId(idOrActivity);
  } else {
    throw new TypeError("Cannot get state of " + idOrActivity);
  }
  var state = self._activityStates.get(id);
  if (_.isUndefined(state)) {
    state = new ActivityExecutionState(id);
    state.on(enums.activityStates.run, function(args) {
      self.emit(enums.activityStates.run, args);
    });
    state.on(enums.activityStates.end, function(args) {
      self.emit(enums.activityStates.end, args);
    });
    self._activityStates.set(id, state);
  }
  return state;
};
ActivityExecutionContext.prototype._getKnownActivity = function(activityId) {
  var activity = this._knownActivities.get(activityId);
  if (!activity) {
    throw new errors.ActivityRuntimeError("Activity by id '" + activityId + "' not found.");
  }
  return activity;
};
ActivityExecutionContext.prototype.createBookmark = function(activityId, name, endCallback) {
  this.registerBookmark({
    name: name,
    instanceId: activityId,
    timestamp: new Date().getTime(),
    endCallback: endCallback
  });
  return name;
};
ActivityExecutionContext.prototype.registerBookmark = function(bookmark) {
  var bm = this._bookmarks.get(bookmark.name);
  if (bm) {
    throw new errors.ActivityRuntimeError("Bookmark '" + bookmark.name + "' already exists.");
  }
  this._bookmarks.set(bookmark.name, bookmark);
};
ActivityExecutionContext.prototype.isBookmarkExists = function(name) {
  return this._bookmarks.has(name);
};
ActivityExecutionContext.prototype.getBookmarkTimestamp = function(name, throwIfNotFound) {
  var bm = this._bookmarks.get(name);
  if (_.isUndefined(bm) && throwIfNotFound) {
    throw new Error("Bookmark '" + name + "' not found.");
  }
  return bm ? bm.timestamp : null;
};
ActivityExecutionContext.prototype.deleteBookmark = function(name) {
  this._bookmarks.delete(name);
};
ActivityExecutionContext.prototype.noopCallbacks = function(bookmarkNames) {
  var $__5 = true;
  var $__6 = false;
  var $__7 = undefined;
  try {
    for (var $__3 = void 0,
        $__2 = (bookmarkNames)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
      var name = $__3.value;
      {
        var bm = this._bookmarks.get(name);
        if (bm) {
          bm.endCallback = _.noop;
        }
      }
    }
  } catch ($__8) {
    $__6 = true;
    $__7 = $__8;
  } finally {
    try {
      if (!$__5 && $__2.return != null) {
        $__2.return();
      }
    } finally {
      if ($__6) {
        throw $__7;
      }
    }
  }
};
ActivityExecutionContext.prototype.resumeBookmarkInScope = function(callContext, name, reason, result) {
  var bm = this._bookmarks.get(name);
  if (_.isUndefined(bm)) {
    throw new Error("Bookmark '" + name + "' doesn't exists. Cannot continue with reason: " + reason + ".");
  }
  var self = this;
  return new Bluebird(function(resolve, reject) {
    setImmediate(function() {
      try {
        bm = self._bookmarks.get(name);
        if (bm) {
          self._doResumeBookmark(callContext, bm, reason, result, reason === enums.activityStates.idle);
          resolve(true);
        }
        resolve(false);
      } catch (e) {
        reject(e);
      }
    });
  });
};
ActivityExecutionContext.prototype.resumeBookmarkInternal = function(callContext, name, reason, result) {
  var bm = this._bookmarks.get(name);
  this._resumeBMQueue.enqueue(name, reason, result);
};
ActivityExecutionContext.prototype.resumeBookmarkExternal = function(name, reason, result) {
  var self = this;
  var bm = self._bookmarks.get(name);
  if (!bm) {
    throw new errors.BookmarkNotFoundError("Internal resume bookmark request cannot be processed because bookmark '" + name + "' doesn't exists.");
  }
  self._doResumeBookmark(new CallContext(this, bm.instanceId), bm, reason, result);
};
ActivityExecutionContext.prototype.processResumeBookmarkQueue = function() {
  var self = this;
  var command = self._resumeBMQueue.dequeue();
  if (command) {
    var bm = self._bookmarks.get(command.name);
    if (!bm) {
      throw new errors.BookmarkNotFoundError("Internal resume bookmark request cannot be processed because bookmark '" + command.name + "' doesn't exists.");
    }
    self._doResumeBookmark(new CallContext(this, bm.instanceId), bm, command.reason, command.result);
    return true;
  }
  return false;
};
ActivityExecutionContext.prototype._doResumeBookmark = function(callContext, bookmark, reason, result, noRemove) {
  var scope = callContext.scope;
  if (!noRemove) {
    this._bookmarks.delete(bookmark.name);
  }
  var cb = bookmark.endCallback;
  if (_.isString(cb)) {
    cb = scope[bookmark.endCallback];
    if (!_.isFunction(cb)) {
      cb = null;
    }
  }
  if (!cb) {
    throw new errors.ActivityRuntimeError("Bookmark's '" + bookmark.name + "' callback '" + bookmark.endCallback + "' is not defined on the current scope.");
  }
  cb.call(scope, callContext, reason, result, bookmark);
};
ActivityExecutionContext.prototype.cancelExecution = function(scope, activityIds) {
  var self = this;
  var allIds = new Set();
  var $__5 = true;
  var $__6 = false;
  var $__7 = undefined;
  try {
    for (var $__3 = void 0,
        $__2 = (activityIds)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
      var id = $__3.value;
      {
        self._cancelSubtree(scope, allIds, id);
      }
    }
  } catch ($__8) {
    $__6 = true;
    $__7 = $__8;
  } finally {
    try {
      if (!$__5 && $__2.return != null) {
        $__2.return();
      }
    } finally {
      if ($__6) {
        throw $__7;
      }
    }
  }
  var $__12 = true;
  var $__13 = false;
  var $__14 = undefined;
  try {
    for (var $__10 = void 0,
        $__9 = (self._bookmarks.values())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__12 = ($__10 = $__9.next()).done); $__12 = true) {
      var bm = $__10.value;
      {
        if (allIds.has(bm.instanceId)) {
          self._bookmarks.delete(bm.name);
        }
      }
    }
  } catch ($__15) {
    $__13 = true;
    $__14 = $__15;
  } finally {
    try {
      if (!$__12 && $__9.return != null) {
        $__9.return();
      }
    } finally {
      if ($__13) {
        throw $__14;
      }
    }
  }
};
ActivityExecutionContext.prototype._cancelSubtree = function(scope, allIds, activityId) {
  var self = this;
  allIds.add(activityId);
  var state = self.getExecutionState(activityId);
  var $__5 = true;
  var $__6 = false;
  var $__7 = undefined;
  try {
    for (var $__3 = void 0,
        $__2 = (state.childInstanceIds.values())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
      var id = $__3.value;
      {
        self._cancelSubtree(scope, allIds, id);
      }
    }
  } catch ($__8) {
    $__6 = true;
    $__7 = $__8;
  } finally {
    try {
      if (!$__5 && $__2.return != null) {
        $__2.return();
      }
    } finally {
      if ($__6) {
        throw $__7;
      }
    }
  }
  state.reportState(enums.activityStates.cancel, null, scope);
};
ActivityExecutionContext.prototype.deleteScopeOfActivity = function(callContext, activityId) {
  this._scopeTree.deleteScopePart(callContext.instanceId, activityId);
};
ActivityExecutionContext.prototype.emitWorkflowEvent = function(args) {
  this.emit(enums.events.workflowEvent, args);
};
ActivityExecutionContext.prototype.getStateAndPromotions = function(serializer, enablePromotions) {
  if (serializer && !_.isFunction(serializer.toJSON)) {
    throw new TypeError("Argument 'serializer' is not a serializer.");
  }
  var activityStates = new Map();
  var $__5 = true;
  var $__6 = false;
  var $__7 = undefined;
  try {
    for (var $__3 = void 0,
        $__2 = (this._activityStates.values())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
      var s = $__3.value;
      {
        activityStates.set(s.instanceId, s.asJSON());
      }
    }
  } catch ($__8) {
    $__6 = true;
    $__7 = $__8;
  } finally {
    try {
      if (!$__5 && $__2.return != null) {
        $__2.return();
      }
    } finally {
      if ($__6) {
        throw $__7;
      }
    }
  }
  var scopeStateAndPromotions = this._scopeTree.getExecutionState(this, enablePromotions, serializer);
  var serialized;
  if (serializer) {
    serialized = serializer.toJSON({
      activityStates: activityStates,
      bookmarks: this._bookmarks,
      scope: scopeStateAndPromotions.state
    });
  } else {
    serialized = {
      activityStates: converters.mapToArray(activityStates),
      bookmarks: converters.mapToArray(this._bookmarks),
      scope: scopeStateAndPromotions.state
    };
  }
  return {
    state: serialized,
    promotedProperties: scopeStateAndPromotions.promotedProperties
  };
};
ActivityExecutionContext.prototype.setState = function(serializer, json) {
  if (serializer && !_.isFunction(serializer.fromJSON)) {
    throw new TypeError("Argument 'serializer' is not a serializer.");
  }
  if (!_.isObject(json)) {
    throw new TypeError("Argument 'json' is not an object.");
  }
  if (serializer) {
    json = serializer.fromJSON(json);
    if (!(json.activityStates instanceof Map)) {
      throw new TypeError("activityStates property value of argument 'json' is not an Map instance.");
    }
    if (!(json.bookmarks instanceof Map)) {
      throw new TypeError("Bookmarks property value of argument 'json' is not an Map instance.");
    }
  } else {
    if (!json.activityStates) {
      throw new TypeError("activityStates property value of argument 'json' is not an object.");
    }
    if (!json.bookmarks) {
      throw new TypeError("Bookmarks property value of argument 'json' is not an object.");
    }
    json = {
      activityStates: converters.arrayToMap(json.activityStates),
      bookmarks: converters.arrayToMap(json.bookmarks),
      scope: json.scope
    };
  }
  var $__5 = true;
  var $__6 = false;
  var $__7 = undefined;
  try {
    for (var $__3 = void 0,
        $__2 = (this._activityStates.values())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
      var s = $__3.value;
      {
        var stored = json.activityStates.get(s.instanceId);
        if (_.isUndefined(stored)) {
          throw new Error("Activity's of '" + s.instanceId + "' state not found.");
        }
        s.fromJSON(stored);
      }
    }
  } catch ($__8) {
    $__6 = true;
    $__7 = $__8;
  } finally {
    try {
      if (!$__5 && $__2.return != null) {
        $__2.return();
      }
    } finally {
      if ($__6) {
        throw $__7;
      }
    }
  }
  this._bookmarks = json.bookmarks;
  this._scopeTree.setState(json.scope, serializer);
};
module.exports = ActivityExecutionContext;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUVBLEFBQUksRUFBQSxDQUFBLHNCQUFxQixFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsMEJBQXlCLENBQUMsQ0FBQztBQUNoRSxBQUFJLEVBQUEsQ0FBQSxtQkFBa0IsRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLHVCQUFzQixDQUFDLENBQUM7QUFDMUQsQUFBSSxFQUFBLENBQUEsS0FBSSxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsaUJBQWdCLENBQUMsQ0FBQztBQUN0QyxBQUFJLEVBQUEsQ0FBQSxNQUFLLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxrQkFBaUIsQ0FBQyxDQUFDO0FBQ3hDLEFBQUksRUFBQSxDQUFBLElBQUcsRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLE1BQUssQ0FBQyxDQUFDO0FBQzFCLEFBQUksRUFBQSxDQUFBLFlBQVcsRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLFFBQU8sQ0FBQyxhQUFhLENBQUM7QUFDakQsQUFBSSxFQUFBLENBQUEsQ0FBQSxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsUUFBTyxDQUFDLENBQUM7QUFDekIsQUFBSSxFQUFBLENBQUEsS0FBSSxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsaUJBQWdCLENBQUMsQ0FBQztBQUN0QyxBQUFJLEVBQUEsQ0FBQSxTQUFRLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxhQUFZLENBQUMsQ0FBQztBQUN0QyxBQUFJLEVBQUEsQ0FBQSxFQUFDLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxjQUFhLENBQUMsQ0FBQztBQUNoQyxBQUFJLEVBQUEsQ0FBQSxXQUFVLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxlQUFjLENBQUMsQ0FBQztBQUMxQyxBQUFJLEVBQUEsQ0FBQSxNQUFLLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxlQUFjLENBQUMsQ0FBQztBQUNyQyxB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SUFBRyxNQUFNLENBQUcsV0FBUyxDQUFDLENBQUM7QUFDcEQsQ0FBQztBQUdELEtBQUssUUFBUSxFQUFJLHlCQUF1QixDQUFDO0FBQUEiLCJmaWxlIjoiYWN0aXZpdGllcy9hY3Rpdml0eUV4ZWN1dGlvbkNvbnRleHQuanMiLCJzb3VyY2VSb290IjoibGliL2VzNiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5sZXQgQWN0aXZpdHlFeGVjdXRpb25TdGF0ZSA9IHJlcXVpcmUoXCIuL2FjdGl2aXR5RXhlY3V0aW9uU3RhdGVcIik7XG5sZXQgUmVzdW1lQm9va21hcmtRdWV1ZSA9IHJlcXVpcmUoXCIuL3Jlc3VtZUJvb2ttYXJrUXVldWVcIik7XG5sZXQgZW51bXMgPSByZXF1aXJlKFwiLi4vY29tbW9uL2VudW1zXCIpO1xubGV0IGVycm9ycyA9IHJlcXVpcmUoXCIuLi9jb21tb24vZXJyb3JzXCIpO1xubGV0IHV0aWwgPSByZXF1aXJlKFwidXRpbFwiKTtcbmxldCBFdmVudEVtaXR0ZXIgPSByZXF1aXJlKFwiZXZlbnRzXCIpLkV2ZW50RW1pdHRlcjtcbmxldCBfID0gcmVxdWlyZShcImxvZGFzaFwiKTtcbmxldCBndWlkcyA9IHJlcXVpcmUoXCIuLi9jb21tb24vZ3VpZHNcIik7XG5sZXQgU2NvcGVUcmVlID0gcmVxdWlyZShcIi4vc2NvcGVUcmVlXCIpO1xubGV0IGlzID0gcmVxdWlyZShcIi4uL2NvbW1vbi9pc1wiKTtcbmxldCBDYWxsQ29udGV4dCA9IHJlcXVpcmUoXCIuL2NhbGxDb250ZXh0XCIpO1xubGV0IGFzc2VydCA9IHJlcXVpcmUoXCJiZXR0ZXItYXNzZXJ0XCIpO1xubGV0IEJsdWViaXJkID0gcmVxdWlyZShcImJsdWViaXJkXCIpO1xubGV0IGNvbnZlcnRlcnMgPSByZXF1aXJlKFwiLi4vY29tbW9uL2NvbnZlcnRlcnNcIik7XG5cbmZ1bmN0aW9uIEFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dChlbmdpbmUpIHtcbiAgICBFdmVudEVtaXR0ZXIuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMuX2FjdGl2aXR5U3RhdGVzID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuX2Jvb2ttYXJrcyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLl9hY3Rpdml0eUlkcyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLl9yZXN1bWVCTVF1ZXVlID0gbmV3IFJlc3VtZUJvb2ttYXJrUXVldWUoKTtcbiAgICB0aGlzLl9yb290QWN0aXZpdHkgPSBudWxsO1xuICAgIHRoaXMuX2tub3duQWN0aXZpdGllcyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLl9uZXh0QWN0aXZpdHlJZCA9IDA7XG4gICAgdGhpcy5fc2NvcGVUcmVlID0gdGhpcy5fY3JlYXRlU2NvcGVUcmVlKCk7XG4gICAgdGhpcy5lbmdpbmUgPSBlbmdpbmU7IC8vIENvdWxkIGJlIG51bGwgaW4gc3BlY2lhbCBjYXNlcywgc2VlIHdvcmtmbG93UmVnaXN0cnkuanNcbn1cblxudXRpbC5pbmhlcml0cyhBY3Rpdml0eUV4ZWN1dGlvbkNvbnRleHQsIEV2ZW50RW1pdHRlcik7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKFxuICAgIEFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dC5wcm90b3R5cGUsXG4gICAge1xuICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Njb3BlVHJlZS5jdXJyZW50U2NvcGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGhhc1Njb3BlOiB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gIXRoaXMuX3Njb3BlVHJlZS5pc09uSW5pdGlhbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcm9vdEFjdGl2aXR5OiB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcm9vdEFjdGl2aXR5O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuKTtcblxuQWN0aXZpdHlFeGVjdXRpb25Db250ZXh0LnByb3RvdHlwZS5nZXRJbnN0YW5jZUlkID0gZnVuY3Rpb24gKGFjdGl2aXR5LCB0cnlJdCkge1xuICAgIGxldCBpZCA9IHRoaXMuX2FjdGl2aXR5SWRzLmdldChhY3Rpdml0eSk7XG4gICAgaWYgKF8uaXNVbmRlZmluZWQoaWQpICYmICF0cnlJdCkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLkFjdGl2aXR5U3RhdGVFeGNlcHRpb25FcnJvcihgQWN0aXZpdHkgJHthY3Rpdml0eX0gaXMgbm90IHBhcnQgb2YgdGhlIGNvbnRleHQuYCk7XG4gICAgfVxuICAgIHJldHVybiBpZDtcbn07XG5cbkFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dC5wcm90b3R5cGUuc2V0SW5zdGFuY2VJZCA9IGZ1bmN0aW9uIChhY3Rpdml0eSwgaWQpIHtcbiAgICByZXR1cm4gdGhpcy5fYWN0aXZpdHlJZHMuc2V0KGFjdGl2aXR5LCBpZCk7XG59O1xuXG5BY3Rpdml0eUV4ZWN1dGlvbkNvbnRleHQucHJvdG90eXBlLl9jcmVhdGVTY29wZVRyZWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgIHJldHVybiBuZXcgU2NvcGVUcmVlKFxuICAgICAgICB7XG4gICAgICAgICAgICByZXN1bHRDb2xsZWN0ZWQ6IGZ1bmN0aW9uIChjb250ZXh0LCByZWFzb24sIHJlc3VsdCwgYm9va21hcmtOYW1lKSB7XG4gICAgICAgICAgICAgICAgY29udGV4dC5hY3Rpdml0eS5yZXN1bHRDb2xsZWN0ZWQuY2FsbChjb250ZXh0LnNjb3BlLCBjb250ZXh0LCByZWFzb24sIHJlc3VsdCwgYm9va21hcmtOYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5fZ2V0S25vd25BY3Rpdml0eShpZCk7XG4gICAgICAgIH0pO1xufTtcblxuQWN0aXZpdHlFeGVjdXRpb25Db250ZXh0LnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKHJvb3RBY3Rpdml0eSkge1xuICAgIGlmICh0aGlzLl9yb290QWN0aXZpdHkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ29udGV4dCBpcyBhbHJlYWR5IGluaXRpYWxpemVkLlwiKTtcbiAgICB9XG4gICAgaWYgKCFpcy5hY3Rpdml0eShyb290QWN0aXZpdHkpKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJBcmd1bWVudCAncm9vdEFjdGl2aXR5JyB2YWx1ZSBpcyBub3QgYW4gYWN0aXZpdHkuXCIpO1xuICAgIH1cblxuICAgIHRoaXMuX3Jvb3RBY3Rpdml0eSA9IHJvb3RBY3Rpdml0eTtcbiAgICB0aGlzLl9pbml0aWFsaXplKG51bGwsIHJvb3RBY3Rpdml0eSwgeyBpbnN0YW5jZUlkOiAwIH0pO1xufTtcblxuQWN0aXZpdHlFeGVjdXRpb25Db250ZXh0LnByb3RvdHlwZS5hcHBlbmRUb0NvbnRleHQgPSBmdW5jdGlvbiAoYXJncykge1xuICAgIHRoaXMuX2NoZWNrSW5pdCgpO1xuXG4gICAgbGV0IGN1cnJNYXggPSB0aGlzLl9uZXh0QWN0aXZpdHlJZDtcbiAgICBsZXQgYyA9IHsgaW5zdGFuY2VJZDogY3Vyck1heCB9O1xuXG4gICAgaWYgKF8uaXNBcnJheShhcmdzKSkge1xuICAgICAgICBsZXQgc3RhdGUgPSB0aGlzLmdldEV4ZWN1dGlvblN0YXRlKHRoaXMuX3Jvb3RBY3Rpdml0eSk7XG4gICAgICAgIGZvciAobGV0IGFyZyBvZiBhcmdzKSB7XG4gICAgICAgICAgICBpZiAoaXMuYWN0aXZpdHkoYXJnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2luaXRpYWxpemUodGhpcy5fcm9vdEFjdGl2aXR5LCBhcmcsIGMpO1xuICAgICAgICAgICAgICAgIHN0YXRlLmNoaWxkSW5zdGFuY2VJZHMuYWRkKHRoaXMuZ2V0SW5zdGFuY2VJZChhcmcpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFyZ3VtZW50ICdhcmdzJyB2YWx1ZSBpcyBub3QgYW4gYXJyYXkuXCIpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGZyb21JZDogY3Vyck1heCxcbiAgICAgICAgdG9JZDogdGhpcy5fbmV4dEFjdGl2aXR5SWRcbiAgICB9O1xufTtcblxuQWN0aXZpdHlFeGVjdXRpb25Db250ZXh0LnByb3RvdHlwZS5yZW1vdmVGcm9tQ29udGV4dCA9IGZ1bmN0aW9uIChyZW1vdmVUb2tlbikge1xuICAgIHRoaXMuX2NoZWNrSW5pdCgpO1xuXG4gICAgaWYgKHJlbW92ZVRva2VuICYmICFfLmlzVW5kZWZpbmVkKHJlbW92ZVRva2VuLmZyb21JZCkgJiYgIV8uaXNVbmRlZmluZWQocmVtb3ZlVG9rZW4udG9JZCkpIHtcbiAgICAgICAgbGV0IHN0YXRlID0gdGhpcy5nZXRFeGVjdXRpb25TdGF0ZSh0aGlzLl9yb290QWN0aXZpdHkpO1xuXG4gICAgICAgIGZvciAobGV0IGlkID0gcmVtb3ZlVG9rZW4uZnJvbUlkOyBpZCA8PSByZW1vdmVUb2tlbi50b0lkOyBpZCsrKSB7XG4gICAgICAgICAgICBsZXQgc2lkID0gaWQudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIHRoaXMuX2tub3duQWN0aXZpdGllcy5kZWxldGUoc2lkKTtcbiAgICAgICAgICAgIHRoaXMuX2FjdGl2aXR5U3RhdGVzLmRlbGV0ZShzaWQpO1xuICAgICAgICAgICAgc3RhdGUuY2hpbGRJbnN0YW5jZUlkcy5kZWxldGUoc2lkKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFyZ3VtZW50ICdyZW1vdmVUb2tlbicgdmFsdWUgaXMgbm90IGEgdmFsaWQgcmVtb3ZlIHRva2VuIG9iamVjdC5cIik7XG4gICAgfVxuXG4gICAgdGhpcy5fbmV4dEFjdGl2aXR5SWQgPSByZW1vdmVUb2tlbi5mcm9tSWQ7XG59O1xuXG5BY3Rpdml0eUV4ZWN1dGlvbkNvbnRleHQucHJvdG90eXBlLl9jaGVja0luaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCF0aGlzLl9yb290QWN0aXZpdHkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ29udGV4dCBpcyBub3QgaW5pdGlhbGl6ZWQuXCIpO1xuICAgIH1cbn07XG5cbkFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dC5wcm90b3R5cGUuX2luaXRpYWxpemUgPSBmdW5jdGlvbiAocGFyZW50LCBhY3Rpdml0eSwgaWRDb3VudGVyKSB7XG4gICAgbGV0IGFjdGl2aXR5SWQgPSB0aGlzLmdldEluc3RhbmNlSWQoYWN0aXZpdHksIHRydWUpO1xuICAgIGxldCBuZXh0SWQgPSAoaWRDb3VudGVyLmluc3RhbmNlSWQrKykudG9TdHJpbmcoKTtcbiAgICBpZiAoIWFjdGl2aXR5SWQpIHtcbiAgICAgICAgYWN0aXZpdHlJZCA9IG5leHRJZDtcbiAgICAgICAgdGhpcy5zZXRJbnN0YW5jZUlkKGFjdGl2aXR5LCBhY3Rpdml0eUlkKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoYWN0aXZpdHlJZCAhPT0gbmV4dElkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFjdGl2aXR5IFwiICsgYWN0aXZpdHkgKyBcIiBoYXMgYmVlbiBhc3NpZ25lZCB0byBhbiBvdGhlciBjb250ZXh0IGluIGEgZGlmZmVyZW50IHRyZWUgd2hpY2ggaXMgbm90IGFsbG93ZWQuXCIpO1xuICAgIH1cblxuICAgIHRoaXMuX25leHRBY3Rpdml0eUlkID0gaWRDb3VudGVyLmluc3RhbmNlSWQ7XG4gICAgbGV0IHN0YXRlID0gdGhpcy5nZXRFeGVjdXRpb25TdGF0ZShhY3Rpdml0eUlkKTtcbiAgICBzdGF0ZS5wYXJlbnRJbnN0YW5jZUlkID0gcGFyZW50ID8gdGhpcy5nZXRJbnN0YW5jZUlkKHBhcmVudCkgOiBudWxsO1xuICAgIHRoaXMuX2tub3duQWN0aXZpdGllcy5zZXQoYWN0aXZpdHlJZCwgYWN0aXZpdHkpO1xuXG4gICAgZm9yIChsZXQgY2hpbGQgb2YgYWN0aXZpdHkuaW1tZWRpYXRlQ2hpbGRyZW4odGhpcykpIHtcbiAgICAgICAgdGhpcy5faW5pdGlhbGl6ZShhY3Rpdml0eSwgY2hpbGQsIGlkQ291bnRlcik7XG4gICAgICAgIHN0YXRlLmNoaWxkSW5zdGFuY2VJZHMuYWRkKHRoaXMuZ2V0SW5zdGFuY2VJZChjaGlsZCkpO1xuICAgIH1cbn07XG5cbkFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dC5wcm90b3R5cGUuZ2V0RXhlY3V0aW9uU3RhdGUgPSBmdW5jdGlvbiAoaWRPckFjdGl2aXR5KSB7XG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuXG4gICAgbGV0IGlkO1xuICAgIGlmIChfLmlzU3RyaW5nKGlkT3JBY3Rpdml0eSkpIHtcbiAgICAgICAgaWQgPSBpZE9yQWN0aXZpdHk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGlzLmFjdGl2aXR5KGlkT3JBY3Rpdml0eSkpIHtcbiAgICAgICAgaWQgPSBzZWxmLmdldEluc3RhbmNlSWQoaWRPckFjdGl2aXR5KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgZ2V0IHN0YXRlIG9mIFwiICsgaWRPckFjdGl2aXR5KTtcbiAgICB9XG4gICAgbGV0IHN0YXRlID0gc2VsZi5fYWN0aXZpdHlTdGF0ZXMuZ2V0KGlkKTtcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChzdGF0ZSkpIHtcbiAgICAgICAgc3RhdGUgPSBuZXcgQWN0aXZpdHlFeGVjdXRpb25TdGF0ZShpZCk7XG4gICAgICAgIHN0YXRlLm9uKFxuICAgICAgICAgICAgZW51bXMuYWN0aXZpdHlTdGF0ZXMucnVuLFxuICAgICAgICAgICAgZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmVtaXQoZW51bXMuYWN0aXZpdHlTdGF0ZXMucnVuLCBhcmdzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICBzdGF0ZS5vbihcbiAgICAgICAgICAgIGVudW1zLmFjdGl2aXR5U3RhdGVzLmVuZCxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5lbWl0KGVudW1zLmFjdGl2aXR5U3RhdGVzLmVuZCwgYXJncyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgc2VsZi5fYWN0aXZpdHlTdGF0ZXMuc2V0KGlkLCBzdGF0ZSk7XG4gICAgfVxuICAgIHJldHVybiBzdGF0ZTtcbn07XG5cbkFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dC5wcm90b3R5cGUuX2dldEtub3duQWN0aXZpdHkgPSBmdW5jdGlvbiAoYWN0aXZpdHlJZCkge1xuICAgIGxldCBhY3Rpdml0eSA9IHRoaXMuX2tub3duQWN0aXZpdGllcy5nZXQoYWN0aXZpdHlJZCk7XG4gICAgaWYgKCFhY3Rpdml0eSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLkFjdGl2aXR5UnVudGltZUVycm9yKFwiQWN0aXZpdHkgYnkgaWQgJ1wiICsgYWN0aXZpdHlJZCArIFwiJyBub3QgZm91bmQuXCIpO1xuICAgIH1cbiAgICByZXR1cm4gYWN0aXZpdHk7XG59O1xuXG5BY3Rpdml0eUV4ZWN1dGlvbkNvbnRleHQucHJvdG90eXBlLmNyZWF0ZUJvb2ttYXJrID0gZnVuY3Rpb24gKGFjdGl2aXR5SWQsIG5hbWUsIGVuZENhbGxiYWNrKSB7XG4gICAgdGhpcy5yZWdpc3RlckJvb2ttYXJrKFxuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgaW5zdGFuY2VJZDogYWN0aXZpdHlJZCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS5nZXRUaW1lKCksXG4gICAgICAgICAgICBlbmRDYWxsYmFjazogZW5kQ2FsbGJhY2tcbiAgICAgICAgfSk7XG4gICAgcmV0dXJuIG5hbWU7XG59O1xuXG5BY3Rpdml0eUV4ZWN1dGlvbkNvbnRleHQucHJvdG90eXBlLnJlZ2lzdGVyQm9va21hcmsgPSBmdW5jdGlvbiAoYm9va21hcmspIHtcbiAgICBsZXQgYm0gPSB0aGlzLl9ib29rbWFya3MuZ2V0KGJvb2ttYXJrLm5hbWUpO1xuICAgIGlmIChibSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLkFjdGl2aXR5UnVudGltZUVycm9yKFwiQm9va21hcmsgJ1wiICsgYm9va21hcmsubmFtZSArIFwiJyBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgfVxuICAgIHRoaXMuX2Jvb2ttYXJrcy5zZXQoYm9va21hcmsubmFtZSwgYm9va21hcmspO1xufTtcblxuQWN0aXZpdHlFeGVjdXRpb25Db250ZXh0LnByb3RvdHlwZS5pc0Jvb2ttYXJrRXhpc3RzID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICByZXR1cm4gdGhpcy5fYm9va21hcmtzLmhhcyhuYW1lKTtcbn07XG5cbkFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dC5wcm90b3R5cGUuZ2V0Qm9va21hcmtUaW1lc3RhbXAgPSBmdW5jdGlvbiAobmFtZSwgdGhyb3dJZk5vdEZvdW5kKSB7XG4gICAgbGV0IGJtID0gdGhpcy5fYm9va21hcmtzLmdldChuYW1lKTtcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChibSkgJiYgdGhyb3dJZk5vdEZvdW5kKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkJvb2ttYXJrICdcIiArIG5hbWUgKyBcIicgbm90IGZvdW5kLlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGJtID8gYm0udGltZXN0YW1wIDogbnVsbDtcbn07XG5cbkFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dC5wcm90b3R5cGUuZGVsZXRlQm9va21hcmsgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgIHRoaXMuX2Jvb2ttYXJrcy5kZWxldGUobmFtZSk7XG59O1xuXG5BY3Rpdml0eUV4ZWN1dGlvbkNvbnRleHQucHJvdG90eXBlLm5vb3BDYWxsYmFja3MgPSBmdW5jdGlvbiAoYm9va21hcmtOYW1lcykge1xuICAgIGZvciAobGV0IG5hbWUgb2YgYm9va21hcmtOYW1lcykge1xuICAgICAgICBsZXQgYm0gPSB0aGlzLl9ib29rbWFya3MuZ2V0KG5hbWUpO1xuICAgICAgICBpZiAoYm0pIHtcbiAgICAgICAgICAgIGJtLmVuZENhbGxiYWNrID0gXy5ub29wO1xuICAgICAgICB9XG4gICAgfVxufTtcblxuQWN0aXZpdHlFeGVjdXRpb25Db250ZXh0LnByb3RvdHlwZS5yZXN1bWVCb29rbWFya0luU2NvcGUgPSBmdW5jdGlvbiAoY2FsbENvbnRleHQsIG5hbWUsIHJlYXNvbiwgcmVzdWx0KSB7XG4gICAgbGV0IGJtID0gdGhpcy5fYm9va21hcmtzLmdldChuYW1lKTtcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChibSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQm9va21hcmsgJ1wiICsgbmFtZSArIFwiJyBkb2Vzbid0IGV4aXN0cy4gQ2Fubm90IGNvbnRpbnVlIHdpdGggcmVhc29uOiBcIiArIHJlYXNvbiArIFwiLlwiKTtcbiAgICB9XG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgIHJldHVybiBuZXcgQmx1ZWJpcmQoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBzZXRJbW1lZGlhdGUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBibSA9IHNlbGYuX2Jvb2ttYXJrcy5nZXQobmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKGJtKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIElmIGJtIGlzIHN0aWxsIGV4aXN0cy5cbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fZG9SZXN1bWVCb29rbWFyayhjYWxsQ29udGV4dCwgYm0sIHJlYXNvbiwgcmVzdWx0LCByZWFzb24gPT09IGVudW1zLmFjdGl2aXR5U3RhdGVzLmlkbGUpO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn07XG5cbkFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dC5wcm90b3R5cGUucmVzdW1lQm9va21hcmtJbnRlcm5hbCA9IGZ1bmN0aW9uIChjYWxsQ29udGV4dCwgbmFtZSwgcmVhc29uLCByZXN1bHQpIHtcbiAgICBsZXQgYm0gPSB0aGlzLl9ib29rbWFya3MuZ2V0KG5hbWUpO1xuICAgIHRoaXMuX3Jlc3VtZUJNUXVldWUuZW5xdWV1ZShuYW1lLCByZWFzb24sIHJlc3VsdCk7XG59O1xuXG5BY3Rpdml0eUV4ZWN1dGlvbkNvbnRleHQucHJvdG90eXBlLnJlc3VtZUJvb2ttYXJrRXh0ZXJuYWwgPSBmdW5jdGlvbiAobmFtZSwgcmVhc29uLCByZXN1bHQpIHtcbiAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgbGV0IGJtID0gc2VsZi5fYm9va21hcmtzLmdldChuYW1lKTtcbiAgICBpZiAoIWJtKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcnMuQm9va21hcmtOb3RGb3VuZEVycm9yKFwiSW50ZXJuYWwgcmVzdW1lIGJvb2ttYXJrIHJlcXVlc3QgY2Fubm90IGJlIHByb2Nlc3NlZCBiZWNhdXNlIGJvb2ttYXJrICdcIiArIG5hbWUgKyBcIicgZG9lc24ndCBleGlzdHMuXCIpO1xuICAgIH1cbiAgICBzZWxmLl9kb1Jlc3VtZUJvb2ttYXJrKG5ldyBDYWxsQ29udGV4dCh0aGlzLCBibS5pbnN0YW5jZUlkKSwgYm0sIHJlYXNvbiwgcmVzdWx0KTtcbn07XG5cbkFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dC5wcm90b3R5cGUucHJvY2Vzc1Jlc3VtZUJvb2ttYXJrUXVldWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgIGxldCBjb21tYW5kID0gc2VsZi5fcmVzdW1lQk1RdWV1ZS5kZXF1ZXVlKCk7XG4gICAgaWYgKGNvbW1hbmQpIHtcbiAgICAgICAgbGV0IGJtID0gc2VsZi5fYm9va21hcmtzLmdldChjb21tYW5kLm5hbWUpO1xuICAgICAgICBpZiAoIWJtKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLkJvb2ttYXJrTm90Rm91bmRFcnJvcihcIkludGVybmFsIHJlc3VtZSBib29rbWFyayByZXF1ZXN0IGNhbm5vdCBiZSBwcm9jZXNzZWQgYmVjYXVzZSBib29rbWFyayAnXCIgKyBjb21tYW5kLm5hbWUgKyBcIicgZG9lc24ndCBleGlzdHMuXCIpO1xuICAgICAgICB9XG4gICAgICAgIHNlbGYuX2RvUmVzdW1lQm9va21hcmsobmV3IENhbGxDb250ZXh0KHRoaXMsIGJtLmluc3RhbmNlSWQpLCBibSwgY29tbWFuZC5yZWFzb24sIGNvbW1hbmQucmVzdWx0KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn07XG5cbkFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dC5wcm90b3R5cGUuX2RvUmVzdW1lQm9va21hcmsgPSBmdW5jdGlvbiAoY2FsbENvbnRleHQsIGJvb2ttYXJrLCByZWFzb24sIHJlc3VsdCwgbm9SZW1vdmUpIHtcbiAgICBsZXQgc2NvcGUgPSBjYWxsQ29udGV4dC5zY29wZTtcbiAgICBpZiAoIW5vUmVtb3ZlKSB7XG4gICAgICAgIHRoaXMuX2Jvb2ttYXJrcy5kZWxldGUoYm9va21hcmsubmFtZSk7XG4gICAgfVxuICAgIGxldCBjYiA9IGJvb2ttYXJrLmVuZENhbGxiYWNrO1xuICAgIGlmIChfLmlzU3RyaW5nKGNiKSkge1xuICAgICAgICBjYiA9IHNjb3BlW2Jvb2ttYXJrLmVuZENhbGxiYWNrXTtcbiAgICAgICAgaWYgKCFfLmlzRnVuY3Rpb24oY2IpKSB7XG4gICAgICAgICAgICBjYiA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIWNiKSB7XG4gICAgICAgIHRocm93IG5ldyBlcnJvcnMuQWN0aXZpdHlSdW50aW1lRXJyb3IoXCJCb29rbWFyaydzICdcIiArIGJvb2ttYXJrLm5hbWUgKyBcIicgY2FsbGJhY2sgJ1wiICsgYm9va21hcmsuZW5kQ2FsbGJhY2sgKyBcIicgaXMgbm90IGRlZmluZWQgb24gdGhlIGN1cnJlbnQgc2NvcGUuXCIpO1xuICAgIH1cblxuICAgIGNiLmNhbGwoc2NvcGUsIGNhbGxDb250ZXh0LCByZWFzb24sIHJlc3VsdCwgYm9va21hcmspO1xufTtcblxuQWN0aXZpdHlFeGVjdXRpb25Db250ZXh0LnByb3RvdHlwZS5jYW5jZWxFeGVjdXRpb24gPSBmdW5jdGlvbiAoc2NvcGUsIGFjdGl2aXR5SWRzKSB7XG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgIGxldCBhbGxJZHMgPSBuZXcgU2V0KCk7XG4gICAgZm9yIChsZXQgaWQgb2YgYWN0aXZpdHlJZHMpIHtcbiAgICAgICAgc2VsZi5fY2FuY2VsU3VidHJlZShzY29wZSwgYWxsSWRzLCBpZCk7XG4gICAgfVxuICAgIGZvciAobGV0IGJtIG9mIHNlbGYuX2Jvb2ttYXJrcy52YWx1ZXMoKSkge1xuICAgICAgICBpZiAoYWxsSWRzLmhhcyhibS5pbnN0YW5jZUlkKSkge1xuICAgICAgICAgICAgc2VsZi5fYm9va21hcmtzLmRlbGV0ZShibS5uYW1lKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbkFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dC5wcm90b3R5cGUuX2NhbmNlbFN1YnRyZWUgPSBmdW5jdGlvbiAoc2NvcGUsIGFsbElkcywgYWN0aXZpdHlJZCkge1xuICAgIGxldCBzZWxmID0gdGhpcztcbiAgICBhbGxJZHMuYWRkKGFjdGl2aXR5SWQpO1xuICAgIGxldCBzdGF0ZSA9IHNlbGYuZ2V0RXhlY3V0aW9uU3RhdGUoYWN0aXZpdHlJZCk7XG4gICAgZm9yIChsZXQgaWQgb2Ygc3RhdGUuY2hpbGRJbnN0YW5jZUlkcy52YWx1ZXMoKSkge1xuICAgICAgICBzZWxmLl9jYW5jZWxTdWJ0cmVlKHNjb3BlLCBhbGxJZHMsIGlkKTtcbiAgICB9XG4gICAgc3RhdGUucmVwb3J0U3RhdGUoZW51bXMuYWN0aXZpdHlTdGF0ZXMuY2FuY2VsLCBudWxsLCBzY29wZSk7XG59O1xuXG5BY3Rpdml0eUV4ZWN1dGlvbkNvbnRleHQucHJvdG90eXBlLmRlbGV0ZVNjb3BlT2ZBY3Rpdml0eSA9IGZ1bmN0aW9uIChjYWxsQ29udGV4dCwgYWN0aXZpdHlJZCkge1xuICAgIHRoaXMuX3Njb3BlVHJlZS5kZWxldGVTY29wZVBhcnQoY2FsbENvbnRleHQuaW5zdGFuY2VJZCwgYWN0aXZpdHlJZCk7XG59O1xuXG5BY3Rpdml0eUV4ZWN1dGlvbkNvbnRleHQucHJvdG90eXBlLmVtaXRXb3JrZmxvd0V2ZW50ID0gZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICB0aGlzLmVtaXQoZW51bXMuZXZlbnRzLndvcmtmbG93RXZlbnQsIGFyZ3MpO1xufTtcblxuLyogU0VSSUFMSVpBVElPTiAqL1xuXG5BY3Rpdml0eUV4ZWN1dGlvbkNvbnRleHQucHJvdG90eXBlLmdldFN0YXRlQW5kUHJvbW90aW9ucyA9IGZ1bmN0aW9uIChzZXJpYWxpemVyLCBlbmFibGVQcm9tb3Rpb25zKSB7XG4gICAgaWYgKHNlcmlhbGl6ZXIgJiYgIV8uaXNGdW5jdGlvbihzZXJpYWxpemVyLnRvSlNPTikpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFyZ3VtZW50ICdzZXJpYWxpemVyJyBpcyBub3QgYSBzZXJpYWxpemVyLlwiKTtcbiAgICB9XG5cbiAgICBsZXQgYWN0aXZpdHlTdGF0ZXMgPSBuZXcgTWFwKCk7XG4gICAgZm9yIChsZXQgcyBvZiB0aGlzLl9hY3Rpdml0eVN0YXRlcy52YWx1ZXMoKSkge1xuICAgICAgICBhY3Rpdml0eVN0YXRlcy5zZXQocy5pbnN0YW5jZUlkLCBzLmFzSlNPTigpKTtcbiAgICB9XG5cbiAgICBsZXQgc2NvcGVTdGF0ZUFuZFByb21vdGlvbnMgPSB0aGlzLl9zY29wZVRyZWUuZ2V0RXhlY3V0aW9uU3RhdGUodGhpcywgZW5hYmxlUHJvbW90aW9ucywgc2VyaWFsaXplcik7XG5cbiAgICBsZXQgc2VyaWFsaXplZDtcbiAgICBpZiAoc2VyaWFsaXplcikge1xuICAgICAgICBzZXJpYWxpemVkID0gc2VyaWFsaXplci50b0pTT04oe1xuICAgICAgICAgICAgYWN0aXZpdHlTdGF0ZXM6IGFjdGl2aXR5U3RhdGVzLFxuICAgICAgICAgICAgYm9va21hcmtzOiB0aGlzLl9ib29rbWFya3MsXG4gICAgICAgICAgICBzY29wZTogc2NvcGVTdGF0ZUFuZFByb21vdGlvbnMuc3RhdGVcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBzZXJpYWxpemVkID0ge1xuICAgICAgICAgICAgYWN0aXZpdHlTdGF0ZXM6IGNvbnZlcnRlcnMubWFwVG9BcnJheShhY3Rpdml0eVN0YXRlcyksXG4gICAgICAgICAgICBib29rbWFya3M6IGNvbnZlcnRlcnMubWFwVG9BcnJheSh0aGlzLl9ib29rbWFya3MpLFxuICAgICAgICAgICAgc2NvcGU6IHNjb3BlU3RhdGVBbmRQcm9tb3Rpb25zLnN0YXRlXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdGU6IHNlcmlhbGl6ZWQsXG4gICAgICAgIHByb21vdGVkUHJvcGVydGllczogc2NvcGVTdGF0ZUFuZFByb21vdGlvbnMucHJvbW90ZWRQcm9wZXJ0aWVzXG4gICAgfTtcbn07XG5cbkFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dC5wcm90b3R5cGUuc2V0U3RhdGUgPSBmdW5jdGlvbiAoc2VyaWFsaXplciwganNvbikge1xuICAgIGlmIChzZXJpYWxpemVyICYmICFfLmlzRnVuY3Rpb24oc2VyaWFsaXplci5mcm9tSlNPTikpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFyZ3VtZW50ICdzZXJpYWxpemVyJyBpcyBub3QgYSBzZXJpYWxpemVyLlwiKTtcbiAgICB9XG4gICAgaWYgKCFfLmlzT2JqZWN0KGpzb24pKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJBcmd1bWVudCAnanNvbicgaXMgbm90IGFuIG9iamVjdC5cIik7XG4gICAgfVxuXG4gICAgaWYgKHNlcmlhbGl6ZXIpIHtcbiAgICAgICAganNvbiA9IHNlcmlhbGl6ZXIuZnJvbUpTT04oanNvbik7XG4gICAgICAgIGlmICghKGpzb24uYWN0aXZpdHlTdGF0ZXMgaW5zdGFuY2VvZiBNYXApKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiYWN0aXZpdHlTdGF0ZXMgcHJvcGVydHkgdmFsdWUgb2YgYXJndW1lbnQgJ2pzb24nIGlzIG5vdCBhbiBNYXAgaW5zdGFuY2UuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghKGpzb24uYm9va21hcmtzIGluc3RhbmNlb2YgTWFwKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkJvb2ttYXJrcyBwcm9wZXJ0eSB2YWx1ZSBvZiBhcmd1bWVudCAnanNvbicgaXMgbm90IGFuIE1hcCBpbnN0YW5jZS5cIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmICghanNvbi5hY3Rpdml0eVN0YXRlcykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcImFjdGl2aXR5U3RhdGVzIHByb3BlcnR5IHZhbHVlIG9mIGFyZ3VtZW50ICdqc29uJyBpcyBub3QgYW4gb2JqZWN0LlwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWpzb24uYm9va21hcmtzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQm9va21hcmtzIHByb3BlcnR5IHZhbHVlIG9mIGFyZ3VtZW50ICdqc29uJyBpcyBub3QgYW4gb2JqZWN0LlwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGpzb24gPSB7XG4gICAgICAgICAgICBhY3Rpdml0eVN0YXRlczogY29udmVydGVycy5hcnJheVRvTWFwKGpzb24uYWN0aXZpdHlTdGF0ZXMpLFxuICAgICAgICAgICAgYm9va21hcmtzOiBjb252ZXJ0ZXJzLmFycmF5VG9NYXAoanNvbi5ib29rbWFya3MpLFxuICAgICAgICAgICAgc2NvcGU6IGpzb24uc2NvcGVcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBzIG9mIHRoaXMuX2FjdGl2aXR5U3RhdGVzLnZhbHVlcygpKSB7XG4gICAgICAgIGxldCBzdG9yZWQgPSBqc29uLmFjdGl2aXR5U3RhdGVzLmdldChzLmluc3RhbmNlSWQpO1xuICAgICAgICBpZiAoXy5pc1VuZGVmaW5lZChzdG9yZWQpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBY3Rpdml0eSdzIG9mICdcIiArIHMuaW5zdGFuY2VJZCArIFwiJyBzdGF0ZSBub3QgZm91bmQuXCIpO1xuICAgICAgICB9XG4gICAgICAgIHMuZnJvbUpTT04oc3RvcmVkKTtcbiAgICB9XG5cbiAgICB0aGlzLl9ib29rbWFya3MgPSBqc29uLmJvb2ttYXJrcztcbiAgICB0aGlzLl9zY29wZVRyZWUuc2V0U3RhdGUoanNvbi5zY29wZSwgc2VyaWFsaXplcik7XG59O1xuLyogU0VSSUFMSVpBVElPTiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IEFjdGl2aXR5RXhlY3V0aW9uQ29udGV4dDsiXX0=
