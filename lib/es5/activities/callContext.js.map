{"version":3,"sources":["activities/callContext.js"],"names":[],"mappings":"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","file":"activities/callContext.js","sourcesContent":["\"use strict\";\n\nlet common = require(\"../common\");\nlet is = common.is;\nlet _ = require(\"lodash\");\n\nfunction CallContext(executionContext, activityOrActivityId, scope) {\n    this._executionContext = executionContext;\n    this._activity = activityOrActivityId ? this._asActivity(activityOrActivityId) : null;\n    this._activityInstanceId = this._activity ? this._activity.instanceId : null;\n    this._scope = scope ? scope : null;\n    this._executionState = null;\n    this._scopePart = null;\n}\n\nObject.defineProperties(\n    CallContext.prototype,\n    {\n        instanceId: {\n            get: function () {\n                return this._activityInstanceId;\n            }\n        },\n        _parentActivityId: {\n            get: function () {\n                if (!this._activity) {\n                    return null;\n                }\n                let state = this._executionContext.getExecutionState(this.instanceId);\n                return state.parentInstanceId;\n            }\n        },\n        _scopeTree: {\n            get: function () {\n                return this._executionContext._scopeTree;\n            }\n        },\n        activity: {\n            get: function () {\n                return this._activity;\n            }\n        },\n        executionContext: {\n            get: function () {\n                return this._executionContext;\n            }\n        },\n        executionState: {\n            get: function () {\n                return this._executionState || (this._activity ? (this._executionState = this._executionContext.getExecutionState(this.instanceId)) : null);\n            }\n        },\n        scope: {\n            get: function () {\n                return this._scope || (this._scope = this._scopeTree.find(this.instanceId));\n            }\n        }\n    }\n);\n\nCallContext.prototype.next = function (childActivityOrActivityId, variables) {\n    let child = this._asActivity(childActivityOrActivityId);\n    let part = child.createScopePart();\n    if (_.isObject(variables)) {\n        _.extend(part, variables);\n    }\n    return new CallContext(\n        this._executionContext,\n        child,\n        this._scopeTree.next(this.instanceId, child.instanceId, part, child.id));\n};\n\nCallContext.prototype.back = function (keepScope) {\n    let parentId = this._parentActivityId;\n    if (parentId) {\n        return new CallContext(\n            this._executionContext,\n            parentId,\n            this._scopeTree.back(this.instanceId, keepScope));\n    }\n    else {\n        return null;\n    }\n};\n\nCallContext.prototype._asActivity = function (activityOrActivityId) {\n    return is.activity(activityOrActivityId) ? activityOrActivityId : this._executionContext._getKnownActivity(activityOrActivityId);\n};\n\n/* Callbacks */\n\nCallContext.prototype.complete = function (result) {\n    this.activity.complete(this, result);\n};\n\nCallContext.prototype.cancel = function () {\n    this.activity.cancel(this);\n};\n\nCallContext.prototype.idle = function () {\n    this.activity.idle(this);\n};\n\nCallContext.prototype.fail = function (e) {\n    this.activity.fail(this, e);\n};\n\nCallContext.prototype.end = function (reason, result) {\n    this.activity.end(this, reason, result);\n};\n\nCallContext.prototype.emitWorkflowEvent = function (args) {\n    this.executionContext.emitWorkflowEvent(args);\n};\n\nCallContext.prototype.schedule = function (obj, endcallback) {\n    this.activity.schedule(this, obj, endcallback);\n};\n\nCallContext.prototype.createBookmark = function (name, callback) {\n    return this._executionContext.createBookmark(this.instanceId, name, callback);\n};\n\nCallContext.prototype.resumeBookmark = function (name, reason, result) {\n    this._executionContext.resumeBookmarkInternal(this, name, reason, result);\n};\n\nmodule.exports = CallContext;\n"],"sourceRoot":"/source/"}