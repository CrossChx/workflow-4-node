{"version":3,"sources":["activities/activityMarkup.js"],"names":[],"mappings":"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","file":"activities/activityMarkup.js","sourcesContent":["\"use strict\";\n\n/* jshint -W061 */\n\nlet _ = require(\"lodash\");\nlet errors = require(\"../common/errors\");\nlet Activity = require(\"./activity\");\nlet is = require(\"../common/is\");\nlet path = require(\"path\");\nlet fs = require(\"fs\");\nlet Reflection = require(\"backpack-node\").system.Reflection;\nlet templateHelpers = require('./templateHelpers');\n\nconst activityTypeNameRex = /^\\@([a-zA-Z_]+[0-9a-zA-Z_]*)$/;\nfunction getActivityTypeName(str) {\n    if (_.isString(str)) {\n        let result = activityTypeNameRex.exec(str);\n        if (result && result.length === 2) {\n            return result[1];\n        }\n    }\n    return null;\n}\n\nfunction requireFromRoot(resource) {\n    try {\n        return require(resource);\n    }\n    catch (e) {\n        _.noop(e);\n    }\n    let pPos = resource.indexOf(\"/\");\n    if (pPos === -1) {\n        return require(resource);\n    }\n    let module = resource.substr(0, pPos);\n    if (!module) {\n        return require(resource);\n    }\n    try {\n        module = require(module);\n        let obj = module;\n        for (let key of resource.substr(pPos + 1).split(\"/\")) {\n            obj = obj[key];\n        }\n        return obj;\n    }\n    catch (e) {\n        return require(resource);\n    }\n}\n\nfunction ActivityMarkup() {\n    this._systemTypes = new Map();\n    this._registerSystemTypes();\n}\n\nActivityMarkup.prototype._registerSystemTypes = function () {\n    this._registerTypes(__dirname);\n};\n\nActivityMarkup.prototype._registerTypes = function (sourcePath) {\n    this._registerTypesTo(this._systemTypes, sourcePath);\n};\n\nActivityMarkup.prototype._registerTypesTo = function (types, sourcePath) {\n    let self = this;\n    let obj = requireFromRoot(sourcePath);\n    Reflection.visitObject(obj, function (inObj) {\n        let alias = self.getAlias(inObj);\n        if (alias && !types.has(alias)) {\n            // This is an activity type\n            types.set(alias, inObj);\n        }\n        return alias === null;\n    });\n};\n\nActivityMarkup.prototype.getAlias = function (type) {\n    if (_.isFunction(type) && !_.isUndefined(type.super_)) {\n        let alias = this._toCamelCase(type.name);\n        do\n        {\n            if (type.super_ === Activity) {\n                return alias;\n            }\n            type = type.super_;\n        }\n        while (type);\n    }\n    return null;\n};\n\nActivityMarkup.prototype._toCamelCase = function (id) {\n    return id[0].toLowerCase() + id.substr(1);\n};\n\nActivityMarkup.prototype.parse = function (markup) {\n    if (!markup) {\n        throw new TypeError(\"Parameter 'markup' expected.\");\n    }\n    if (_.isString(markup)) {\n        markup = JSON.parse(markup);\n    }\n    if (!_.isPlainObject(markup)) {\n        throw new TypeError(\"Parameter 'markup' is not a plain object.\");\n    }\n\n    let types = new Map();\n    for (let kvp of this._systemTypes.entries()) {\n        types.set(kvp[0], kvp[1]);\n    }\n    let req = markup[\"@require\"];\n    if (req) {\n        this._require(types, req);\n    }\n    let activity = this._createActivity(types, markup);\n    if (req) {\n        activity[\"@require\"] = req;\n    }\n    return activity;\n};\n\nActivityMarkup.prototype._createActivity = function (types, markup) {\n    let filedNames = _.filter(_.keys(markup), function (k) { return k !== \"@require\"; });\n    if (filedNames.length !== 1) {\n        throw new errors.ActivityMarkupError(\"There should be one field.\" + this._errorHint(markup));\n    }\n\n    let activityAlias = getActivityTypeName(filedNames[0]);\n    if (activityAlias) {\n        return this._createAndInitActivityInstance(types, activityAlias, markup);\n    }\n    else {\n        throw new errors.ActivityMarkupError(\"Root entry is not an activity type name '\" + filedNames[0] + \"'.\" + this._errorHint(markup));\n    }\n};\n\nActivityMarkup.prototype._createAndInitActivityInstance = function (types, typeName, markup) {\n    let activity = this._createActivityInstance(types, typeName);\n    if (!activity) {\n        throw new errors.ActivityMarkupError(\"Unknown activity type name '\" + typeName + \"'.\" + this._errorHint(markup));\n    }\n    let activityRef = {\n        name: typeName,\n        value: activity\n    };\n    let pars = markup[\"@\" + typeName];\n    if (pars) {\n        this._setupActivity(types, activityRef, pars);\n    }\n    return activityRef.value;\n};\n\nActivityMarkup.prototype._createActivityInstance = function (types, alias) {\n    let Constructor = types.get(alias);\n    if (_.isUndefined(Constructor)) {\n        return null;\n    }\n    return new Constructor();\n};\n\nActivityMarkup.prototype._setupActivity = function (types, activityRef, pars) {\n    let self = this;\n    let activity = activityRef.value;\n\n    function noFunction(fieldName) {\n        return activity.codeProperties.has(fieldName);\n    }\n\n    if (_.isArray(pars)) {\n        // args\n        activity.args = [];\n        for (let obj of pars) {\n            activity.args.push(self._createValue(types, obj, false, is.template(activity)));\n        }\n    }\n    else if (_.isObject(pars)) {\n        let to = null;\n        // values\n        for (let fieldName in pars) {\n            if (pars.hasOwnProperty(fieldName)) {\n                if (activity.isArrayProperty(fieldName)) {\n                    let v = self._createValue(types, pars[fieldName], true, is.template(activity));\n                    if (!_.isArray(v)) {\n                        v = [v];\n                    }\n                    activity[fieldName] = v;\n                }\n                else if (fieldName === \"@to\") {\n                    if (to) {\n                        throw new errors.ActivityMarkupError(\"Multiple to defined in activity '\" + activityRef.name + \".\" + this._errorHint(pars));\n                    }\n                    to = pars[fieldName];\n                }\n                else if (fieldName[0] === \"!\") {\n                    // Promoted:\n                    if (!activity.promotedProperties || !_.isFunction(activity.promoted)) {\n                        throw new errors.ActivityMarkupError(\"Activity '\" + activityRef.name + \" cannot have promoted properties.\" + this._errorHint(pars));\n                    }\n                    activity.promoted(fieldName.substr(1), self._createValue(types, pars[fieldName], true, is.template(activity)));\n                }\n                else if (fieldName[0] === \"`\") {\n                    // Reserved:\n                    if (!activity.reservedProperties || !_.isFunction(activity.reserved)) {\n                        throw new errors.ActivityMarkupError(\"Activity '\" + activityRef.name + \" cannot have reserved properties.\" + this._errorHint(pars));\n                    }\n                    activity.reserved(fieldName.substr(1), self._createValue(types, pars[fieldName], true, is.template(activity)));\n                }\n                else if (fieldName === \"@require\") {\n                    // Require:\n                    self._require(types, pars[fieldName]);\n                }\n                else {\n                    activity[fieldName] = self._createValue(types, pars[fieldName], false, is.template(activity), noFunction(fieldName));\n                }\n            }\n        }\n        if (to) {\n            let current = activity;\n            let assign = activityRef.value = this._createActivityInstance(types, \"assign\");\n            assign.value = current;\n            assign.to = to;\n        }\n    }\n    else {\n        // 1 arg\n        activity.args = [self._createValue(types, pars, false, is.template(activity))];\n    }\n};\n\nActivityMarkup.prototype._require = function (types, markup) {\n    let self = this;\n\n    if (_.isArray(markup)) {\n        for (let item of markup) {\n            self._require(types, item);\n        }\n    }\n    else if (_.isString(markup)) {\n        self._registerTypesTo(types, markup);\n    }\n    else {\n        throw new errors.ActivityMarkupError(\"Cannot register '\" + markup + \"'.\" + self._errorHint(markup));\n    }\n};\n\nActivityMarkup.prototype._createValue = function (types, markup, canBeArray, noTemplate, noFunction) {\n    let self = this;\n\n    // Helpers\n    function toTemplate(_markup) {\n        let template = self._createActivityInstance(types, \"template\");\n        template.declare = _markup;\n        return template;\n    }\n\n    function toFunc(f) {\n        let func = self._createActivityInstance(types, \"func\");\n        func.code = f;\n        return func;\n    }\n\n    function toExpression(str) {\n        let expr = self._createActivityInstance(types, \"expression\");\n        expr.expr = str;\n        return expr;\n    }\n\n    if (_.isArray(markup)) {\n        if (canBeArray) {\n            let result = [];\n            for (let v of markup) {\n                result.push(self._createValue(types, v));\n            }\n            return result;\n        }\n        else if (!noTemplate && templateHelpers.isTemplate(markup)) {\n            return toTemplate(markup);\n        }\n    }\n    else if (_.isPlainObject(markup)) {\n        let filedNames = _.keys(markup);\n        if (filedNames.length === 1) {\n            let fieldName = filedNames[0];\n            let fieldValue = markup[fieldName];\n\n            if (fieldName === \"_\") {\n                // Escape:\n                return fieldValue;\n            }\n\n            let activityTypeName = getActivityTypeName(fieldName);\n            if (activityTypeName) {\n                // Activity:\n                return self._createAndInitActivityInstance(types, activityTypeName, markup);\n            }\n        }\n\n        // Plain object:\n        if (!noTemplate && templateHelpers.isTemplate(markup)) {\n            return toTemplate(markup);\n        }\n    }\n    else if (_.isString(markup)) {\n        let str = markup.trim();\n        if (templateHelpers.isFunctionString(str)) {\n            let f;\n            eval(\"f = function(_){return (\" + str + \");}\");\n            f = f(_);\n            if (!noFunction) {\n                return toFunc(f);\n            }\n            else {\n                return f; // aka when func.code\n            }\n        }\n        else if (str.length > 1) {\n            if (str[0] === \"=\") {\n                // Expression\n                return toExpression(str.substr(1));\n            }\n        }\n    }\n    else if (_.isFunction(markup)) {\n        if (!noFunction) {\n            return toFunc(markup);\n        }\n    }\n\n    return this._clone(markup);\n};\n\nActivityMarkup.prototype._clone = function(obj) {\n    return templateHelpers.cloneDeep(obj);\n};\n\nActivityMarkup.prototype._errorHint = function (markup) {\n    let len = 20;\n    let json = JSON.stringify(markup);\n    if (json.length > len) {\n        json = json.substr(0, len) + \" ...\";\n    }\n    return \"\\nSee error near:\\n\" + json;\n};\n\nActivityMarkup.prototype.stringify = function (obj) {\n    if (_.isString(obj)) {\n        return obj;\n    }\n    if (is.activity(obj)) {\n        obj = this.toMarkup(obj);\n    }\n    if (!_.isPlainObject(obj)) {\n        throw new TypeError(\"Parameter 'obj' is not a plain object.\");\n    }\n    let cloned = _.cloneDeep(obj);\n    this._functionsToString(cloned);\n    return JSON.stringify(cloned);\n};\n\nActivityMarkup.prototype._functionsToString = function (obj) {\n    let self = this;\n    for (let fieldName in obj) {\n        let fieldValue = obj[fieldName];\n        if (_.isFunction(fieldValue)) {\n            obj[fieldName] = fieldValue.toString();\n        }\n        else if (_.isObject(fieldValue)) {\n            self._functionsToString(fieldValue);\n        }\n        else if (_.isArray(fieldValue)) {\n            for (let v of fieldValue) {\n                self._functionsToString(v);\n            }\n        }\n    }\n};\n\n// To Markup:\n\nActivityMarkup.prototype.toMarkup = function (activity) {\n    /*if (!is.activity(activity)) {\n        throw new TypeError(\"Argument is not an activity instance.\");\n    }\n    let markup = {};\n    let alias = this.getAlias(activity.constructor);\n    let activityMarkup = this._createMarkupOfActivity(activity);*/\n    throw new Error(\"Not supported yet!\");\n};\n\n// Exports:\n\nlet activityMarkup = null;\n\nmodule.exports = {\n    parse: function (markup) {\n        return (activityMarkup = (activityMarkup || new ActivityMarkup())).parse(markup);\n    },\n\n    toMarkup: function (activity) {\n        return (activityMarkup = (activityMarkup || new ActivityMarkup())).toMarkup(activity);\n    },\n\n    stringify: function (obj) {\n        return (activityMarkup = (activityMarkup || new ActivityMarkup())).stringify(obj);\n    },\n\n    getAlias: function (activity) {\n        return (activityMarkup = (activityMarkup || new ActivityMarkup())).getAlias(activity.constructor);\n    }\n};"],"sourceRoot":"/source/"}