"use strict";
"use strict";
var Activity = require("./activity");
var util = require("util");
var StrSet = require("backpack-node").collections.StrSet;
var is = require("../common/is");
function Declarator() {
  Activity.call(this);
  this.nonScopedProperties.add("reservedProperties");
  this.nonScopedProperties.add("reserved");
  this.nonScopedProperties.add("promotedProperties");
  this.nonScopedProperties.add("promoted");
  this.nonScopedProperties.add("varsDeclared");
  this.reservedProperties = new StrSet();
  this.promotedProperties = new StrSet();
}
util.inherits(Declarator, Activity);
Declarator.prototype.reserved = function(name, value) {
  if (this.promotedProperties.exists(name)) {
    throw new Error("Property '" + name + "' cannot be reserved because it's promoted.");
  }
  if (is.defined(value)) {
    this[name] = value;
  }
  this.reservedProperties.add(name);
};
Activity.prototype.promoted = function(name, value) {
  if (this.reservedProperties.exists(name)) {
    throw new Error("Property '" + name + "' cannot be promoted because it's reserved.");
  }
  if (is.defined(value)) {
    this[name] = value;
  }
  this.promotedProperties.add(name);
};
Declarator.prototype.run = function(callContext, args) {
  var self = this;
  var activityVariables = [];
  var _activityVariableFieldNames = [];
  self.set("_activityVariableFieldNames", _activityVariableFieldNames);
  var resProps = callContext.activity.reservedProperties;
  var $__3 = true;
  var $__4 = false;
  var $__5 = undefined;
  try {
    for (var $__1 = void 0,
        $__0 = (callContext.activity._getScopeKeys())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__3 = ($__1 = $__0.next()).done); $__3 = true) {
      var fieldName = $__1.value;
      {
        if (!resProps.exists(fieldName)) {
          var fieldValue = self.get(fieldName);
          if (fieldValue instanceof Activity) {
            activityVariables.push(fieldValue);
            _activityVariableFieldNames.push(fieldName);
          }
        }
      }
    }
  } catch ($__6) {
    $__4 = true;
    $__5 = $__6;
  } finally {
    try {
      if (!$__3 && $__0.return != null) {
        $__0.return();
      }
    } finally {
      if ($__4) {
        throw $__5;
      }
    }
  }
  if (activityVariables.length) {
    self.set("_savedArgs", args);
    callContext.schedule(activityVariables, "_varsGot");
  } else {
    self.delete("_activityVariableFieldNames");
    callContext.activity.varsDeclared.call(self, callContext, args);
  }
};
Declarator.prototype._varsGot = function(callContext, reason, result) {
  var self = this;
  if (reason === Activity.states.complete) {
    var idx = 0;
    var $__3 = true;
    var $__4 = false;
    var $__5 = undefined;
    try {
      for (var $__1 = void 0,
          $__0 = (self.get("_activityVariableFieldNames"))[$traceurRuntime.toProperty(Symbol.iterator)](); !($__3 = ($__1 = $__0.next()).done); $__3 = true) {
        var fieldName = $__1.value;
        {
          self.set(fieldName, result[idx++]);
        }
      }
    } catch ($__6) {
      $__4 = true;
      $__5 = $__6;
    } finally {
      try {
        if (!$__3 && $__0.return != null) {
          $__0.return();
        }
      } finally {
        if ($__4) {
          throw $__5;
        }
      }
    }
    var args = self.get("_savedArgs");
    self.delete("_savedArgs");
    self.delete("_activityVariableFieldNames");
    callContext.activity.varsDeclared.call(self, callContext, args);
  } else {
    callContext.end(reason, result);
  }
};
module.exports = Declarator;
//# sourceMappingURL=data:application/json;base64,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LENBQUMsQ0FBQyxDQUFDO1FBQ3RDO01BcEVBO0FBQUEsSUFGQSxDQUFFLFlBQTBCO0FBQzFCLFdBQW9CLEtBQUcsQ0FBQztBQUN4QixnQkFBb0MsQ0FBQztJQUN2QyxDQUFFLE9BQVE7QUFDUixRQUFJO0FBQ0YsV0FBSSxLQUFpQixHQUFLLENBQUEsV0FBdUIsR0FBSyxLQUFHLENBQUc7QUFDMUQsb0JBQXdCLEFBQUMsRUFBQyxDQUFDO1FBQzdCO0FBQUEsTUFDRixDQUFFLE9BQVE7QUFDUixnQkFBd0I7QUFDdEIsb0JBQXdCO1FBQzFCO0FBQUEsTUFDRjtBQUFBLElBQ0Y7QUFBQSxBQTBESSxNQUFBLENBQUEsSUFBRyxFQUFJLENBQUEsSUFBRyxJQUFJLEFBQUMsQ0FBQyxZQUFXLENBQUMsQ0FBQztBQUNqQyxPQUFHLE9BQU8sQUFBQyxDQUFDLFlBQVcsQ0FBQyxDQUFDO0FBQ3pCLE9BQUcsT0FBTyxBQUFDLENBQUMsNkJBQTRCLENBQUMsQ0FBQztBQUMxQyxjQUFVLFNBQVMsYUFBYSxLQUFLLEFBQUMsQ0FBQyxJQUFHLENBQUcsWUFBVSxDQUFHLEtBQUcsQ0FBQyxDQUFDO0VBQ25FLEtBQ0s7QUFDRCxjQUFVLElBQUksQUFBQyxDQUFDLE1BQUssQ0FBRyxPQUFLLENBQUMsQ0FBQztFQUNuQztBQUFBLEFBQ0osQ0FBQztBQUVELEtBQUssUUFBUSxFQUFJLFdBQVMsQ0FBQztBQUFBIiwiZmlsZSI6ImFjdGl2aXRpZXMvZGVjbGFyYXRvci5qcyIsInNvdXJjZVJvb3QiOiJsaWIvZXM2Iiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmxldCBBY3Rpdml0eSA9IHJlcXVpcmUoXCIuL2FjdGl2aXR5XCIpO1xubGV0IHV0aWwgPSByZXF1aXJlKFwidXRpbFwiKTtcbmxldCBTdHJTZXQgPSByZXF1aXJlKFwiYmFja3BhY2stbm9kZVwiKS5jb2xsZWN0aW9ucy5TdHJTZXQ7XG5sZXQgaXMgPSByZXF1aXJlKFwiLi4vY29tbW9uL2lzXCIpO1xuXG5mdW5jdGlvbiBEZWNsYXJhdG9yKCkge1xuICAgIEFjdGl2aXR5LmNhbGwodGhpcyk7XG4gICAgdGhpcy5ub25TY29wZWRQcm9wZXJ0aWVzLmFkZChcInJlc2VydmVkUHJvcGVydGllc1wiKTtcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKFwicmVzZXJ2ZWRcIik7XG4gICAgdGhpcy5ub25TY29wZWRQcm9wZXJ0aWVzLmFkZChcInByb21vdGVkUHJvcGVydGllc1wiKTtcbiAgICB0aGlzLm5vblNjb3BlZFByb3BlcnRpZXMuYWRkKFwicHJvbW90ZWRcIik7XG4gICAgdGhpcy5ub25TY29wZWRQcm9wZXJ0aWVzLmFkZChcInZhcnNEZWNsYXJlZFwiKTtcblxuICAgIC8vIFByb3BlcnRpZXMgdGhvc2UgY2Fubm90IGJlIGRlY2xhcmVkIGZyZWVseVxuICAgIHRoaXMucmVzZXJ2ZWRQcm9wZXJ0aWVzID0gbmV3IFN0clNldCgpO1xuXG4gICAgLy8gUHJvcGVydGllcyB0aG9zZSB3aWxsIGJlIHByb21vdGVkIGR1cmluZyBzZXJpYWxpemF0aW9uXG4gICAgdGhpcy5wcm9tb3RlZFByb3BlcnRpZXMgPSBuZXcgU3RyU2V0KCk7XG59XG5cbnV0aWwuaW5oZXJpdHMoRGVjbGFyYXRvciwgQWN0aXZpdHkpO1xuXG5EZWNsYXJhdG9yLnByb3RvdHlwZS5yZXNlcnZlZCA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkge1xuICAgIGlmICh0aGlzLnByb21vdGVkUHJvcGVydGllcy5leGlzdHMobmFtZSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUHJvcGVydHkgJ1wiICsgbmFtZSArIFwiJyBjYW5ub3QgYmUgcmVzZXJ2ZWQgYmVjYXVzZSBpdCdzIHByb21vdGVkLlwiKTtcbiAgICB9XG4gICAgaWYgKGlzLmRlZmluZWQodmFsdWUpKSB7XG4gICAgICAgIHRoaXNbbmFtZV0gPSB2YWx1ZTtcbiAgICB9XG4gICAgdGhpcy5yZXNlcnZlZFByb3BlcnRpZXMuYWRkKG5hbWUpO1xufTtcblxuQWN0aXZpdHkucHJvdG90eXBlLnByb21vdGVkID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7XG4gICAgaWYgKHRoaXMucmVzZXJ2ZWRQcm9wZXJ0aWVzLmV4aXN0cyhuYW1lKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQcm9wZXJ0eSAnXCIgKyBuYW1lICsgXCInIGNhbm5vdCBiZSBwcm9tb3RlZCBiZWNhdXNlIGl0J3MgcmVzZXJ2ZWQuXCIpO1xuICAgIH1cbiAgICBpZiAoaXMuZGVmaW5lZCh2YWx1ZSkpIHtcbiAgICAgICAgdGhpc1tuYW1lXSA9IHZhbHVlO1xuICAgIH1cbiAgICB0aGlzLnByb21vdGVkUHJvcGVydGllcy5hZGQobmFtZSk7XG59O1xuXG5EZWNsYXJhdG9yLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoY2FsbENvbnRleHQsIGFyZ3MpIHtcbiAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgbGV0IGFjdGl2aXR5VmFyaWFibGVzID0gW107XG4gICAgbGV0IF9hY3Rpdml0eVZhcmlhYmxlRmllbGROYW1lcyA9IFtdO1xuICAgIHNlbGYuc2V0KFwiX2FjdGl2aXR5VmFyaWFibGVGaWVsZE5hbWVzXCIsIF9hY3Rpdml0eVZhcmlhYmxlRmllbGROYW1lcyk7XG4gICAgbGV0IHJlc1Byb3BzID0gY2FsbENvbnRleHQuYWN0aXZpdHkucmVzZXJ2ZWRQcm9wZXJ0aWVzO1xuICAgIGZvciAobGV0IGZpZWxkTmFtZSBvZiBjYWxsQ29udGV4dC5hY3Rpdml0eS5fZ2V0U2NvcGVLZXlzKCkpIHtcbiAgICAgICAgaWYgKCFyZXNQcm9wcy5leGlzdHMoZmllbGROYW1lKSkge1xuICAgICAgICAgICAgbGV0IGZpZWxkVmFsdWUgPSBzZWxmLmdldChmaWVsZE5hbWUpO1xuICAgICAgICAgICAgaWYgKGZpZWxkVmFsdWUgaW5zdGFuY2VvZiBBY3Rpdml0eSkge1xuICAgICAgICAgICAgICAgIGFjdGl2aXR5VmFyaWFibGVzLnB1c2goZmllbGRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgX2FjdGl2aXR5VmFyaWFibGVGaWVsZE5hbWVzLnB1c2goZmllbGROYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChhY3Rpdml0eVZhcmlhYmxlcy5sZW5ndGgpIHtcbiAgICAgICAgc2VsZi5zZXQoXCJfc2F2ZWRBcmdzXCIsIGFyZ3MpO1xuICAgICAgICBjYWxsQ29udGV4dC5zY2hlZHVsZShhY3Rpdml0eVZhcmlhYmxlcywgXCJfdmFyc0dvdFwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHNlbGYuZGVsZXRlKFwiX2FjdGl2aXR5VmFyaWFibGVGaWVsZE5hbWVzXCIpO1xuICAgICAgICBjYWxsQ29udGV4dC5hY3Rpdml0eS52YXJzRGVjbGFyZWQuY2FsbChzZWxmLCBjYWxsQ29udGV4dCwgYXJncyk7XG4gICAgfVxufTtcblxuRGVjbGFyYXRvci5wcm90b3R5cGUuX3ZhcnNHb3QgPSBmdW5jdGlvbiAoY2FsbENvbnRleHQsIHJlYXNvbiwgcmVzdWx0KSB7XG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgIGlmIChyZWFzb24gPT09IEFjdGl2aXR5LnN0YXRlcy5jb21wbGV0ZSkge1xuICAgICAgICBsZXQgaWR4ID0gMDtcbiAgICAgICAgZm9yIChsZXQgZmllbGROYW1lIG9mIHNlbGYuZ2V0KFwiX2FjdGl2aXR5VmFyaWFibGVGaWVsZE5hbWVzXCIpKSB7XG4gICAgICAgICAgICBzZWxmLnNldChmaWVsZE5hbWUsIHJlc3VsdFtpZHgrK10pO1xuICAgICAgICB9XG4gICAgICAgIGxldCBhcmdzID0gc2VsZi5nZXQoXCJfc2F2ZWRBcmdzXCIpO1xuICAgICAgICBzZWxmLmRlbGV0ZShcIl9zYXZlZEFyZ3NcIik7XG4gICAgICAgIHNlbGYuZGVsZXRlKFwiX2FjdGl2aXR5VmFyaWFibGVGaWVsZE5hbWVzXCIpO1xuICAgICAgICBjYWxsQ29udGV4dC5hY3Rpdml0eS52YXJzRGVjbGFyZWQuY2FsbChzZWxmLCBjYWxsQ29udGV4dCwgYXJncyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjYWxsQ29udGV4dC5lbmQocmVhc29uLCByZXN1bHQpO1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gRGVjbGFyYXRvcjsiXX0=
