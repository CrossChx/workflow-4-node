"use strict";
"use strict";
var wf4node = require("../../../");
var Expression = wf4node.activities.Expression;
var Func = wf4node.activities.Func;
var Block = wf4node.activities.Block;
var activityMarkup = wf4node.activities.activityMarkup;
var ActivityExecutionEngine = wf4node.activities.ActivityExecutionEngine;
var _ = require("lodash");
var ConsoleTracker = wf4node.activities.ConsoleTracker;
var WorkflowHost = wf4node.hosting.WorkflowHost;
var InstanceIdParser = wf4node.hosting.InstanceIdParser;
var assert = require("assert");
describe("bookmarking", function() {
  it("should handle parallel activities", function(done) {
    var activity = activityMarkup.parse({"@parallel": {
        var1: "",
        displayName: "Root",
        args: [{"@block": {
            displayName: "Wait Block 1",
            args: [{"@waitForBookmark": {
                displayName: "Wait 1",
                bookmarkName: "bm1"
              }}, {"@func": {
                displayName: "Func 1",
                code: function() {
                  return this.add("var1", "a");
                }
              }}]
          }}, {"@block": {
            displayName: "Wait Block 2",
            args: [{"@waitForBookmark": {
                displayName: "Wait 2",
                bookmarkName: "bm2"
              }}, {"@func": {
                displayName: "Func 2",
                code: function() {
                  return this.add("var1", "b");
                }
              }}]
          }}, {"@block": {
            displayName: "Resume Block",
            args: [{"@resumeBookmark": {
                displayName: "Resume 1",
                bookmarkName: "bm1"
              }}, {"@resumeBookmark": {
                displayName: "Resume 2",
                bookmarkName: "bm2"
              }}, "bubu"]
          }}]
      }});
    var engine = new ActivityExecutionEngine(activity);
    engine.invoke().then(function(result) {
      try {
        assert.ok(_.isArray(result));
        assert.equal(result.length, 3);
        assert.equal(result[0], "a");
        assert.equal(result[1], "ab");
        assert.equal(result[2], "bubu");
      } catch (e) {
        assert.ifError(e);
      }
    }).nodeify(done);
  });
  it("should handle of picking activities", function(done) {
    var activity = activityMarkup.parse({"@block": {
        var1: 0,
        args: [{"@parallel": [{"@pick": [{"@block": [{"@waitForBookmark": {bookmarkName: "foo"}}, {"@func": {
                  displayName: "Do Not Do This Func",
                  code: function() {
                    this.set("var1", -1);
                  }
                }}]}, {"@block": [{"@waitForBookmark": {bookmarkName: "bm"}}, {"@func": {
                  displayName: "Do This Func",
                  code: function() {
                    this.set("var1", 1);
                  }
                }}]}]}, {"@resumeBookmark": {bookmarkName: "bm"}}]}, {"@func": {
            displayName: "Final Func",
            code: function() {
              return this.get("var1");
            }
          }}]
      }});
    var engine = new ActivityExecutionEngine(activity);
    engine.invoke().then(function(result) {
      try {
        assert.equal(result, 1);
      } catch (e) {
        assert.ifError(e);
      }
    }).nodeify(done);
  });
});
//# sourceMappingURL=data:application/json;base64,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Q0FBQSxDQUFDLENBQUM7TUFDckI7QUFBQSxJQUNKLENBQUMsUUFBUSxBQUFDLENBQUMsSUFBRyxDQUFDLENBQUM7RUFDeEIsQ0FBQyxDQUFDO0FBQ04sQ0FBQyxDQUFDO0FBQUEiLCJmaWxlIjoiYWN0aXZpdGllcy9ib29rbWFya2luZy5qcyIsInNvdXJjZVJvb3QiOiJ0ZXN0cy9lczYiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLyogZ2xvYmFsIGRlc2NyaWJlLGl0ICovXG5cbmxldCB3ZjRub2RlID0gcmVxdWlyZShcIi4uLy4uLy4uL1wiKTtcbmxldCBFeHByZXNzaW9uID0gd2Y0bm9kZS5hY3Rpdml0aWVzLkV4cHJlc3Npb247XG5sZXQgRnVuYyA9IHdmNG5vZGUuYWN0aXZpdGllcy5GdW5jO1xubGV0IEJsb2NrID0gd2Y0bm9kZS5hY3Rpdml0aWVzLkJsb2NrO1xubGV0IGFjdGl2aXR5TWFya3VwID0gd2Y0bm9kZS5hY3Rpdml0aWVzLmFjdGl2aXR5TWFya3VwO1xubGV0IEFjdGl2aXR5RXhlY3V0aW9uRW5naW5lID0gd2Y0bm9kZS5hY3Rpdml0aWVzLkFjdGl2aXR5RXhlY3V0aW9uRW5naW5lO1xubGV0IF8gPSByZXF1aXJlKFwibG9kYXNoXCIpO1xubGV0IENvbnNvbGVUcmFja2VyID0gd2Y0bm9kZS5hY3Rpdml0aWVzLkNvbnNvbGVUcmFja2VyO1xubGV0IFdvcmtmbG93SG9zdCA9IHdmNG5vZGUuaG9zdGluZy5Xb3JrZmxvd0hvc3Q7XG5sZXQgSW5zdGFuY2VJZFBhcnNlciA9IHdmNG5vZGUuaG9zdGluZy5JbnN0YW5jZUlkUGFyc2VyO1xubGV0IGFzc2VydCA9IHJlcXVpcmUoXCJhc3NlcnRcIik7XG5cbmRlc2NyaWJlKFwiYm9va21hcmtpbmdcIiwgZnVuY3Rpb24gKCkge1xuICAgIGl0KFwic2hvdWxkIGhhbmRsZSBwYXJhbGxlbCBhY3Rpdml0aWVzXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgIGxldCBhY3Rpdml0eSA9IGFjdGl2aXR5TWFya3VwLnBhcnNlKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwiQHBhcmFsbGVsXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyMTogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiUm9vdFwiLFxuICAgICAgICAgICAgICAgICAgICBhcmdzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJAYmxvY2tcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJXYWl0IEJsb2NrIDFcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQHdhaXRGb3JCb29rbWFya1wiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcIldhaXQgMVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29rbWFya05hbWU6IFwiYm0xXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQGZ1bmNcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJGdW5jIDFcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkKFwidmFyMVwiLCBcImFcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQGJsb2NrXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiV2FpdCBCbG9jayAyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkB3YWl0Rm9yQm9va21hcmtcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJXYWl0IDJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9va21hcmtOYW1lOiBcImJtMlwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkBmdW5jXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiRnVuYyAyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZChcInZhcjFcIiwgXCJiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkBibG9ja1wiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcIlJlc3VtZSBCbG9ja1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJAcmVzdW1lQm9va21hcmtcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJSZXN1bWUgMVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29rbWFya05hbWU6IFwiYm0xXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQHJlc3VtZUJvb2ttYXJrXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiUmVzdW1lIDJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9va21hcmtOYW1lOiBcImJtMlwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYnVidVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBsZXQgZW5naW5lID0gbmV3IEFjdGl2aXR5RXhlY3V0aW9uRW5naW5lKGFjdGl2aXR5KTtcbiAgICAgICAgLy9lbmdpbmUuYWRkVHJhY2tlcihuZXcgQ29uc29sZVRyYWNrZXIoKSk7XG5cbiAgICAgICAgZW5naW5lLmludm9rZSgpLnRoZW4oXG4gICAgICAgICAgICBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0Lm9rKF8uaXNBcnJheShyZXN1bHQpKTtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdC5sZW5ndGgsIDMpO1xuICAgICAgICAgICAgICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0WzBdLCBcImFcIik7XG4gICAgICAgICAgICAgICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRbMV0sIFwiYWJcIik7XG4gICAgICAgICAgICAgICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRbMl0sIFwiYnVidVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0LmlmRXJyb3IoZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkubm9kZWlmeShkb25lKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGhhbmRsZSBvZiBwaWNraW5nIGFjdGl2aXRpZXNcIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgbGV0IGFjdGl2aXR5ID0gYWN0aXZpdHlNYXJrdXAucGFyc2UoXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgXCJAYmxvY2tcIjoge1xuICAgICAgICAgICAgICAgICAgICB2YXIxOiAwLFxuICAgICAgICAgICAgICAgICAgICBhcmdzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJAcGFyYWxsZWxcIjogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkBwaWNrXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQGJsb2NrXCI6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkB3YWl0Rm9yQm9va21hcmtcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29rbWFya05hbWU6IFwiZm9vXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQGZ1bmNcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJEbyBOb3QgRG8gVGhpcyBGdW5jXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0KFwidmFyMVwiLCAtMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJAYmxvY2tcIjogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQHdhaXRGb3JCb29rbWFya1wiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2ttYXJrTmFtZTogXCJibVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkBmdW5jXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiRG8gVGhpcyBGdW5jXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0KFwidmFyMVwiLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJAcmVzdW1lQm9va21hcmtcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2ttYXJrTmFtZTogXCJibVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQGZ1bmNcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJGaW5hbCBGdW5jXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldChcInZhcjFcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBsZXQgZW5naW5lID0gbmV3IEFjdGl2aXR5RXhlY3V0aW9uRW5naW5lKGFjdGl2aXR5KTtcbiAgICAgICAgLy9lbmdpbmUuYWRkVHJhY2tlcihuZXcgQ29uc29sZVRyYWNrZXIoKSk7XG5cbiAgICAgICAgZW5naW5lLmludm9rZSgpLnRoZW4oXG4gICAgICAgICAgICBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdCwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2VydC5pZkVycm9yKGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLm5vZGVpZnkoZG9uZSk7XG4gICAgfSk7XG59KTsiXX0=
