"use strict";
var wf4node = require("../../../");
var ActivityExecutionEngine = wf4node.activities.ActivityExecutionEngine;
var _ = require("lodash");
var assert = require("assert");
describe("templates", function() {
  it("should parse object correctly", function(done) {
    var engine = new ActivityExecutionEngine({"@template": {declare: {
          a: "foo",
          b: ["zoo", {c: {"@func": {code: function() {
                  return 6;
                }}}}, "= 42"]
        }}});
    engine.invoke().then(function(result) {
      assert.ok(_.isPlainObject(result));
      assert.equal(result.a, "foo");
      assert.ok(_.isArray(result.b));
      assert.equal(result.b.length, 3);
      assert.equal(result.b[0], "zoo");
      assert.ok(_.isPlainObject(result.b[1]));
      assert.equal(result.b[1].c, 6);
      assert.equal(result.b[2], 42);
    }).nodeify(done);
  });
  it("should work when specialized", function(done) {
    var engine = new ActivityExecutionEngine({"@block": [{
        a: "foo",
        b: ["zoo", {c: {"@func": {code: function() {
                return 6;
              }}}}, "= 42"]
      }]});
    engine.invoke().then(function(result) {
      assert.ok(_.isPlainObject(result));
      assert.equal(result.a, "foo");
      assert.ok(_.isArray(result.b));
      assert.equal(result.b.length, 3);
      assert.equal(result.b[0], "zoo");
      assert.ok(_.isPlainObject(result.b[1]));
      assert.equal(result.b[1].c, 6);
      assert.equal(result.b[2], 42);
    }).nodeify(done);
  });
  it("should work on arrays", function(done) {
    var engine = new ActivityExecutionEngine({"@block": {
        rule: {value: 22},
        args: [{"@block": {
            a: [{$project: {$literal: "= this.rule.value"}}],
            args: ["= this.a"]
          }}]
      }});
    engine.invoke().then(function(result) {
      assert.ok(_.isArray(result));
      assert.ok(_.isPlainObject(result[0].$project));
      assert.equal(result[0].$project.$literal, 22);
    }).nodeify(done);
  });
  it("should ignore escaped markup", function(done) {
    var engine = new ActivityExecutionEngine({"@block": {
        id: "poo",
        stuff: {_: {sayHello: function(name) {
              return "Hello, " + name + "!";
            }}},
        args: [{"@func": {
            args: " = this.poo.stuff.sayHello",
            code: function(f) {
              return f("Gabor");
            }
          }}]
      }});
    engine.invoke().then(function(result) {
      assert.equal(result, "Hello, Gabor!");
    }).nodeify(done);
  });
});
//# sourceMappingURL=data:application/json;base64,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QUMsUUFBUSxBQUFDLENBQUMsSUFBRyxDQUFDLENBQUM7RUFDcEIsQ0FBQyxDQUFDO0FBQ04sQ0FBQyxDQUFDO0FBQUEiLCJmaWxlIjoiYWN0aXZpdGllcy90ZW1wbGF0ZXMuanMiLCJzb3VyY2VSb290IjoidGVzdHMvZXM2Iiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qIGdsb2JhbCBkZXNjcmliZSxpdCAqL1xuXG5sZXQgd2Y0bm9kZSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9cIik7XG5sZXQgQWN0aXZpdHlFeGVjdXRpb25FbmdpbmUgPSB3ZjRub2RlLmFjdGl2aXRpZXMuQWN0aXZpdHlFeGVjdXRpb25FbmdpbmU7XG5sZXQgXyA9IHJlcXVpcmUoXCJsb2Rhc2hcIik7XG5sZXQgYXNzZXJ0ID0gcmVxdWlyZShcImFzc2VydFwiKTtcblxuZGVzY3JpYmUoXCJ0ZW1wbGF0ZXNcIiwgZnVuY3Rpb24gKCkge1xuICAgIGl0KFwic2hvdWxkIHBhcnNlIG9iamVjdCBjb3JyZWN0bHlcIiwgZnVuY3Rpb24gKGRvbmUpIHtcblxuICAgICAgICBsZXQgZW5naW5lID0gbmV3IEFjdGl2aXR5RXhlY3V0aW9uRW5naW5lKHtcbiAgICAgICAgICAgIFwiQHRlbXBsYXRlXCI6IHtcbiAgICAgICAgICAgICAgICBkZWNsYXJlOiB7XG4gICAgICAgICAgICAgICAgICAgIGE6IFwiZm9vXCIsXG4gICAgICAgICAgICAgICAgICAgIGI6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiem9vXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkBmdW5jXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcIj0gNDJcIlxuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBlbmdpbmUuaW52b2tlKCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG5cbiAgICAgICAgICAgIGFzc2VydC5vayhfLmlzUGxhaW5PYmplY3QocmVzdWx0KSk7XG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0LmEsIFwiZm9vXCIpO1xuICAgICAgICAgICAgYXNzZXJ0Lm9rKF8uaXNBcnJheShyZXN1bHQuYikpO1xuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdC5iLmxlbmd0aCwgMyk7XG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0LmJbMF0sIFwiem9vXCIpO1xuICAgICAgICAgICAgYXNzZXJ0Lm9rKF8uaXNQbGFpbk9iamVjdChyZXN1bHQuYlsxXSkpO1xuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdC5iWzFdLmMsIDYpO1xuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdC5iWzJdLCA0Mik7XG4gICAgICAgIH0pLm5vZGVpZnkoZG9uZSk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCB3b3JrIHdoZW4gc3BlY2lhbGl6ZWRcIiwgZnVuY3Rpb24gKGRvbmUpIHtcblxuICAgICAgICBsZXQgZW5naW5lID0gbmV3IEFjdGl2aXR5RXhlY3V0aW9uRW5naW5lKHtcbiAgICAgICAgICAgIFwiQGJsb2NrXCI6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGE6IFwiZm9vXCIsXG4gICAgICAgICAgICAgICAgICAgIGI6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiem9vXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkBmdW5jXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcIj0gNDJcIlxuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICB9KTtcblxuICAgICAgICBlbmdpbmUuaW52b2tlKCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICBhc3NlcnQub2soXy5pc1BsYWluT2JqZWN0KHJlc3VsdCkpO1xuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdC5hLCBcImZvb1wiKTtcbiAgICAgICAgICAgIGFzc2VydC5vayhfLmlzQXJyYXkocmVzdWx0LmIpKTtcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHQuYi5sZW5ndGgsIDMpO1xuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdC5iWzBdLCBcInpvb1wiKTtcbiAgICAgICAgICAgIGFzc2VydC5vayhfLmlzUGxhaW5PYmplY3QocmVzdWx0LmJbMV0pKTtcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHQuYlsxXS5jLCA2KTtcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHQuYlsyXSwgNDIpO1xuICAgICAgICB9KS5ub2RlaWZ5KGRvbmUpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgd29yayBvbiBhcnJheXNcIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgbGV0IGVuZ2luZSA9IG5ldyBBY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZSh7XG4gICAgICAgICAgICBcIkBibG9ja1wiOiB7XG4gICAgICAgICAgICAgICAgcnVsZToge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogMjJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGFyZ3M6IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJAYmxvY2tcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGE6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByb2plY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGl0ZXJhbDogXCI9IHRoaXMucnVsZS52YWx1ZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCI9IHRoaXMuYVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBlbmdpbmUuaW52b2tlKCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICBhc3NlcnQub2soXy5pc0FycmF5KHJlc3VsdCkpO1xuICAgICAgICAgICAgYXNzZXJ0Lm9rKF8uaXNQbGFpbk9iamVjdChyZXN1bHRbMF0uJHByb2plY3QpKTtcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRbMF0uJHByb2plY3QuJGxpdGVyYWwsIDIyKTtcbiAgICAgICAgfSkubm9kZWlmeShkb25lKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGlnbm9yZSBlc2NhcGVkIG1hcmt1cFwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICBsZXQgZW5naW5lID0gbmV3IEFjdGl2aXR5RXhlY3V0aW9uRW5naW5lKHtcbiAgICAgICAgICAgIFwiQGJsb2NrXCI6IHtcbiAgICAgICAgICAgICAgICBpZDogXCJwb29cIixcbiAgICAgICAgICAgICAgICBzdHVmZjoge1xuICAgICAgICAgICAgICAgICAgICBfOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzYXlIZWxsbzogZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJIZWxsbywgXCIgKyBuYW1lICsgXCIhXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGFyZ3M6IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJAZnVuY1wiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogXCIgPSB0aGlzLnBvby5zdHVmZi5zYXlIZWxsb1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGZ1bmN0aW9uKGYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYoXCJHYWJvclwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGVuZ2luZS5pbnZva2UoKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHQsIFwiSGVsbG8sIEdhYm9yIVwiKTtcbiAgICAgICAgfSkubm9kZWlmeShkb25lKTtcbiAgICB9KTtcbn0pOyJdfQ==
