"use strict";
var wf4node = require("../../../");
var Expression = wf4node.activities.Expression;
var Func = wf4node.activities.Func;
var Block = wf4node.activities.Block;
var activityMarkup = wf4node.activities.activityMarkup;
var ActivityExecutionEngine = wf4node.activities.ActivityExecutionEngine;
var _ = require("lodash");
var ConsoleTracker = wf4node.activities.ConsoleTracker;
var WorkflowHost = wf4node.hosting.WorkflowHost;
var InstanceIdParser = wf4node.hosting.InstanceIdParser;
var assert = require("assert");
describe("ActivityExecutionEngine", function() {
  describe("Bookmarking", function() {
    it("should handle parallel activities", function(done) {
      var activity = activityMarkup.parse({parallel: {
          var1: "",
          displayName: "Root",
          args: [{block: {
              displayName: "Wait Block 1",
              args: [{waitForBookmark: {
                  displayName: "Wait 1",
                  bookmarkName: "bm1"
                }}, {func: {
                  displayName: "Func 1",
                  code: function() {
                    return this.add("var1", "a");
                  }
                }}]
            }}, {block: {
              displayName: "Wait Block 2",
              args: [{waitForBookmark: {
                  displayName: "Wait 2",
                  bookmarkName: "bm2"
                }}, {func: {
                  displayName: "Func 2",
                  code: function() {
                    return this.add("var1", "b");
                  }
                }}]
            }}, {block: {
              displayName: "Resume Block",
              args: [{resumeBookmark: {
                  displayName: "Resume 1",
                  bookmarkName: "bm1"
                }}, {resumeBookmark: {
                  displayName: "Resume 2",
                  bookmarkName: "bm2"
                }}, "bubu"]
            }}]
        }});
      var engine = new ActivityExecutionEngine(activity);
      engine.invoke().then(function(result) {
        try {
          assert.ok(_.isArray(result));
          assert.equal(result.length, 3);
          assert.equal(result[0], "a");
          assert.equal(result[1], "ab");
          assert.equal(result[2], "bubu");
        } catch (e) {
          assert.ifError(e);
        }
      }).nodeify(done);
    });
    it("should handle of picking activities", function(done) {
      var activity = activityMarkup.parse({block: {
          var1: 0,
          args: [{parallel: [{pick: [{block: [{waitForBookmark: {bookmarkName: "foo"}}, {func: {
                    displayName: "Do Not Do This Func",
                    code: function() {
                      this.set("var1", -1);
                    }
                  }}]}, {block: [{waitForBookmark: {bookmarkName: "bm"}}, {func: {
                    displayName: "Do This Func",
                    code: function() {
                      this.set("var1", 1);
                    }
                  }}]}]}, {resumeBookmark: {bookmarkName: "bm"}}]}, {func: {
              displayName: "Final Func",
              code: function() {
                return this.get("var1");
              }
            }}]
        }});
      var engine = new ActivityExecutionEngine(activity);
      engine.invoke().then(function(result) {
        try {
          assert.equal(result, 1);
        } catch (e) {
          assert.ifError(e);
        }
      }).nodeify(done);
    });
  });
});
//# sourceMappingURL=data:application/json;base64,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Q0FBRztBQUNOLGVBQUssUUFBUSxBQUFDLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFDckI7QUFBQSxNQUNKLENBQUMsUUFBUSxBQUFDLENBQUMsSUFBRyxDQUFDLENBQUM7SUFDeEIsQ0FBQyxDQUFDO0VBQ04sQ0FBQyxDQUFDO0FBQ04sQ0FBQyxDQUFDO0FBQUEiLCJmaWxlIjoiYWN0aXZpdGllcy9ib29rbWFya2luZ1Rlc3RzLmpzIiwic291cmNlUm9vdCI6InRlc3RzL2VzNiIsInNvdXJjZXNDb250ZW50IjpbInZhciB3ZjRub2RlID0gcmVxdWlyZShcIi4uLy4uLy4uL1wiKTtcbnZhciBFeHByZXNzaW9uID0gd2Y0bm9kZS5hY3Rpdml0aWVzLkV4cHJlc3Npb247XG52YXIgRnVuYyA9IHdmNG5vZGUuYWN0aXZpdGllcy5GdW5jO1xudmFyIEJsb2NrID0gd2Y0bm9kZS5hY3Rpdml0aWVzLkJsb2NrO1xudmFyIGFjdGl2aXR5TWFya3VwID0gd2Y0bm9kZS5hY3Rpdml0aWVzLmFjdGl2aXR5TWFya3VwO1xudmFyIEFjdGl2aXR5RXhlY3V0aW9uRW5naW5lID0gd2Y0bm9kZS5hY3Rpdml0aWVzLkFjdGl2aXR5RXhlY3V0aW9uRW5naW5lO1xudmFyIF8gPSByZXF1aXJlKFwibG9kYXNoXCIpO1xudmFyIENvbnNvbGVUcmFja2VyID0gd2Y0bm9kZS5hY3Rpdml0aWVzLkNvbnNvbGVUcmFja2VyO1xudmFyIFdvcmtmbG93SG9zdCA9IHdmNG5vZGUuaG9zdGluZy5Xb3JrZmxvd0hvc3Q7XG52YXIgSW5zdGFuY2VJZFBhcnNlciA9IHdmNG5vZGUuaG9zdGluZy5JbnN0YW5jZUlkUGFyc2VyO1xuXG52YXIgYXNzZXJ0ID0gcmVxdWlyZShcImFzc2VydFwiKTtcblxuZGVzY3JpYmUoXCJBY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgZGVzY3JpYmUoXCJCb29rbWFya2luZ1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGl0KFwic2hvdWxkIGhhbmRsZSBwYXJhbGxlbCBhY3Rpdml0aWVzXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgICAgICB2YXIgYWN0aXZpdHkgPSBhY3Rpdml0eU1hcmt1cC5wYXJzZShcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFsbGVsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIxOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiUm9vdFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2s6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcIldhaXQgQmxvY2sgMVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdEZvckJvb2ttYXJrOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJXYWl0IDFcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2ttYXJrTmFtZTogXCJibTFcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcIkZ1bmMgMVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZChcInZhcjFcIiwgXCJhXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJXYWl0IEJsb2NrIDJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXRGb3JCb29rbWFyazoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiV2FpdCAyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29rbWFya05hbWU6IFwiYm0yXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJGdW5jIDJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hZGQoXCJ2YXIxXCIsIFwiYlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9jazoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiUmVzdW1lIEJsb2NrXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bWVCb29rbWFyazoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiUmVzdW1lIDFcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2ttYXJrTmFtZTogXCJibTFcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VtZUJvb2ttYXJrOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJSZXN1bWUgMlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9va21hcmtOYW1lOiBcImJtMlwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYnVidVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmFyIGVuZ2luZSA9IG5ldyBBY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZShhY3Rpdml0eSk7XG4gICAgICAgICAgICAvL2VuZ2luZS5hZGRUcmFja2VyKG5ldyBDb25zb2xlVHJhY2tlcigpKTtcblxuICAgICAgICAgICAgZW5naW5lLmludm9rZSgpLnRoZW4oXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXJ0Lm9rKF8uaXNBcnJheShyZXN1bHQpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHQubGVuZ3RoLCAzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRbMF0sIFwiYVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRbMV0sIFwiYWJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0WzJdLCBcImJ1YnVcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2VydC5pZkVycm9yKGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkubm9kZWlmeShkb25lKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJzaG91bGQgaGFuZGxlIG9mIHBpY2tpbmcgYWN0aXZpdGllc1wiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAgICAgdmFyIGFjdGl2aXR5ID0gYWN0aXZpdHlNYXJrdXAucGFyc2UoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBibG9jazoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyMTogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFsbGVsOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGljazogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9jazogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdEZvckJvb2ttYXJrOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29rbWFya05hbWU6IFwiZm9vXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJEbyBOb3QgRG8gVGhpcyBGdW5jXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXQoXCJ2YXIxXCIsIC0xKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2s6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXRGb3JCb29rbWFyazoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9va21hcmtOYW1lOiBcImJtXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJEbyBUaGlzIEZ1bmNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldChcInZhcjFcIiwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VtZUJvb2ttYXJrOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2ttYXJrTmFtZTogXCJibVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcIkZpbmFsIEZ1bmNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoXCJ2YXIxXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciBlbmdpbmUgPSBuZXcgQWN0aXZpdHlFeGVjdXRpb25FbmdpbmUoYWN0aXZpdHkpO1xuICAgICAgICAgICAgLy9lbmdpbmUuYWRkVHJhY2tlcihuZXcgQ29uc29sZVRyYWNrZXIoKSk7XG5cbiAgICAgICAgICAgIGVuZ2luZS5pbnZva2UoKS50aGVuKFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHQsIDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NlcnQuaWZFcnJvcihlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pLm5vZGVpZnkoZG9uZSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7Il19
