"use strict";
var wf4node = require("../../../");
var Expression = wf4node.activities.Expression;
var Func = wf4node.activities.Func;
var Block = wf4node.activities.Block;
var activityMarkup = wf4node.activities.activityMarkup;
var ActivityExecutionEngine = wf4node.activities.ActivityExecutionEngine;
var _ = require("lodash");
var ConsoleTracker = wf4node.activities.ConsoleTracker;
var WorkflowHost = wf4node.hosting.WorkflowHost;
var InstanceIdParser = wf4node.hosting.InstanceIdParser;
var assert = require("assert");
describe("ActivityExecutionEngine", function() {
  describe("Bookmarking", function() {
    it("should handle parallel activities", function(done) {
      var activity = activityMarkup.parse({parallel: {
          var1: "",
          displayName: "Root",
          args: [{block: {
              displayName: "Wait Block 1",
              args: [{waitForBookmark: {
                  displayName: "Wait 1",
                  bookmarkName: "bm1"
                }}, {func: {
                  displayName: "Func 1",
                  code: function() {
                    return this.add("var1", "a");
                  }
                }}]
            }}, {block: {
              displayName: "Wait Block 2",
              args: [{waitForBookmark: {
                  displayName: "Wait 2",
                  bookmarkName: "bm2"
                }}, {func: {
                  displayName: "Func 2",
                  code: function() {
                    return this.add("var1", "b");
                  }
                }}]
            }}, {block: {
              displayName: "Resume Block",
              args: [{resumeBookmark: {
                  displayName: "Resume 1",
                  bookmarkName: "bm1"
                }}, {resumeBookmark: {
                  displayName: "Resume 2",
                  bookmarkName: "bm2"
                }}, "bubu"]
            }}]
        }});
      var engine = new ActivityExecutionEngine(activity);
      engine.invoke().then(function(result) {
        try {
          assert.ok(_.isArray(result));
          assert.equal(result.length, 3);
          assert.equal(result[0], "a");
          assert.equal(result[1], "ab");
          assert.equal(result[2], "bubu");
        } catch (e) {
          assert.ifError(e);
        }
      }).nodeify(done);
    });
    it("should handle of picking activities", function(done) {
      var activity = activityMarkup.parse({block: {
          var1: 0,
          args: [{parallel: [{pick: [{block: [{waitForBookmark: {bookmarkName: "foo"}}, {func: {
                    displayName: "Do Not Do This Func",
                    code: function() {
                      this.set("var1", -1);
                    }
                  }}]}, {block: [{waitForBookmark: {bookmarkName: "bm"}}, {func: {
                    displayName: "Do This Func",
                    code: function() {
                      this.set("var1", 1);
                    }
                  }}]}]}, {resumeBookmark: {bookmarkName: "bm"}}]}, {func: {
              displayName: "Final Func",
              code: function() {
                return this.get("var1");
              }
            }}]
        }});
      var engine = new ActivityExecutionEngine(activity);
      engine.invoke().then(function(result) {
        try {
          assert.equal(result, 1);
        } catch (e) {
          assert.ifError(e);
        }
      }).nodeify(done);
    });
  });
});
//# sourceMappingURL=data:application/json;base64,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Q0FBRztBQUNOLGVBQUssUUFBUSxBQUFDLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFDckI7QUFBQSxNQUNKLENBQUMsUUFBUSxBQUFDLENBQUMsSUFBRyxDQUFDLENBQUM7SUFDeEIsQ0FBQyxDQUFDO0VBQ04sQ0FBQyxDQUFDO0FBQ04sQ0FBQyxDQUFDO0FBQUEiLCJmaWxlIjoiYWN0aXZpdGllcy9ib29rbWFya2luZ1Rlc3RzLmpzIiwic291cmNlUm9vdCI6InRlc3RzL2VzNiIsInNvdXJjZXNDb250ZW50IjpbInZhciB3ZjRub2RlID0gcmVxdWlyZShcIi4uLy4uLy4uL1wiKTtcclxudmFyIEV4cHJlc3Npb24gPSB3ZjRub2RlLmFjdGl2aXRpZXMuRXhwcmVzc2lvbjtcclxudmFyIEZ1bmMgPSB3ZjRub2RlLmFjdGl2aXRpZXMuRnVuYztcclxudmFyIEJsb2NrID0gd2Y0bm9kZS5hY3Rpdml0aWVzLkJsb2NrO1xyXG52YXIgYWN0aXZpdHlNYXJrdXAgPSB3ZjRub2RlLmFjdGl2aXRpZXMuYWN0aXZpdHlNYXJrdXA7XHJcbnZhciBBY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZSA9IHdmNG5vZGUuYWN0aXZpdGllcy5BY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZTtcclxudmFyIF8gPSByZXF1aXJlKFwibG9kYXNoXCIpO1xyXG52YXIgQ29uc29sZVRyYWNrZXIgPSB3ZjRub2RlLmFjdGl2aXRpZXMuQ29uc29sZVRyYWNrZXI7XHJcbnZhciBXb3JrZmxvd0hvc3QgPSB3ZjRub2RlLmhvc3RpbmcuV29ya2Zsb3dIb3N0O1xyXG52YXIgSW5zdGFuY2VJZFBhcnNlciA9IHdmNG5vZGUuaG9zdGluZy5JbnN0YW5jZUlkUGFyc2VyO1xyXG5cclxudmFyIGFzc2VydCA9IHJlcXVpcmUoXCJhc3NlcnRcIik7XHJcblxyXG5kZXNjcmliZShcIkFjdGl2aXR5RXhlY3V0aW9uRW5naW5lXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgIGRlc2NyaWJlKFwiQm9va21hcmtpbmdcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGl0KFwic2hvdWxkIGhhbmRsZSBwYXJhbGxlbCBhY3Rpdml0aWVzXCIsIGZ1bmN0aW9uIChkb25lKSB7XHJcbiAgICAgICAgICAgIHZhciBhY3Rpdml0eSA9IGFjdGl2aXR5TWFya3VwLnBhcnNlKFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcmFsbGVsOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhcjE6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcIlJvb3RcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcIldhaXQgQmxvY2sgMVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdEZvckJvb2ttYXJrOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcIldhaXQgMVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29rbWFya05hbWU6IFwiYm0xXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiRnVuYyAxXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZChcInZhcjFcIiwgXCJhXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9jazoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJXYWl0IEJsb2NrIDJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXRGb3JCb29rbWFyazoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJXYWl0IDJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9va21hcmtOYW1lOiBcImJtMlwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcIkZ1bmMgMlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hZGQoXCJ2YXIxXCIsIFwiYlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2s6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiUmVzdW1lIEJsb2NrXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bWVCb29rbWFyazoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJSZXN1bWUgMVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29rbWFya05hbWU6IFwiYm0xXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VtZUJvb2ttYXJrOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcIlJlc3VtZSAyXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2ttYXJrTmFtZTogXCJibTJcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJ1YnVcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgZW5naW5lID0gbmV3IEFjdGl2aXR5RXhlY3V0aW9uRW5naW5lKGFjdGl2aXR5KTtcclxuICAgICAgICAgICAgLy9lbmdpbmUuYWRkVHJhY2tlcihuZXcgQ29uc29sZVRyYWNrZXIoKSk7XHJcblxyXG4gICAgICAgICAgICBlbmdpbmUuaW52b2tlKCkudGhlbihcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NlcnQub2soXy5pc0FycmF5KHJlc3VsdCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0Lmxlbmd0aCwgMyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRbMF0sIFwiYVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdFsxXSwgXCJhYlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdFsyXSwgXCJidWJ1XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NlcnQuaWZFcnJvcihlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KS5ub2RlaWZ5KGRvbmUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdChcInNob3VsZCBoYW5kbGUgb2YgcGlja2luZyBhY3Rpdml0aWVzXCIsIGZ1bmN0aW9uIChkb25lKSB7XHJcbiAgICAgICAgICAgIHZhciBhY3Rpdml0eSA9IGFjdGl2aXR5TWFya3VwLnBhcnNlKFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGJsb2NrOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhcjE6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbGxlbDogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaWNrOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9jazogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXRGb3JCb29rbWFyazoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29rbWFya05hbWU6IFwiZm9vXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiRG8gTm90IERvIFRoaXMgRnVuY1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldChcInZhcjFcIiwgLTEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdEZvckJvb2ttYXJrOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2ttYXJrTmFtZTogXCJibVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcIkRvIFRoaXMgRnVuY1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldChcInZhcjFcIiwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VtZUJvb2ttYXJrOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9va21hcmtOYW1lOiBcImJtXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuYzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJGaW5hbCBGdW5jXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldChcInZhcjFcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBlbmdpbmUgPSBuZXcgQWN0aXZpdHlFeGVjdXRpb25FbmdpbmUoYWN0aXZpdHkpO1xyXG4gICAgICAgICAgICAvL2VuZ2luZS5hZGRUcmFja2VyKG5ldyBDb25zb2xlVHJhY2tlcigpKTtcclxuXHJcbiAgICAgICAgICAgIGVuZ2luZS5pbnZva2UoKS50aGVuKFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHQsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NlcnQuaWZFcnJvcihlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KS5ub2RlaWZ5KGRvbmUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pOyJdfQ==
