"use strict";
"use strict";
var wf4node = require("../../../");
var Func = wf4node.activities.Func;
var activityMarkup = wf4node.activities.activityMarkup;
var ActivityExecutionEngine = wf4node.activities.ActivityExecutionEngine;
var assert = require("assert");
var Bluebird = require("bluebird");
var Block = wf4node.activities.Block;
var _ = require("lodash");
describe("conditionals", function() {
  describe("If", function() {
    it("should call then", function(done) {
      var block = activityMarkup.parse({"@block": {
          v: 5,
          args: [{"@if": {
              condition: "# this.get('v') == 5",
              then: {"@func": {
                  args: [1],
                  code: function(a) {
                    return a + this.get('v');
                  }
                }},
              else: {"@func": {
                  args: [2],
                  code: function(a) {
                    return a + this.get('v');
                  }
                }}
            }}]
        }});
      var engine = new ActivityExecutionEngine(block);
      engine.invoke().then(function(result) {
        assert.equal(1 + 5, result);
      }).nodeify(done);
    });
    it("should call else", function(done) {
      var block = activityMarkup.parse({"@block": {
          v: 5,
          r: 0,
          args: [{"@if": {
              condition: {"@func": {code: function() {
                    return false;
                  }}},
              then: {"@func": {
                  args: [1],
                  code: function(a) {
                    this.set("r", a + this.get("v"));
                  }
                }},
              else: {"@func": {
                  args: [2],
                  code: function(a) {
                    this.set("r", a + this.get("v"));
                  }
                }}
            }}, "# this.get('r')"]
        }});
      var engine = new ActivityExecutionEngine(block);
      engine.invoke().then(function(result) {
        assert.equal(2 + 5, result);
      }).nodeify(done);
    });
  });
  describe("Switch", function() {
    describe("switch w/ case", function() {
      it("should work w/o default", function(done) {
        var engine = new ActivityExecutionEngine({"@switch": {
            expression: "# 42",
            args: [{"@case": {
                value: 43,
                args: function() {
                  return "55";
                }
              }}, {"@case": {
                value: 42,
                args: function() {
                  return "hi";
                }
              }}, {"@case": {
                value: "42",
                args: "# 'boo'"
              }}]
          }});
        engine.invoke().then(function(result) {
          assert.deepEqual(result, "hi");
        }).nodeify(done);
      });
      it("should work w default", function(done) {
        var engine = new ActivityExecutionEngine({"@switch": {
            expression: "# 43",
            args: [{"@case": {
                value: 43,
                args: function() {
                  return 55;
                }
              }}, {"@case": {
                value: 42,
                args: function() {
                  return "hi";
                }
              }}, {"@default": "# 'boo'"}]
          }});
        engine.invoke().then(function(result) {
          assert.deepEqual(result, 55);
        }).nodeify(done);
      });
      it("should do its default", function(done) {
        var engine = new ActivityExecutionEngine({"@switch": {
            expression: "# 'klow'",
            args: [{"@case": {
                value: 43,
                args: function() {
                  return 55;
                }
              }}, {"@case": {
                value: 42,
                args: function() {
                  return "hi";
                }
              }}, {"@default": "# 'boo'"}]
          }});
        engine.invoke().then(function(result) {
          assert.deepEqual(result, "boo");
        }).nodeify(done);
      });
    });
    describe("switch w/ when", function() {
      it("should work w/o default", function(done) {
        var engine = new ActivityExecutionEngine({"@switch": {args: [{"@when": {
                condition: 0,
                args: function() {
                  return "55";
                }
              }}, {"@when": {
                condition: function() {
                  return Bluebird.resolve(42);
                },
                args: function() {
                  return "hi";
                }
              }}, {"@when": {
                condition: "42",
                args: "# 'boo'"
              }}]}});
        engine.invoke().then(function(result) {
          assert.deepEqual(result, "hi");
        }).nodeify(done);
      });
      it("should work w default", function(done) {
        var engine = new ActivityExecutionEngine({"@switch": {args: [{"@when": {
                condition: 43,
                args: function() {
                  return 55;
                }
              }}, {"@when": {
                condition: undefined,
                args: function() {
                  return "hi";
                }
              }}, {"@default": "# 'boo'"}]}});
        engine.invoke().then(function(result) {
          assert.deepEqual(result, 55);
        }).nodeify(done);
      });
      it("should do its default", function(done) {
        var engine = new ActivityExecutionEngine({"@switch": {args: [{"@when": {
                condition: "",
                args: function() {
                  return 55;
                }
              }}, {"@when": {
                condition: null,
                args: function() {
                  return "hi";
                }
              }}, {"@default": "# 'boo'"}]}});
        engine.invoke().then(function(result) {
          assert.deepEqual(result, "boo");
        }).nodeify(done);
      });
    });
  });
});
//# sourceMappingURL=data:application/json;base64,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TUFBSyxDQUFHO0FBQ2QsZUFBSyxVQUFVLEFBQUMsQ0FBQyxNQUFLLENBQUcsTUFBSSxDQUFDLENBQUM7UUFDbkMsQ0FBQyxRQUFRLEFBQUMsQ0FBQyxJQUFHLENBQUMsQ0FBQztNQUN4QixDQUFDLENBQUM7SUFDTixDQUFDLENBQUM7RUFDTixDQUFDLENBQUM7QUFDTixDQUFDLENBQUM7QUFBQSIsImZpbGUiOiJhY3Rpdml0aWVzL2NvbmRpdGlvbmFscy5qcyIsInNvdXJjZVJvb3QiOiJ0ZXN0cy9lczYiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLyogZ2xvYmFsIGRlc2NyaWJlLGl0ICovXG5cbmxldCB3ZjRub2RlID0gcmVxdWlyZShcIi4uLy4uLy4uL1wiKTtcbmxldCBGdW5jID0gd2Y0bm9kZS5hY3Rpdml0aWVzLkZ1bmM7XG5sZXQgYWN0aXZpdHlNYXJrdXAgPSB3ZjRub2RlLmFjdGl2aXRpZXMuYWN0aXZpdHlNYXJrdXA7XG5sZXQgQWN0aXZpdHlFeGVjdXRpb25FbmdpbmUgPSB3ZjRub2RlLmFjdGl2aXRpZXMuQWN0aXZpdHlFeGVjdXRpb25FbmdpbmU7XG5sZXQgYXNzZXJ0ID0gcmVxdWlyZShcImFzc2VydFwiKTtcbmxldCBCbHVlYmlyZCA9IHJlcXVpcmUoXCJibHVlYmlyZFwiKTtcbmxldCBCbG9jayA9IHdmNG5vZGUuYWN0aXZpdGllcy5CbG9jaztcbmxldCBfID0gcmVxdWlyZShcImxvZGFzaFwiKTtcblxuZGVzY3JpYmUoXCJjb25kaXRpb25hbHNcIiwgZnVuY3Rpb24oKSB7XG4gICAgZGVzY3JpYmUoXCJJZlwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGl0KFwic2hvdWxkIGNhbGwgdGhlblwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAgICAgbGV0IGJsb2NrID0gYWN0aXZpdHlNYXJrdXAucGFyc2Uoe1xuICAgICAgICAgICAgICAgIFwiQGJsb2NrXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgdjogNSxcbiAgICAgICAgICAgICAgICAgICAgYXJnczogW1xuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQGlmXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9uOiBcIiMgdGhpcy5nZXQoJ3YnKSA9PSA1XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZW46IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQGZ1bmNcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IFsxXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSArIHRoaXMuZ2V0KCd2Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkBmdW5jXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBbMl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEgKyB0aGlzLmdldCgndicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBsZXQgZW5naW5lID0gbmV3IEFjdGl2aXR5RXhlY3V0aW9uRW5naW5lKGJsb2NrKTtcbiAgICAgICAgICAgIGVuZ2luZS5pbnZva2UoKS50aGVuKFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKDEgKyA1LCByZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pLm5vZGVpZnkoZG9uZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIGNhbGwgZWxzZVwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAgICAgbGV0IGJsb2NrID0gYWN0aXZpdHlNYXJrdXAucGFyc2Uoe1xuICAgICAgICAgICAgICAgIFwiQGJsb2NrXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgdjogNSxcbiAgICAgICAgICAgICAgICAgICAgcjogMCxcbiAgICAgICAgICAgICAgICAgICAgYXJnczogW1xuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQGlmXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkBmdW5jXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZW46IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQGZ1bmNcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IFsxXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldChcInJcIiwgYSArIHRoaXMuZ2V0KFwidlwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkBmdW5jXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBbMl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXQoXCJyXCIsIGEgKyB0aGlzLmdldChcInZcIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcIiMgdGhpcy5nZXQoJ3InKVwiXG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbGV0IGVuZ2luZSA9IG5ldyBBY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZShibG9jayk7XG4gICAgICAgICAgICBlbmdpbmUuaW52b2tlKCkudGhlbihcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2VydC5lcXVhbCgyICsgNSwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KS5ub2RlaWZ5KGRvbmUpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiU3dpdGNoXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZGVzY3JpYmUoXCJzd2l0Y2ggdy8gY2FzZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpdChcInNob3VsZCB3b3JrIHcvbyBkZWZhdWx0XCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgICAgICAgICAgbGV0IGVuZ2luZSA9IG5ldyBBY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZSh7XG4gICAgICAgICAgICAgICAgICAgIFwiQHN3aXRjaFwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9uOiBcIiMgNDJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQGNhc2VcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IDQzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIjU1XCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJAY2FzZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogNDIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiaGlcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkBjYXNlXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBcIjQyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBcIiMgJ2JvbydcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBlbmdpbmUuaW52b2tlKCkudGhlbihcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChyZXN1bHQsIFwiaGlcIik7XG4gICAgICAgICAgICAgICAgICAgIH0pLm5vZGVpZnkoZG9uZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoXCJzaG91bGQgd29yayB3IGRlZmF1bHRcIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgICAgICAgICBsZXQgZW5naW5lID0gbmV3IEFjdGl2aXR5RXhlY3V0aW9uRW5naW5lKHtcbiAgICAgICAgICAgICAgICAgICAgXCJAc3dpdGNoXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb246IFwiIyA0M1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJAY2FzZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogNDMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDU1O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQGNhc2VcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IDQyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcImhpXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJAZGVmYXVsdFwiOiBcIiMgJ2JvbydcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZW5naW5lLmludm9rZSgpLnRoZW4oXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwocmVzdWx0LCA1NSk7XG4gICAgICAgICAgICAgICAgICAgIH0pLm5vZGVpZnkoZG9uZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaXQoXCJzaG91bGQgZG8gaXRzIGRlZmF1bHRcIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgICAgICAgICBsZXQgZW5naW5lID0gbmV3IEFjdGl2aXR5RXhlY3V0aW9uRW5naW5lKHtcbiAgICAgICAgICAgICAgICAgICAgXCJAc3dpdGNoXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb246IFwiIyAna2xvdydcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQGNhc2VcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IDQzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA1NTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkBjYXNlXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiA0MixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJoaVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQGRlZmF1bHRcIjogXCIjICdib28nXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGVuZ2luZS5pbnZva2UoKS50aGVuKFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKHJlc3VsdCwgXCJib29cIik7XG4gICAgICAgICAgICAgICAgICAgIH0pLm5vZGVpZnkoZG9uZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoXCJzd2l0Y2ggdy8gd2hlblwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpdChcInNob3VsZCB3b3JrIHcvbyBkZWZhdWx0XCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgICAgICAgICAgbGV0IGVuZ2luZSA9IG5ldyBBY3Rpdml0eUV4ZWN1dGlvbkVuZ2luZSh7XG4gICAgICAgICAgICAgICAgICAgIFwiQHN3aXRjaFwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkB3aGVuXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbjogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCI1NVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQHdoZW5cIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQmx1ZWJpcmQucmVzb2x2ZSg0Mik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcImhpXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJAd2hlblwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb246IFwiNDJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IFwiIyAnYm9vJ1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGVuZ2luZS5pbnZva2UoKS50aGVuKFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKHJlc3VsdCwgXCJoaVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSkubm9kZWlmeShkb25lKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdChcInNob3VsZCB3b3JrIHcgZGVmYXVsdFwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAgICAgICAgIGxldCBlbmdpbmUgPSBuZXcgQWN0aXZpdHlFeGVjdXRpb25FbmdpbmUoe1xuICAgICAgICAgICAgICAgICAgICBcIkBzd2l0Y2hcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJAd2hlblwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb246IDQzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA1NTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkB3aGVuXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcImhpXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJAZGVmYXVsdFwiOiBcIiMgJ2JvbydcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy9lbmdpbmUuYWRkVHJhY2tlcihuZXcgQ29uc29sZVRyYWNrZXIoKSk7XG5cbiAgICAgICAgICAgICAgICBlbmdpbmUuaW52b2tlKCkudGhlbihcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChyZXN1bHQsIDU1KTtcbiAgICAgICAgICAgICAgICAgICAgfSkubm9kZWlmeShkb25lKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpdChcInNob3VsZCBkbyBpdHMgZGVmYXVsdFwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAgICAgICAgIGxldCBlbmdpbmUgPSBuZXcgQWN0aXZpdHlFeGVjdXRpb25FbmdpbmUoe1xuICAgICAgICAgICAgICAgICAgICBcIkBzd2l0Y2hcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJAd2hlblwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb246IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDU1O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQHdoZW5cIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9uOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcImhpXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJAZGVmYXVsdFwiOiBcIiMgJ2JvbydcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZW5naW5lLmludm9rZSgpLnRoZW4oXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwocmVzdWx0LCBcImJvb1wiKTtcbiAgICAgICAgICAgICAgICAgICAgfSkubm9kZWlmeShkb25lKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pOyJdfQ==
