"use strict";
var wf4node = require("../../../");
var SimpleProxy = wf4node.common.SimpleProxy;
var assert = require("better-assert");
var _ = require("lodash");
describe("SimpleProxy", function() {
  it("should work", function() {
    var backend = {
      name: "Gabor",
      getKeys: function(proxy) {
        return _.keys(this);
      },
      getValue: function(proxy, name) {
        var v = this[name];
        if (_.isUndefined(v)) {
          throw new Error((name + " doesn't exists."));
        }
        return v;
      },
      setValue: function(proxy, name, value) {
        return this[name] = value;
      }
    };
    var obj = new SimpleProxy(backend);
    obj.foo = "bar";
    assert(obj.foo === "bar");
    assert(obj.name === "Gabor");
    try {
      var x = obj.punci;
      assert(false);
    } catch (e) {
      _.noop(e);
    }
    try {
      obj.punci = 5;
      assert(false);
    } catch (e) {
      _.noop(e);
    }
    obj.name = 33;
    assert(obj.name === 33);
    assert(backend.name === 33);
    backend.punci = "je";
    assert(backend.punci === "je");
    obj.update();
    assert(obj.punci === "je");
    var keys = _.keys(obj).sort();
    assert(keys.length === 3);
    assert(keys[0] === "foo");
    assert(obj[keys[0]] === "bar");
    assert(keys[1] === "name");
    assert(obj[keys[1]] === 33);
    assert(keys[2] === "punci");
    assert(obj[keys[2]] === "je");
    delete backend.punci;
    assert(backend.punci === undefined);
    try {
      assert(obj.punci === undefined);
      assert(false);
    } catch (e) {
      _.noop(e);
    }
    obj.update();
    assert(obj.punci === undefined);
    keys.length = 0;
    for (var key in obj) {
      if (obj.hasOwnProperty(key)) {
        keys.push(key);
      }
    }
    keys.sort();
    assert(keys.length === 2);
    assert(keys[0] === "foo");
    assert(obj[keys[0]] === "bar");
    assert(keys[1] === "name");
    assert(obj[keys[1]] === 33);
  });
  it("should accept new props on update", function() {
    var backend = {
      name: "Gabor",
      getKeys: function(proxy) {
        return _.keys(this);
      },
      getValue: function(proxy, name) {
        var v = this[name];
        if (_.isUndefined(v)) {
          throw new Error((name + " doesn't exists."));
        }
        return v;
      },
      setValue: function(proxy, name, value) {
        return this[name] = value;
      }
    };
    var obj = new SimpleProxy(backend);
    assert(backend.name === "Gabor");
    assert(obj.name === "Gabor");
    obj.klow = "mudz";
    assert(obj.klow === "mudz");
    try {
      assert(backend.klow === "mudz");
      assert(false);
    } catch (e) {
      _.noop(e);
    }
    obj.update();
    assert(obj.klow === "mudz");
    assert(backend.klow === "mudz");
    backend.klow = "foo";
    assert(obj.klow === "foo");
    assert(backend.klow === "foo");
  });
});
//# sourceMappingURL=data:application/json;base64,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dXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuLypnbG9iYWwgZGVzY3JpYmUsaXQqL1xubGV0IHdmNG5vZGUgPSByZXF1aXJlKFwiLi4vLi4vLi4vXCIpO1xubGV0IFNpbXBsZVByb3h5ID0gd2Y0bm9kZS5jb21tb24uU2ltcGxlUHJveHk7XG5cbmxldCBhc3NlcnQgPSByZXF1aXJlKFwiYmV0dGVyLWFzc2VydFwiKTtcbmxldCBfID0gcmVxdWlyZShcImxvZGFzaFwiKTtcblxuZGVzY3JpYmUoXCJTaW1wbGVQcm94eVwiLCBmdW5jdGlvbigpIHtcbiAgICBpdChcInNob3VsZCB3b3JrXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICBsZXQgYmFja2VuZCA9IHtcbiAgICAgICAgICAgIG5hbWU6IFwiR2Fib3JcIixcbiAgICAgICAgICAgIGdldEtleXM6IGZ1bmN0aW9uKHByb3h5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF8ua2V5cyh0aGlzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24ocHJveHksIG5hbWUpIHtcbiAgICAgICAgICAgICAgICBsZXQgdiA9IHRoaXNbbmFtZV07XG4gICAgICAgICAgICAgICAgaWYgKF8uaXNVbmRlZmluZWQodikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke25hbWV9IGRvZXNuJ3QgZXhpc3RzLmApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24ocHJveHksIG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgbGV0IG9iaiA9IG5ldyBTaW1wbGVQcm94eShiYWNrZW5kKTtcblxuICAgICAgICBvYmouZm9vID0gXCJiYXJcIjtcblxuICAgICAgICBhc3NlcnQob2JqLmZvbyA9PT0gXCJiYXJcIik7XG4gICAgICAgIGFzc2VydChvYmoubmFtZSA9PT0gXCJHYWJvclwiKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGxldCB4ID0gb2JqLnB1bmNpO1xuICAgICAgICAgICAgYXNzZXJ0KGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgXy5ub29wKGUpO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBvYmoucHVuY2kgPSA1O1xuICAgICAgICAgICAgYXNzZXJ0KGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgXy5ub29wKGUpO1xuICAgICAgICB9XG4gICAgICAgIG9iai5uYW1lID0gMzM7XG4gICAgICAgIGFzc2VydChvYmoubmFtZSA9PT0gMzMpO1xuICAgICAgICBhc3NlcnQoYmFja2VuZC5uYW1lID09PSAzMyk7XG4gICAgICAgIGJhY2tlbmQucHVuY2kgPSBcImplXCI7XG4gICAgICAgIGFzc2VydChiYWNrZW5kLnB1bmNpID09PSBcImplXCIpO1xuICAgICAgICBvYmoudXBkYXRlKCk7XG4gICAgICAgIGFzc2VydChvYmoucHVuY2kgPT09IFwiamVcIik7XG5cbiAgICAgICAgbGV0IGtleXMgPSBfLmtleXMob2JqKS5zb3J0KCk7XG4gICAgICAgIGFzc2VydChrZXlzLmxlbmd0aCA9PT0gMyk7XG4gICAgICAgIGFzc2VydChrZXlzWzBdID09PSBcImZvb1wiKTtcbiAgICAgICAgYXNzZXJ0KG9ialtrZXlzWzBdXSA9PT0gXCJiYXJcIik7XG4gICAgICAgIGFzc2VydChrZXlzWzFdID09PSBcIm5hbWVcIik7XG4gICAgICAgIGFzc2VydChvYmpba2V5c1sxXV0gPT09IDMzKTtcbiAgICAgICAgYXNzZXJ0KGtleXNbMl0gPT09IFwicHVuY2lcIik7XG4gICAgICAgIGFzc2VydChvYmpba2V5c1syXV0gPT09IFwiamVcIik7XG5cbiAgICAgICAgZGVsZXRlIGJhY2tlbmQucHVuY2k7XG4gICAgICAgIGFzc2VydChiYWNrZW5kLnB1bmNpID09PSB1bmRlZmluZWQpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXNzZXJ0KG9iai5wdW5jaSA9PT0gdW5kZWZpbmVkKTtcbiAgICAgICAgICAgIGFzc2VydChmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIF8ubm9vcChlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIG9iai51cGRhdGUoKTtcbiAgICAgICAgYXNzZXJ0KG9iai5wdW5jaSA9PT0gdW5kZWZpbmVkKTtcblxuICAgICAgICBrZXlzLmxlbmd0aCA9IDA7XG4gICAgICAgIGZvciAobGV0IGtleSBpbiBvYmopIHtcbiAgICAgICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgIGtleXMucHVzaChrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGtleXMuc29ydCgpO1xuICAgICAgICBhc3NlcnQoa2V5cy5sZW5ndGggPT09IDIpO1xuICAgICAgICBhc3NlcnQoa2V5c1swXSA9PT0gXCJmb29cIik7XG4gICAgICAgIGFzc2VydChvYmpba2V5c1swXV0gPT09IFwiYmFyXCIpO1xuICAgICAgICBhc3NlcnQoa2V5c1sxXSA9PT0gXCJuYW1lXCIpO1xuICAgICAgICBhc3NlcnQob2JqW2tleXNbMV1dID09PSAzMyk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBhY2NlcHQgbmV3IHByb3BzIG9uIHVwZGF0ZVwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgbGV0IGJhY2tlbmQgPSB7XG4gICAgICAgICAgICBuYW1lOiBcIkdhYm9yXCIsXG4gICAgICAgICAgICBnZXRLZXlzOiBmdW5jdGlvbihwcm94eSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfLmtleXModGhpcyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uKHByb3h5LCBuYW1lKSB7XG4gICAgICAgICAgICAgICAgbGV0IHYgPSB0aGlzW25hbWVdO1xuICAgICAgICAgICAgICAgIGlmIChfLmlzVW5kZWZpbmVkKHYpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgJHtuYW1lfSBkb2Vzbid0IGV4aXN0cy5gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHY7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0VmFsdWU6IGZ1bmN0aW9uKHByb3h5LCBuYW1lLCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGxldCBvYmogPSBuZXcgU2ltcGxlUHJveHkoYmFja2VuZCk7XG5cbiAgICAgICAgYXNzZXJ0KGJhY2tlbmQubmFtZSA9PT0gXCJHYWJvclwiKTtcbiAgICAgICAgYXNzZXJ0KG9iai5uYW1lID09PSBcIkdhYm9yXCIpO1xuXG4gICAgICAgIG9iai5rbG93ID0gXCJtdWR6XCI7XG5cbiAgICAgICAgYXNzZXJ0KG9iai5rbG93ID09PSBcIm11ZHpcIik7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhc3NlcnQoYmFja2VuZC5rbG93ID09PSBcIm11ZHpcIik7XG4gICAgICAgICAgICBhc3NlcnQoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBfLm5vb3AoZSk7XG4gICAgICAgIH1cbiAgICAgICAgb2JqLnVwZGF0ZSgpO1xuICAgICAgICBhc3NlcnQob2JqLmtsb3cgPT09IFwibXVkelwiKTtcbiAgICAgICAgYXNzZXJ0KGJhY2tlbmQua2xvdyA9PT0gXCJtdWR6XCIpO1xuXG4gICAgICAgIC8vIEVuc3VyZSB0aGF0IHRoZSB2YWx1ZSBvcmlnaW5hdGVzIGl0c2VsZiBmcm9tIHRoZSBiYWNrZW5kOlxuICAgICAgICBiYWNrZW5kLmtsb3cgPSBcImZvb1wiO1xuICAgICAgICBhc3NlcnQob2JqLmtsb3cgPT09IFwiZm9vXCIpO1xuICAgICAgICBhc3NlcnQoYmFja2VuZC5rbG93ID09PSBcImZvb1wiKTtcbiAgICB9KTtcbn0pOyJdfQ==
