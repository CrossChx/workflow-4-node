"use strict";
var wf4node = require("../../../");
var activityMarkup = wf4node.activities.activityMarkup;
var WorkflowHost = wf4node.hosting.WorkflowHost;
var ConsoleTracker = wf4node.activities.ConsoleTracker;
var _ = require("lodash");
var asyncHelpers = wf4node.common.asyncHelpers;
var Promise = require("bluebird");
var assert = require("assert");
module.exports = {
  doBasicHostTest: Promise.coroutine($traceurRuntime.initGeneratorFunction(function $__0(hostOptions) {
    var workflow,
        host,
        result,
        promotedProperties;
    return $traceurRuntime.createGeneratorInstance(function($ctx) {
      while (true)
        switch ($ctx.state) {
          case 0:
            hostOptions = _.extend({enablePromotions: true}, hostOptions);
            workflow = activityMarkup.parse({workflow: {
                name: "wf",
                "!v": null,
                "!x": 0,
                args: [{beginMethod: {
                    methodName: "foo",
                    canCreateInstance: true,
                    instanceIdPath: "[0]",
                    "@to": "v"
                  }}, {endMethod: {
                    methodName: "foo",
                    result: "# this.get('v')[0] * this.get('v')[0]",
                    "@to": "v"
                  }}, {assign: {
                    value: 666,
                    to: "x"
                  }}, {method: {
                    methodName: "bar",
                    instanceIdPath: "[0]",
                    result: "# this.get('v') * 2"
                  }}, "some string for wf result but not for the method result"]
              }});
            host = new WorkflowHost(hostOptions);
            host.registerWorkflow(workflow);
            $ctx.state = 17;
            break;
          case 17:
            $ctx.state = 2;
            return (host.invokeMethod("wf", "foo", [5]));
          case 2:
            result = $ctx.sent;
            $ctx.state = 4;
            break;
          case 4:
            assert.equal(result, 25);
            $ctx.state = 19;
            break;
          case 19:
            $ctx.state = (hostOptions && hostOptions.persistence) ? 5 : 10;
            break;
          case 5:
            $ctx.state = 6;
            return (Promise.resolve(hostOptions.persistence.loadPromotedProperties("wf", 5)));
          case 6:
            promotedProperties = $ctx.sent;
            $ctx.state = 8;
            break;
          case 8:
            assert.ok(promotedProperties);
            assert.equal(promotedProperties.v, 25);
            assert.equal(promotedProperties.x, 666);
            assert.equal(_.keys(promotedProperties).length, 2);
            $ctx.state = 10;
            break;
          case 10:
            $ctx.state = 13;
            return (host.invokeMethod("wf", "bar", [5]));
          case 13:
            result = $ctx.sent;
            $ctx.state = 15;
            break;
          case 15:
            assert.equal(result, 50);
            $ctx.state = -2;
            break;
          default:
            return $ctx.end();
        }
    }, $__0, this);
  })),
  doCalculatorTest: Promise.coroutine($traceurRuntime.initGeneratorFunction(function $__1(hostOptions) {
    var workflow,
        host,
        arg,
        result;
    return $traceurRuntime.createGeneratorInstance(function($ctx) {
      while (true)
        switch ($ctx.state) {
          case 0:
            workflow = activityMarkup.parse({workflow: {
                name: "calculator",
                running: true,
                inputArgs: null,
                currentValue: 0,
                args: [{while: {
                    condition: "# this.get('running')",
                    body: {pick: [{block: {
                          displayName: "Add block",
                          args: [{method: {
                              displayName: "Add method",
                              methodName: "add",
                              instanceIdPath: "[0].id",
                              canCreateInstance: true,
                              "@to": "inputArgs"
                            }}, {assign: {
                              value: "# this.get('currentValue') + this.get('inputArgs')[0].value",
                              to: "currentValue"
                            }}]
                        }}, {block: {
                          displayName: "Subtract block",
                          args: [{method: {
                              displayName: "Subtract method",
                              methodName: "subtract",
                              instanceIdPath: "[0].id",
                              canCreateInstance: true,
                              "@to": "inputArgs"
                            }}, {assign: {
                              value: "# this.get('currentValue') - this.get('inputArgs')[0].value",
                              to: "currentValue"
                            }}]
                        }}, {block: {
                          displayName: "Multiply block",
                          args: [{method: {
                              displayName: "Multiply method",
                              methodName: "multiply",
                              instanceIdPath: "[0].id",
                              canCreateInstance: true,
                              "@to": "inputArgs"
                            }}, {assign: {
                              value: "# this.get('currentValue') * this.get('inputArgs')[0].value",
                              to: "currentValue"
                            }}]
                        }}, {block: {
                          displayName: "Divide block",
                          args: [{method: {
                              displayName: "Divide method",
                              methodName: "divide",
                              instanceIdPath: "[0].id",
                              canCreateInstance: true,
                              "@to": "inputArgs"
                            }}, {assign: {
                              value: "# this.get('currentValue') / this.get('inputArgs')[0].value",
                              to: "currentValue"
                            }}]
                        }}, {method: {
                          displayName: "Equals method",
                          methodName: "equals",
                          instanceIdPath: "[0].id",
                          canCreateInstance: true,
                          result: "# this.get('currentValue')"
                        }}, {block: {
                          displayName: "Reset block",
                          args: [{method: {
                              displayName: "Reset method",
                              methodName: "reset",
                              instanceIdPath: "[0].id"
                            }}, {assign: {
                              value: false,
                              to: "running"
                            }}]
                        }}]}
                  }}]
              }});
            host = new WorkflowHost(hostOptions);
            host.registerWorkflow(workflow);
            arg = {id: Math.floor((Math.random() * 1000000000) + 1)};
            $ctx.state = 50;
            break;
          case 50:
            $ctx.state = 2;
            return (host.invokeMethod("calculator", "equals", [arg]));
          case 2:
            result = $ctx.sent;
            $ctx.state = 4;
            break;
          case 4:
            assert.equal(result, 0);
            arg.value = 55;
            $ctx.state = 52;
            break;
          case 52:
            $ctx.state = 6;
            return (host.invokeMethod("calculator", "add", [arg]));
          case 6:
            $ctx.maybeThrow();
            $ctx.state = 8;
            break;
          case 8:
            if (hostOptions && hostOptions.persistence) {
              host = new WorkflowHost(hostOptions);
              host.registerWorkflow(workflow);
            }
            $ctx.state = 54;
            break;
          case 54:
            $ctx.state = 10;
            return (host.invokeMethod("calculator", "equals", [arg]));
          case 10:
            result = $ctx.sent;
            $ctx.state = 12;
            break;
          case 12:
            assert.equal(result, 55);
            arg.value = 5;
            $ctx.state = 56;
            break;
          case 56:
            $ctx.state = 14;
            return (host.invokeMethod("calculator", "divide", [arg]));
          case 14:
            $ctx.maybeThrow();
            $ctx.state = 16;
            break;
          case 16:
            $ctx.state = 18;
            return (host.invokeMethod("calculator", "equals", [arg]));
          case 18:
            result = $ctx.sent;
            $ctx.state = 20;
            break;
          case 20:
            assert.equal(result, 11);
            arg.value = 1;
            $ctx.state = 58;
            break;
          case 58:
            $ctx.state = 22;
            return (host.invokeMethod("calculator", "subtract", [arg]));
          case 22:
            $ctx.maybeThrow();
            $ctx.state = 24;
            break;
          case 24:
            $ctx.state = 26;
            return (host.invokeMethod("calculator", "equals", [arg]));
          case 26:
            result = $ctx.sent;
            $ctx.state = 28;
            break;
          case 28:
            assert.equal(result, 10);
            arg.value = 100;
            $ctx.state = 60;
            break;
          case 60:
            $ctx.state = 30;
            return (host.invokeMethod("calculator", "multiply", [arg]));
          case 30:
            $ctx.maybeThrow();
            $ctx.state = 32;
            break;
          case 32:
            $ctx.state = 34;
            return (host.invokeMethod("calculator", "equals", [arg]));
          case 34:
            result = $ctx.sent;
            $ctx.state = 36;
            break;
          case 36:
            assert.equal(result, 1000);
            delete arg.value;
            $ctx.state = 62;
            break;
          case 62:
            $ctx.state = 38;
            return (host.invokeMethod("calculator", "reset", [arg]));
          case 38:
            $ctx.maybeThrow();
            $ctx.state = 40;
            break;
          case 40:
            $ctx.state = 42;
            return (host.invokeMethod("calculator", "equals", [arg]));
          case 42:
            result = $ctx.sent;
            $ctx.state = 44;
            break;
          case 44:
            assert.equal(result, 0);
            delete arg.value;
            $ctx.state = 64;
            break;
          case 64:
            $ctx.state = 46;
            return (host.invokeMethod("calculator", "reset", [arg]));
          case 46:
            $ctx.maybeThrow();
            $ctx.state = -2;
            break;
          default:
            return $ctx.end();
        }
    }, $__1, this);
  }))
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhvc3RpbmdUZXN0Q29tbW9uLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQUEsQUFBSSxFQUFBLENBQUEsT0FBTSxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsV0FBVSxDQUFDLENBQUM7QUFDbEMsQUFBSSxFQUFBLENBQUEsY0FBYSxFQUFJLENBQUEsT0FBTSxXQUFXLGVBQWUsQ0FBQztBQUN0RCxBQUFJLEVBQUEsQ0FBQSxZQUFXLEVBQUksQ0FBQSxPQUFNLFFBQVEsYUFBYSxDQUFDO0FBQy9DLEFBQUksRUFBQSxDQUFBLGNBQWEsRUFBSSxDQUFBLE9BQU0sV0FBVyxlQUFlLENBQUM7QUFDdEQsQUFBSSxFQUFBLENBQUEsQ0FBQSxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsUUFBTyxDQUFDLENBQUM7QUFDekIsQUFBSSxFQUFBLENBQUEsWUFBVyxFQUFJLENBQUEsT0FBTSxPQUFPLGFBQWEsQ0FBQztBQUM5QyxBQUFJLEVBQUEsQ0FBQSxPQUFNLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxVQUFTLENBQUMsQ0FBQztBQUVqQyxBQUFJLEVBQUEsQ0FBQSxNQUFLLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxRQUFPLENBQUMsQ0FBQztBQUU5QixLQUFLLFFBQVEsRUFBSTtBQUNiLGdCQUFjLENBQUcsQ0FBQSxPQUFNLFVBQVUsQUFBQyxDQVh0QyxlQUFjLHNCQUFzQixBQUFDLENBWTdCLGNBQVcsV0FBVTs7Ozs7QUFaN0IsU0FBTyxDQUFQLGVBQWMsd0JBQXdCLEFBQWQsQ0FBeEIsU0FBUyxJQUFHLENBQUc7QUFDVCxZQUFPLElBQUc7OztBQVlKLHNCQUFVLEVBQUksQ0FBQSxDQUFBLE9BQU8sQUFBQyxDQUNsQixDQUNJLGdCQUFlLENBQUcsS0FBRyxDQUN6QixDQUNBLFlBQVUsQ0FBQyxDQUFDO3FCQUVELENBQUEsY0FBYSxNQUFNLEFBQUMsQ0FDL0IsQ0FDSSxRQUFPLENBQUc7QUFDTixtQkFBRyxDQUFHLEtBQUc7QUFDVCxtQkFB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QyxDQUFDLENBOVByRDs7QUE4UFgsaUJBQUssRUE5UGpCLENBQUEsSUFBRyxLQUFLLEFBOFBvRSxDQUFBOzs7O0FBQ2hFLGlCQUFLLE1BQU0sQUFBQyxDQUFDLE1BQUssQ0FBRyxLQUFHLENBQUMsQ0FBQztBQUUxQixpQkFBTyxJQUFFLE1BQU0sQ0FBQzs7Ozs7QUFqUTVCLGlCQWtRa0IsRUFBQyxJQUFHLGFBQWEsQUFBQyxDQUFDLFlBQVcsQ0FBRyxRQUFNLENBQUcsRUFBQyxHQUFFLENBQUMsQ0FBQyxDQUFDLENBbFEzQzs7QUFBdkIsZUFBRyxXQUFXLEFBQUMsRUFBQyxDQUFBOzs7OztBQUFoQixpQkFtUTJCLEVBQUMsSUFBRyxhQUFhLEFBQUMsQ0FBQyxZQUFXLENBQUcsU0FBTyxDQUFHLEVBQUMsR0FBRSxDQUFDLENBQUMsQ0FBQyxDQW5RckQ7O0FBbVFYLGlCQUFLLEVBblFqQixDQUFBLElBQUcsS0FBSyxBQW1Rb0UsQ0FBQTs7OztBQUNoRSxpQkFBSyxNQUFNLEFBQUMsQ0FBQyxNQUFLLENBQUcsRUFBQSxDQUFDLENBQUM7QUFFdkIsaUJBQU8sSUFBRSxNQUFNLENBQUM7Ozs7O0FBdFE1QixpQkF1UWtCLEVBQUMsSUFBRyxhQUFhLEFBQUMsQ0FBQyxZQUFXLENBQUcsUUFBTSxDQUFHLEVBQUMsR0FBRSxDQUFDLENBQUMsQ0FBQyxDQXZRM0M7O0FBQXZCLGVBQUcsV0FBVyxBQUFDLEVBQUMsQ0FBQTs7OztBQUFoQixpQkFBTyxDQUFBLElBQUcsSUFBSSxBQUFDLEVBQUMsQ0FBQTs7QUFDbUIsSUFDL0IsT0FBNkIsS0FBRyxDQUFDLENBQUM7RUFzUTlCLENBeFErQyxDQXdROUM7QUFBQSxBQUNULENBQUM7QUFDRCIsImZpbGUiOiJob3N0aW5nL2hvc3RpbmdUZXN0Q29tbW9uLmpzIiwic291cmNlUm9vdCI6InRlc3RzL2VzNiIsInNvdXJjZXNDb250ZW50IjpbInZhciB3ZjRub2RlID0gcmVxdWlyZShcIi4uLy4uLy4uL1wiKTtcclxudmFyIGFjdGl2aXR5TWFya3VwID0gd2Y0bm9kZS5hY3Rpdml0aWVzLmFjdGl2aXR5TWFya3VwO1xyXG52YXIgV29ya2Zsb3dIb3N0ID0gd2Y0bm9kZS5ob3N0aW5nLldvcmtmbG93SG9zdDtcclxudmFyIENvbnNvbGVUcmFja2VyID0gd2Y0bm9kZS5hY3Rpdml0aWVzLkNvbnNvbGVUcmFja2VyO1xyXG52YXIgXyA9IHJlcXVpcmUoXCJsb2Rhc2hcIik7XHJcbnZhciBhc3luY0hlbHBlcnMgPSB3ZjRub2RlLmNvbW1vbi5hc3luY0hlbHBlcnM7XHJcbnZhciBQcm9taXNlID0gcmVxdWlyZShcImJsdWViaXJkXCIpO1xyXG5cclxudmFyIGFzc2VydCA9IHJlcXVpcmUoXCJhc3NlcnRcIik7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIGRvQmFzaWNIb3N0VGVzdDogUHJvbWlzZS5jb3JvdXRpbmUoXHJcbiAgICAgICAgZnVuY3Rpb24qIChob3N0T3B0aW9ucykge1xyXG4gICAgICAgICAgICBob3N0T3B0aW9ucyA9IF8uZXh0ZW5kKFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZVByb21vdGlvbnM6IHRydWVcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBob3N0T3B0aW9ucyk7XHJcblxyXG4gICAgICAgICAgICB2YXIgd29ya2Zsb3cgPSBhY3Rpdml0eU1hcmt1cC5wYXJzZShcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB3b3JrZmxvdzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIndmXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiIXZcIjogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCIheFwiOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW5NZXRob2Q6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kTmFtZTogXCJmb29cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuQ3JlYXRlSW5zdGFuY2U6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlSWRQYXRoOiBcIlswXVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkB0b1wiOiBcInZcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kTWV0aG9kOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZE5hbWU6IFwiZm9vXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdDogXCIjIHRoaXMuZ2V0KCd2JylbMF0gKiB0aGlzLmdldCgndicpWzBdXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQHRvXCI6IFwidlwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IDY2NixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG86IFwieFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kTmFtZTogXCJiYXJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VJZFBhdGg6IFwiWzBdXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdDogXCIjIHRoaXMuZ2V0KCd2JykgKiAyXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzb21lIHN0cmluZyBmb3Igd2YgcmVzdWx0IGJ1dCBub3QgZm9yIHRoZSBtZXRob2QgcmVzdWx0XCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdmFyIGhvc3QgPSBuZXcgV29ya2Zsb3dIb3N0KGhvc3RPcHRpb25zKTtcclxuICAgICAgICAgICAgLy9ob3N0LmFkZFRyYWNrZXIobmV3IENvbnNvbGVUcmFja2VyKCkpO1xyXG5cclxuICAgICAgICAgICAgaG9zdC5yZWdpc3RlcldvcmtmbG93KHdvcmtmbG93KTtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHlpZWxkIChob3N0Lmludm9rZU1ldGhvZChcIndmXCIsIFwiZm9vXCIsIFs1XSkpO1xyXG5cclxuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdCwgMjUpO1xyXG5cclxuICAgICAgICAgICAgLy8gVmVyaWZ5IHByb21vdGVkUHJvcGVydGllczpcclxuICAgICAgICAgICAgaWYgKGhvc3RPcHRpb25zICYmIGhvc3RPcHRpb25zLnBlcnNpc3RlbmNlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcHJvbW90ZWRQcm9wZXJ0aWVzID0geWllbGQgKFByb21pc2UucmVzb2x2ZShob3N0T3B0aW9ucy5wZXJzaXN0ZW5jZS5sb2FkUHJvbW90ZWRQcm9wZXJ0aWVzKFwid2ZcIiwgNSkpKTtcclxuICAgICAgICAgICAgICAgIGFzc2VydC5vayhwcm9tb3RlZFByb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHByb21vdGVkUHJvcGVydGllcy52LCAyNSk7XHJcbiAgICAgICAgICAgICAgICBhc3NlcnQuZXF1YWwocHJvbW90ZWRQcm9wZXJ0aWVzLngsIDY2Nik7XHJcbiAgICAgICAgICAgICAgICBhc3NlcnQuZXF1YWwoXy5rZXlzKHByb21vdGVkUHJvcGVydGllcykubGVuZ3RoLCAyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmVzdWx0ID0geWllbGQgKGhvc3QuaW52b2tlTWV0aG9kKFwid2ZcIiwgXCJiYXJcIiwgWzVdKSk7XHJcblxyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0LCA1MCk7XHJcbiAgICAgICAgfSksXHJcblxyXG4gICAgZG9DYWxjdWxhdG9yVGVzdDogUHJvbWlzZS5jb3JvdXRpbmUoXHJcbiAgICAgICAgZnVuY3Rpb24qIChob3N0T3B0aW9ucykge1xyXG4gICAgICAgICAgICB2YXIgd29ya2Zsb3cgPSBhY3Rpdml0eU1hcmt1cC5wYXJzZShcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB3b3JrZmxvdzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcImNhbGN1bGF0b3JcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcnVubmluZzogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRBcmdzOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VmFsdWU6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb246IFwiIyB0aGlzLmdldCgncnVubmluZycpXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpY2s6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJBZGQgYmxvY2tcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiQWRkIG1ldGhvZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kTmFtZTogXCJhZGRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlSWRQYXRoOiBcIlswXS5pZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuQ3JlYXRlSW5zdGFuY2U6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkB0b1wiOiBcImlucHV0QXJnc1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWduOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogXCIjIHRoaXMuZ2V0KCdjdXJyZW50VmFsdWUnKSArIHRoaXMuZ2V0KCdpbnB1dEFyZ3MnKVswXS52YWx1ZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG86IFwiY3VycmVudFZhbHVlXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9jazoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiU3VidHJhY3QgYmxvY2tcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiU3VidHJhY3QgbWV0aG9kXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2ROYW1lOiBcInN1YnRyYWN0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZUlkUGF0aDogXCJbMF0uaWRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbkNyZWF0ZUluc3RhbmNlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJAdG9cIjogXCJpbnB1dEFyZ3NcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFwiIyB0aGlzLmdldCgnY3VycmVudFZhbHVlJykgLSB0aGlzLmdldCgnaW5wdXRBcmdzJylbMF0udmFsdWVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvOiBcImN1cnJlbnRWYWx1ZVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2s6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcIk11bHRpcGx5IGJsb2NrXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcIk11bHRpcGx5IG1ldGhvZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kTmFtZTogXCJtdWx0aXBseVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VJZFBhdGg6IFwiWzBdLmlkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5DcmVhdGVJbnN0YW5jZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQHRvXCI6IFwiaW5wdXRBcmdzXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBcIiMgdGhpcy5nZXQoJ2N1cnJlbnRWYWx1ZScpICogdGhpcy5nZXQoJ2lucHV0QXJncycpWzBdLnZhbHVlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bzogXCJjdXJyZW50VmFsdWVcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJEaXZpZGUgYmxvY2tcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiRGl2aWRlIG1ldGhvZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kTmFtZTogXCJkaXZpZGVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlSWRQYXRoOiBcIlswXS5pZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuQ3JlYXRlSW5zdGFuY2U6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkB0b1wiOiBcImlucHV0QXJnc1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWduOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogXCIjIHRoaXMuZ2V0KCdjdXJyZW50VmFsdWUnKSAvIHRoaXMuZ2V0KCdpbnB1dEFyZ3MnKVswXS52YWx1ZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG86IFwiY3VycmVudFZhbHVlXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcIkVxdWFscyBtZXRob2RcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZE5hbWU6IFwiZXF1YWxzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZUlkUGF0aDogXCJbMF0uaWRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbkNyZWF0ZUluc3RhbmNlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0OiBcIiMgdGhpcy5nZXQoJ2N1cnJlbnRWYWx1ZScpXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9jazoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiUmVzZXQgYmxvY2tcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiUmVzZXQgbWV0aG9kXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2ROYW1lOiBcInJlc2V0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZUlkUGF0aDogXCJbMF0uaWRcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG86IFwicnVubmluZ1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBob3N0ID0gbmV3IFdvcmtmbG93SG9zdChob3N0T3B0aW9ucyk7XHJcblxyXG4gICAgICAgICAgICBob3N0LnJlZ2lzdGVyV29ya2Zsb3cod29ya2Zsb3cpO1xyXG4gICAgICAgICAgICAvL2hvc3QuYWRkVHJhY2tlcihuZXcgQ29uc29sZVRyYWNrZXIoKSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgYXJnID0ge2lkOiBNYXRoLmZsb29yKChNYXRoLnJhbmRvbSgpICogMTAwMDAwMDAwMCkgKyAxKX07XHJcblxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0geWllbGQgKGhvc3QuaW52b2tlTWV0aG9kKFwiY2FsY3VsYXRvclwiLCBcImVxdWFsc1wiLCBbYXJnXSkpO1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0LCAwKTtcclxuXHJcbiAgICAgICAgICAgIGFyZy52YWx1ZSA9IDU1O1xyXG4gICAgICAgICAgICB5aWVsZCAoaG9zdC5pbnZva2VNZXRob2QoXCJjYWxjdWxhdG9yXCIsIFwiYWRkXCIsIFthcmddKSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoaG9zdE9wdGlvbnMgJiYgaG9zdE9wdGlvbnMucGVyc2lzdGVuY2UpIHtcclxuICAgICAgICAgICAgICAgIHZhciBob3N0ID0gbmV3IFdvcmtmbG93SG9zdChob3N0T3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICBob3N0LnJlZ2lzdGVyV29ya2Zsb3cod29ya2Zsb3cpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXN1bHQgPSB5aWVsZCAoaG9zdC5pbnZva2VNZXRob2QoXCJjYWxjdWxhdG9yXCIsIFwiZXF1YWxzXCIsIFthcmddKSk7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHQsIDU1KTtcclxuXHJcbiAgICAgICAgICAgIGFyZy52YWx1ZSA9IDU7XHJcbiAgICAgICAgICAgIHlpZWxkIChob3N0Lmludm9rZU1ldGhvZChcImNhbGN1bGF0b3JcIiwgXCJkaXZpZGVcIiwgW2FyZ10pKTtcclxuICAgICAgICAgICAgcmVzdWx0ID0geWllbGQgKGhvc3QuaW52b2tlTWV0aG9kKFwiY2FsY3VsYXRvclwiLCBcImVxdWFsc1wiLCBbYXJnXSkpO1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0LCAxMSk7XHJcblxyXG4gICAgICAgICAgICBhcmcudmFsdWUgPSAxO1xyXG4gICAgICAgICAgICB5aWVsZCAoaG9zdC5pbnZva2VNZXRob2QoXCJjYWxjdWxhdG9yXCIsIFwic3VidHJhY3RcIiwgW2FyZ10pKTtcclxuICAgICAgICAgICAgcmVzdWx0ID0geWllbGQgKGhvc3QuaW52b2tlTWV0aG9kKFwiY2FsY3VsYXRvclwiLCBcImVxdWFsc1wiLCBbYXJnXSkpO1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0LCAxMCk7XHJcblxyXG4gICAgICAgICAgICBhcmcudmFsdWUgPSAxMDA7XHJcbiAgICAgICAgICAgIHlpZWxkIChob3N0Lmludm9rZU1ldGhvZChcImNhbGN1bGF0b3JcIiwgXCJtdWx0aXBseVwiLCBbYXJnXSkpO1xyXG4gICAgICAgICAgICByZXN1bHQgPSB5aWVsZCAoaG9zdC5pbnZva2VNZXRob2QoXCJjYWxjdWxhdG9yXCIsIFwiZXF1YWxzXCIsIFthcmddKSk7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHQsIDEwMDApO1xyXG5cclxuICAgICAgICAgICAgZGVsZXRlIGFyZy52YWx1ZTtcclxuICAgICAgICAgICAgeWllbGQgKGhvc3QuaW52b2tlTWV0aG9kKFwiY2FsY3VsYXRvclwiLCBcInJlc2V0XCIsIFthcmddKSk7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IHlpZWxkIChob3N0Lmludm9rZU1ldGhvZChcImNhbGN1bGF0b3JcIiwgXCJlcXVhbHNcIiwgW2FyZ10pKTtcclxuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdCwgMCk7XHJcblxyXG4gICAgICAgICAgICBkZWxldGUgYXJnLnZhbHVlO1xyXG4gICAgICAgICAgICB5aWVsZCAoaG9zdC5pbnZva2VNZXRob2QoXCJjYWxjdWxhdG9yXCIsIFwicmVzZXRcIiwgW2FyZ10pKTtcclxuICAgICAgICB9KVxyXG59O1xyXG4iXX0=
