"use strict";
var wf4node = require("../../../");
var InstanceIdParser = wf4node.hosting.InstanceIdParser;
var _ = require("lodash");
var hostingTestCommon = require("./hostingTestCommon");
var MemoryPersistence = wf4node.hosting.MemoryPersistence;
var Serializer = require("backpack-node").system.Serializer;
var assert = require("assert");
describe("InstanceIdParser", function() {
  describe("parse()", function() {
    it("should understand common paths", function() {
      var p = new InstanceIdParser();
      assert.equal(p.parse("this", 1), 1);
      assert.equal(p.parse("[0]", [1]), 1);
      assert.equal(p.parse("[0]", [4, 5]), 4);
      assert.equal(p.parse("[1].id", [{id: 1}, {id: 2}]), 2);
      assert.equal(p.parse("id[0].a", {id: [{a: "foo"}]}), "foo");
    });
  });
});
describe("WorkflowHost", function() {
  this.timeout(60000);
  function getInfo(options) {
    return ("persistence: " + (options.persistence ? "on" : "off") + ", lazy: " + (options.lazyPersistence ? "yes" : "no") + ", serializer: " + (options.serializer ? "yes" : "no") + ", alwaysLoad: " + (options.alwaysLoadState ? "yes" : "no"));
  }
  function testBasic(options) {
    it("should run by: " + getInfo(options), function(done) {
      hostingTestCommon.doBasicHostTest(options).nodeify(done);
    });
  }
  function testCalc(options) {
    it("should run by: " + getInfo(options), function(done) {
      hostingTestCommon.doCalculatorTest(options).nodeify(done);
    });
  }
  function testDelayTo(options) {
    it("should run by: " + getInfo(options), function(done) {
      hostingTestCommon.doDelayTest(options).nodeify(done);
    });
  }
  function testStopOutdatedVersions(options) {
    it("should run by: " + getInfo(options), function(done) {
      hostingTestCommon.doStopOutdatedVersionsTest(options).nodeify(done);
    });
  }
  var allOptions = [{
    persistence: null,
    lazyPersistence: false,
    serializer: null,
    alwaysLoadState: false
  }, {
    persistence: new MemoryPersistence(),
    lazyPersistence: false,
    serializer: null,
    alwaysLoadState: false
  }, {
    persistence: new MemoryPersistence(),
    lazyPersistence: true,
    serializer: null,
    alwaysLoadState: false
  }, {
    persistence: new MemoryPersistence(),
    lazyPersistence: false,
    serializer: new Serializer(),
    alwaysLoadState: false
  }, {
    persistence: new MemoryPersistence(),
    lazyPersistence: true,
    serializer: new Serializer(),
    alwaysLoadState: false
  }, {
    persistence: new MemoryPersistence(),
    lazyPersistence: false,
    serializer: new Serializer(),
    alwaysLoadState: true
  }, {
    persistence: new MemoryPersistence(),
    lazyPersistence: true,
    serializer: new Serializer(),
    alwaysLoadState: true
  }];
  describe("Without Persistence and With Memory Persistence", function() {
    describe("Basic Example", function() {
      var $__5 = true;
      var $__6 = false;
      var $__7 = undefined;
      try {
        for (var $__3 = void 0,
            $__2 = (allOptions)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
          var opt = $__3.value;
          {
            testBasic(opt);
          }
        }
      } catch ($__8) {
        $__6 = true;
        $__7 = $__8;
      } finally {
        try {
          if (!$__5 && $__2.return != null) {
            $__2.return();
          }
        } finally {
          if ($__6) {
            throw $__7;
          }
        }
      }
    });
    describe("Calculator Example", function() {
      var $__5 = true;
      var $__6 = false;
      var $__7 = undefined;
      try {
        for (var $__3 = void 0,
            $__2 = (allOptions)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
          var opt = $__3.value;
          {
            testCalc(opt);
          }
        }
      } catch ($__8) {
        $__6 = true;
        $__7 = $__8;
      } finally {
        try {
          if (!$__5 && $__2.return != null) {
            $__2.return();
          }
        } finally {
          if ($__6) {
            throw $__7;
          }
        }
      }
    });
    describe("DelayTo Example", function() {
      var $__5 = true;
      var $__6 = false;
      var $__7 = undefined;
      try {
        for (var $__3 = void 0,
            $__2 = (allOptions)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
          var opt = $__3.value;
          {
            testDelayTo(opt);
          }
        }
      } catch ($__8) {
        $__6 = true;
        $__7 = $__8;
      } finally {
        try {
          if (!$__5 && $__2.return != null) {
            $__2.return();
          }
        } finally {
          if ($__6) {
            throw $__7;
          }
        }
      }
    });
    describe("StopOutdatedVersions Example", function() {
      var $__5 = true;
      var $__6 = false;
      var $__7 = undefined;
      try {
        for (var $__3 = void 0,
            $__2 = (allOptions)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
          var opt = $__3.value;
          {
            testStopOutdatedVersions(opt);
          }
        }
      } catch ($__8) {
        $__6 = true;
        $__7 = $__8;
      } finally {
        try {
          if (!$__5 && $__2.return != null) {
            $__2.return();
          }
        } finally {
          if ($__6) {
            throw $__7;
          }
        }
      }
    });
  });
});
//# sourceMappingURL=data:application/json;base64,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bGUiOiJob3N0aW5nL2NvcmVIb3N0aW5nVGVzdHMuanMiLCJzb3VyY2VSb290IjoidGVzdHMvZXM2Iiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qIGdsb2JhbCBkZXNjcmliZSxpdCAqL1xuXG5sZXQgd2Y0bm9kZSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9cIik7XG5sZXQgSW5zdGFuY2VJZFBhcnNlciA9IHdmNG5vZGUuaG9zdGluZy5JbnN0YW5jZUlkUGFyc2VyO1xubGV0IF8gPSByZXF1aXJlKFwibG9kYXNoXCIpO1xubGV0IGhvc3RpbmdUZXN0Q29tbW9uID0gcmVxdWlyZShcIi4vaG9zdGluZ1Rlc3RDb21tb25cIik7XG5sZXQgTWVtb3J5UGVyc2lzdGVuY2UgPSB3ZjRub2RlLmhvc3RpbmcuTWVtb3J5UGVyc2lzdGVuY2U7XG5sZXQgU2VyaWFsaXplciA9IHJlcXVpcmUoXCJiYWNrcGFjay1ub2RlXCIpLnN5c3RlbS5TZXJpYWxpemVyO1xuXG5sZXQgYXNzZXJ0ID0gcmVxdWlyZShcImFzc2VydFwiKTtcblxuZGVzY3JpYmUoXCJJbnN0YW5jZUlkUGFyc2VyXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBkZXNjcmliZShcInBhcnNlKClcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBpdChcInNob3VsZCB1bmRlcnN0YW5kIGNvbW1vbiBwYXRoc1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBsZXQgcCA9IG5ldyBJbnN0YW5jZUlkUGFyc2VyKCk7XG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwocC5wYXJzZShcInRoaXNcIiwgMSksIDEpO1xuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHAucGFyc2UoXCJbMF1cIiwgWzFdKSwgMSk7XG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwocC5wYXJzZShcIlswXVwiLCBbNCwgNV0pLCA0KTtcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChwLnBhcnNlKFwiWzFdLmlkXCIsIFt7IGlkOiAxIH0sIHsgaWQ6IDIgfV0pLCAyKTtcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChwLnBhcnNlKFwiaWRbMF0uYVwiLCB7IGlkOiBbeyBhOiBcImZvb1wiIH1dIH0pLCBcImZvb1wiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcblxuZGVzY3JpYmUoXCJXb3JrZmxvd0hvc3RcIiwgZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudGltZW91dCg2MDAwMCk7XG5cbiAgICBmdW5jdGlvbiBnZXRJbmZvKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIGBwZXJzaXN0ZW5jZTogJHtvcHRpb25zLnBlcnNpc3RlbmNlID8gXCJvblwiIDogXCJvZmZcIn0sIGxhenk6ICR7b3B0aW9ucy5sYXp5UGVyc2lzdGVuY2UgPyBcInllc1wiIDogXCJub1wifSwgc2VyaWFsaXplcjogJHtvcHRpb25zLnNlcmlhbGl6ZXIgPyBcInllc1wiIDogXCJub1wifSwgYWx3YXlzTG9hZDogJHtvcHRpb25zLmFsd2F5c0xvYWRTdGF0ZSA/IFwieWVzXCIgOiBcIm5vXCJ9YDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0ZXN0QmFzaWMob3B0aW9ucykge1xuICAgICAgICBpdChcInNob3VsZCBydW4gYnk6IFwiICsgZ2V0SW5mbyhvcHRpb25zKSwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgICAgIGhvc3RpbmdUZXN0Q29tbW9uLmRvQmFzaWNIb3N0VGVzdChvcHRpb25zKS5ub2RlaWZ5KGRvbmUpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0ZXN0Q2FsYyhvcHRpb25zKSB7XG4gICAgICAgIGl0KFwic2hvdWxkIHJ1biBieTogXCIgKyBnZXRJbmZvKG9wdGlvbnMpLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAgICAgaG9zdGluZ1Rlc3RDb21tb24uZG9DYWxjdWxhdG9yVGVzdChvcHRpb25zKS5ub2RlaWZ5KGRvbmUpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0ZXN0RGVsYXlUbyhvcHRpb25zKSB7XG4gICAgICAgIGl0KFwic2hvdWxkIHJ1biBieTogXCIgKyBnZXRJbmZvKG9wdGlvbnMpLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAgICAgaG9zdGluZ1Rlc3RDb21tb24uZG9EZWxheVRlc3Qob3B0aW9ucykubm9kZWlmeShkb25lKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdGVzdFN0b3BPdXRkYXRlZFZlcnNpb25zKG9wdGlvbnMpIHtcbiAgICAgICAgaXQoXCJzaG91bGQgcnVuIGJ5OiBcIiArIGdldEluZm8ob3B0aW9ucyksIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgICAgICBob3N0aW5nVGVzdENvbW1vbi5kb1N0b3BPdXRkYXRlZFZlcnNpb25zVGVzdChvcHRpb25zKS5ub2RlaWZ5KGRvbmUpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBsZXQgYWxsT3B0aW9ucyA9IFtcbiAgICAgICAge1xuICAgICAgICAgICAgcGVyc2lzdGVuY2U6IG51bGwsXG4gICAgICAgICAgICBsYXp5UGVyc2lzdGVuY2U6IGZhbHNlLFxuICAgICAgICAgICAgc2VyaWFsaXplcjogbnVsbCxcbiAgICAgICAgICAgIGFsd2F5c0xvYWRTdGF0ZTogZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgcGVyc2lzdGVuY2U6IG5ldyBNZW1vcnlQZXJzaXN0ZW5jZSgpLFxuICAgICAgICAgICAgbGF6eVBlcnNpc3RlbmNlOiBmYWxzZSxcbiAgICAgICAgICAgIHNlcmlhbGl6ZXI6IG51bGwsXG4gICAgICAgICAgICBhbHdheXNMb2FkU3RhdGU6IGZhbHNlXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIHBlcnNpc3RlbmNlOiBuZXcgTWVtb3J5UGVyc2lzdGVuY2UoKSxcbiAgICAgICAgICAgIGxhenlQZXJzaXN0ZW5jZTogdHJ1ZSxcbiAgICAgICAgICAgIHNlcmlhbGl6ZXI6IG51bGwsXG4gICAgICAgICAgICBhbHdheXNMb2FkU3RhdGU6IGZhbHNlXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIHBlcnNpc3RlbmNlOiBuZXcgTWVtb3J5UGVyc2lzdGVuY2UoKSxcbiAgICAgICAgICAgIGxhenlQZXJzaXN0ZW5jZTogZmFsc2UsXG4gICAgICAgICAgICBzZXJpYWxpemVyOiBuZXcgU2VyaWFsaXplcigpLFxuICAgICAgICAgICAgYWx3YXlzTG9hZFN0YXRlOiBmYWxzZVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBwZXJzaXN0ZW5jZTogbmV3IE1lbW9yeVBlcnNpc3RlbmNlKCksXG4gICAgICAgICAgICBsYXp5UGVyc2lzdGVuY2U6IHRydWUsXG4gICAgICAgICAgICBzZXJpYWxpemVyOiBuZXcgU2VyaWFsaXplcigpLFxuICAgICAgICAgICAgYWx3YXlzTG9hZFN0YXRlOiBmYWxzZVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBwZXJzaXN0ZW5jZTogbmV3IE1lbW9yeVBlcnNpc3RlbmNlKCksXG4gICAgICAgICAgICBsYXp5UGVyc2lzdGVuY2U6IGZhbHNlLFxuICAgICAgICAgICAgc2VyaWFsaXplcjogbmV3IFNlcmlhbGl6ZXIoKSxcbiAgICAgICAgICAgIGFsd2F5c0xvYWRTdGF0ZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBwZXJzaXN0ZW5jZTogbmV3IE1lbW9yeVBlcnNpc3RlbmNlKCksXG4gICAgICAgICAgICBsYXp5UGVyc2lzdGVuY2U6IHRydWUsXG4gICAgICAgICAgICBzZXJpYWxpemVyOiBuZXcgU2VyaWFsaXplcigpLFxuICAgICAgICAgICAgYWx3YXlzTG9hZFN0YXRlOiB0cnVlXG4gICAgICAgIH1cbiAgICBdO1xuXG4gICAgZGVzY3JpYmUoXCJXaXRob3V0IFBlcnNpc3RlbmNlIGFuZCBXaXRoIE1lbW9yeSBQZXJzaXN0ZW5jZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRlc2NyaWJlKFwiQmFzaWMgRXhhbXBsZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBvcHQgb2YgYWxsT3B0aW9ucykge1xuICAgICAgICAgICAgICAgIHRlc3RCYXNpYyhvcHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBkZXNjcmliZShcIkNhbGN1bGF0b3IgRXhhbXBsZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBvcHQgb2YgYWxsT3B0aW9ucykge1xuICAgICAgICAgICAgICAgIHRlc3RDYWxjKG9wdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKFwiRGVsYXlUbyBFeGFtcGxlXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGZvciAobGV0IG9wdCBvZiBhbGxPcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgdGVzdERlbGF5VG8ob3B0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoXCJTdG9wT3V0ZGF0ZWRWZXJzaW9ucyBFeGFtcGxlXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGZvciAobGV0IG9wdCBvZiBhbGxPcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgdGVzdFN0b3BPdXRkYXRlZFZlcnNpb25zKG9wdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4iXX0=
