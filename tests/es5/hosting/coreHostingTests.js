"use strict";
var wf4node = require("../../../");
var InstanceIdParser = wf4node.hosting.InstanceIdParser;
var _ = require("lodash");
var hostingTestCommon = require("./hostingTestCommon");
var MemoryPersistence = wf4node.hosting.MemoryPersistence;
var Serializer = require("backpack-node").system.Serializer;
var assert = require("assert");
describe("InstanceIdParser", function() {
  describe("parse()", function() {
    it("should understand common paths", function() {
      var p = new InstanceIdParser();
      assert.equal(p.parse("this", 1), 1);
      assert.equal(p.parse("[0]", [1]), 1);
      assert.equal(p.parse("[0]", [4, 5]), 4);
      assert.equal(p.parse("[1].id", [{id: 1}, {id: 2}]), 2);
      assert.equal(p.parse("id[0].a", {id: [{a: "foo"}]}), "foo");
    });
  });
});
describe("WorkflowHost", function() {
  this.timeout(5000);
  function getInfo(options) {
    return ("persistence: " + (options.persistence ? "on" : "off") + ", lazy: " + (options.lazyPersistence ? "yes" : "no") + ", serializer: " + (options.serializer ? "yes" : "no") + ", alwaysLoad: " + (options.alwaysLoadState ? "yes" : "no"));
  }
  function testBasic(options) {
    it("should run by: " + getInfo(options), function(done) {
      hostingTestCommon.doBasicHostTest(options).nodeify(done);
    });
  }
  function testCalc(options) {
    it("should run by: " + getInfo(options), function(done) {
      hostingTestCommon.doCalculatorTest(options).nodeify(done);
    });
  }
  function testDelayTo(options) {
    it("should run by: " + getInfo(options), function(done) {
      hostingTestCommon.doDelayTest(options).nodeify(done);
    });
  }
  var allOptions = [{
    persistence: null,
    lazyPersistence: false,
    serializer: null,
    alwaysLoadState: false
  }, {
    persistence: new MemoryPersistence(),
    lazyPersistence: false,
    serializer: null,
    alwaysLoadState: false
  }, {
    persistence: new MemoryPersistence(),
    lazyPersistence: true,
    serializer: null,
    alwaysLoadState: false
  }, {
    persistence: new MemoryPersistence(),
    lazyPersistence: false,
    serializer: new Serializer(),
    alwaysLoadState: false
  }, {
    persistence: new MemoryPersistence(),
    lazyPersistence: true,
    serializer: new Serializer(),
    alwaysLoadState: false
  }, {
    persistence: new MemoryPersistence(),
    lazyPersistence: false,
    serializer: new Serializer(),
    alwaysLoadState: true
  }, {
    persistence: new MemoryPersistence(),
    lazyPersistence: true,
    serializer: new Serializer(),
    alwaysLoadState: true
  }];
  describe("Without Persistence and With Memory Persistence", function() {
    describe("Basic Example", function() {
      var $__5 = true;
      var $__6 = false;
      var $__7 = undefined;
      try {
        for (var $__3 = void 0,
            $__2 = (allOptions)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
          var opt = $__3.value;
          {
            testBasic(opt);
          }
        }
      } catch ($__8) {
        $__6 = true;
        $__7 = $__8;
      } finally {
        try {
          if (!$__5 && $__2.return != null) {
            $__2.return();
          }
        } finally {
          if ($__6) {
            throw $__7;
          }
        }
      }
    });
    describe("Calculator Example", function() {
      var $__5 = true;
      var $__6 = false;
      var $__7 = undefined;
      try {
        for (var $__3 = void 0,
            $__2 = (allOptions)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
          var opt = $__3.value;
          {
            testCalc(opt);
          }
        }
      } catch ($__8) {
        $__6 = true;
        $__7 = $__8;
      } finally {
        try {
          if (!$__5 && $__2.return != null) {
            $__2.return();
          }
        } finally {
          if ($__6) {
            throw $__7;
          }
        }
      }
    });
    describe("DelayTo Example", function() {
      var $__5 = true;
      var $__6 = false;
      var $__7 = undefined;
      try {
        for (var $__3 = void 0,
            $__2 = (allOptions)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__5 = ($__3 = $__2.next()).done); $__5 = true) {
          var opt = $__3.value;
          {
            testDelayTo(opt);
          }
        }
      } catch ($__8) {
        $__6 = true;
        $__7 = $__8;
      } finally {
        try {
          if (!$__5 && $__2.return != null) {
            $__2.return();
          }
        } finally {
          if ($__6) {
            throw $__7;
          }
        }
      }
    });
  });
});
//# sourceMappingURL=data:application/json;base64,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b3JlSG9zdGluZ1Rlc3RzLmpzIiwic291cmNlUm9vdCI6InRlc3RzL2VzNiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG4vKiBnbG9iYWwgZGVzY3JpYmUsaXQgKi9cblxubGV0IHdmNG5vZGUgPSByZXF1aXJlKFwiLi4vLi4vLi4vXCIpO1xubGV0IEluc3RhbmNlSWRQYXJzZXIgPSB3ZjRub2RlLmhvc3RpbmcuSW5zdGFuY2VJZFBhcnNlcjtcbmxldCBfID0gcmVxdWlyZShcImxvZGFzaFwiKTtcbmxldCBob3N0aW5nVGVzdENvbW1vbiA9IHJlcXVpcmUoXCIuL2hvc3RpbmdUZXN0Q29tbW9uXCIpO1xubGV0IE1lbW9yeVBlcnNpc3RlbmNlID0gd2Y0bm9kZS5ob3N0aW5nLk1lbW9yeVBlcnNpc3RlbmNlO1xubGV0IFNlcmlhbGl6ZXIgPSByZXF1aXJlKFwiYmFja3BhY2stbm9kZVwiKS5zeXN0ZW0uU2VyaWFsaXplcjtcblxubGV0IGFzc2VydCA9IHJlcXVpcmUoXCJhc3NlcnRcIik7XG5cbmRlc2NyaWJlKFwiSW5zdGFuY2VJZFBhcnNlclwiLCBmdW5jdGlvbiAoKSB7XG4gICAgZGVzY3JpYmUoXCJwYXJzZSgpXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaXQoXCJzaG91bGQgdW5kZXJzdGFuZCBjb21tb24gcGF0aHNcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbGV0IHAgPSBuZXcgSW5zdGFuY2VJZFBhcnNlcigpO1xuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHAucGFyc2UoXCJ0aGlzXCIsIDEpLCAxKTtcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChwLnBhcnNlKFwiWzBdXCIsIFsxXSksIDEpO1xuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHAucGFyc2UoXCJbMF1cIiwgWzQsIDVdKSwgNCk7XG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwocC5wYXJzZShcIlsxXS5pZFwiLCBbeyBpZDogMSB9LCB7IGlkOiAyIH1dKSwgMik7XG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwocC5wYXJzZShcImlkWzBdLmFcIiwgeyBpZDogW3sgYTogXCJmb29cIiB9XSB9KSwgXCJmb29cIik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG5cbmRlc2NyaWJlKFwiV29ya2Zsb3dIb3N0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnRpbWVvdXQoNTAwMCk7XG5cbiAgICBmdW5jdGlvbiBnZXRJbmZvKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIGBwZXJzaXN0ZW5jZTogJHtvcHRpb25zLnBlcnNpc3RlbmNlID8gXCJvblwiIDogXCJvZmZcIn0sIGxhenk6ICR7b3B0aW9ucy5sYXp5UGVyc2lzdGVuY2UgPyBcInllc1wiIDogXCJub1wifSwgc2VyaWFsaXplcjogJHtvcHRpb25zLnNlcmlhbGl6ZXIgPyBcInllc1wiIDogXCJub1wifSwgYWx3YXlzTG9hZDogJHtvcHRpb25zLmFsd2F5c0xvYWRTdGF0ZSA/IFwieWVzXCIgOiBcIm5vXCJ9YDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0ZXN0QmFzaWMob3B0aW9ucykge1xuICAgICAgICBpdChcInNob3VsZCBydW4gYnk6IFwiICsgZ2V0SW5mbyhvcHRpb25zKSwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgICAgIGhvc3RpbmdUZXN0Q29tbW9uLmRvQmFzaWNIb3N0VGVzdChvcHRpb25zKS5ub2RlaWZ5KGRvbmUpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0ZXN0Q2FsYyhvcHRpb25zKSB7XG4gICAgICAgIGl0KFwic2hvdWxkIHJ1biBieTogXCIgKyBnZXRJbmZvKG9wdGlvbnMpLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAgICAgaG9zdGluZ1Rlc3RDb21tb24uZG9DYWxjdWxhdG9yVGVzdChvcHRpb25zKS5ub2RlaWZ5KGRvbmUpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0ZXN0RGVsYXlUbyhvcHRpb25zKSB7XG4gICAgICAgIGl0KFwic2hvdWxkIHJ1biBieTogXCIgKyBnZXRJbmZvKG9wdGlvbnMpLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAgICAgaG9zdGluZ1Rlc3RDb21tb24uZG9EZWxheVRlc3Qob3B0aW9ucykubm9kZWlmeShkb25lKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbGV0IGFsbE9wdGlvbnMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIHBlcnNpc3RlbmNlOiBudWxsLFxuICAgICAgICAgICAgbGF6eVBlcnNpc3RlbmNlOiBmYWxzZSxcbiAgICAgICAgICAgIHNlcmlhbGl6ZXI6IG51bGwsXG4gICAgICAgICAgICBhbHdheXNMb2FkU3RhdGU6IGZhbHNlXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIHBlcnNpc3RlbmNlOiBuZXcgTWVtb3J5UGVyc2lzdGVuY2UoKSxcbiAgICAgICAgICAgIGxhenlQZXJzaXN0ZW5jZTogZmFsc2UsXG4gICAgICAgICAgICBzZXJpYWxpemVyOiBudWxsLFxuICAgICAgICAgICAgYWx3YXlzTG9hZFN0YXRlOiBmYWxzZVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBwZXJzaXN0ZW5jZTogbmV3IE1lbW9yeVBlcnNpc3RlbmNlKCksXG4gICAgICAgICAgICBsYXp5UGVyc2lzdGVuY2U6IHRydWUsXG4gICAgICAgICAgICBzZXJpYWxpemVyOiBudWxsLFxuICAgICAgICAgICAgYWx3YXlzTG9hZFN0YXRlOiBmYWxzZVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBwZXJzaXN0ZW5jZTogbmV3IE1lbW9yeVBlcnNpc3RlbmNlKCksXG4gICAgICAgICAgICBsYXp5UGVyc2lzdGVuY2U6IGZhbHNlLFxuICAgICAgICAgICAgc2VyaWFsaXplcjogbmV3IFNlcmlhbGl6ZXIoKSxcbiAgICAgICAgICAgIGFsd2F5c0xvYWRTdGF0ZTogZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgcGVyc2lzdGVuY2U6IG5ldyBNZW1vcnlQZXJzaXN0ZW5jZSgpLFxuICAgICAgICAgICAgbGF6eVBlcnNpc3RlbmNlOiB0cnVlLFxuICAgICAgICAgICAgc2VyaWFsaXplcjogbmV3IFNlcmlhbGl6ZXIoKSxcbiAgICAgICAgICAgIGFsd2F5c0xvYWRTdGF0ZTogZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgcGVyc2lzdGVuY2U6IG5ldyBNZW1vcnlQZXJzaXN0ZW5jZSgpLFxuICAgICAgICAgICAgbGF6eVBlcnNpc3RlbmNlOiBmYWxzZSxcbiAgICAgICAgICAgIHNlcmlhbGl6ZXI6IG5ldyBTZXJpYWxpemVyKCksXG4gICAgICAgICAgICBhbHdheXNMb2FkU3RhdGU6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgcGVyc2lzdGVuY2U6IG5ldyBNZW1vcnlQZXJzaXN0ZW5jZSgpLFxuICAgICAgICAgICAgbGF6eVBlcnNpc3RlbmNlOiB0cnVlLFxuICAgICAgICAgICAgc2VyaWFsaXplcjogbmV3IFNlcmlhbGl6ZXIoKSxcbiAgICAgICAgICAgIGFsd2F5c0xvYWRTdGF0ZTogdHJ1ZVxuICAgICAgICB9XG4gICAgXTtcblxuICAgIGRlc2NyaWJlKFwiV2l0aG91dCBQZXJzaXN0ZW5jZSBhbmQgV2l0aCBNZW1vcnkgUGVyc2lzdGVuY2VcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBkZXNjcmliZShcIkJhc2ljIEV4YW1wbGVcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZm9yIChsZXQgb3B0IG9mIGFsbE9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICB0ZXN0QmFzaWMob3B0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoXCJDYWxjdWxhdG9yIEV4YW1wbGVcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZm9yIChsZXQgb3B0IG9mIGFsbE9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICB0ZXN0Q2FsYyhvcHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBkZXNjcmliZShcIkRlbGF5VG8gRXhhbXBsZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBvcHQgb2YgYWxsT3B0aW9ucykge1xuICAgICAgICAgICAgICAgIHRlc3REZWxheVRvKG9wdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4iXX0=
